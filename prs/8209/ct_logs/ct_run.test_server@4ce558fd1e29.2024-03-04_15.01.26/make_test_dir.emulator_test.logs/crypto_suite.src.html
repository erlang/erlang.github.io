<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/></meta>
<title>/buildroot/otp/erts/emulator/make_test_dir/emulator_test/crypto_SUITE.erl</title>
</head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
<a name="1"/>    1: <i>%%</i>
<a name="2"/>    2: <i>%% %CopyrightBegin%</i>
<a name="3"/>    3: <i>%% </i>
<a name="4"/>    4: <i>%% Copyright Ericsson AB 1999-2016. All Rights Reserved.</i>
<a name="5"/>    5: <i>%% </i>
<a name="6"/>    6: <i>%% Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</i>
<a name="7"/>    7: <i>%% you may not use this file except in compliance with the License.</i>
<a name="8"/>    8: <i>%% You may obtain a copy of the License at</i>
<a name="9"/>    9: <i>%%</i>
<a name="10"/>   10: <i>%%     http://www.apache.org/licenses/LICENSE-2.0</i>
<a name="11"/>   11: <i>%%</i>
<a name="12"/>   12: <i>%% Unless required by applicable law or agreed to in writing, software</i>
<a name="13"/>   13: <i>%% distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</i>
<a name="14"/>   14: <i>%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</i>
<a name="15"/>   15: <i>%% See the License for the specific language governing permissions and</i>
<a name="16"/>   16: <i>%% limitations under the License.</i>
<a name="17"/>   17: <i>%% </i>
<a name="18"/>   18: <i>%% %CopyrightEnd%</i>
<a name="19"/>   19: <i>%%</i>
<a name="20"/>   20: 
<a name="21"/>   21: <b>-module</b>(crypto_SUITE).
<a name="22"/>   22: 
<a name="23"/>   23: <b>-include_lib</b>(&quot;common_test/include/ct.hrl&quot;).
<a name="24"/>   24: 
<a name="25"/>   25: <b>-export</b>([all/0, suite/0,
<a name="26"/>   26:          t_md5/1,t_md5_update/1,error/1,unaligned_context/1,random_lists/1,
<a name="27"/>   27:          misc_errors/1]).
<a name="28"/>   28: 
<a name="suite-0"/><a name="29"/>   29: <b>suite</b>() -&gt;
<a name="suite-last_expr"/><a name="30"/>   30:     [{ct_hooks,[ts_install_cth]}].
<a name="31"/>   31: 
<a name="all-0"/><a name="32"/>   32: <b>all</b>() -&gt; 
<a name="all-last_expr"/><a name="33"/>   33:     [t_md5, t_md5_update, error, unaligned_context,
<a name="34"/>   34:      random_lists, misc_errors].
<a name="35"/>   35: 
<a name="36"/>   36: <i>%% Test crc32, adler32 and md5 error cases not covered by other tests&quot;</i>
<a name="misc_errors-1"/><a name="37"/>   37: <b>misc_errors</b>(Config) when is_list(Config) -&gt;
<a name="38"/>   38:     ct:timetrap({minutes, 2}),
<a name="39"/>   39:     1 = erlang:adler32([]),
<a name="40"/>   40:     L = lists:duplicate(600,3),
<a name="41"/>   41:     1135871753 = erlang:adler32(L),
<a name="42"/>   42:     L2 = lists:duplicate(22000,3),
<a name="43"/>   43:     1100939744 = erlang:adler32(L2),
<a name="44"/>   44:     {'EXIT', {badarg,_}} = (catch erlang:adler32(L++[a])),
<a name="45"/>   45:     {'EXIT', {badarg,_}} = (catch erlang:crc32(L++[a])),
<a name="46"/>   46:     {'EXIT', {badarg,_}} = (catch erlang:crc32([1,2,3|&lt;&lt;25:7&gt;&gt;])),
<a name="47"/>   47:     {'EXIT', {badarg,_}} = (catch erlang:crc32([1,2,3|4])),
<a name="48"/>   48:     Big = 111111111111111111111111111111,
<a name="49"/>   49:     {'EXIT', {badarg,_}} = (catch erlang:crc32(Big,&lt;&lt;&quot;hej&quot;&gt;&gt;)),
<a name="50"/>   50:     {'EXIT', {badarg,_}} = (catch erlang:crc32(25,[1,2,3|4])),
<a name="51"/>   51:     {'EXIT', {badarg,_}} = (catch erlang:crc32_combine(Big,3,3)),
<a name="52"/>   52:     {'EXIT', {badarg,_}} = (catch erlang:crc32_combine(3,Big,3)),
<a name="53"/>   53:     {'EXIT', {badarg,_}} = (catch erlang:crc32_combine(3,3,Big)),
<a name="54"/>   54:     {'EXIT', {badarg,_}} = (catch erlang:adler32(Big,&lt;&lt;&quot;hej&quot;&gt;&gt;)),
<a name="55"/>   55:     {'EXIT', {badarg,_}} = (catch erlang:adler32(25,[1,2,3|4])),
<a name="56"/>   56:     {'EXIT', {badarg,_}} = (catch erlang:adler32_combine(Big,3,3)),
<a name="57"/>   57:     {'EXIT', {badarg,_}} = (catch erlang:adler32_combine(3,Big,3)),
<a name="58"/>   58:     {'EXIT', {badarg,_}} = (catch erlang:adler32_combine(3,3,Big)),
<a name="59"/>   59:     {'EXIT', {badarg,_}} = (catch erlang:md5_update(&lt;&lt;&quot;hej&quot;&gt;&gt;,&lt;&lt;&quot;hej&quot;&gt;&gt;)),
<a name="60"/>   60:     {'EXIT', {badarg,_}} = (catch erlang:md5_final(&lt;&lt;&quot;hej&quot;&gt;&gt;)),
<a name="misc_errors-last_expr"/><a name="61"/>   61:     ok.
<a name="62"/>   62: 
<a name="63"/>   63: 
<a name="64"/>   64: <i>%%</i>
<a name="65"/>   65: <i>%% Most of the real code for these test cases are in </i>
<a name="66"/>   66: <i>%% the modules crypto_reference and random_iolist.</i>
<a name="67"/>   67: <i>%%</i>
<a name="68"/>   68: <b>-define</b>(REF,crypto_reference).
<a name="69"/>   69: 
<a name="nicesplit-2"/><a name="70"/>   70: <b>nicesplit</b>(N,L) -&gt;
<a name="nicesplit-last_expr"/><a name="71"/>   71: <b>    nicesplit</b>(N,L,[]).
<a name="nicesplit-3"/><a name="72"/>   72: <b>nicesplit</b>(0,Tail,Acc) -&gt;
<a name="73"/>   73:     {lists:reverse(Acc),Tail};
<a name="74"/>   74: <b>nicesplit</b>(_,[],Acc) -&gt;
<a name="75"/>   75:     {lists:reverse(Acc),[]};
<a name="76"/>   76: <b>nicesplit</b>(N,[H|Tail],Acc) -&gt;
<a name="nicesplit-last_expr"/><a name="77"/>   77: <b>    nicesplit</b>(N-1,Tail,[H|Acc]).
<a name="78"/>   78: 
<a name="run_in_para-2"/><a name="79"/>   79: <b>run_in_para</b>([],_) -&gt;
<a name="80"/>   80:     true;
<a name="81"/>   81: <b>run_in_para</b>(FunList,Schedulers) -&gt;
<a name="82"/>   82:     {ThisTime,NextTime} = nicesplit(Schedulers,FunList),
<a name="83"/>   83:     case length(ThisTime) of 
<a name="84"/>   84:         1 -&gt;
<a name="85"/>   85:             [{L,Fun}] = ThisTime,
<a name="86"/>   86:             try
<a name="87"/>   87:                 Fun()
<a name="88"/>   88:             catch
<a name="89"/>   89:                 _:Reason -&gt;
<a name="90"/>   90:                     exit({error_at_line,L,Reason})
<a name="91"/>   91:             end;
<a name="92"/>   92:         _ -&gt;
<a name="93"/>   93:             These = [ {L,erlang:spawn_monitor(F)} || {L,F} &lt;- ThisTime ],
<a name="94"/>   94:             collect_workers(These)
<a name="95"/>   95:     end,
<a name="run_in_para-last_expr"/><a name="96"/>   96: <b>    run_in_para</b>(NextTime,Schedulers).
<a name="97"/>   97: 
<a name="collect_workers-1"/><a name="98"/>   98: <b>collect_workers</b>([]) -&gt;
<a name="99"/>   99:     ok;
<a name="100"/>  100: <b>collect_workers</b>([{L,{Pid,Ref}}|T]) -&gt;
<a name="collect_workers-last_expr"/><a name="101"/>  101:     receive
<a name="102"/>  102:         {'DOWN',Ref,process,Pid,normal} -&gt;
<a name="103"/>  103:             collect_workers(T);
<a name="104"/>  104:         {'DOWN',Ref,process,Pid,Other} -&gt;
<a name="105"/>  105:             exit({error_at_line,L,Other})
<a name="106"/>  106:     end.
<a name="107"/>  107: 
<a name="108"/>  108: <i>%% Test crc32, adler32 and md5 on a number of pseudo-randomly generated lists.</i>
<a name="random_lists-1"/><a name="109"/>  109: <b>random_lists</b>(Config) when is_list(Config) -&gt;
<a name="110"/>  110:     ct:timetrap({minutes, 5}),
<a name="111"/>  111:     Num = erlang:system_info(schedulers_online),
<a name="112"/>  112:     B = list_to_binary(
<a name="113"/>  113:           lists:duplicate(
<a name="114"/>  114:             (erlang:system_info(context_reductions)*10) - 50,$!)),
<a name="115"/>  115:     CRC32_1 = fun(L) -&gt; erlang:crc32(L) end,
<a name="116"/>  116:     CRC32_2 = fun(L) -&gt; ?REF:crc32(L) end,
<a name="117"/>  117:     ADLER32_1 = fun(L) -&gt; erlang:adler32(L) end,
<a name="118"/>  118:     ADLER32_2 = fun(L) -&gt; ?REF:adler32(L) end,
<a name="119"/>  119:     MD5_1 = fun(L) -&gt; erlang:md5(L) end,
<a name="120"/>  120:     MD5_2 = fun(L) -&gt; ?REF:md5_final(
<a name="121"/>  121:                          ?REF:md5_update(?REF:md5_init(),L)) end,
<a name="122"/>  122:     MD5_3 =  fun(L) -&gt; erlang:md5_final(
<a name="123"/>  123:                          erlang:md5_update(erlang:md5_init(),L)) end,
<a name="124"/>  124:     CRC32_1_L = fun(L) -&gt; erlang:crc32([B|L]) end,
<a name="125"/>  125:     CRC32_2_L = fun(L) -&gt; ?REF:crc32([B|L]) end,
<a name="126"/>  126:     ADLER32_1_L = fun(L) -&gt; erlang:adler32([B|L]) end,
<a name="127"/>  127:     ADLER32_2_L = fun(L) -&gt; ?REF:adler32([B|L]) end,
<a name="128"/>  128:     MD5_1_L = fun(L) -&gt; erlang:md5([B|L]) end,
<a name="129"/>  129:     MD5_2_L = fun(L) -&gt; ?REF:md5_final(
<a name="130"/>  130:                            ?REF:md5_update(?REF:md5_init(),[B|L])) end,
<a name="131"/>  131:     MD5_3_L =  fun(L) -&gt; erlang:md5_final(
<a name="132"/>  132:                            erlang:md5_update(
<a name="133"/>  133:                              erlang:md5_init(),[B|L])) end,
<a name="134"/>  134:     Wlist0 = 
<a name="135"/>  135:     [{?LINE, fun() -&gt; random_iolist:run(150, CRC32_1, CRC32_2) end},
<a name="136"/>  136:      {?LINE, fun() -&gt; random_iolist:run(150, ADLER32_1, ADLER32_2) end},
<a name="137"/>  137:      {?LINE, fun() -&gt; random_iolist:run(150,MD5_1,MD5_2) end},
<a name="138"/>  138:      {?LINE, fun() -&gt; random_iolist:run(150,MD5_1,MD5_3) end},
<a name="139"/>  139:      {?LINE, fun() -&gt; random_iolist:run(150, CRC32_1_L, CRC32_2_L) end},
<a name="140"/>  140:      {?LINE, 
<a name="141"/>  141:       fun() -&gt; random_iolist:run(150, ADLER32_1_L, ADLER32_2_L) end},
<a name="142"/>  142:      {?LINE, fun() -&gt; random_iolist:run(150,MD5_1_L,MD5_2_L) end},
<a name="143"/>  143:      {?LINE, fun() -&gt; random_iolist:run(150,MD5_1_L,MD5_3_L) end}],
<a name="144"/>  144:     run_in_para(Wlist0,Num),
<a name="145"/>  145:     CRC32_1_2 = fun(L1,L2) -&gt; erlang:crc32([L1,L2]) end,
<a name="146"/>  146:     CRC32_2_2 = fun(L1,L2) -&gt; erlang:crc32(erlang:crc32(L1),L2) end,
<a name="147"/>  147:     CRC32_3_2 = fun(L1,L2) -&gt; erlang:crc32_combine(
<a name="148"/>  148:                                 erlang:crc32(L1),
<a name="149"/>  149:                                 erlang:crc32(L2),
<a name="150"/>  150:                                 erlang:iolist_size(L2)) 
<a name="151"/>  151:                 end,
<a name="152"/>  152:     ADLER32_1_2 = fun(L1,L2) -&gt; erlang:adler32([L1,L2]) end,
<a name="153"/>  153:     ADLER32_2_2 = fun(L1,L2) -&gt; erlang:adler32(
<a name="154"/>  154:                                   erlang:adler32(L1),L2) end,
<a name="155"/>  155:     ADLER32_3_2 = fun(L1,L2) -&gt; erlang:adler32_combine(
<a name="156"/>  156:                                   erlang:adler32(L1),
<a name="157"/>  157:                                   erlang:adler32(L2),
<a name="158"/>  158:                                   erlang:iolist_size(L2)) 
<a name="159"/>  159:                   end,
<a name="160"/>  160:     MD5_1_2 = fun(L1,L2) -&gt; erlang:md5([L1,L2]) end,
<a name="161"/>  161:     MD5_2_2 = fun(L1,L2) -&gt; 
<a name="162"/>  162:                       erlang:md5_final(
<a name="163"/>  163:                         erlang:md5_update(
<a name="164"/>  164:                           erlang:md5_update(
<a name="165"/>  165:                             erlang:md5_init(),
<a name="166"/>  166:                             L1),
<a name="167"/>  167:                           L2)) 
<a name="168"/>  168:               end,
<a name="169"/>  169:     CRC32_1_L_2 = fun(L1,L2) -&gt; erlang:crc32([[B|L1],[B|L2]]) end,
<a name="170"/>  170:     CRC32_2_L_2 = fun(L1,L2) -&gt; erlang:crc32(
<a name="171"/>  171:                                   erlang:crc32([B|L1]),[B|L2]) end,
<a name="172"/>  172:     CRC32_3_L_2 = fun(L1,L2) -&gt; erlang:crc32_combine(
<a name="173"/>  173:                                   erlang:crc32([B|L1]),
<a name="174"/>  174:                                   erlang:crc32([B|L2]),
<a name="175"/>  175:                                   erlang:iolist_size([B|L2])) 
<a name="176"/>  176:                   end,
<a name="177"/>  177:     ADLER32_1_L_2 = fun(L1,L2) -&gt; erlang:adler32([[B|L1],[B|L2]]) end,
<a name="178"/>  178:     ADLER32_2_L_2 = fun(L1,L2) -&gt; erlang:adler32(
<a name="179"/>  179:                                     erlang:adler32([B|L1]),
<a name="180"/>  180:                                     [B|L2]) 
<a name="181"/>  181:                     end,
<a name="182"/>  182:     ADLER32_3_L_2 = fun(L1,L2) -&gt; erlang:adler32_combine(
<a name="183"/>  183:                                     erlang:adler32([B|L1]),
<a name="184"/>  184:                                     erlang:adler32([B|L2]),
<a name="185"/>  185:                                     erlang:iolist_size([B|L2])) 
<a name="186"/>  186:                     end,
<a name="187"/>  187:     MD5_1_L_2 = fun(L1,L2) -&gt; erlang:md5([[B|L1],[B|L2]]) end,
<a name="188"/>  188:     MD5_2_L_2 = fun(L1,L2) -&gt; 
<a name="189"/>  189:                         erlang:md5_final(
<a name="190"/>  190:                           erlang:md5_update(
<a name="191"/>  191:                             erlang:md5_update(
<a name="192"/>  192:                               erlang:md5_init(),
<a name="193"/>  193:                               [B|L1]),
<a name="194"/>  194:                             [B|L2])) 
<a name="195"/>  195:                 end,
<a name="196"/>  196:     Wlist1 = 
<a name="197"/>  197:     [{?LINE, fun() -&gt; random_iolist:run2(150,CRC32_1_2,CRC32_2_2) end},
<a name="198"/>  198:      {?LINE, fun() -&gt; random_iolist:run2(150,CRC32_1_2,CRC32_3_2) end},
<a name="199"/>  199:      {?LINE, fun() -&gt; random_iolist:run2(150,ADLER32_1_2,ADLER32_2_2) end},
<a name="200"/>  200:      {?LINE, fun() -&gt; random_iolist:run2(150,ADLER32_1_2,ADLER32_3_2) end},
<a name="201"/>  201:      {?LINE, fun() -&gt; random_iolist:run2(150,MD5_1_2,MD5_2_2) end},
<a name="202"/>  202:      {?LINE, fun() -&gt; random_iolist:run2(150,CRC32_1_L_2,CRC32_2_L_2) end},
<a name="203"/>  203:      {?LINE, fun() -&gt; random_iolist:run2(150,CRC32_1_L_2,CRC32_3_L_2) end},
<a name="204"/>  204:      {?LINE, 
<a name="205"/>  205:       fun() -&gt; random_iolist:run2(150,ADLER32_1_L_2,ADLER32_2_L_2) end},
<a name="206"/>  206:      {?LINE, 
<a name="207"/>  207:       fun() -&gt; random_iolist:run2(150,ADLER32_1_L_2,ADLER32_3_L_2) end},
<a name="208"/>  208:      {?LINE, fun() -&gt; random_iolist:run2(150,MD5_1_L_2,MD5_2_L_2) end}],
<a name="209"/>  209:     run_in_para(Wlist1,Num),
<a name="random_lists-last_expr"/><a name="210"/>  210:     ok.
<a name="211"/>  211: 
<a name="212"/>  212: <i>%% Generate MD5 message digests and check the result. Examples are from RFC-1321.</i>
<a name="t_md5-1"/><a name="213"/>  213: <b>t_md5</b>(Config) when is_list(Config) -&gt;
<a name="214"/>  214:     t_md5_test(&quot;&quot;, &quot;d41d8cd98f00b204e9800998ecf8427e&quot;),
<a name="215"/>  215:     t_md5_test(&quot;a&quot;, &quot;0cc175b9c0f1b6a831c399e269772661&quot;),
<a name="216"/>  216:     t_md5_test(&quot;abc&quot;, &quot;900150983cd24fb0d6963f7d28e17f72&quot;),
<a name="217"/>  217:     t_md5_test([&quot;message &quot;,&quot;digest&quot;], &quot;f96b697d7cb7938d525a2f31aaf161d0&quot;),
<a name="218"/>  218:     t_md5_test([&quot;message &quot;,unaligned_sub_bin(&lt;&lt;&quot;digest&quot;&gt;&gt;)],
<a name="219"/>  219:                &quot;f96b697d7cb7938d525a2f31aaf161d0&quot;),
<a name="220"/>  220:     t_md5_test(&quot;abcdefghijklmnopqrstuvwxyz&quot;,
<a name="221"/>  221:                &quot;c3fcd3d76192e4007dfb496cca67e13b&quot;),
<a name="222"/>  222:     t_md5_test(&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;
<a name="223"/>  223:                &quot;0123456789&quot;,
<a name="224"/>  224:                &quot;d174ab98d277d9f5a5611c2c9f419d9f&quot;),
<a name="225"/>  225:     t_md5_test(&quot;12345678901234567890123456789012345678901234567890&quot;
<a name="226"/>  226:                &quot;123456789012345678901234567890&quot;,
<a name="227"/>  227:                &quot;57edf4a22be3c955ac49da2e2107b67a&quot;),
<a name="t_md5-last_expr"/><a name="228"/>  228:     ok.
<a name="229"/>  229: 
<a name="230"/>  230: <i>%% Generate MD5 message using md5_init, md5_update, and md5_final, and</i>
<a name="231"/>  231: <i>%% check the result. Examples are from RFC-1321.</i>
<a name="t_md5_update-1"/><a name="232"/>  232: <b>t_md5_update</b>(Config) when is_list(Config) -&gt;
<a name="233"/>  233:     t_md5_update_1(fun(Str) -&gt; Str end),
<a name="234"/>  234:     t_md5_update_1(fun(Str) -&gt; list_to_binary(Str) end),
<a name="235"/>  235:     t_md5_update_1(fun(Str) -&gt; unaligned_sub_bin(list_to_binary(Str)) end),
<a name="t_md5_update-last_expr"/><a name="236"/>  236:     ok.
<a name="237"/>  237: 
<a name="t_md5_update_1-1"/><a name="238"/>  238: <b>t_md5_update_1</b>(Tr) when is_function(Tr, 1) -&gt;
<a name="239"/>  239:     Ctx = erlang:md5_init(),
<a name="240"/>  240:     Ctx1 = erlang:md5_update(Ctx, Tr(&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;)),
<a name="241"/>  241:     Ctx2 = erlang:md5_update(Ctx1, Tr(&quot;abcdefghijklmnopqrstuvwxyz&quot;
<a name="242"/>  242:                                       &quot;0123456789&quot;)),
<a name="243"/>  243:     m(erlang:md5_final(Ctx2),
<a name="244"/>  244:       hexstr2bin(&quot;d174ab98d277d9f5a5611c2c9f419d9f&quot;)),
<a name="t_md5_update_1-last_expr"/><a name="245"/>  245:     ok.
<a name="246"/>  246: 
<a name="247"/>  247: <i>%%</i>
<a name="248"/>  248: <i>%%</i>
<a name="error-1"/><a name="249"/>  249: <b>error</b>(Config) when is_list(Config) -&gt;
<a name="250"/>  250:     {'EXIT',{badarg,_}} = (catch erlang:md5(bit_sized_binary(&lt;&lt;&quot;abc&quot;&gt;&gt;))),
<a name="251"/>  251:     Ctx0 = erlang:md5_init(),
<a name="252"/>  252:     {'EXIT',{badarg,_}} =
<a name="253"/>  253:     (catch erlang:md5_update(Ctx0, bit_sized_binary(&lt;&lt;&quot;abcfjldjd&quot;&gt;&gt;))),
<a name="254"/>  254:     {'EXIT',{badarg,_}} =
<a name="255"/>  255:     (catch erlang:md5_update(Ctx0, [&quot;something&quot;,bit_sized_binary(&lt;&lt;&quot;abcfjldjd&quot;&gt;&gt;)])),
<a name="256"/>  256:     {'EXIT',{badarg,_}} =
<a name="257"/>  257:     (catch erlang:md5_update(bit_sized_binary(Ctx0), &quot;something&quot;)),
<a name="258"/>  258:     {'EXIT',{badarg,_}} = (catch erlang:md5_final(bit_sized_binary(Ctx0))),
<a name="259"/>  259:     m(erlang:md5_final(Ctx0), hexstr2bin(&quot;d41d8cd98f00b204e9800998ecf8427e&quot;)),
<a name="error-last_expr"/><a name="260"/>  260:     ok.
<a name="261"/>  261: 
<a name="262"/>  262: 
<a name="263"/>  263: <i>%%</i>
<a name="264"/>  264: <i>%%</i>
<a name="unaligned_context-1"/><a name="265"/>  265: <b>unaligned_context</b>(Config) when is_list(Config) -&gt;
<a name="266"/>  266:     Ctx0 = erlang:md5_init(),
<a name="267"/>  267:     Ctx1 = erlang:md5_update(unaligned_sub_bin(Ctx0), &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;),
<a name="268"/>  268:     Ctx = erlang:md5_update(unaligned_sub_bin(Ctx1),
<a name="269"/>  269:                             &quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;),
<a name="270"/>  270:     m(erlang:md5_final(unaligned_sub_bin(Ctx)),
<a name="271"/>  271:       hexstr2bin(&quot;d174ab98d277d9f5a5611c2c9f419d9f&quot;)),
<a name="unaligned_context-last_expr"/><a name="272"/>  272:     ok.
<a name="273"/>  273: 
<a name="274"/>  274: <i>%%</i>
<a name="275"/>  275: <i>%% Help functions</i>
<a name="276"/>  276: <i>%%</i>
<a name="277"/>  277: 
<a name="t_md5_test-2"/><a name="278"/>  278: <b>t_md5_test</b>(Str, ResultStr) -&gt;
<a name="279"/>  279:     ResultBin = hexstr2bin(ResultStr),
<a name="280"/>  280:     m(erlang:md5(Str), ResultBin),
<a name="281"/>  281:     Bin = list_to_binary(Str),
<a name="282"/>  282:     m(erlang:md5(Bin), ResultBin),
<a name="283"/>  283:     UnalignedSubBin = unaligned_sub_bin(Bin),
<a name="t_md5_test-last_expr"/><a name="284"/>  284: <b>    m</b>(erlang:md5(UnalignedSubBin), ResultBin).
<a name="285"/>  285: 
<a name="m-2"/><a name="m-last_expr"/><a name="286"/>  286: <b>m</b>(X, X) -&gt; true.
<a name="287"/>  287: 
<a name="hexstr2bin-1"/><a name="288"/>  288: <b>hexstr2bin</b>(S) -&gt;
<a name="hexstr2bin-last_expr"/><a name="289"/>  289: <b>    list_to_binary</b>(hexstr2list(S)).
<a name="290"/>  290: 
<a name="hexstr2list-1"/><a name="291"/>  291: <b>hexstr2list</b>([X,Y|T]) -&gt;
<a name="292"/>  292:     [mkint(X)*16 + mkint(Y) | hexstr2list(T)];
<a name="293"/>  293: <b>hexstr2list</b>([]) -&gt;
<a name="hexstr2list-last_expr"/><a name="294"/>  294:     [].
<a name="295"/>  295: 
<a name="mkint-1"/><a name="296"/>  296: <b>mkint</b>(C) when $0 =&lt; C, C =&lt; $9 -&gt;
<a name="297"/>  297:     C - $0;
<a name="298"/>  298: <b>mkint</b>(C) when $A =&lt; C, C =&lt; $F -&gt;
<a name="299"/>  299:     C - $A + 10;
<a name="300"/>  300: <b>mkint</b>(C) when $a =&lt; C, C =&lt; $f -&gt;
<a name="mkint-last_expr"/><a name="301"/>  301:     C - $a + 10.
<a name="302"/>  302: 
<a name="unaligned_sub_bin-1"/><a name="303"/>  303: <b>unaligned_sub_bin</b>(Bin0) -&gt;
<a name="304"/>  304:     Bin1 = &lt;&lt;0:3,Bin0/binary,31:5&gt;&gt;,
<a name="305"/>  305:     Sz = size(Bin0),
<a name="306"/>  306:     &lt;&lt;0:3,Bin:Sz/binary,31:5&gt;&gt; = id(Bin1),
<a name="unaligned_sub_bin-last_expr"/><a name="307"/>  307:     Bin.
<a name="308"/>  308: 
<a name="309"/>  309: <i>%% Add 1 bit to the size of the binary.</i>
<a name="bit_sized_binary-1"/><a name="310"/>  310: <b>bit_sized_binary</b>(Bin0) -&gt;
<a name="311"/>  311:     Bin = &lt;&lt;Bin0/binary,1:1&gt;&gt;,
<a name="312"/>  312:     BitSize = bit_size(Bin),
<a name="313"/>  313:     BitSize = 8*size(Bin) + 1,
<a name="bit_sized_binary-last_expr"/><a name="314"/>  314:     Bin.
<a name="315"/>  315: 
<a name="id-1"/><a name="id-last_expr"/><a name="316"/>  316: <b>id</b>(I) -&gt; I.
</pre>
<script>
var hash = window.location.hash.substring(1);
var anchor = document.getElementsByName(hash);
anchor[0].style.backgroundColor="orange";
</script>
</body>
</html>
