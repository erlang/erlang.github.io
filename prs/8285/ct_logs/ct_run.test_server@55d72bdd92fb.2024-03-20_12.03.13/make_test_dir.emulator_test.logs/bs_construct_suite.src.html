<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/></meta>
<title>/buildroot/otp/erts/emulator/make_test_dir/emulator_test/bs_construct_SUITE.erl</title>
</head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
<a name="1"/>    1: <i>%%</i>
<a name="2"/>    2: <i>%% %CopyrightBegin%</i>
<a name="3"/>    3: <i>%% </i>
<a name="4"/>    4: <i>%% Copyright Ericsson AB 1999-2023. All Rights Reserved.</i>
<a name="5"/>    5: <i>%% </i>
<a name="6"/>    6: <i>%% Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</i>
<a name="7"/>    7: <i>%% you may not use this file except in compliance with the License.</i>
<a name="8"/>    8: <i>%% You may obtain a copy of the License at</i>
<a name="9"/>    9: <i>%%</i>
<a name="10"/>   10: <i>%%     http://www.apache.org/licenses/LICENSE-2.0</i>
<a name="11"/>   11: <i>%%</i>
<a name="12"/>   12: <i>%% Unless required by applicable law or agreed to in writing, software</i>
<a name="13"/>   13: <i>%% distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</i>
<a name="14"/>   14: <i>%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</i>
<a name="15"/>   15: <i>%% See the License for the specific language governing permissions and</i>
<a name="16"/>   16: <i>%% limitations under the License.</i>
<a name="17"/>   17: <i>%% </i>
<a name="18"/>   18: <i>%% %CopyrightEnd%</i>
<a name="19"/>   19: <i>%% </i>
<a name="20"/>   20: 
<a name="21"/>   21: <b>-module</b>(bs_construct_SUITE).
<a name="22"/>   22: 
<a name="23"/>   23: <b>-export</b>([all/0, suite/0,
<a name="24"/>   24:          init_per_suite/1, end_per_suite/1,
<a name="25"/>   25: 	 test1/1, test2/1, test3/1, test4/1, test5/1, testf/1,
<a name="26"/>   26: 	 not_used/1, in_guard/1,
<a name="27"/>   27: 	 mem_leak/1, coerce_to_float/1, bjorn/1, append_empty_is_same/1,
<a name="28"/>   28: 	 huge_float_field/1, system_limit/1, badarg/1,
<a name="29"/>   29: 	 copy_writable_binary/1, kostis/1, dynamic/1, bs_add/1,
<a name="30"/>   30: 	 otp_7422/1, zero_width/1, bad_append/1, bs_append_overflow/1,
<a name="31"/>   31:          bs_append_offheap/1,
<a name="32"/>   32:          reductions/1, fp16/1, zero_init/1, error_info/1, little/1,
<a name="33"/>   33:          heap_binary_unit/1]).
<a name="34"/>   34: 
<a name="35"/>   35: <b>-include_lib</b>(&quot;common_test/include/ct.hrl&quot;).
<a name="36"/>   36: 
<a name="suite-0"/><a name="37"/>   37: <b>suite</b>() -&gt;
<a name="suite-last_expr"/><a name="38"/>   38:     [{ct_hooks,[ts_install_cth]},
<a name="39"/>   39:      {timetrap, {minutes, 1}}].
<a name="40"/>   40: 
<a name="all-0"/><a name="41"/>   41: <b>all</b>() -&gt; 
<a name="all-last_expr"/><a name="42"/>   42:     [test1, test2, test3, test4, test5, testf, not_used,
<a name="43"/>   43:      in_guard, mem_leak, coerce_to_float, bjorn, append_empty_is_same,
<a name="44"/>   44:      huge_float_field, system_limit, badarg,
<a name="45"/>   45:      copy_writable_binary, kostis, dynamic, bs_add, otp_7422, zero_width,
<a name="46"/>   46:      bad_append, bs_append_overflow, bs_append_offheap,
<a name="47"/>   47:      reductions, fp16, zero_init,
<a name="48"/>   48:      error_info, little, heap_binary_unit].
<a name="49"/>   49: 
<a name="init_per_suite-1"/><a name="50"/>   50: <b>init_per_suite</b>(Config) -&gt;
<a name="init_per_suite-last_expr"/><a name="51"/>   51:     Config.
<a name="52"/>   52: 
<a name="end_per_suite-1"/><a name="53"/>   53: <b>end_per_suite</b>(_Config) -&gt;
<a name="end_per_suite-last_expr"/><a name="54"/>   54: <b>    application:stop</b>(os_mon).
<a name="55"/>   55: 
<a name="56"/>   56: <b>-define</b>(T(B, L), {B, ??B, L}).
<a name="57"/>   57: <b>-define</b>(N(B), {B, ??B, unknown}).
<a name="58"/>   58: 
<a name="59"/>   59: <b>-define</b>(FAIL(Expr), fail_check(catch Expr, ??Expr, [])).
<a name="60"/>   60: 
<a name="61"/>   61: <b>-define</b>(FAIL_VARS(Expr, Vars), fail_check(catch Expr, ??Expr, Vars)).
<a name="62"/>   62: 
<a name="l-2"/><a name="63"/>   63: <b>l</b>(I_13, I_big1) -&gt;
<a name="l-last_expr"/><a name="64"/>   64:     [
<a name="65"/>   65:      ?T(&lt;&lt;-43&gt;&gt;,
<a name="66"/>   66: 	[256-43]),
<a name="67"/>   67:      ?T(&lt;&lt;56&gt;&gt;,
<a name="68"/>   68: 	[56]),
<a name="69"/>   69:      ?T(&lt;&lt;1,2&gt;&gt;,
<a name="70"/>   70: 	[1, 2]),
<a name="71"/>   71:      ?T(&lt;&lt;4:4, 7:4&gt;&gt;,
<a name="72"/>   72: 	[4*16+7]),
<a name="73"/>   73:      ?T(&lt;&lt;777:16/big&gt;&gt;,
<a name="74"/>   74: 	[3, 9]),
<a name="75"/>   75:      ?T(&lt;&lt;777:16/little&gt;&gt;,
<a name="76"/>   76: 	[9, 3]),
<a name="77"/>   77:      ?T(&lt;&lt;0.0:32/float&gt;&gt;,
<a name="78"/>   78: 	[0,0,0,0]),
<a name="79"/>   79:      ?T(&lt;&lt;0.125:32/float&gt;&gt;,
<a name="80"/>   80: 	[62,0,0,0]),
<a name="81"/>   81:      ?T(&lt;&lt;0.125:32/little-float&gt;&gt;,
<a name="82"/>   82: 	[0,0,0,62]),
<a name="83"/>   83:      ?T(&lt;&lt;I_big1:32&gt;&gt;,
<a name="84"/>   84: 	[138, 99, 0, 147]),
<a name="85"/>   85:      ?T(&lt;&lt;57285702734876389752897684:32&gt;&gt;,
<a name="86"/>   86: 	[138, 99, 0, 148]),
<a name="87"/>   87:      ?T(&lt;&lt;I_big1:32/little&gt;&gt;,
<a name="88"/>   88: 	lists:reverse([138, 99, 0, 147])),
<a name="89"/>   89:      ?T(&lt;&lt;-1:17/unit:8&gt;&gt;,
<a name="90"/>   90: 	lists:duplicate(17, 255)),
<a name="91"/>   91: 
<a name="92"/>   92:      ?T(&lt;&lt;I_13&gt;&gt;,
<a name="93"/>   93: 	[13]),
<a name="94"/>   94: 
<a name="95"/>   95:      ?T(&lt;&lt;4:8/unit:2,5:2/unit:8&gt;&gt;,
<a name="96"/>   96: 	[0, 4, 0, 5]),
<a name="97"/>   97: 
<a name="98"/>   98:      ?T(&lt;&lt;1:1, 0:6, 1:1&gt;&gt;,
<a name="99"/>   99: 	[129]),
<a name="100"/>  100:      ?T(&lt;&lt;1:1/little, 0:6/little, 1:1/little&gt;&gt;,
<a name="101"/>  101: 	[129]),
<a name="102"/>  102: 
<a name="103"/>  103:      ?T(&lt;&lt;&lt;&lt;1,2&gt;&gt;/binary&gt;&gt;,
<a name="104"/>  104: 	[1, 2]),
<a name="105"/>  105:      ?T(&lt;&lt;&lt;&lt;1,2&gt;&gt;:1/binary&gt;&gt;,
<a name="106"/>  106: 	[1]),
<a name="107"/>  107:      ?T(&lt;&lt;4,3,&lt;&lt;1,2&gt;&gt;:1/binary&gt;&gt;,
<a name="108"/>  108: 	[4,3,1]),
<a name="109"/>  109: 
<a name="110"/>  110:      ?T(&lt;&lt; &lt;&lt;153,27:5&gt;&gt;:I_13/bits, 1:3 &gt;&gt;,
<a name="111"/>  111:         [153,217]),
<a name="112"/>  112: 
<a name="113"/>  113:      ?T(&lt;&lt;(256*45+47)&gt;&gt;,
<a name="114"/>  114: 	[47]),
<a name="115"/>  115: 
<a name="116"/>  116:      ?T(&lt;&lt;57:0&gt;&gt;,
<a name="117"/>  117: 	[]),
<a name="118"/>  118: 
<a name="119"/>  119:      ?T(&lt;&lt;&quot;apa&quot;&gt;&gt;,
<a name="120"/>  120: 	&quot;apa&quot;),
<a name="121"/>  121: 
<a name="122"/>  122:      ?T(&lt;&lt;1:3,&quot;string&quot;,9:5&gt;&gt;,
<a name="123"/>  123: 	[46,110,142,77,45,204,233]),
<a name="124"/>  124: 
<a name="125"/>  125:      ?T(&lt;&lt;&gt;&gt;,
<a name="126"/>  126: 	[]),
<a name="127"/>  127: 
<a name="128"/>  128:      ?T(&lt;&lt;37.98:64/native-float&gt;&gt;,
<a name="129"/>  129: 	native_3798()),
<a name="130"/>  130: 
<a name="131"/>  131:      ?T(&lt;&lt;32978297842987249827298387697777669766334937:128/native-integer&gt;&gt;,
<a name="132"/>  132: 	native_bignum()),
<a name="133"/>  133: 
<a name="134"/>  134:      ?T(&lt;&lt;$э/native-utf16,$т/native-utf16,$о/native-utf16,&quot; спутник&quot;/native-utf16&gt;&gt;,
<a name="135"/>  135:         native_utf16()),
<a name="136"/>  136: 
<a name="137"/>  137:      ?T(&lt;&lt;$в/native-utf32,&quot;ода&quot;/native-utf32&gt;&gt;,
<a name="138"/>  138: 	native_utf32()),
<a name="139"/>  139: 
<a name="140"/>  140:      %% Unit tests.
<a name="141"/>  141:      ?T(&lt;&lt;&lt;&lt;5:3&gt;&gt;/bitstring&gt;&gt;, &lt;&lt;5:3&gt;&gt;),
<a name="142"/>  142:      ?T(&lt;&lt;42,&lt;&lt;7:4&gt;&gt;/binary-unit:4&gt;&gt;, &lt;&lt;42,7:4&gt;&gt;),
<a name="143"/>  143:      ?T(&lt;&lt;&lt;&lt;344:17&gt;&gt;/binary-unit:17&gt;&gt;, &lt;&lt;344:17&gt;&gt;),
<a name="144"/>  144:      ?T(&lt;&lt;&lt;&lt;42,3,7656:16&gt;&gt;/binary-unit:16&gt;&gt;, &lt;&lt;42,3,7656:16&gt;&gt;),
<a name="145"/>  145: 
<a name="146"/>  146:      %% Different sizes and types. First without types.
<a name="147"/>  147:      ?T(&lt;&lt;I_big1:8&gt;&gt;, [147]),
<a name="148"/>  148:      ?T(&lt;&lt;I_big1:16&gt;&gt;, [0, 147]),
<a name="149"/>  149:      ?T(&lt;&lt;I_big1:24&gt;&gt;, [99, 0, 147]),
<a name="150"/>  150:      ?T(&lt;&lt;I_big1:32&gt;&gt;, [138, 99, 0, 147]),
<a name="151"/>  151:      ?T(&lt;&lt;I_big1:40&gt;&gt;, [5, 138, 99, 0, 147]),
<a name="152"/>  152:      ?T(&lt;&lt;I_big1:48&gt;&gt;, [229, 5, 138, 99, 0, 147]),
<a name="153"/>  153:      ?T(&lt;&lt;I_big1:56&gt;&gt;, [249, 229, 5, 138, 99, 0, 147]),
<a name="154"/>  154:      ?T(&lt;&lt;I_big1:64&gt;&gt;, [42, 249, 229, 5, 138, 99, 0, 147]),
<a name="155"/>  155: 
<a name="156"/>  156:      %% Known integer with range.
<a name="157"/>  157:      ?T(&lt;&lt;(I_big1 band ((1 bsl 56) - 1)):8&gt;&gt;, [147]),
<a name="158"/>  158:      ?T(&lt;&lt;(I_big1 band ((1 bsl 56) - 1)):16&gt;&gt;, [0, 147]),
<a name="159"/>  159:      ?T(&lt;&lt;(I_big1 band ((1 bsl 56) - 1)):24&gt;&gt;, [99, 0, 147]),
<a name="160"/>  160:      ?T(&lt;&lt;(I_big1 band ((1 bsl 56) - 1)):32&gt;&gt;, [138, 99, 0, 147]),
<a name="161"/>  161:      ?T(&lt;&lt;(I_big1 band ((1 bsl 56) - 1)):40&gt;&gt;, [5, 138, 99, 0, 147]),
<a name="162"/>  162:      ?T(&lt;&lt;(I_big1 band ((1 bsl 56) - 1)):48&gt;&gt;, [229, 5, 138, 99, 0, 147]),
<a name="163"/>  163:      ?T(&lt;&lt;(I_big1 band ((1 bsl 56) - 1)):56&gt;&gt;, [249, 229, 5, 138, 99, 0, 147]),
<a name="164"/>  164:      ?T(&lt;&lt;(I_big1 band ((1 bsl 64) - 1)):64&gt;&gt;, [42, 249, 229, 5, 138, 99, 0, 147]),
<a name="165"/>  165: 
<a name="166"/>  166:      %% Known integer with exact range.
<a name="167"/>  167:      ?T(&lt;&lt;(I_big1 band ((1 bsl  8) - 1)):8&gt;&gt;, [147]),
<a name="168"/>  168:      ?T(&lt;&lt;(I_big1 band ((1 bsl 16) - 1)):16&gt;&gt;, [0, 147]),
<a name="169"/>  169:      ?T(&lt;&lt;(I_big1 band ((1 bsl 24) - 1)):24&gt;&gt;, [99, 0, 147]),
<a name="170"/>  170:      ?T(&lt;&lt;(I_big1 band ((1 bsl 32) - 1)):32&gt;&gt;, [138, 99, 0, 147]),
<a name="171"/>  171:      ?T(&lt;&lt;(I_big1 band ((1 bsl 40) - 1)):40&gt;&gt;, [5, 138, 99, 0, 147]),
<a name="172"/>  172:      ?T(&lt;&lt;(I_big1 band ((1 bsl 48) - 1)):48&gt;&gt;, [229, 5, 138, 99, 0, 147]),
<a name="173"/>  173: 
<a name="174"/>  174:      %% Known integer without range.
<a name="175"/>  175:      ?T(&lt;&lt;(I_big1 + 0):8&gt;&gt;, [147]),
<a name="176"/>  176:      ?T(&lt;&lt;(I_big1 + 0):16&gt;&gt;, [0, 147]),
<a name="177"/>  177:      ?T(&lt;&lt;(I_big1 + 0):24&gt;&gt;, [99, 0, 147]),
<a name="178"/>  178:      ?T(&lt;&lt;(I_big1 + 0):32&gt;&gt;, [138, 99, 0, 147]),
<a name="179"/>  179:      ?T(&lt;&lt;(I_big1 + 0):40&gt;&gt;, [5, 138, 99, 0, 147]),
<a name="180"/>  180:      ?T(&lt;&lt;(I_big1 + 0):48&gt;&gt;, [229, 5, 138, 99, 0, 147]),
<a name="181"/>  181:      ?T(&lt;&lt;(I_big1 + 0):56&gt;&gt;, [249, 229, 5, 138, 99, 0, 147]),
<a name="182"/>  182:      ?T(&lt;&lt;(I_big1 + 0):64&gt;&gt;, [42, 249, 229, 5, 138, 99, 0, 147]),
<a name="183"/>  183: 
<a name="184"/>  184:      %% Known integer. Verify that the value does not bleed into the
<a name="185"/>  185:      %% previous segment.
<a name="186"/>  186:      ?T(&lt;&lt;1, (I_big1 + 0):8&gt;&gt;,  [1, 147]),
<a name="187"/>  187:      ?T(&lt;&lt;2, (I_big1 + 0):16&gt;&gt;, [2, 0, 147]),
<a name="188"/>  188:      ?T(&lt;&lt;3, (I_big1 + 0):24&gt;&gt;, [3, 99, 0, 147]),
<a name="189"/>  189:      ?T(&lt;&lt;4, (I_big1 + 0):32&gt;&gt;, [4, 138, 99, 0, 147]),
<a name="190"/>  190:      ?T(&lt;&lt;5, (I_big1 + 0):40&gt;&gt;, [5, 5, 138, 99, 0, 147]),
<a name="191"/>  191:      ?T(&lt;&lt;6, (I_big1 + 0):48&gt;&gt;, [6, 229, 5, 138, 99, 0, 147]),
<a name="192"/>  192:      ?T(&lt;&lt;7, (I_big1 + 0):56&gt;&gt;, [7, 249, 229, 5, 138, 99, 0, 147]),
<a name="193"/>  193:      ?T(&lt;&lt;8, (I_big1 + 0):64&gt;&gt;, [8, 42, 249, 229, 5, 138, 99, 0, 147]),
<a name="194"/>  194: 
<a name="195"/>  195:      %% Test non-byte sizes.
<a name="196"/>  196:      ?T(&lt;&lt;I_big1:33&gt;&gt;, &lt;&lt;197,49,128,73,1:1&gt;&gt;),
<a name="197"/>  197:      ?T(&lt;&lt;I_big1:39&gt;&gt;, &lt;&lt;11,20,198,1,19:7&gt;&gt;),
<a name="198"/>  198: 
<a name="199"/>  199:      ?T(&lt;&lt;I_big1:57&gt;&gt;, &lt;&lt;124,242,130,197,49,128,73,1:1&gt;&gt;),
<a name="200"/>  200:      ?T(&lt;&lt;I_big1:58&gt;&gt;, &lt;&lt;190,121,65,98,152,192,36,3:2&gt;&gt;),
<a name="201"/>  201:      ?T(&lt;&lt;I_big1:59&gt;&gt;, &lt;&lt;95,60,160,177,76,96,18,3:3&gt;&gt;),
<a name="202"/>  202:      ?T(&lt;&lt;I_big1:60&gt;&gt;, &lt;&lt;175,158,80,88,166,48,9,3:4&gt;&gt;),
<a name="203"/>  203:      ?T(&lt;&lt;I_big1:61&gt;&gt;, &lt;&lt;87,207,40,44,83,24,4,19:5&gt;&gt;),
<a name="204"/>  204:      ?T(&lt;&lt;I_big1:62&gt;&gt;, &lt;&lt;171,231,148,22,41,140,2,19:6&gt;&gt;),
<a name="205"/>  205:      ?T(&lt;&lt;I_big1:63&gt;&gt;, &lt;&lt;85,243,202,11,20,198,1,19:7&gt;&gt;),
<a name="206"/>  206: 
<a name="207"/>  207:      %% Test non-byte sizes and also that the value does not bleed
<a name="208"/>  208:      %% into the previous segment.
<a name="209"/>  209:      ?T(&lt;&lt;17, I_big1:33&gt;&gt;, &lt;&lt;17, 197,49,128,73,1:1&gt;&gt;),
<a name="210"/>  210:      ?T(&lt;&lt;19, I_big1:39&gt;&gt;, &lt;&lt;19, 11,20,198,1,19:7&gt;&gt;)
<a name="211"/>  211:     ].
<a name="212"/>  212: 
<a name="native_3798-0"/><a name="213"/>  213: <b>native_3798</b>() -&gt;
<a name="native_3798-last_expr"/><a name="214"/>  214:     case &lt;&lt;1:16/native&gt;&gt; of
<a name="215"/>  215: 	&lt;&lt;0,1&gt;&gt; -&gt; [64,66,253,112,163,215,10,61];
<a name="216"/>  216: 	&lt;&lt;1,0&gt;&gt; -&gt; [61,10,215,163,112,253,66,64]
<a name="217"/>  217:     end.
<a name="218"/>  218: 
<a name="native_bignum-0"/><a name="219"/>  219: <b>native_bignum</b>() -&gt;
<a name="native_bignum-last_expr"/><a name="220"/>  220:     case &lt;&lt;1:16/native&gt;&gt; of
<a name="221"/>  221: 	&lt;&lt;0,1&gt;&gt; -&gt; [129,205,18,177,1,213,170,101,39,231,109,128,176,11,73,217];
<a name="222"/>  222: 	&lt;&lt;1,0&gt;&gt; -&gt; [217,73,11,176,128,109,231,39,101,170,213,1,177,18,205,129]
<a name="223"/>  223:     end.
<a name="224"/>  224: 
<a name="native_utf16-0"/><a name="225"/>  225: <b>native_utf16</b>() -&gt;
<a name="native_utf16-last_expr"/><a name="226"/>  226:     case &lt;&lt;1:16/native&gt;&gt; of
<a name="227"/>  227: 	&lt;&lt;0,1&gt;&gt; -&gt; [4,77,4,66,4,62,0,32,4,65,4,63,4,67,4,66,4,61,4,56,4,58];
<a name="228"/>  228:         &lt;&lt;1,0&gt;&gt; -&gt; [77,4,66,4,62,4,32,0,65,4,63,4,67,4,66,4,61,4,56,4,58,4]
<a name="229"/>  229:     end.
<a name="230"/>  230: 
<a name="native_utf32-0"/><a name="231"/>  231: <b>native_utf32</b>() -&gt;
<a name="native_utf32-last_expr"/><a name="232"/>  232:     case &lt;&lt;1:16/native&gt;&gt; of
<a name="233"/>  233: 	&lt;&lt;0,1&gt;&gt; -&gt; [0,0,4,50,0,0,4,62,0,0,4,52,0,0,4,48];
<a name="234"/>  234:         &lt;&lt;1,0&gt;&gt; -&gt; [50,4,0,0,62,4,0,0,52,4,0,0,48,4,0,0]
<a name="235"/>  235:     end.
<a name="236"/>  236: 
<a name="evaluate-2"/><a name="237"/>  237: <b>evaluate</b>(Str, Vars) -&gt;
<a name="238"/>  238:     {ok,Tokens,_} =
<a name="239"/>  239: 	erl_scan:string(Str ++ &quot; . &quot;),
<a name="240"/>  240:     {ok, [Expr]} = erl_parse:parse_exprs(Tokens),
<a name="evaluate-last_expr"/><a name="241"/>  241: <b>    case erl_eval:expr</b>(Expr, Vars) of
<a name="242"/>  242: 	{value, Result, _} -&gt;
<a name="243"/>  243: 	    Result
<a name="244"/>  244:     end.
<a name="245"/>  245: 
<a name="eval_list-2"/><a name="246"/>  246: <b>eval_list</b>([], _Vars) -&gt;
<a name="247"/>  247:     [];
<a name="248"/>  248: <b>eval_list</b>([{C_bin, Str, Bytes} | Rest], Vars) -&gt;
<a name="eval_list-last_expr"/><a name="249"/>  249: <b>    case catch evaluate</b>(Str, Vars) of
<a name="250"/>  250: 	{'EXIT', Error} -&gt;
<a name="251"/>  251: 	    io:format(&quot;Evaluation error: ~p, ~p, ~p~n&quot;, [Str, Vars, Error]),
<a name="252"/>  252: 	    exit(Error);
<a name="253"/>  253: 	E_bin -&gt;
<a name="254"/>  254: 	    [{C_bin, E_bin, Str, Bytes} | eval_list(Rest, Vars)]
<a name="255"/>  255:     end.
<a name="256"/>  256: 
<a name="one_test-1"/><a name="257"/>  257: <b>one_test</b>({C_bin, E_bin, Str, Bytes}) when is_list(Bytes) -&gt;
<a name="258"/>  258:     io:format(&quot;  ~ts, ~p~n&quot;, [Str, Bytes]),
<a name="259"/>  259:     Bin = list_to_binary(Bytes),
<a name="260"/>  260:     if
<a name="261"/>  261: 	C_bin == Bin -&gt;
<a name="262"/>  262: 	    ok;
<a name="263"/>  263: 	true -&gt;
<a name="264"/>  264: 	    io:format(&quot;ERROR: Compiled: ~p.~nExpected ~p.~nGot ~p.~n&quot;,
<a name="265"/>  265: 		      [Str, Bytes, binary_to_list(C_bin)]),
<a name="266"/>  266: 	    ct:fail(comp)
<a name="267"/>  267:     end,
<a name="268"/>  268:     if
<a name="269"/>  269: 	E_bin == Bin -&gt;
<a name="270"/>  270: 	    ok;
<a name="271"/>  271: 	true -&gt;
<a name="272"/>  272: 	    io:format(&quot;ERROR: Interpreted: ~p.~nExpected ~p.~nGot ~p.~n&quot;,
<a name="273"/>  273: 		      [Str, Bytes, binary_to_list(E_bin)]),
<a name="274"/>  274: 	    ct:fail(comp)
<a name="275"/>  275:     end;
<a name="276"/>  276: <b>one_test</b>({C_bin, E_bin, Str, Result}) -&gt;
<a name="277"/>  277:     io:format(&quot;  ~ts ~p~n&quot;, [Str, C_bin]),
<a name="one_test-last_expr"/><a name="278"/>  278:     if
<a name="279"/>  279: 	C_bin == E_bin -&gt;
<a name="280"/>  280: 	    ok;
<a name="281"/>  281: 	true -&gt;
<a name="282"/>  282: 	    Arbitrary = case Result of
<a name="283"/>  283: 			    unknown -&gt;
<a name="284"/>  284: 				size(C_bin);
<a name="285"/>  285: 			    _ -&gt;
<a name="286"/>  286: 				Result
<a name="287"/>  287: 			end,
<a name="288"/>  288: 	    case equal_lists(binary_to_list(C_bin),
<a name="289"/>  289: 			     binary_to_list(E_bin),
<a name="290"/>  290: 			     Arbitrary) of
<a name="291"/>  291: 		false -&gt;
<a name="292"/>  292: 		    io:format(&quot;ERROR: Compiled not equal to interpreted:&quot;
<a name="293"/>  293: 			      &quot;~n ~p, ~p.~n&quot;,
<a name="294"/>  294: 			      [binary_to_list(C_bin), binary_to_list(E_bin)]),
<a name="295"/>  295: 		    ct:fail(comp);
<a name="296"/>  296: 		0 -&gt;
<a name="297"/>  297: 		    ok;
<a name="298"/>  298: 		%% For situations where the final bits may not matter, like
<a name="299"/>  299: 		%% for floats:
<a name="300"/>  300: 		N when is_integer(N) -&gt;
<a name="301"/>  301: 		    io:format(&quot;Info: compiled and interpreted differ in the&quot;
<a name="302"/>  302: 			      &quot; last bytes:~n ~p, ~p.~n&quot;,
<a name="303"/>  303: 			      [binary_to_list(C_bin), binary_to_list(E_bin)]),
<a name="304"/>  304: 		    ok
<a name="305"/>  305: 	    end
<a name="306"/>  306:     end.
<a name="307"/>  307: 
<a name="equal_lists-3"/><a name="308"/>  308: <b>equal_lists</b>([], [], _) -&gt;
<a name="309"/>  309:     0;
<a name="310"/>  310: <b>equal_lists</b>([], _, _) -&gt;
<a name="311"/>  311:     false;
<a name="312"/>  312: <b>equal_lists</b>(_, [], _) -&gt;
<a name="313"/>  313:     false;
<a name="314"/>  314: <b>equal_lists</b>([A|AR], [A|BR], R) -&gt;
<a name="315"/>  315:     equal_lists(AR, BR, R);
<a name="316"/>  316: <b>equal_lists</b>(A, B, R) -&gt;
<a name="equal_lists-last_expr"/><a name="317"/>  317:     if
<a name="318"/>  318: 	length(A) /= length(B) -&gt;
<a name="319"/>  319: 	    false;
<a name="320"/>  320: 	length(A) =&lt; R -&gt;
<a name="321"/>  321: 	    R;
<a name="322"/>  322: 	true -&gt;
<a name="323"/>  323: 	    false
<a name="324"/>  324:     end.
<a name="325"/>  325: 
<a name="fail_check-3"/><a name="326"/>  326: <b>fail_check</b>({'EXIT',{badarg,_}}, Str, Vars) -&gt;
<a name="327"/>  327:     try	evaluate(Str, Vars) of
<a name="328"/>  328: 	Res -&gt;
<a name="329"/>  329: 	    io:format(&quot;Interpreted result: ~p&quot;, [Res]),
<a name="330"/>  330: 	    ct:fail(did_not_fail_in_intepreted_code)
<a name="331"/>  331:     catch
<a name="332"/>  332: 	error:badarg -&gt;
<a name="333"/>  333: 	    ok
<a name="334"/>  334:     end;
<a name="335"/>  335: <b>fail_check</b>(Res, _, _) -&gt;
<a name="336"/>  336:     io:format(&quot;Compiled result: ~p&quot;, [Res]),
<a name="fail_check-last_expr"/><a name="337"/>  337: <b>    ct:fail</b>(did_not_fail_in_compiled_code).
<a name="338"/>  338: 
<a name="339"/>  339: <i>%%% Simple working cases</i>
<a name="test1-1"/><a name="340"/>  340: <b>test1</b>(Config) when is_list(Config) -&gt;
<a name="341"/>  341:     I_13 = id(13),
<a name="342"/>  342:     I_big1 = id(57285702734876389752897683),
<a name="343"/>  343:     Vars = [{'I_13', I_13},
<a name="344"/>  344:             {'I_big1', I_big1}],
<a name="test1-last_expr"/><a name="345"/>  345: <b>    lists:foreach</b>(fun one_test/1, eval_list(l(I_13, I_big1), Vars)).
<a name="346"/>  346: 
<a name="347"/>  347: <i>%%% Misc</i>
<a name="348"/>  348: 
<a name="349"/>  349: <i>%%% &lt;&lt;A:S, A:(N-S)&gt;&gt;</i>
<a name="comp-3"/><a name="350"/>  350: <b>comp</b>(N, A, S) -&gt;
<a name="351"/>  351:     M1 = (1 bsl S) - 1,
<a name="352"/>  352:     M2 = (1 bsl (N-S)) - 1,
<a name="comp-last_expr"/><a name="353"/>  353: <b>    [</b>((A band M1) bsl (N-S)) bor (A band M2)].
<a name="354"/>  354: 
<a name="gen-3"/><a name="355"/>  355: <b>gen</b>(N, S, A) -&gt;
<a name="gen-last_expr"/><a name="356"/>  356: <b>    [?T</b>(&lt;&lt;A:S, A:(N-S)&gt;&gt;, comp(N, A, S))].
<a name="357"/>  357: 
<a name="gen_l-3"/><a name="358"/>  358: <b>gen_l</b>(N, S, A) -&gt;
<a name="gen_l-last_expr"/><a name="359"/>  359: <b>    [?T</b>(&lt;&lt;A:S/little, A:(N-S)/little&gt;&gt;, comp(N, A, S))].
<a name="360"/>  360: 
<a name="test2-1"/><a name="361"/>  361: <b>test2</b>(Config) when is_list(Config) -&gt;
<a name="362"/>  362:     test2(0, 8, 2#10101010101010101),
<a name="test2-last_expr"/><a name="363"/>  363: <b>    test2</b>(0, 8, 2#1111111111).
<a name="364"/>  364: 
<a name="test2-3"/><a name="365"/>  365: <b>test2</b>(End, End, _) -&gt;
<a name="366"/>  366:     ok;
<a name="367"/>  367: <b>test2</b>(I, End, A) -&gt;
<a name="368"/>  368:     test2(I, A),
<a name="test2-last_expr"/><a name="369"/>  369: <b>    test2</b>(I+1, End, A).
<a name="370"/>  370: 
<a name="test2-2"/><a name="371"/>  371: <b>test2</b>(S, A) -&gt;
<a name="372"/>  372:     N = 8,
<a name="373"/>  373:     Vars = [{'A',A}, {'N',N}, {'S',S}],
<a name="374"/>  374:     io:format(&quot;Vars: ~p\n&quot;, [Vars]),
<a name="375"/>  375:     lists:foreach(fun one_test/1, eval_list(gen(N, S, A), Vars)),
<a name="test2-last_expr"/><a name="376"/>  376: <b>    lists:foreach</b>(fun one_test/1, eval_list(gen_l(N, S, A), Vars)).
<a name="377"/>  377: 
<a name="378"/>  378: <i>%%% Tests without facit</i>
<a name="379"/>  379: 
<a name="t3-0"/><a name="380"/>  380: <b>t3</b>() -&gt;
<a name="t3-last_expr"/><a name="381"/>  381: <b>    [?N</b>(&lt;&lt;4711:13, 9876:13, 3:6&gt;&gt;),
<a name="382"/>  382:      ?N(&lt;&lt;4.57:64/float&gt;&gt;),
<a name="383"/>  383:      ?N(&lt;&lt;4.57:32/float&gt;&gt;),
<a name="384"/>  384: 
<a name="385"/>  385:      ?N(&lt;&lt;&gt;&gt;)
<a name="386"/>  386:     ].
<a name="387"/>  387: 
<a name="test3-1"/><a name="388"/>  388: <b>test3</b>(Config) when is_list(Config) -&gt;
<a name="389"/>  389:     Vars = [],
<a name="test3-last_expr"/><a name="390"/>  390: <b>    lists:foreach</b>(fun one_test/1, eval_list(t3(), Vars)).
<a name="391"/>  391: 
<a name="gen_u-3"/><a name="392"/>  392: <b>gen_u</b>(N, S, A) -&gt;
<a name="gen_u-last_expr"/><a name="393"/>  393: <b>    [?N</b>(&lt;&lt;A:S, A:(N-S)&gt;&gt;)].
<a name="394"/>  394: 
<a name="gen_u_l-3"/><a name="395"/>  395: <b>gen_u_l</b>(N, S, A) -&gt;
<a name="gen_u_l-last_expr"/><a name="396"/>  396: <b>    [?N</b>(&lt;&lt;A:S/little, A:(N-S)/little&gt;&gt;)].
<a name="397"/>  397: 
<a name="test4-1"/><a name="398"/>  398: <b>test4</b>(Config) when is_list(Config) -&gt;
<a name="399"/>  399:     test4(0, 16, 2#10101010101010101),
<a name="test4-last_expr"/><a name="400"/>  400: <b>    test4</b>(0, 16, 2#1111111111).
<a name="401"/>  401: 
<a name="test4-3"/><a name="402"/>  402: <b>test4</b>(End, End, _) -&gt;
<a name="403"/>  403:     ok;
<a name="404"/>  404: <b>test4</b>(I, End, A) -&gt;
<a name="405"/>  405:     test4(I, A),
<a name="test4-last_expr"/><a name="406"/>  406: <b>    test4</b>(I+1, End, A).
<a name="407"/>  407: 
<a name="test4-2"/><a name="408"/>  408: <b>test4</b>(S, A) -&gt;
<a name="409"/>  409:     N = 16,
<a name="410"/>  410:     Vars = [{'A', A}, {'N', 16}, {'S', S}],
<a name="411"/>  411:     lists:foreach(fun one_test/1, eval_list(gen_u(N, S, A), Vars)),
<a name="test4-last_expr"/><a name="412"/>  412: <b>    lists:foreach</b>(fun one_test/1, eval_list(gen_u_l(N, S, A), Vars)).
<a name="413"/>  413: 
<a name="gen_b-3"/><a name="414"/>  414: <b>gen_b</b>(N, S, A) -&gt;
<a name="gen_b-last_expr"/><a name="415"/>  415: <b>    [?T</b>(&lt;&lt;A:S/binary-unit:1, A:(N-S)/binary-unit:1&gt;&gt;,
<a name="416"/>  416: 	binary_to_list(&lt;&lt;A:S/binary-unit:1, A:(N-S)/binary-unit:1&gt;&gt;))].
<a name="417"/>  417: 
<a name="418"/>  418: <i>%% OTP-3995</i>
<a name="test5-1"/><a name="419"/>  419: <b>test5</b>(Config) when is_list(Config) -&gt;
<a name="420"/>  420:     test5(0, 8, &lt;&lt;73&gt;&gt;),
<a name="test5-last_expr"/><a name="421"/>  421: <b>    test5</b>(0, 8, &lt;&lt;68&gt;&gt;).
<a name="422"/>  422: 
<a name="test5-3"/><a name="423"/>  423: <b>test5</b>(End, End, _) -&gt;
<a name="424"/>  424:     ok;
<a name="425"/>  425: <b>test5</b>(I, End, A) -&gt;
<a name="426"/>  426:     test5(I, A),
<a name="test5-last_expr"/><a name="427"/>  427: <b>    test5</b>(I+1, End, A).
<a name="428"/>  428: 
<a name="test5-2"/><a name="429"/>  429: <b>test5</b>(S, A) -&gt;
<a name="430"/>  430:     N = 8,
<a name="431"/>  431:     Vars = [{'A', A}, {'N', 8}, {'S', S}],
<a name="test5-last_expr"/><a name="432"/>  432: <b>    lists:foreach</b>(fun one_test/1, eval_list(gen_b(N, S, A), Vars)).
<a name="433"/>  433: 
<a name="434"/>  434: <i>%%% Failure cases</i>
<a name="testf-1"/><a name="435"/>  435: <b>testf</b>(Config) when is_list(Config) -&gt;
<a name="436"/>  436:     ?FAIL(&lt;&lt;3.14&gt;&gt;),
<a name="437"/>  437:     ?FAIL(&lt;&lt;&lt;&lt;1,2&gt;&gt;&gt;&gt;),
<a name="438"/>  438: 
<a name="439"/>  439:     ?FAIL(&lt;&lt;2.71/binary&gt;&gt;),
<a name="440"/>  440:     ?FAIL(&lt;&lt;24334/binary&gt;&gt;),
<a name="441"/>  441:     ?FAIL(&lt;&lt;24334344294788947129487129487219847/binary&gt;&gt;),
<a name="442"/>  442:     BigInt = id(24334344294788947129487129487219847),
<a name="443"/>  443:     ?FAIL_VARS(&lt;&lt;BigInt/binary&gt;&gt;, [{'BigInt',BigInt}]),
<a name="444"/>  444:     ?FAIL_VARS(&lt;&lt;42,BigInt/binary&gt;&gt;, [{'BigInt',BigInt}]),
<a name="445"/>  445:     ?FAIL_VARS(&lt;&lt;BigInt:2/binary&gt;&gt;, [{'BigInt',BigInt}]),
<a name="446"/>  446: 
<a name="447"/>  447:     %% One negative field size, but the sum of field sizes will be 1 byte.
<a name="448"/>  448:     %% Make sure that we reject that properly.
<a name="449"/>  449:     I_minus_777 = id(-777),
<a name="450"/>  450:     I_minus_2047 = id(-2047),
<a name="451"/>  451:     ?FAIL_VARS(&lt;&lt;I_minus_777:2048/unit:8,57:I_minus_2047/unit:8&gt;&gt;,
<a name="452"/>  452: 		     ordsets:from_list([{'I_minus_777',I_minus_777},
<a name="453"/>  453: 					{'I_minus_2047',I_minus_2047}])),
<a name="454"/>  454:     ?FAIL(&lt;&lt;&lt;&lt;1,2,3&gt;&gt;/float&gt;&gt;),
<a name="455"/>  455: 
<a name="456"/>  456:     %% Negative field widths.
<a name="457"/>  457:     testf_1(-8, &lt;&lt;1,2,3,4,5&gt;&gt;),
<a name="458"/>  458:     ?FAIL(&lt;&lt;0:(-(1 bsl 100))&gt;&gt;),
<a name="459"/>  459: 
<a name="460"/>  460:     ?FAIL(&lt;&lt;42:(-16)&gt;&gt;),
<a name="461"/>  461:     ?FAIL(&lt;&lt;3.14:(-8)/float&gt;&gt;),
<a name="462"/>  462:     ?FAIL(&lt;&lt;&lt;&lt;23,56,0,2&gt;&gt;:(-16)/binary&gt;&gt;),
<a name="463"/>  463:     ?FAIL(&lt;&lt;&lt;&lt;23,56,0,2&gt;&gt;:(2.5)/binary&gt;&gt;),
<a name="464"/>  464:     ?FAIL(&lt;&lt;&lt;&lt;23,56,0,2&gt;&gt;:(anka)&gt;&gt;),
<a name="465"/>  465:     ?FAIL(&lt;&lt;&lt;&lt;23,56,0,2&gt;&gt;:(anka)&gt;&gt;),
<a name="466"/>  466: 
<a name="467"/>  467:     %% Unit failures.
<a name="468"/>  468:     ?FAIL(&lt;&lt;&lt;&lt;1:1&gt;&gt;/binary&gt;&gt;),
<a name="469"/>  469:     Sz = id(1),
<a name="470"/>  470:     ?FAIL_VARS(&lt;&lt;&lt;&lt;1:Sz&gt;&gt;/binary&gt;&gt;, [{'Sz',Sz}]),
<a name="471"/>  471:     {'EXIT',{badarg,_}} = (catch &lt;&lt;&lt;&lt;1:(id(1))&gt;&gt;/binary&gt;&gt;),
<a name="472"/>  472:     ?FAIL(&lt;&lt;&lt;&lt;7,8,9&gt;&gt;/binary-unit:16&gt;&gt;),
<a name="473"/>  473:     ?FAIL(&lt;&lt;&lt;&lt;7,8,9,3:7&gt;&gt;/binary-unit:16&gt;&gt;),
<a name="474"/>  474:     ?FAIL(&lt;&lt;&lt;&lt;7,8,9,3:7&gt;&gt;/binary-unit:17&gt;&gt;),
<a name="475"/>  475: 
<a name="476"/>  476:     %% Failures not deteced by v3_core. Those must be detected at
<a name="477"/>  477:     %% runtime.
<a name="478"/>  478:     Atom = id(ok),
<a name="479"/>  479:     Float = id(2.71),
<a name="480"/>  480:     List = id([-1,0,1]),
<a name="481"/>  481:     NonBinaries = [{'Atom',Atom}, {'Float',Float}, {'List',List}],
<a name="482"/>  482:     ?FAIL_VARS(&lt;&lt;Atom/bits&gt;&gt;, NonBinaries),
<a name="483"/>  483:     ?FAIL_VARS(&lt;&lt;Atom/bits,0&gt;&gt;, NonBinaries),
<a name="484"/>  484:     ?FAIL_VARS(&lt;&lt;0,Atom/bits&gt;&gt;, NonBinaries),
<a name="485"/>  485:     ?FAIL_VARS(&lt;&lt;Float/bits&gt;&gt;, NonBinaries),
<a name="486"/>  486:     ?FAIL_VARS(&lt;&lt;Float/bits,0&gt;&gt;, NonBinaries),
<a name="487"/>  487:     ?FAIL_VARS(&lt;&lt;List/bits&gt;&gt;, NonBinaries),
<a name="488"/>  488:     ?FAIL_VARS(&lt;&lt;List/bits,0&gt;&gt;, NonBinaries),
<a name="489"/>  489: 
<a name="testf-last_expr"/><a name="490"/>  490:     ok.
<a name="491"/>  491: 
<a name="testf_1-2"/><a name="492"/>  492: <b>testf_1</b>(W, B) -&gt;
<a name="493"/>  493:     Vars = [{'W',W}],
<a name="494"/>  494:     ?FAIL_VARS(&lt;&lt;42:W&gt;&gt;, Vars),
<a name="495"/>  495:     ?FAIL_VARS(&lt;&lt;3.14:W/float&gt;&gt;, Vars),
<a name="testf_1-last_expr"/><a name="496"/>  496: <b>    ?FAIL_VARS</b>(&lt;&lt;B:W/binary&gt;&gt;, [{'B',B}|Vars]).
<a name="497"/>  497: 
<a name="498"/>  498: <i>%% Test that constructed binaries that are not used will still give an exception.</i>
<a name="not_used-1"/><a name="499"/>  499: <b>not_used</b>(Config) when is_list(Config) -&gt;
<a name="500"/>  500:     ok = not_used1(3, &lt;&lt;&quot;dum&quot;&gt;&gt;),
<a name="501"/>  501:     {'EXIT',{badarg,_}} = (catch not_used1(3, &quot;dum&quot;)),
<a name="502"/>  502:     {'EXIT',{badarg,_}} = (catch not_used2(444, -2)),
<a name="503"/>  503:     {'EXIT',{badarg,_}} = (catch not_used2(444, anka)),
<a name="504"/>  504:     {'EXIT',{badarg,_}} = (catch not_used3(444)),
<a name="not_used-last_expr"/><a name="505"/>  505:     ok.
<a name="506"/>  506: 
<a name="not_used1-2"/><a name="507"/>  507: <b>not_used1</b>(I, BinString) -&gt;
<a name="508"/>  508:     &lt;&lt;I:32,BinString/binary&gt;&gt;,
<a name="not_used1-last_expr"/><a name="509"/>  509:     ok.
<a name="510"/>  510: 
<a name="not_used2-2"/><a name="511"/>  511: <b>not_used2</b>(I, Sz) -&gt;
<a name="512"/>  512:     &lt;&lt;I:Sz&gt;&gt;,
<a name="not_used2-last_expr"/><a name="513"/>  513:     ok.
<a name="514"/>  514: 
<a name="not_used3-1"/><a name="515"/>  515: <b>not_used3</b>(I) -&gt;
<a name="516"/>  516:     &lt;&lt;I:(-8)&gt;&gt;,
<a name="not_used3-last_expr"/><a name="517"/>  517:     ok.
<a name="518"/>  518: 
<a name="in_guard-1"/><a name="519"/>  519: <b>in_guard</b>(Config) when is_list(Config) -&gt;
<a name="520"/>  520:     1 = in_guard(&lt;&lt;16#74ad:16&gt;&gt;, 16#e95, 5),
<a name="521"/>  521:     2 = in_guard(&lt;&lt;16#3A,16#F7,&quot;hello&quot;&gt;&gt;, 16#3AF7, &lt;&lt;&quot;hello&quot;&gt;&gt;),
<a name="522"/>  522:     3 = in_guard(&lt;&lt;16#FBCD:14,3.1415/float,3:2&gt;&gt;, 16#FBCD, 3.1415),
<a name="523"/>  523:     3 = in_guard(&lt;&lt;16#FBCD:14,3/float,3:2&gt;&gt;, 16#FBCD, 3),
<a name="524"/>  524:     3 = in_guard(&lt;&lt;16#FBCD:14,(2 bsl 226)/float,3:2&gt;&gt;, 16#FBCD, 2 bsl 226),
<a name="525"/>  525:     nope = in_guard(&lt;&lt;1&gt;&gt;, 42, b),
<a name="526"/>  526:     nope = in_guard(&lt;&lt;1&gt;&gt;, a, b),
<a name="527"/>  527:     nope = in_guard(&lt;&lt;1,2&gt;&gt;, 1, 1),
<a name="528"/>  528:     nope = in_guard(&lt;&lt;4,5&gt;&gt;, 1, 2.71),
<a name="529"/>  529:     nope = in_guard(&lt;&lt;4,5&gt;&gt;, 1, &lt;&lt;12,13&gt;&gt;),
<a name="in_guard-last_expr"/><a name="530"/>  530:     ok.
<a name="531"/>  531: 
<a name="in_guard-3"/><a name="532"/>  532: <b>in_guard</b>(Bin, A, B) when &lt;&lt;A:13,B:3&gt;&gt; == Bin -&gt; 1;
<a name="533"/>  533: <b>in_guard</b>(Bin, A, B) when &lt;&lt;A:16,B/binary&gt;&gt; == Bin -&gt; 2;
<a name="534"/>  534: <b>in_guard</b>(Bin, A, B) when &lt;&lt;A:14,B/float,3:2&gt;&gt; == Bin -&gt; 3;
<a name="535"/>  535: <b>in_guard</b>(Bin, A, B) when {a,b,&lt;&lt;A:14,B/float,3:2&gt;&gt;} == Bin -&gt; cant_happen;
<a name="in_guard-last_expr"/><a name="536"/>  536: <b>in_guard</b>(_, _, _) -&gt; nope.
<a name="537"/>  537: 
<a name="538"/>  538: <i>%% Make sure that construction has no memory leak</i>
<a name="mem_leak-1"/><a name="539"/>  539: <b>mem_leak</b>(Config) when is_list(Config) -&gt;
<a name="540"/>  540:     B = make_bin(16, &lt;&lt;0&gt;&gt;),
<a name="541"/>  541:     mem_leak(1024, B),
<a name="mem_leak-last_expr"/><a name="542"/>  542:     ok.
<a name="543"/>  543: 
<a name="mem_leak-2"/><a name="544"/>  544: <b>mem_leak</b>(0, _) -&gt; ok;
<a name="545"/>  545: <b>mem_leak</b>(N, B) -&gt;
<a name="546"/>  546:     big_bin(B, &lt;&lt;23&gt;&gt;),
<a name="547"/>  547:     {'EXIT',{badarg,_}} = (catch big_bin(B, bad)),
<a name="mem_leak-last_expr"/><a name="548"/>  548: <b>    mem_leak</b>(N-1, B).
<a name="549"/>  549: 
<a name="big_bin-2"/><a name="550"/>  550: <b>big_bin</b>(B1, B2) -&gt;
<a name="big_bin-last_expr"/><a name="551"/>  551:     &lt;&lt;B1/binary,B1/binary,B1/binary,B1/binary,
<a name="552"/>  552:       B1/binary,B1/binary,B1/binary,B1/binary,
<a name="553"/>  553:       B1/binary,B1/binary,B1/binary,B1/binary,
<a name="554"/>  554:       B1/binary,B1/binary,B1/binary,B1/binary,
<a name="555"/>  555:       B2/binary&gt;&gt;.
<a name="556"/>  556:     
<a name="make_bin-2"/><a name="557"/>  557: <b>make_bin</b>(0, Acc) -&gt; Acc;
<a name="make_bin-last_expr"/><a name="558"/>  558: <b>make_bin</b>(N, Acc) -&gt; make_bin(N-1, &lt;&lt;Acc/binary,Acc/binary&gt;&gt;).
<a name="559"/>  559: 
<a name="560"/>  560: <b>-define</b>(COF(Int0),
<a name="561"/>  561: 	(fun(Int) -&gt;
<a name="562"/>  562: 		 true = &lt;&lt;Int:16/float&gt;&gt; =:= &lt;&lt;(float(Int)):16/float&gt;&gt;,
<a name="563"/>  563: 		 true = &lt;&lt;Int:32/float&gt;&gt; =:= &lt;&lt;(float(Int)):32/float&gt;&gt;,
<a name="564"/>  564: 		 true = &lt;&lt;Int:64/float&gt;&gt; =:= &lt;&lt;(float(Int)):64/float&gt;&gt;
<a name="565"/>  565: 	 end)(nonliteral(Int0)),
<a name="566"/>  566: 	true = &lt;&lt;Int0:16/float&gt;&gt; =:= &lt;&lt;(float(Int0)):16/float&gt;&gt;,
<a name="567"/>  567: 	true = &lt;&lt;Int0:32/float&gt;&gt; =:= &lt;&lt;(float(Int0)):32/float&gt;&gt;,
<a name="568"/>  568: 	true = &lt;&lt;Int0:64/float&gt;&gt; =:= &lt;&lt;(float(Int0)):64/float&gt;&gt;).
<a name="569"/>  569: 
<a name="570"/>  570: <b>-define</b>(COF32(Int0),
<a name="571"/>  571: 	(fun(Int) -&gt;
<a name="572"/>  572: 		 true = &lt;&lt;Int:32/float&gt;&gt; =:= &lt;&lt;(float(Int)):32/float&gt;&gt;,
<a name="573"/>  573: 		 true = &lt;&lt;Int:64/float&gt;&gt; =:= &lt;&lt;(float(Int)):64/float&gt;&gt;
<a name="574"/>  574: 	 end)(nonliteral(Int0)),
<a name="575"/>  575: 	true = &lt;&lt;Int0:32/float&gt;&gt; =:= &lt;&lt;(float(Int0)):32/float&gt;&gt;,
<a name="576"/>  576: 	true = &lt;&lt;Int0:64/float&gt;&gt; =:= &lt;&lt;(float(Int0)):64/float&gt;&gt;).
<a name="577"/>  577: 
<a name="578"/>  578: <b>-define</b>(COF64(Int0),
<a name="579"/>  579: 	(fun(Int) -&gt;
<a name="580"/>  580: 		 true = &lt;&lt;Int:64/float&gt;&gt; =:= &lt;&lt;(float(Int)):64/float&gt;&gt;
<a name="581"/>  581: 	 end)(nonliteral(Int0)),
<a name="582"/>  582: 	true = &lt;&lt;Int0:64/float&gt;&gt; =:= &lt;&lt;(float(Int0)):64/float&gt;&gt;).
<a name="583"/>  583: 
<a name="nonliteral-1"/><a name="nonliteral-last_expr"/><a name="584"/>  584: <b>nonliteral</b>(X) -&gt; X.
<a name="585"/>  585:     
<a name="coerce_to_float-1"/><a name="586"/>  586: <b>coerce_to_float</b>(Config) when is_list(Config) -&gt;
<a name="587"/>  587:     ?COF(0),
<a name="588"/>  588:     ?COF(-1),
<a name="589"/>  589:     ?COF(1),
<a name="590"/>  590:     ?COF(42),
<a name="591"/>  591:     ?COF(255),
<a name="592"/>  592:     ?COF(-255),
<a name="593"/>  593:     ?COF(38474),
<a name="594"/>  594:     ?COF(65504),
<a name="595"/>  595:     ?COF(-65504),
<a name="596"/>  596:     ?COF32(387498738948729893849444444443),
<a name="597"/>  597:     ?COF32(-37489378937773899999999999999993),
<a name="598"/>  598:     ?COF64(298748888888888888888888888883478264866528467367364766666666666666663),
<a name="599"/>  599:     ?COF64(-367546729879999999999947826486652846736736476555566666663),
<a name="coerce_to_float-last_expr"/><a name="600"/>  600:     ok.
<a name="601"/>  601: 
<a name="bjorn-1"/><a name="602"/>  602: <b>bjorn</b>(Config) when is_list(Config) -&gt;
<a name="603"/>  603:     error = bjorn_1(),
<a name="bjorn-last_expr"/><a name="604"/>  604:     ok.
<a name="605"/>  605: 
<a name="bjorn_1-0"/><a name="606"/>  606: <b>bjorn_1</b>() -&gt;
<a name="607"/>  607:     Bitstr = &lt;&lt;7:13&gt;&gt;,
<a name="608"/>  608:     try
<a name="609"/>  609: 	do_something()
<a name="610"/>  610:     catch
<a name="611"/>  611: 	throw:blurf -&gt;
<a name="612"/>  612: 	    ignore
<a name="613"/>  613:     end,
<a name="bjorn_1-last_expr"/><a name="614"/>  614: <b>    do_more</b>(Bitstr, 13).
<a name="615"/>  615: 
<a name="do_more-2"/><a name="616"/>  616: <b>do_more</b>(Bin, Sz) -&gt;
<a name="617"/>  617:     %% Previous bug in the bs_bits_to_bytes instruction: The exeption code
<a name="618"/>  618:     %% was not set - the previous exception (throw:blurf) would be used,
<a name="619"/>  619:     %% causing the catch to slip.
<a name="do_more-last_expr"/><a name="620"/>  620:     try &lt;&lt;Bin:Sz/binary&gt;&gt; of
<a name="621"/>  621: 	_V -&gt; ok
<a name="622"/>  622:     catch
<a name="623"/>  623: 	error:_ -&gt;
<a name="624"/>  624: 	    error
<a name="625"/>  625:     end.
<a name="626"/>  626: 
<a name="do_something-0"/><a name="627"/>  627: <b>do_something</b>() -&gt;
<a name="do_something-last_expr"/><a name="628"/>  628: <b>    throw</b>(blurf).
<a name="629"/>  629: 
<a name="append_empty_is_same-1"/><a name="630"/>  630: <b>append_empty_is_same</b>(Config) when is_list(Config) -&gt;
<a name="631"/>  631:     NonWritableBin = &lt;&lt;&quot;123&quot;&gt;&gt;,
<a name="632"/>  632:     true = erts_debug:same(NonWritableBin, append(NonWritableBin, &lt;&lt;&gt;&gt;)),
<a name="633"/>  633:     WritableBin = &lt;&lt;(id(&lt;&lt;&gt;&gt;))/binary,0,1,2,3,4,5,6,7&gt;&gt;,
<a name="634"/>  634:     true = erts_debug:same(WritableBin, append(WritableBin, &lt;&lt;&gt;&gt;)),
<a name="append_empty_is_same-last_expr"/><a name="635"/>  635:     ok.
<a name="636"/>  636: 
<a name="append-2"/><a name="637"/>  637: <b>append</b>(A, B) -&gt;
<a name="append-last_expr"/><a name="638"/>  638:     &lt;&lt;A/binary, B/binary&gt;&gt;.
<a name="639"/>  639: 
<a name="huge_float_field-1"/><a name="640"/>  640: <b>huge_float_field</b>(Config) when is_list(Config) -&gt;
<a name="641"/>  641:     {'EXIT',{badarg,_}} = (catch &lt;&lt;0.0:9/float-unit:8&gt;&gt;),
<a name="642"/>  642:     huge_float_check(catch &lt;&lt;0.0:67108865/float-unit:64&gt;&gt;),
<a name="643"/>  643:     huge_float_check(catch &lt;&lt;0.0:((1 bsl 26)+1)/float-unit:64&gt;&gt;),
<a name="644"/>  644:     huge_float_check(catch &lt;&lt;0.0:(id(67108865))/float-unit:64&gt;&gt;),
<a name="645"/>  645: <i>%%  huge_float_check(catch &lt;&lt;0.0:((1 bsl 60)+1)/float-unit:64&gt;&gt;),</i>
<a name="646"/>  646:     huge_float_check(catch &lt;&lt;3839739387439387383739387987347983:((1 bsl 26)+1)/float-unit:64&gt;&gt;),
<a name="647"/>  647: <i>%%  huge_float_check(catch &lt;&lt;3839739387439387383739387987347983:((1 bsl 60)+1)/float-unit:64&gt;&gt;),</i>
<a name="huge_float_field-last_expr"/><a name="648"/>  648:     ok.
<a name="649"/>  649: 
<a name="huge_float_check-1"/><a name="650"/>  650: <b>huge_float_check</b>({'EXIT',{system_limit,_}}) -&gt; ok;
<a name="huge_float_check-last_expr"/><a name="651"/>  651: <b>huge_float_check</b>({'EXIT',{badarg,_}}) -&gt; ok.
<a name="652"/>  652: 
<a name="system_limit-1"/><a name="653"/>  653: <b>system_limit</b>(Config) when is_list(Config) -&gt;
<a name="654"/>  654:     WordSize = erlang:system_info(wordsize),
<a name="655"/>  655:     BitsPerWord = WordSize * 8,
<a name="656"/>  656:     {'EXIT',{system_limit,_}} =
<a name="657"/>  657: 	(catch &lt;&lt;0:(id(0)),42:(id(1 bsl BitsPerWord))&gt;&gt;),
<a name="658"/>  658:     {'EXIT',{system_limit,_}} =
<a name="659"/>  659: 	(catch &lt;&lt;42:(id(1 bsl BitsPerWord)),0:(id(0))&gt;&gt;),
<a name="660"/>  660:     {'EXIT',{system_limit,_}} =
<a name="661"/>  661: 	(catch &lt;&lt;(id(&lt;&lt;&gt;&gt;))/binary,0:(id(1 bsl 100))&gt;&gt;),
<a name="662"/>  662: 
<a name="663"/>  663:     %% Would fail to load.
<a name="664"/>  664:     {'EXIT',{system_limit,_}} = (catch &lt;&lt;0:(1 bsl 67)&gt;&gt;),
<a name="665"/>  665:     {'EXIT',{system_limit,_}} = (catch &lt;&lt;0:((1 bsl 64)+1)&gt;&gt;),
<a name="666"/>  666: 
<a name="system_limit-last_expr"/><a name="667"/>  667:     case WordSize of
<a name="668"/>  668: 	4 -&gt;
<a name="669"/>  669: 	    system_limit_32();
<a name="670"/>  670: 	8 -&gt;
<a name="671"/>  671: 	    ok
<a name="672"/>  672:     end.
<a name="673"/>  673: 
<a name="system_limit_32-0"/><a name="674"/>  674: <b>system_limit_32</b>() -&gt;
<a name="675"/>  675:     {'EXIT',{badarg,_}} = (catch &lt;&lt;42:(-1)&gt;&gt;),
<a name="676"/>  676:     {'EXIT',{badarg,_}} = (catch &lt;&lt;42:(id(-1))&gt;&gt;),
<a name="677"/>  677:     {'EXIT',{badarg,_}} = (catch &lt;&lt;42:(id(-389739873536870912))/unit:8&gt;&gt;),
<a name="678"/>  678:     {'EXIT',{system_limit,_}} = (catch &lt;&lt;42:536870912/unit:8&gt;&gt;),
<a name="679"/>  679:     {'EXIT',{system_limit,_}} = (catch &lt;&lt;42:(id(536870912))/unit:8&gt;&gt;),
<a name="680"/>  680:     {'EXIT',{system_limit,_}} = (catch &lt;&lt;0:(id(8)),42:536870912/unit:8&gt;&gt;),
<a name="681"/>  681:     {'EXIT',{system_limit,_}} = (catch &lt;&lt;0:(id(8)),42:(id(536870912))/unit:8&gt;&gt;),
<a name="682"/>  682: 
<a name="683"/>  683:     %% The size would be silently truncated, resulting in a crash.
<a name="684"/>  684:     {'EXIT',{system_limit,_}} = (catch &lt;&lt;0:(1 bsl 35)&gt;&gt;),
<a name="685"/>  685:     {'EXIT',{system_limit,_}} = (catch &lt;&lt;0:((1 bsl 32)+1)&gt;&gt;),
<a name="686"/>  686: 
<a name="687"/>  687:     %% Would fail to load.
<a name="688"/>  688:     {'EXIT',{system_limit,_}} = (catch &lt;&lt;0:(1 bsl 43)&gt;&gt;),
<a name="689"/>  689:     {'EXIT',{system_limit,_}} = (catch &lt;&lt;0:((1 bsl 40)+1)&gt;&gt;),
<a name="system_limit_32-last_expr"/><a name="690"/>  690:     ok.
<a name="691"/>  691: 
<a name="badarg-1"/><a name="692"/>  692: <b>badarg</b>(Config) when is_list(Config) -&gt;
<a name="693"/>  693:     &lt;&lt;3:2&gt;&gt; = &lt;&lt;1:(id(1)),1:(id(1))&gt;&gt;,
<a name="694"/>  694:     {'EXIT',{badarg,_}} = (catch &lt;&lt;0:(id(1)),0:(id(-1))&gt;&gt;),
<a name="695"/>  695:     {'EXIT',{badarg,_}} = (catch &lt;&lt;0:(id(1)),0:(id(-(1 bsl 70)))&gt;&gt;),
<a name="696"/>  696:     {'EXIT',{badarg,_}} = (catch &lt;&lt;0:(id(-(1 bsl 70))),0:(id(1))&gt;&gt;),
<a name="697"/>  697:     {'EXIT',{badarg,_}} = (catch &lt;&lt;(id(&lt;&lt;&gt;&gt;))/binary,0:(id(-(1)))&gt;&gt;),
<a name="badarg-last_expr"/><a name="698"/>  698:     ok.
<a name="699"/>  699: 
<a name="copy_writable_binary-1"/><a name="700"/>  700: <b>copy_writable_binary</b>(Config) when is_list(Config) -&gt;
<a name="701"/>  701:     [copy_writable_binary_1(I) || I &lt;- lists:seq(0, 256)],
<a name="copy_writable_binary-last_expr"/><a name="702"/>  702:     ok.
<a name="703"/>  703: 
<a name="copy_writable_binary_1-1"/><a name="704"/>  704: <b>copy_writable_binary_1</b>(_) -&gt;
<a name="705"/>  705:     Bin0 = &lt;&lt;(id(&lt;&lt;&gt;&gt;))/binary,0,1,2,3,4,5,6,7&gt;&gt;,
<a name="706"/>  706:     SubBin = make_sub_bin(Bin0),
<a name="707"/>  707:     id(&lt;&lt;42,34,55,Bin0/binary&gt;&gt;),		%Make reallocation likelier.
<a name="708"/>  708:     Pid = spawn(fun() -&gt;
<a name="709"/>  709: 			      copy_writable_binary_holder(Bin0, SubBin)
<a name="710"/>  710: 		      end),
<a name="711"/>  711:     Tab = ets:new(holder, []),
<a name="712"/>  712:     ets:insert(Tab, {17,Bin0}),
<a name="713"/>  713:     ets:insert(Tab, {42,SubBin}),
<a name="714"/>  714:     id(&lt;&lt;Bin0/binary,0:(64*1024*8)&gt;&gt;),
<a name="715"/>  715:     Pid ! self(),
<a name="716"/>  716:     [{17,Bin0}] = ets:lookup(Tab, 17),
<a name="717"/>  717:     [{42,Bin0}] = ets:lookup(Tab, 42),
<a name="718"/>  718:     receive
<a name="719"/>  719: 	{Pid,Bin0,Bin0} -&gt; ok;
<a name="720"/>  720: 	Other -&gt;
<a name="721"/>  721: 	    ct:fail(&quot;Unexpected message: ~p&quot;, [Other])
<a name="722"/>  722:     end,
<a name="copy_writable_binary_1-last_expr"/><a name="723"/>  723:     ok.
<a name="724"/>  724: 
<a name="copy_writable_binary_holder-2"/><a name="725"/>  725: <b>copy_writable_binary_holder</b>(Bin, SubBin) -&gt;
<a name="copy_writable_binary_holder-last_expr"/><a name="726"/>  726:     receive
<a name="727"/>  727: 	Pid -&gt;
<a name="728"/>  728: 	    Pid ! {self(),Bin,SubBin}
<a name="729"/>  729:     end.
<a name="730"/>  730: 
<a name="make_sub_bin-1"/><a name="731"/>  731: <b>make_sub_bin</b>(Bin0) -&gt;
<a name="732"/>  732:     N = bit_size(Bin0),
<a name="733"/>  733:     &lt;&lt;_:17,Bin:N/bitstring,_:5&gt;&gt; = &lt;&lt;(-1):17,Bin0/bitstring,(-1):5&gt;&gt;,
<a name="734"/>  734:     Bin = Bin0,					%Assertion.
<a name="make_sub_bin-last_expr"/><a name="735"/>  735:     Bin.
<a name="736"/>  736: 
<a name="737"/>  737: <i>%% Make sure that bit syntax expression with huge field size are</i>
<a name="738"/>  738: <i>%% not constructed at compile time.</i>
<a name="739"/>  739: 
<a name="kostis-1"/><a name="740"/>  740: <b>kostis</b>(Config) when is_list(Config) -&gt;
<a name="kostis-last_expr"/><a name="741"/>  741: <b>    case have_250_terabytes_of_ram</b>() of
<a name="742"/>  742: 	true -&gt;
<a name="743"/>  743: 	    Bin = &lt;&lt;0:800000000000&gt;&gt;,
<a name="744"/>  744: 	    EmbeddedBin = &lt;&lt;0,(&lt;&lt;0:99999999999&gt;&gt;)/bitstring,1&gt;&gt;,
<a name="745"/>  745: 	    Bin0 = list_to_binary([Bin,Bin,Bin,Bin,Bin]),
<a name="746"/>  746: 	    Bin1 = list_to_binary([Bin0,Bin0,Bin0,Bin0,Bin0,Bin0]),
<a name="747"/>  747: 	    Bin2 = list_to_binary([Bin1,Bin1]),
<a name="748"/>  748: 	    id({EmbeddedBin,Bin0,Bin1,Bin2});
<a name="749"/>  749: 	false -&gt;
<a name="750"/>  750: 	    ok
<a name="751"/>  751:     end.
<a name="752"/>  752: 
<a name="753"/>  753: <i>%% I'm not even certain how much 250 TB really is...</i>
<a name="754"/>  754: <i>%% but I'm sure I don't have it :-)</i>
<a name="755"/>  755: 
<a name="have_250_terabytes_of_ram-0"/><a name="have_250_terabytes_of_ram-last_expr"/><a name="756"/>  756: <b>have_250_terabytes_of_ram</b>() -&gt; false.
<a name="757"/>  757: 
<a name="758"/>  758: <i>%% Test that different ways of using bit syntax instructions</i>
<a name="759"/>  759: <i>%% give the same result.</i>
<a name="760"/>  760: 
<a name="dynamic-1"/><a name="761"/>  761: <b>dynamic</b>(Config) when is_list(Config) -&gt;
<a name="762"/>  762:     dynamic_1(fun dynamic_big/5),
<a name="763"/>  763:     dynamic_1(fun dynamic_little/5),
<a name="dynamic-last_expr"/><a name="764"/>  764:     ok.
<a name="765"/>  765: 		      
<a name="dynamic_1-1"/><a name="766"/>  766: <b>dynamic_1</b>(Dynamic) -&gt;
<a name="767"/>  767:     &lt;&lt;Lpad:128&gt;&gt; = erlang:md5([0]),
<a name="768"/>  768:     &lt;&lt;Rpad:128&gt;&gt; = erlang:md5([1]),
<a name="769"/>  769:     &lt;&lt;Int:128&gt;&gt; = erlang:md5([2]),
<a name="dynamic_1-last_expr"/><a name="770"/>  770: <b>    8385 = dynamic_2</b>(0, {Int,Lpad,Rpad,Dynamic}, 0).
<a name="771"/>  771: 
<a name="dynamic_2-3"/><a name="772"/>  772: <b>dynamic_2</b>(129, _, Count) -&gt; Count;
<a name="773"/>  773: <b>dynamic_2</b>(Bef, Data, Count0) -&gt;
<a name="774"/>  774:     Count = dynamic_3(Bef, 128-Bef, Data, Count0),
<a name="dynamic_2-last_expr"/><a name="775"/>  775: <b>    dynamic_2</b>(Bef+1, Data, Count).
<a name="776"/>  776: 
<a name="dynamic_3-4"/><a name="777"/>  777: <b>dynamic_3</b>(_, -1, _, Count) -&gt; Count;
<a name="778"/>  778: <b>dynamic_3</b>(Bef, N, {Int0,Lpad,Rpad,Dynamic}=Data, Count) -&gt;
<a name="779"/>  779:     Int1 = Int0 band ((1 bsl (N+3))-1),
<a name="780"/>  780:     Dynamic(Bef, N, Int1, Lpad, Rpad),
<a name="781"/>  781:     Dynamic(Bef, N, -Int1, Lpad, Rpad),
<a name="782"/>  782: 
<a name="783"/>  783:     %% OTP-7085: Test a small number in a wide field.
<a name="784"/>  784:     Int2 = Int0 band 16#FFFFFF,
<a name="785"/>  785:     Dynamic(Bef, N, Int2, Lpad, Rpad),
<a name="786"/>  786:     Dynamic(Bef, N, -Int2, Lpad, Rpad),
<a name="dynamic_3-last_expr"/><a name="787"/>  787: <b>    dynamic_3</b>(Bef, N-1, Data, Count+1).
<a name="788"/>  788: 
<a name="dynamic_big-5"/><a name="789"/>  789: <b>dynamic_big</b>(Bef, N, Int, Lpad, Rpad) -&gt;
<a name="790"/>  790:     NumBin = id(&lt;&lt;Int:N&gt;&gt;),
<a name="791"/>  791:     MaskedInt = Int band ((1 bsl N) - 1),
<a name="792"/>  792:     &lt;&lt;MaskedInt:N&gt;&gt; = NumBin,
<a name="793"/>  793: 
<a name="794"/>  794:     %% Construct the binary in two different ways.
<a name="795"/>  795:     Bin = id(&lt;&lt;Lpad:Bef,NumBin/bitstring,Rpad:(128-Bef-N)&gt;&gt;),
<a name="796"/>  796:     Bin = &lt;&lt;Lpad:Bef,Int:N,Rpad:(128-Bef-N)&gt;&gt;,
<a name="797"/>  797: 
<a name="798"/>  798:     %% Units are seldom used with integer segments even in our test
<a name="799"/>  799:     %% suites, and I have never seen non-power-of-two units in
<a name="800"/>  800:     %% production code.
<a name="801"/>  801:     if
<a name="802"/>  802:         Bef rem 8 =:= 0 -&gt;
<a name="803"/>  803:             Bin = &lt;&lt;Lpad:(Bef div 8)/unit:8,Int:N,Rpad:(128-Bef-N)&gt;&gt;;
<a name="804"/>  804:         Bef rem 7 =:= 0 -&gt;
<a name="805"/>  805:             Bin = &lt;&lt;Lpad:(Bef div 7)/unit:7,Int:N,Rpad:(128-Bef-N)&gt;&gt;;
<a name="806"/>  806:         (128-Bef-N) rem 5 =:= 0 -&gt;
<a name="807"/>  807:             Aft = (128 - Bef - N) div 5,
<a name="808"/>  808:             Bin = &lt;&lt;Lpad:Bef,Int:N,Rpad:Aft/unit:5&gt;&gt;;
<a name="809"/>  809:         true -&gt;
<a name="810"/>  810:             ok
<a name="811"/>  811:     end,
<a name="812"/>  812: 
<a name="813"/>  813:     %% Further verify the result by matching.
<a name="814"/>  814:     LpadMasked = Lpad band ((1 bsl Bef) - 1),
<a name="815"/>  815:     RpadMasked = Rpad band ((1 bsl (128-Bef-N)) - 1),
<a name="816"/>  816:     Rbits = (128-Bef-N),
<a name="817"/>  817:     &lt;&lt;LpadMasked:Bef,MaskedInt:N,RpadMasked:Rbits&gt;&gt; = id(Bin),
<a name="dynamic_big-last_expr"/><a name="818"/>  818:     ok.
<a name="819"/>  819: 
<a name="dynamic_little-5"/><a name="820"/>  820: <b>dynamic_little</b>(Bef, N, Int, Lpad, Rpad) -&gt;
<a name="821"/>  821:     NumBin = id(&lt;&lt;Int:N/little&gt;&gt;),
<a name="822"/>  822:     MaskedInt = Int band ((1 bsl N) - 1),
<a name="823"/>  823:     &lt;&lt;MaskedInt:N/little&gt;&gt; = NumBin,
<a name="824"/>  824: 
<a name="825"/>  825:     %% Construct the binary in two different ways.
<a name="826"/>  826:     Bin = id(&lt;&lt;Lpad:Bef/little,NumBin/bitstring,Rpad:(128-Bef-N)/little&gt;&gt;),
<a name="827"/>  827:     Bin = &lt;&lt;Lpad:Bef/little,Int:N/little,Rpad:(128-Bef-N)/little&gt;&gt;,
<a name="828"/>  828: 
<a name="829"/>  829:     if
<a name="830"/>  830:         Bef rem 8 =:= 0 -&gt;
<a name="831"/>  831:             Bin = &lt;&lt;Lpad:(Bef div 8)/little-unit:8,
<a name="832"/>  832:                     Int:N/little,Rpad:(128-Bef-N)/little&gt;&gt;;
<a name="833"/>  833:         Bef rem 9 =:= 0 -&gt;
<a name="834"/>  834:             Bin = &lt;&lt;Lpad:(Bef div 9)/little-unit:9,
<a name="835"/>  835:                     Int:N/little,Rpad:(128-Bef-N)/little&gt;&gt;;
<a name="836"/>  836:         (128-Bef-N) rem 17 =:= 0 -&gt;
<a name="837"/>  837:             Aft = (128 - Bef - N) div 17,
<a name="838"/>  838:             Bin = &lt;&lt;Lpad:Bef/little,Int:N/little,Rpad:Aft/little-unit:17&gt;&gt;;
<a name="839"/>  839:         true -&gt;
<a name="840"/>  840:             ok
<a name="841"/>  841:     end,
<a name="842"/>  842: 
<a name="843"/>  843:     %% Further verify the result by matching.
<a name="844"/>  844:     LpadMasked = Lpad band ((1 bsl Bef) - 1),
<a name="845"/>  845:     RpadMasked = Rpad band ((1 bsl (128-Bef-N)) - 1),
<a name="846"/>  846:     Rbits = (128-Bef-N),
<a name="847"/>  847:     &lt;&lt;LpadMasked:Bef/little,MaskedInt:N/little,RpadMasked:Rbits/little&gt;&gt; = id(Bin),
<a name="dynamic_little-last_expr"/><a name="848"/>  848:     ok.
<a name="849"/>  849: 
<a name="850"/>  850: <i>%% Test that the bs_add/5 instruction handles big numbers correctly.</i>
<a name="bs_add-1"/><a name="851"/>  851: <b>bs_add</b>(Config) when is_list(Config) -&gt;
<a name="852"/>  852:     Mod = list_to_atom(atom_to_list(?MODULE) ++ &quot;_&quot; ++
<a name="853"/>  853:                            atom_to_list(?FUNCTION_NAME)),
<a name="854"/>  854:     N = 2000,
<a name="855"/>  855:     Code = [{module, Mod},
<a name="856"/>  856: 	    {exports, [{bs_add,2}]},
<a name="857"/>  857: 	    {labels, 2},
<a name="858"/>  858: 
<a name="859"/>  859: 	    %% bs_add(Number, -SmallestBig) -&gt; Number + N
<a name="860"/>  860: 	    {function, bs_add, 2, 2},
<a name="861"/>  861: 	    {label,1},
<a name="862"/>  862: 	    {func_info,{atom,Mod},{atom,bs_add},2},
<a name="863"/>  863: 
<a name="864"/>  864: 	    {label,2},
<a name="865"/>  865: 	    {move,{x,0},{x,2}}] ++
<a name="866"/>  866: 	lists:duplicate(N-1, {bs_add,{f,0},[{x,2},{integer,1},1],{x,2}}) ++
<a name="867"/>  867: 	[{gc_bif,abs,{f,0},3,[{x,1}],{x,4}},	%Force GC, ignore result.
<a name="868"/>  868: 	 {gc_bif,'+',{f,0},3,[{x,2},{integer,1}],{x,0}}, %Safe result in {x,0}
<a name="869"/>  869: 	 return],
<a name="870"/>  870: 
<a name="871"/>  871:     %% Write assembly file and assemble it.
<a name="872"/>  872:     PrivDir = proplists:get_value(priv_dir, Config),
<a name="873"/>  873:     RootName = filename:join(PrivDir, atom_to_list(Mod)),
<a name="874"/>  874:     AsmFile = RootName ++ &quot;.S&quot;,
<a name="875"/>  875:     {ok,Fd} = file:open(AsmFile, [write]),
<a name="876"/>  876:     [io:format(Fd, &quot;~p. \n&quot;, [T]) || T &lt;- Code],
<a name="877"/>  877:     ok = file:close(Fd),
<a name="878"/>  878:     {ok,Mod} = compile:file(AsmFile, [from_asm,report,{outdir,PrivDir}]),
<a name="879"/>  879:     LoadRc = code:load_abs(RootName),
<a name="880"/>  880:     {module,_Module} = LoadRc,
<a name="881"/>  881: 
<a name="882"/>  882:     %% Find smallest positive bignum.
<a name="883"/>  883:     SmallestBig = smallest_big(),
<a name="884"/>  884:     io:format(&quot;~p\n&quot;, [SmallestBig]),
<a name="885"/>  885:     DoTest = fun() -&gt;
<a name="886"/>  886: 		     exit(Mod:bs_add(SmallestBig, -SmallestBig))
<a name="887"/>  887: 	     end,
<a name="888"/>  888:     {Pid,Mref} = spawn_monitor(DoTest),
<a name="889"/>  889:     receive
<a name="890"/>  890: 	{'DOWN',Mref,process,Pid,Res} -&gt; ok
<a name="891"/>  891:     end,
<a name="892"/>  892: 
<a name="893"/>  893:     case erlang:system_info(wordsize) of
<a name="894"/>  894:         8 -&gt;
<a name="895"/>  895:             %% bignum-sized binaries must system_limit on 64-bit platforms
<a name="896"/>  896:             {system_limit, _} = Res;
<a name="897"/>  897:         4 -&gt;
<a name="898"/>  898:             Res = SmallestBig + N
<a name="899"/>  899:     end,
<a name="900"/>  900: 
<a name="901"/>  901:     %% Clean up.
<a name="902"/>  902:     ok = file:delete(AsmFile),
<a name="903"/>  903:     ok = file:delete(code:which(Mod)),
<a name="904"/>  904:     _ = code:delete(Mod),
<a name="905"/>  905:     _ = code:purge(Mod),
<a name="906"/>  906: 
<a name="bs_add-last_expr"/><a name="907"/>  907:     ok.
<a name="908"/>  908: 
<a name="909"/>  909: 
<a name="smallest_big-0"/><a name="910"/>  910: <b>smallest_big</b>() -&gt;
<a name="smallest_big-last_expr"/><a name="911"/>  911: <b>    smallest_big_1</b>(1 bsl 24).
<a name="912"/>  912: 
<a name="smallest_big_1-1"/><a name="913"/>  913: <b>smallest_big_1</b>(N) -&gt;
<a name="smallest_big_1-last_expr"/><a name="914"/>  914: <b>    case erts_debug:flat_size</b>(N) of
<a name="915"/>  915: 	0 -&gt; smallest_big_1(N+N);
<a name="916"/>  916: 	_  -&gt; N
<a name="917"/>  917:     end.
<a name="918"/>  918: 
<a name="otp_7422-1"/><a name="919"/>  919: <b>otp_7422</b>(Config) when is_list(Config) -&gt;
<a name="920"/>  920:     otp_7422_int(0),
<a name="otp_7422-last_expr"/><a name="921"/>  921: <b>    otp_7422_bin</b>(0).
<a name="922"/>  922: 
<a name="otp_7422_int-1"/><a name="923"/>  923: <b>otp_7422_int</b>(N) when N &lt; 512 -&gt;
<a name="924"/>  924:     T = erlang:make_tuple(N, []),
<a name="925"/>  925:     spawn_link(fun() -&gt;
<a name="926"/>  926: 		       id(T),
<a name="927"/>  927: 		       %% A size of field 0 would write one byte beyond
<a name="928"/>  928: 		       %% the current position in the binary. It could
<a name="929"/>  929: 		       %% overwrite the continuation pointer stored on
<a name="930"/>  930: 		       %% the stack if HTOP was equal to E (the stack pointer).
<a name="931"/>  931: 		       id(&lt;&lt;0:(id(0))&gt;&gt;)
<a name="932"/>  932: 	       end),
<a name="933"/>  933:     otp_7422_int(N+1);
<a name="otp_7422_int-last_expr"/><a name="934"/>  934: <b>otp_7422_int</b>(_) -&gt; ok.
<a name="935"/>  935: 
<a name="otp_7422_bin-1"/><a name="936"/>  936: <b>otp_7422_bin</b>(N) when N &lt; 512 -&gt;
<a name="937"/>  937:     T = erlang:make_tuple(N, []),
<a name="938"/>  938:     Z = id(&lt;&lt;&gt;&gt;),
<a name="939"/>  939:     spawn_link(fun() -&gt;
<a name="940"/>  940: 		       id(T),
<a name="941"/>  941: 		       id(&lt;&lt;Z:(id(0))/bits&gt;&gt;)
<a name="942"/>  942: 	       end),
<a name="943"/>  943:     otp_7422_bin(N+1);
<a name="otp_7422_bin-last_expr"/><a name="944"/>  944: <b>otp_7422_bin</b>(_) -&gt; ok.
<a name="945"/>  945: 
<a name="zero_width-1"/><a name="946"/>  946: <b>zero_width</b>(Config) when is_list(Config) -&gt;
<a name="947"/>  947:     Z = id(0),
<a name="948"/>  948:     Small = id(42),
<a name="949"/>  949:     Big = id(1 bsl 128),
<a name="950"/>  950:     &lt;&lt;&gt;&gt; = &lt;&lt;Small:Z&gt;&gt;,
<a name="951"/>  951:     &lt;&lt;&gt;&gt; = &lt;&lt;Small:0&gt;&gt;,
<a name="952"/>  952:     &lt;&lt;&gt;&gt; = &lt;&lt;Big:Z&gt;&gt;,
<a name="953"/>  953:     &lt;&lt;&gt;&gt; = &lt;&lt;Big:0&gt;&gt;,
<a name="954"/>  954:     
<a name="955"/>  955:     {'EXIT',{badarg,_}} = (catch &lt;&lt;not_a_number:0&gt;&gt;),
<a name="956"/>  956:     {'EXIT',{badarg,_}} = (catch &lt;&lt;(id(not_a_number)):Z&gt;&gt;),
<a name="957"/>  957:     {'EXIT',{badarg,_}} = (catch &lt;&lt;(id(not_a_number)):0&gt;&gt;),
<a name="958"/>  958: 
<a name="zero_width-last_expr"/><a name="959"/>  959:     ok.
<a name="960"/>  960: 
<a name="bad_append-1"/><a name="961"/>  961: <b>bad_append</b>(_) -&gt;
<a name="962"/>  962:     do_bad_append(&lt;&lt;127:1&gt;&gt;, fun append_unit_3/1),
<a name="963"/>  963:     do_bad_append(&lt;&lt;127:2&gt;&gt;, fun append_unit_3/1),
<a name="964"/>  964:     do_bad_append(&lt;&lt;127:17&gt;&gt;, fun append_unit_3/1),
<a name="965"/>  965: 
<a name="966"/>  966:     do_bad_append(&lt;&lt;127:3&gt;&gt;, fun append_unit_4/1),
<a name="967"/>  967:     do_bad_append(&lt;&lt;127:5&gt;&gt;, fun append_unit_4/1),
<a name="968"/>  968:     do_bad_append(&lt;&lt;127:7&gt;&gt;, fun append_unit_4/1),
<a name="969"/>  969:     do_bad_append(&lt;&lt;127:199&gt;&gt;, fun append_unit_4/1),
<a name="970"/>  970: 
<a name="971"/>  971:     do_bad_append(&lt;&lt;127:7&gt;&gt;, fun append_unit_8/1),
<a name="972"/>  972:     do_bad_append(&lt;&lt;127:9&gt;&gt;, fun append_unit_8/1),
<a name="973"/>  973: 
<a name="974"/>  974:     do_bad_append(&lt;&lt;0:8&gt;&gt;, fun append_unit_16/1),
<a name="975"/>  975:     do_bad_append(&lt;&lt;0:15&gt;&gt;, fun append_unit_16/1),
<a name="976"/>  976:     do_bad_append(&lt;&lt;0:17&gt;&gt;, fun append_unit_16/1),
<a name="bad_append-last_expr"/><a name="977"/>  977:     ok.
<a name="978"/>  978: 
<a name="do_bad_append-2"/><a name="979"/>  979: <b>do_bad_append</b>(Bin0, Appender) -&gt;
<a name="980"/>  980:     {'EXIT',{badarg,_}} = (catch Appender(Bin0)),
<a name="981"/>  981: 
<a name="982"/>  982:     Bin1 = id(&lt;&lt;0:3,Bin0/bitstring&gt;&gt;),
<a name="983"/>  983:     &lt;&lt;_:3,Bin2/bitstring&gt;&gt; = Bin1,
<a name="984"/>  984:     {'EXIT',{badarg,_}} = (catch Appender(Bin2)),
<a name="985"/>  985: 
<a name="986"/>  986:     %% Create a writable binary.
<a name="987"/>  987:     Empty = id(&lt;&lt;&gt;&gt;),
<a name="988"/>  988:     Bin3 = &lt;&lt;Empty/bitstring,Bin0/bitstring&gt;&gt;,
<a name="989"/>  989:     {'EXIT',{badarg,_}} = (catch Appender(Bin3)),
<a name="do_bad_append-last_expr"/><a name="990"/>  990:     ok.
<a name="991"/>  991: 
<a name="append_unit_3-1"/><a name="992"/>  992: <b>append_unit_3</b>(Bin) -&gt;
<a name="append_unit_3-last_expr"/><a name="993"/>  993:     &lt;&lt;Bin/binary-unit:3,0:1&gt;&gt;.
<a name="994"/>  994: 
<a name="append_unit_4-1"/><a name="995"/>  995: <b>append_unit_4</b>(Bin) -&gt;
<a name="append_unit_4-last_expr"/><a name="996"/>  996:     &lt;&lt;Bin/binary-unit:4,0:1&gt;&gt;.
<a name="997"/>  997: 
<a name="append_unit_8-1"/><a name="998"/>  998: <b>append_unit_8</b>(Bin) -&gt;
<a name="append_unit_8-last_expr"/><a name="999"/>  999:     &lt;&lt;Bin/binary,0:1&gt;&gt;.
<a name="1000"/> 1000: 
<a name="append_unit_16-1"/><a name="1001"/> 1001: <b>append_unit_16</b>(Bin) -&gt;
<a name="append_unit_16-last_expr"/><a name="1002"/> 1002:     &lt;&lt;Bin/binary-unit:16,0:1&gt;&gt;.
<a name="1003"/> 1003: 
<a name="1004"/> 1004: <i>%% Test that the bs_append instruction will correctly check for</i>
<a name="1005"/> 1005: <i>%% overflow by producing a binary whose total size would exceed the</i>
<a name="1006"/> 1006: <i>%% maximum allowed size for a binary on a 32-bit computer.</i>
<a name="1007"/> 1007: 
<a name="bs_append_overflow-1"/><a name="1008"/> 1008: <b>bs_append_overflow</b>(_Config) -&gt;
<a name="1009"/> 1009:     Memsize = memsize(),
<a name="1010"/> 1010:     io:format(&quot;Memsize = ~w Bytes~n&quot;, [Memsize]),
<a name="bs_append_overflow-last_expr"/><a name="1011"/> 1011: <b>    case erlang:system_info</b>(wordsize) of
<a name="1012"/> 1012: 	8 -&gt;
<a name="1013"/> 1013:             %% Not possible to test on a 64-bit computer.
<a name="1014"/> 1014: 	    {skip, &quot;64-bit architecture&quot;};
<a name="1015"/> 1015:         _ when Memsize &lt; (2 bsl 30) -&gt;
<a name="1016"/> 1016: 	    {skip, &quot;Less than 2 GB of memory&quot;};
<a name="1017"/> 1017: 	4 -&gt;
<a name="1018"/> 1018:             {'EXIT', {system_limit, _}} = (catch bs_append_overflow_signed()),
<a name="1019"/> 1019:             erlang:garbage_collect(),
<a name="1020"/> 1020:             {'EXIT', {system_limit, _}} = (catch bs_append_overflow_unsigned()),
<a name="1021"/> 1021:             erlang:garbage_collect(),
<a name="1022"/> 1022: 	    ok
<a name="1023"/> 1023:     end.
<a name="1024"/> 1024: 
<a name="bs_append_overflow_signed-0"/><a name="1025"/> 1025: <b>bs_append_overflow_signed</b>() -&gt;
<a name="1026"/> 1026:     %% Produce a large binary that, if cast to signed int, would
<a name="1027"/> 1027:     %% overflow into a negative number that fits a smallnum.
<a name="1028"/> 1028:     Large = &lt;&lt;0:((1 bsl 30)-1)&gt;&gt;,
<a name="bs_append_overflow_signed-last_expr"/><a name="1029"/> 1029:     &lt;&lt;Large/bits, Large/bits, Large/bits, Large/bits,
<a name="1030"/> 1030:       Large/bits, Large/bits, Large/bits, Large/bits,
<a name="1031"/> 1031:       Large/bits&gt;&gt;.
<a name="1032"/> 1032: 
<a name="bs_append_overflow_unsigned-0"/><a name="1033"/> 1033: <b>bs_append_overflow_unsigned</b>() -&gt;
<a name="1034"/> 1034:     %% The following would succeed but would produce an incorrect result
<a name="1035"/> 1035:     %% where B =:= C!
<a name="1036"/> 1036:     A = &lt;&lt;0:((1 bsl 32)-8)&gt;&gt;,
<a name="1037"/> 1037:     B = &lt;&lt;2, 3&gt;&gt;,
<a name="1038"/> 1038:     C = &lt;&lt;A/binary,1,B/binary&gt;&gt;,
<a name="bs_append_overflow_unsigned-last_expr"/><a name="1039"/> 1039: <b>    true = byte_size</b>(B) &lt; byte_size(C).
<a name="1040"/> 1040: 
<a name="bs_append_offheap-1"/><a name="1041"/> 1041: <b>bs_append_offheap</b>(Config) when is_list(Config) -&gt;
<a name="1042"/> 1042:     %% test that erts_bs_private_append is reflected correctly in
<a name="1043"/> 1043:     %%  process_info(Pid, binary()) report for off-heap binaries.
<a name="1044"/> 1044:     {Pid, MRef} = erlang:spawn_monitor(fun bs_append_offheap_proc/0),
<a name="bs_append_offheap-last_expr"/><a name="1045"/> 1045:     receive
<a name="1046"/> 1046:         {'DOWN', MRef, process, Pid, normal} -&gt;
<a name="1047"/> 1047:             ok;
<a name="1048"/> 1048:         {'DOWN', MRef, process, Pid, {{badmatch,[{binary,[]}]}, _}} -&gt;
<a name="1049"/> 1049:             {fail, &quot;missing binary in erts_bs_private_append&quot;}
<a name="1050"/> 1050:     end.
<a name="1051"/> 1051: 
<a name="bs_append_offheap_proc-0"/><a name="1052"/> 1052: <b>bs_append_offheap_proc</b>() -&gt;
<a name="1053"/> 1053:     Self = self(),
<a name="1054"/> 1054:     Len = 128,
<a name="1055"/> 1055:     OffHeapBin = list_to_binary(lists:duplicate(Len, $b)),
<a name="1056"/> 1056:     erlang:garbage_collect(Self),
<a name="1057"/> 1057:     [{binary, [{_, Len, 1}]}] = erlang:process_info(Self, [binary]),
<a name="1058"/> 1058:     Bin = &lt;&lt;OffHeapBin/binary, &quot;a&quot;&gt;&gt;,
<a name="1059"/> 1059:     erlang:garbage_collect(Self),
<a name="1060"/> 1060:     %% expect a single binary (2 bytes longer than the original)
<a name="1061"/> 1061:     [{binary, [{_, _, 1}]}] = erlang:process_info(Self, [binary]),
<a name="bs_append_offheap_proc-last_expr"/><a name="1062"/> 1062:     Bin.
<a name="1063"/> 1063: 
<a name="reductions-1"/><a name="1064"/> 1064: <b>reductions</b>(_Config) -&gt;
<a name="1065"/> 1065:     TwoMeg = &lt;&lt;0:(2_000*1024)/unit:8&gt;&gt;,
<a name="1066"/> 1066:     reds_at_least(2000, fun() -&gt; &lt;&lt;0:8,TwoMeg/binary&gt;&gt; end),
<a name="1067"/> 1067:     reds_at_least(4000, fun() -&gt; &lt;&lt;0:8,TwoMeg/binary,TwoMeg/binary&gt;&gt; end),
<a name="1068"/> 1068:     reds_at_least(1000, fun() -&gt; &lt;&lt;0:8,TwoMeg:(1000*1024)/binary&gt;&gt; end),
<a name="1069"/> 1069: 
<a name="1070"/> 1070:     %% Here we expect about 500 reductions in the bs_append
<a name="1071"/> 1071:     %% instruction for setting up a writable binary and about 2000
<a name="1072"/> 1072:     %% reductions in the bs_put_binary instruction for copying the
<a name="1073"/> 1073:     %% binary data.
<a name="1074"/> 1074:     reds_at_least(2500, fun() -&gt; &lt;&lt;TwoMeg/binary,TwoMeg:(2000*1024)/binary&gt;&gt; end),
<a name="reductions-last_expr"/><a name="1075"/> 1075:     ok.
<a name="1076"/> 1076: 
<a name="reds_at_least-2"/><a name="1077"/> 1077: <b>reds_at_least</b>(N, Fun) -&gt;
<a name="1078"/> 1078:     receive after 1 -&gt; ok end,
<a name="1079"/> 1079:     {reductions,Red0} = process_info(self(), reductions),
<a name="1080"/> 1080:     _ = Fun(),
<a name="1081"/> 1081:     {reductions,Red1} = process_info(self(), reductions),
<a name="1082"/> 1082:     Diff = Red1 - Red0,
<a name="1083"/> 1083:     io:format(&quot;Expected at least ~p; got ~p\n&quot;, [N,Diff]),
<a name="reds_at_least-last_expr"/><a name="1084"/> 1084:     if
<a name="1085"/> 1085:         Diff &gt;= N -&gt;
<a name="1086"/> 1086:             ok;
<a name="1087"/> 1087:         Diff -&gt;
<a name="1088"/> 1088:             ct:fail({expected,N,got,Diff})
<a name="1089"/> 1089:     end.
<a name="memsize-0"/><a name="1090"/> 1090: <b>memsize</b>() -&gt;
<a name="1091"/> 1091:     application:ensure_all_started(os_mon),
<a name="memsize-last_expr"/><a name="1092"/> 1092: <b>    case proplists:get_value</b>(available_memory, memsup:get_system_memory_data()) of
<a name="1093"/> 1093:         undefined -&gt;
<a name="1094"/> 1094:             {Tot,_Used,_}  = memsup:get_memory_data(),
<a name="1095"/> 1095:             Tot;
<a name="1096"/> 1096:         Available -&gt;
<a name="1097"/> 1097:             Available
<a name="1098"/> 1098:     end.
<a name="1099"/> 1099: 
<a name="1100"/> 1100: <b>-define</b>(FP16(EncodedInt, Float),
<a name="1101"/> 1101:         (fun(NlInt, NlFloat) -&gt;
<a name="1102"/> 1102:                  {0, true} = {0, &lt;&lt;NlInt:16&gt;&gt; =:= &lt;&lt;NlFloat:16/float&gt;&gt;},
<a name="1103"/> 1103:                  {1, true} = {1, &lt;&lt;(NlInt+16#8000):16&gt;&gt; =:= &lt;&lt;-NlFloat:16/float&gt;&gt;},
<a name="1104"/> 1104:                  {2, true} = {2, &lt;&lt;NlInt:16/little&gt;&gt; =:= &lt;&lt;NlFloat:16/float-little&gt;&gt;},
<a name="1105"/> 1105:                  {3, true} = {3, &lt;&lt;(NlInt+16#8000):16/little&gt;&gt; =:= &lt;&lt;-NlFloat:16/float-little&gt;&gt;},
<a name="1106"/> 1106:                  {4, true} = {4, &lt;&lt;NlInt:16/native&gt;&gt; =:= &lt;&lt;NlFloat:16/float-native&gt;&gt;},
<a name="1107"/> 1107:                  {5, true} = {5, &lt;&lt;(NlInt+16#8000):16/native&gt;&gt; =:= &lt;&lt;-NlFloat:16/float-native&gt;&gt;}
<a name="1108"/> 1108:          end)(nonliteral(EncodedInt), nonliteral(Float)),
<a name="1109"/> 1109:         {a, true} = {a, &lt;&lt;EncodedInt:16&gt;&gt; =:= &lt;&lt;Float:16/float&gt;&gt;},
<a name="1110"/> 1110:         {b, true} = {b, &lt;&lt;(EncodedInt+16#8000):16&gt;&gt; =:= &lt;&lt;-Float:16/float&gt;&gt;},
<a name="1111"/> 1111:         {c, true} = {c, &lt;&lt;EncodedInt:16/little&gt;&gt; =:= &lt;&lt;Float:16/float-little&gt;&gt;},
<a name="1112"/> 1112:         {d, true} = {d, &lt;&lt;(EncodedInt+16#8000):16/little&gt;&gt; =:= &lt;&lt;-Float:16/float-little&gt;&gt;},
<a name="1113"/> 1113:         {e, true} = {e, &lt;&lt;EncodedInt:16/native&gt;&gt; =:= &lt;&lt;Float:16/float-native&gt;&gt;},
<a name="1114"/> 1114:         {f, true} = {f, &lt;&lt;(EncodedInt+16#8000):16/native&gt;&gt; =:= &lt;&lt;-Float:16/float-native&gt;&gt;}).
<a name="1115"/> 1115: 
<a name="fp16-1"/><a name="1116"/> 1116: <b>fp16</b>(_Config) -&gt;
<a name="1117"/> 1117:     %% smallest positive subnormal number
<a name="1118"/> 1118:     ?FP16(16#0001, 0.000000059604645),
<a name="1119"/> 1119:     %% largest positive subnormal number
<a name="1120"/> 1120:     ?FP16(16#03ff, 0.000060975552),
<a name="1121"/> 1121:     %% smallest positive normal number
<a name="1122"/> 1122:     ?FP16(16#0400, 0.00006103515625),
<a name="1123"/> 1123:     %% largest normal number
<a name="1124"/> 1124:     ?FP16(16#7bff, 65504),
<a name="1125"/> 1125:     ?FP16(16#7bff, 65504.0),
<a name="1126"/> 1126:     %% largest number less than one
<a name="1127"/> 1127:     ?FP16(16#3bff, 0.99951172),
<a name="1128"/> 1128:     %% zero
<a name="1129"/> 1129:     ?FP16(16#0000, 0.0),
<a name="1130"/> 1130:     %% one
<a name="1131"/> 1131:     ?FP16(16#3c00, 1),
<a name="1132"/> 1132:     ?FP16(16#3c00, 1.0),
<a name="1133"/> 1133:     %% smallest number larger than one
<a name="1134"/> 1134:     ?FP16(16#3c01, 1.00097656),
<a name="1135"/> 1135:     %% rounding of 1/3 to nearest
<a name="1136"/> 1136:     ?FP16(16#3555, 0.33325195),
<a name="1137"/> 1137:     %% others
<a name="1138"/> 1138:     ?FP16(16#4000, 2),
<a name="1139"/> 1139:     ?FP16(16#4000, 2.0),
<a name="fp16-last_expr"/><a name="1140"/> 1140:     ok.
<a name="1141"/> 1141: 
<a name="zero_init-1"/><a name="1142"/> 1142: <b>zero_init</b>(_Config) -&gt;
<a name="1143"/> 1143:     &lt;&lt;LPad:64/bits,RPad:64/bits&gt;&gt; = id(erlang:md5([42])),
<a name="1144"/> 1144:     Sizes = [511,512,513, 767,768,769, 1023,1024,1025,
<a name="1145"/> 1145:              16#7fff,16#ffff,16#10000] ++ lists:seq(0, 257),
<a name="1146"/> 1146:     _ = [do_zero_init(Size, LPad, RPad) || Size &lt;- Sizes],
<a name="zero_init-last_expr"/><a name="1147"/> 1147:     ok.
<a name="1148"/> 1148: 
<a name="do_zero_init-3"/><a name="1149"/> 1149: <b>do_zero_init</b>(Size, LPad, RPad) -&gt;
<a name="do_zero_init-last_expr"/><a name="1150"/> 1150:     try
<a name="1151"/> 1151:         do_zero_init_1(Size, LPad, RPad)
<a name="1152"/> 1152:     catch
<a name="1153"/> 1153:         C:R:Stk -&gt;
<a name="1154"/> 1154:             io:format(&quot;Size = ~p, LPad = ~p, RPad = ~p\n&quot;, [Size, LPad, RPad]),
<a name="1155"/> 1155:             erlang:raise(C, R, Stk)
<a name="1156"/> 1156:     end.
<a name="1157"/> 1157: 
<a name="do_zero_init_1-3"/><a name="1158"/> 1158: <b>do_zero_init_1</b>(Size, LPad, RPad) -&gt;
<a name="1159"/> 1159:     Zeroes = id(&lt;&lt;0:Size&gt;&gt;),
<a name="1160"/> 1160:     &lt;&lt;0:Size&gt;&gt; = Zeroes,
<a name="1161"/> 1161:     Bin = id(&lt;&lt;LPad:64/bits, Zeroes/bits, RPad:64/bits&gt;&gt;),
<a name="1162"/> 1162:     Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;),
<a name="1163"/> 1163:     Bin = id(&lt;&lt;LPad:(id(64))/bits, 0:Size, RPad:64/bits&gt;&gt;),
<a name="1164"/> 1164: 
<a name="1165"/> 1165:     if
<a name="1166"/> 1166:         Size rem 11 =:= 0 -&gt;
<a name="1167"/> 1167:             Bin = id(&lt;&lt;LPad:64/bits, 0:(Size div 11)/unit:11, RPad:64/bits&gt;&gt;);
<a name="1168"/> 1168:         true -&gt;
<a name="1169"/> 1169:             ok
<a name="1170"/> 1170:     end,
<a name="1171"/> 1171: 
<a name="do_zero_init_1-last_expr"/><a name="1172"/> 1172:     case Size of
<a name="1173"/> 1173:         0 -&gt;
<a name="1174"/> 1174:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1175"/> 1175:         1 -&gt;
<a name="1176"/> 1176:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1177"/> 1177:         2 -&gt;
<a name="1178"/> 1178:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1179"/> 1179:         3 -&gt;
<a name="1180"/> 1180:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1181"/> 1181:         4 -&gt;
<a name="1182"/> 1182:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1183"/> 1183:         5 -&gt;
<a name="1184"/> 1184:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1185"/> 1185:         6 -&gt;
<a name="1186"/> 1186:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1187"/> 1187:         7 -&gt;
<a name="1188"/> 1188:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1189"/> 1189:         8 -&gt;
<a name="1190"/> 1190:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1191"/> 1191:         9 -&gt;
<a name="1192"/> 1192:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1193"/> 1193:         10 -&gt;
<a name="1194"/> 1194:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1195"/> 1195:         11 -&gt;
<a name="1196"/> 1196:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1197"/> 1197:         12 -&gt;
<a name="1198"/> 1198:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1199"/> 1199:         13 -&gt;
<a name="1200"/> 1200:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1201"/> 1201:         14 -&gt;
<a name="1202"/> 1202:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1203"/> 1203:         15 -&gt;
<a name="1204"/> 1204:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1205"/> 1205:         16 -&gt;
<a name="1206"/> 1206:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1207"/> 1207: 
<a name="1208"/> 1208:         31 -&gt;
<a name="1209"/> 1209:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1210"/> 1210:         32 -&gt;
<a name="1211"/> 1211:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1212"/> 1212:         33 -&gt;
<a name="1213"/> 1213:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1214"/> 1214: 
<a name="1215"/> 1215:         47 -&gt;
<a name="1216"/> 1216:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1217"/> 1217:         48 -&gt;
<a name="1218"/> 1218:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1219"/> 1219:         49 -&gt;
<a name="1220"/> 1220:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1221"/> 1221: 
<a name="1222"/> 1222:         63 -&gt;
<a name="1223"/> 1223:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1224"/> 1224:         64 -&gt;
<a name="1225"/> 1225:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1226"/> 1226:         65 -&gt;
<a name="1227"/> 1227:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1228"/> 1228: 
<a name="1229"/> 1229:         79 -&gt;
<a name="1230"/> 1230:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1231"/> 1231:         80 -&gt;
<a name="1232"/> 1232:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1233"/> 1233:         81 -&gt;
<a name="1234"/> 1234:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1235"/> 1235: 
<a name="1236"/> 1236:         90 -&gt;
<a name="1237"/> 1237:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1238"/> 1238:         91 -&gt;
<a name="1239"/> 1239:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1240"/> 1240:         92 -&gt;
<a name="1241"/> 1241:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1242"/> 1242:         93 -&gt;
<a name="1243"/> 1243:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1244"/> 1244:         94 -&gt;
<a name="1245"/> 1245:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1246"/> 1246:         95 -&gt;
<a name="1247"/> 1247:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1248"/> 1248:         96 -&gt;
<a name="1249"/> 1249:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1250"/> 1250:         97 -&gt;
<a name="1251"/> 1251:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1252"/> 1252:         98 -&gt;
<a name="1253"/> 1253:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1254"/> 1254:         99 -&gt;
<a name="1255"/> 1255:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1256"/> 1256:         100 -&gt;
<a name="1257"/> 1257:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1258"/> 1258:         101 -&gt;
<a name="1259"/> 1259:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1260"/> 1260:         102 -&gt;
<a name="1261"/> 1261:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1262"/> 1262:         103 -&gt;
<a name="1263"/> 1263:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1264"/> 1264:         104 -&gt;
<a name="1265"/> 1265:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1266"/> 1266:         105 -&gt;
<a name="1267"/> 1267:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1268"/> 1268:         106 -&gt;
<a name="1269"/> 1269:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1270"/> 1270:         107 -&gt;
<a name="1271"/> 1271:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1272"/> 1272:         108 -&gt;
<a name="1273"/> 1273:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1274"/> 1274:         109 -&gt;
<a name="1275"/> 1275:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1276"/> 1276: 
<a name="1277"/> 1277:         127 -&gt;
<a name="1278"/> 1278:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1279"/> 1279:         128 -&gt;
<a name="1280"/> 1280:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1281"/> 1281:         129 -&gt;
<a name="1282"/> 1282:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1283"/> 1283:         130 -&gt;
<a name="1284"/> 1284:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1285"/> 1285:         131 -&gt;
<a name="1286"/> 1286:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1287"/> 1287:         132 -&gt;
<a name="1288"/> 1288:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1289"/> 1289:         133 -&gt;
<a name="1290"/> 1290:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1291"/> 1291:         134 -&gt;
<a name="1292"/> 1292:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1293"/> 1293:         135 -&gt;
<a name="1294"/> 1294:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1295"/> 1295:         136 -&gt;
<a name="1296"/> 1296:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1297"/> 1297:         137 -&gt;
<a name="1298"/> 1298:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1299"/> 1299:         138 -&gt;
<a name="1300"/> 1300:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1301"/> 1301:         139 -&gt;
<a name="1302"/> 1302:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1303"/> 1303:         140 -&gt;
<a name="1304"/> 1304:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1305"/> 1305:         141 -&gt;
<a name="1306"/> 1306:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1307"/> 1307:         142 -&gt;
<a name="1308"/> 1308:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1309"/> 1309:         143 -&gt;
<a name="1310"/> 1310:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1311"/> 1311:         144 -&gt;
<a name="1312"/> 1312:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1313"/> 1313:         145 -&gt;
<a name="1314"/> 1314:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1315"/> 1315: 
<a name="1316"/> 1316:         159 -&gt;
<a name="1317"/> 1317:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1318"/> 1318:         160 -&gt;
<a name="1319"/> 1319:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1320"/> 1320:         161 -&gt;
<a name="1321"/> 1321:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1322"/> 1322: 
<a name="1323"/> 1323:         191 -&gt;
<a name="1324"/> 1324:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1325"/> 1325:         192 -&gt;
<a name="1326"/> 1326:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1327"/> 1327:         193 -&gt;
<a name="1328"/> 1328:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1329"/> 1329: 
<a name="1330"/> 1330:         255 -&gt;
<a name="1331"/> 1331:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1332"/> 1332:         256 -&gt;
<a name="1333"/> 1333:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1334"/> 1334:         257 -&gt;
<a name="1335"/> 1335:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1336"/> 1336: 
<a name="1337"/> 1337:         511 -&gt;
<a name="1338"/> 1338:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1339"/> 1339:         512 -&gt;
<a name="1340"/> 1340:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1341"/> 1341:         513 -&gt;
<a name="1342"/> 1342:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1343"/> 1343: 
<a name="1344"/> 1344:         767 -&gt;
<a name="1345"/> 1345:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1346"/> 1346:         768 -&gt;
<a name="1347"/> 1347:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1348"/> 1348:         769 -&gt;
<a name="1349"/> 1349:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1350"/> 1350: 
<a name="1351"/> 1351:         1023 -&gt;
<a name="1352"/> 1352:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1353"/> 1353:         1024 -&gt;
<a name="1354"/> 1354:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1355"/> 1355:         1025 -&gt;
<a name="1356"/> 1356:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1357"/> 1357: 
<a name="1358"/> 1358:         16#7fff -&gt;
<a name="1359"/> 1359:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1360"/> 1360:         16#ffff -&gt;
<a name="1361"/> 1361:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1362"/> 1362:         16#10000 -&gt;
<a name="1363"/> 1363:             Bin = id(&lt;&lt;LPad:64/bits, 0:Size, RPad:64/bits&gt;&gt;);
<a name="1364"/> 1364:         _ -&gt;
<a name="1365"/> 1365:             ok
<a name="1366"/> 1366:     end.
<a name="1367"/> 1367: 
<a name="1368"/> 1368: 
<a name="1369"/> 1369: <b>-define</b>(ERROR_INFO(Expr),
<a name="1370"/> 1370:         fun() -&gt;
<a name="1371"/> 1371:                 try Expr of
<a name="1372"/> 1372:                     _ -&gt;
<a name="1373"/> 1373:                         error(should_fail)
<a name="1374"/> 1374:                 catch
<a name="1375"/> 1375:                     error:Reason:Stk -&gt;
<a name="1376"/> 1376:                         error_info_verify(Reason, Stk, ??Expr, #{})
<a name="1377"/> 1377:                 end
<a name="1378"/> 1378:         end()).
<a name="1379"/> 1379: 
<a name="1380"/> 1380: <b>-define</b>(ERROR_INFO(Expr, Overrides),
<a name="1381"/> 1381:         fun() -&gt;
<a name="1382"/> 1382:                 try Expr of
<a name="1383"/> 1383:                     _ -&gt;
<a name="1384"/> 1384:                         error(should_fail)
<a name="1385"/> 1385:                 catch
<a name="1386"/> 1386:                     error:Reason:Stk -&gt;
<a name="1387"/> 1387:                         error_info_verify(Reason, Stk, ??Expr, Overrides)
<a name="1388"/> 1388:                 end
<a name="1389"/> 1389:         end()).
<a name="1390"/> 1390: 
<a name="error_info-1"/><a name="1391"/> 1391: <b>error_info</b>(_Config) -&gt;
<a name="1392"/> 1392:     Atom = id(some_atom),
<a name="1393"/> 1393:     NegSize = id(-1),
<a name="1394"/> 1394:     HugeNegSize = id(-1 bsl 64),
<a name="1395"/> 1395:     Binary = id(&lt;&lt;&quot;abc&quot;&gt;&gt;),
<a name="1396"/> 1396:     HugeBig = id(1 bsl 1500),
<a name="1397"/> 1397:     LongList = lists:seq(1, 100),
<a name="1398"/> 1398:     BadBinary = id(ok),
<a name="1399"/> 1399:     BadSize = case Atom of
<a name="1400"/> 1400:                   a -&gt; 0;
<a name="1401"/> 1401:                   _ -&gt; bad_size
<a name="1402"/> 1402:               end,
<a name="1403"/> 1403: 
<a name="1404"/> 1404:     {badarg, {1,binary,type,Atom}, _} = ?ERROR_INFO(&lt;&lt;Atom/binary, Binary/binary&gt;&gt;),
<a name="1405"/> 1405:     {badarg, {2,binary,type,Atom}, _} = ?ERROR_INFO(&lt;&lt;Binary/binary, Atom/binary&gt;&gt;),
<a name="1406"/> 1406:     {badarg, {3,binary,type,Atom}, _} = ?ERROR_INFO(&lt;&lt;1:32, Binary/binary, Atom/binary&gt;&gt;),
<a name="1407"/> 1407:     {badarg, {4,binary,type,Atom}, _} = ?ERROR_INFO(&lt;&lt;1:32, &quot;xyz&quot;, Binary/binary, Atom/binary&gt;&gt;),
<a name="1408"/> 1408: 
<a name="1409"/> 1409:     {badarg, {1,integer,type,Atom}, _} = ?ERROR_INFO(&lt;&lt;Atom:32&gt;&gt;),
<a name="1410"/> 1410:     {badarg, {1,integer,type,Atom}, _} = ?ERROR_INFO(&lt;&lt;Atom:(id(32))&gt;&gt;),
<a name="1411"/> 1411:     {badarg, {1,integer,type,LongList}, _} = ?ERROR_INFO(&lt;&lt;LongList:32&gt;&gt;),
<a name="1412"/> 1412:     {badarg, {1,integer,size,Atom}, _} = ?ERROR_INFO(&lt;&lt;42:Atom&gt;&gt;),
<a name="1413"/> 1413:     {badarg, {1,integer,type,Atom}, _} = ?ERROR_INFO(&lt;&lt;Atom:32&gt;&gt;),
<a name="1414"/> 1414:     {badarg, {1,integer,size,NegSize}, _} = ?ERROR_INFO(&lt;&lt;42:NegSize&gt;&gt;),
<a name="1415"/> 1415:     {badarg, {1,integer,size,HugeNegSize}, _} = ?ERROR_INFO(&lt;&lt;42:HugeNegSize&gt;&gt;),
<a name="1416"/> 1416:     {system_limit, {1,integer,size,1 bsl 58}, _} = ?ERROR_INFO(&lt;&lt;42:(1 bsl 58)/unit:255&gt;&gt;),
<a name="1417"/> 1417:     {system_limit, {1,integer,size,1 bsl 60}, _} = ?ERROR_INFO(&lt;&lt;42:(1 bsl 60)/unit:8&gt;&gt;),
<a name="1418"/> 1418:     {system_limit, {1,integer,size,1 bsl 64}, _} = ?ERROR_INFO(&lt;&lt;42:(1 bsl 64)&gt;&gt;),
<a name="1419"/> 1419: 
<a name="1420"/> 1420:     {badarg, {1,binary,type,Atom}, _} = ?ERROR_INFO(&lt;&lt;Atom:10/binary&gt;&gt;),
<a name="1421"/> 1421:     {badarg, {1,binary,type,Atom}, _} = ?ERROR_INFO(&lt;&lt;Atom:(id(10))/binary&gt;&gt;),
<a name="1422"/> 1422:     {badarg, {1,binary,size,Atom}, _} = ?ERROR_INFO(&lt;&lt;Binary:Atom/binary&gt;&gt;),
<a name="1423"/> 1423:     {badarg, {1,binary,size,NegSize}, _} = ?ERROR_INFO(&lt;&lt;Binary:NegSize/binary&gt;&gt;),
<a name="1424"/> 1424:     {badarg, {1,binary,size,HugeNegSize}, _} = ?ERROR_INFO(&lt;&lt;Binary:HugeNegSize/binary&gt;&gt;),
<a name="1425"/> 1425:     {badarg, {1,binary,size,BadSize}, _} = ?ERROR_INFO(&lt;&lt;Binary:BadSize/binary&gt;&gt;),
<a name="1426"/> 1426:     {badarg, {1,binary,size,BadSize}, _} = ?ERROR_INFO(&lt;&lt;BadBinary:BadSize/binary&gt;&gt;),
<a name="1427"/> 1427:     {badarg, {1,binary,short,Binary}, _} = ?ERROR_INFO(&lt;&lt;Binary:10/binary&gt;&gt;),
<a name="1428"/> 1428:     {badarg, {1,binary,short,Binary}, _} = ?ERROR_INFO(&lt;&lt;Binary:(id(10))/binary&gt;&gt;),
<a name="1429"/> 1429:     {badarg, {1,binary,type,Atom}, _} = ?ERROR_INFO(&lt;&lt;Atom/binary&gt;&gt;),
<a name="1430"/> 1430:     {badarg, {1,binary,unit,&lt;&lt;1:1&gt;&gt;}, _} = ?ERROR_INFO(&lt;&lt;(id(&lt;&lt;1:1&gt;&gt;))/binary&gt;&gt;),
<a name="1431"/> 1431:     {badarg, {1,binary,unit,&lt;&lt;0:1111&gt;&gt;}, _} = ?ERROR_INFO(&lt;&lt;(id(&lt;&lt;0:1111&gt;&gt;))/binary&gt;&gt;),
<a name="1432"/> 1432:     {badarg, {2,binary,unit,&lt;&lt;1:1&gt;&gt;}, _} = ?ERROR_INFO(&lt;&lt;0, (id(&lt;&lt;1:1&gt;&gt;))/binary&gt;&gt;),
<a name="1433"/> 1433:     {badarg, {2,binary,unit,&lt;&lt;0:1111&gt;&gt;}, _} = ?ERROR_INFO(&lt;&lt;0, (id(&lt;&lt;0:1111&gt;&gt;))/binary&gt;&gt;),
<a name="1434"/> 1434:     {system_limit, {1,binary,size,1 bsl 64}, _} = ?ERROR_INFO(&lt;&lt;Binary:(1 bsl 64)/binary&gt;&gt;),
<a name="1435"/> 1435:     {system_limit, {1,binary,size,1 bsl 64}, _} = ?ERROR_INFO(&lt;&lt;Binary:(id(1 bsl 64))/binary&gt;&gt;),
<a name="1436"/> 1436: 
<a name="1437"/> 1437:     {badarg, {1,float,type,Atom}, _} = ?ERROR_INFO(&lt;&lt;Atom:64/float&gt;&gt;),
<a name="1438"/> 1438:     {badarg, {1,float,size,Atom}, _} = ?ERROR_INFO(&lt;&lt;Atom:Atom/float&gt;&gt;),
<a name="1439"/> 1439:     {badarg, {1,float,size,NegSize}, _} = ?ERROR_INFO(&lt;&lt;42.0:NegSize/float&gt;&gt;),
<a name="1440"/> 1440:     {badarg, {1,float,size,HugeNegSize}, _} = ?ERROR_INFO(&lt;&lt;42.0:HugeNegSize/float&gt;&gt;),
<a name="1441"/> 1441:     {badarg, {1,float,invalid,1}, _} = ?ERROR_INFO(&lt;&lt;42.0:(id(1))/float&gt;&gt;),
<a name="1442"/> 1442:     {badarg, {1,float,no_float,HugeBig}, _} = ?ERROR_INFO(&lt;&lt;HugeBig:(id(64))/float&gt;&gt;),
<a name="1443"/> 1443:     {badarg, {1,float,no_float,HugeBig}, _} = ?ERROR_INFO(&lt;&lt;HugeBig:64/float&gt;&gt;),
<a name="1444"/> 1444:     {system_limit, {1,float,size,1 bsl 64}, _} = ?ERROR_INFO(&lt;&lt;42.0:(id(1 bsl 64))/float&gt;&gt;),
<a name="1445"/> 1445: 
<a name="1446"/> 1446:     {badarg, {1,utf8,type,Atom}, _} = ?ERROR_INFO(&lt;&lt;Atom/utf8&gt;&gt;),
<a name="1447"/> 1447:     {badarg, {1,utf16,type,Atom}, _} = ?ERROR_INFO(&lt;&lt;Atom/utf16&gt;&gt;),
<a name="1448"/> 1448:     {badarg, {1,utf32,type,Atom}, _} = ?ERROR_INFO(&lt;&lt;Atom/utf32&gt;&gt;),
<a name="1449"/> 1449: 
<a name="1450"/> 1450:     Bin = id(&lt;&lt;&gt;&gt;),
<a name="1451"/> 1451:     Float = id(42.0),
<a name="1452"/> 1452:     MaxSmall = (1 bsl 59) - 1,                  %Max small for 64-bit architectures.
<a name="1453"/> 1453: 
<a name="1454"/> 1454:     %% Attempt constructing a binary with total size 1^64 + 32.
<a name="1455"/> 1455: 
<a name="1456"/> 1456:     {system_limit, {1,integer,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;0:(MaxSmall)/unit:32,0:64&gt;&gt;),
<a name="1457"/> 1457:     {system_limit, {1,integer,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;0:(MaxSmall)/unit:32,(id(0)):64&gt;&gt;),
<a name="1458"/> 1458:     {system_limit, {1,integer,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;0:(id(MaxSmall))/unit:32,0:64&gt;&gt;),
<a name="1459"/> 1459:     {system_limit, {1,integer,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;0:(id(MaxSmall))/unit:32,(id(0)):64&gt;&gt;),
<a name="1460"/> 1460: 
<a name="1461"/> 1461:     {system_limit, {1,binary,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Bin:(MaxSmall)/binary-unit:32,0:64&gt;&gt;),
<a name="1462"/> 1462:     {system_limit, {1,binary,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Bin:(MaxSmall)/binary-unit:32,(id(0)):64&gt;&gt;),
<a name="1463"/> 1463:     {system_limit, {1,binary,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Bin:(id(MaxSmall))/binary-unit:32,0:64&gt;&gt;),
<a name="1464"/> 1464:     {system_limit, {1,binary,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Bin:(id(MaxSmall))/binary-unit:32,(id(0)):64&gt;&gt;),
<a name="1465"/> 1465: 
<a name="1466"/> 1466:     {system_limit, {1,float,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Float:(MaxSmall)/float-unit:32,0:64&gt;&gt;),
<a name="1467"/> 1467:     {system_limit, {1,float,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Float:(MaxSmall)/float-unit:32,(id(0)):64&gt;&gt;),
<a name="1468"/> 1468:     {system_limit, {1,float,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Float:(id(MaxSmall))/float-unit:32,0:64&gt;&gt;),
<a name="1469"/> 1469:     {system_limit, {1,float,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Float:(id(MaxSmall))/float-unit:32,(id(0)):64&gt;&gt;),
<a name="1470"/> 1470: 
<a name="1471"/> 1471:     %% Test a size exceeding 1^64, where the sign bit (bit 63) is not set.
<a name="1472"/> 1472:     0 = (((MaxSmall) * 33) bsr 63) band 1, %Assertion: The sign bit is not set.
<a name="1473"/> 1473: 
<a name="1474"/> 1474:     {system_limit, {1,integer,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;0:(MaxSmall)/unit:33&gt;&gt;),
<a name="1475"/> 1475:     {system_limit, {1,integer,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;0:(MaxSmall)/unit:33&gt;&gt;),
<a name="1476"/> 1476:     {system_limit, {1,integer,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;0:(id(MaxSmall))/unit:33&gt;&gt;),
<a name="1477"/> 1477:     {system_limit, {1,integer,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;0:(id(MaxSmall))/unit:33&gt;&gt;),
<a name="1478"/> 1478: 
<a name="1479"/> 1479:     {system_limit, {1,binary,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Bin:(MaxSmall)/binary-unit:33&gt;&gt;),
<a name="1480"/> 1480:     {system_limit, {1,binary,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Bin:(MaxSmall)/binary-unit:33&gt;&gt;),
<a name="1481"/> 1481:     {system_limit, {1,binary,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Bin:(id(MaxSmall))/binary-unit:33&gt;&gt;),
<a name="1482"/> 1482:     {system_limit, {1,binary,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Bin:(id(MaxSmall))/binary-unit:33&gt;&gt;),
<a name="1483"/> 1483: 
<a name="1484"/> 1484:     {system_limit, {1,float,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Float:(MaxSmall)/float-unit:33&gt;&gt;),
<a name="1485"/> 1485:     {system_limit, {1,float,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Float:(MaxSmall)/float-unit:33&gt;&gt;),
<a name="1486"/> 1486:     {system_limit, {1,float,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Float:(id(MaxSmall))/float-unit:33&gt;&gt;),
<a name="1487"/> 1487:     {system_limit, {1,float,size,MaxSmall}, _} = ?ERROR_INFO(&lt;&lt;Float:(id(MaxSmall))/float-unit:33&gt;&gt;),
<a name="1488"/> 1488: 
<a name="1489"/> 1489:     %% error messages with options
<a name="1490"/> 1490:     PP = fun(Term) -&gt; &lt;&lt;&quot;'&quot;, (erlang:atom_to_binary(Term))/binary, &quot;'&quot;&gt;&gt; end,
<a name="1491"/> 1491: 
<a name="1492"/> 1492:     {_, _, &lt;&lt;&quot;segment 1 of type 'float': expected a float or an integer but got: some_atom&quot;&gt;&gt;} =
<a name="1493"/> 1493:         ?ERROR_INFO(&lt;&lt;Atom:64/float&gt;&gt;, #{}),
<a name="1494"/> 1494: 
<a name="1495"/> 1495:     {_, _, &lt;&lt;&quot;segment 2 of type 'float': expected a float or an integer but got: some_atom&quot;&gt;&gt;} =
<a name="1496"/> 1496:         ?ERROR_INFO(&lt;&lt;Atom:64/float&gt;&gt;, #{override_segment_position =&gt; 2}),
<a name="1497"/> 1497: 
<a name="1498"/> 1498:     {_, _, &lt;&lt;&quot;segment 1 of type 'float': expected a float or an integer but got: 'some_atom'&quot;&gt;&gt;} =
<a name="1499"/> 1499:         ?ERROR_INFO(&lt;&lt;Atom:64/float&gt;&gt;, #{pretty_printer =&gt; PP}),
<a name="1500"/> 1500: 
<a name="error_info-last_expr"/><a name="1501"/> 1501:     ok.
<a name="1502"/> 1502: 
<a name="error_info_verify-4"/><a name="1503"/> 1503: <b>error_info_verify</b>(Reason, Stk0, Expr, Overrides) -&gt;
<a name="1504"/> 1504:     [{?MODULE, Fun, Arity, Info0}|Rest] = Stk0,
<a name="1505"/> 1505:     {value, {error_info, ErrorInfo}, Info1} = lists:keytake(error_info, 1, Info0),
<a name="1506"/> 1506:     #{cause := Cause, module := Module, function := Function} = ErrorInfo,
<a name="1507"/> 1507:     Info2 = maps:merge(ErrorInfo, Overrides),
<a name="1508"/> 1508:     Stk1 = [{?MODULE, Fun, Arity, Info1 ++ [{error_info, Info2}]} | Rest],
<a name="1509"/> 1509:     Result = Module:Function(Reason, Stk1),
<a name="1510"/> 1510:     #{general := String} = Result,
<a name="1511"/> 1511:     true = is_binary(String),
<a name="1512"/> 1512:     io:format(&quot;~ts: ~ts\n&quot;, [Expr,String]),
<a name="error_info_verify-last_expr"/><a name="1513"/> 1513:     {Reason, Cause, String}.
<a name="1514"/> 1514: 
<a name="little-1"/><a name="1515"/> 1515: <b>little</b>(_Config) -&gt;
<a name="1516"/> 1516:     _ = rand:uniform(),				%Seed generator
<a name="1517"/> 1517:     io:format(&quot;Seed: ~p&quot;, [rand:export_seed()]),
<a name="1518"/> 1518: 
<a name="1519"/> 1519:     RandBytes = rand:bytes(10),
<a name="1520"/> 1520:     _ = [do_little(RandBytes, N) || N &lt;- lists:seq(0, 10*8)],
<a name="1521"/> 1521: 
<a name="little-last_expr"/><a name="1522"/> 1522:     ok.
<a name="1523"/> 1523: 
<a name="do_little-2"/><a name="1524"/> 1524: <b>do_little</b>(Bin0, N) -&gt;
<a name="1525"/> 1525:     &lt;&lt;Bin1:N/bits,Bin2/bits&gt;&gt; = Bin0,
<a name="1526"/> 1526:     Bin2Size = bit_size(Bin2),
<a name="1527"/> 1527: 
<a name="1528"/> 1528:     &lt;&lt;I1:N/little-integer&gt;&gt; = Bin1,
<a name="1529"/> 1529:     &lt;&lt;I2:Bin2Size/little-integer&gt;&gt; = Bin2,
<a name="1530"/> 1530: 
<a name="1531"/> 1531:     Bin1 = &lt;&lt;I1:N/little-integer&gt;&gt;,
<a name="1532"/> 1532:     Bin1 = do_little_1(N, id(I1)),
<a name="1533"/> 1533: 
<a name="1534"/> 1534:     Bin2 = &lt;&lt;I2:Bin2Size/little-integer&gt;&gt;,
<a name="1535"/> 1535:     Bin2 = do_little_1(Bin2Size, id(I2)),
<a name="1536"/> 1536: 
<a name="do_little-last_expr"/><a name="1537"/> 1537:     ok.
<a name="1538"/> 1538: 
<a name="do_little_1-2"/><a name="1539"/> 1539: <b>do_little_1</b>(0, I) -&gt; &lt;&lt;I:0/little-integer&gt;&gt;;
<a name="1540"/> 1540: <b>do_little_1</b>(1, I) -&gt; &lt;&lt;I:1/little-integer&gt;&gt;;
<a name="1541"/> 1541: <b>do_little_1</b>(2, I) -&gt; &lt;&lt;I:2/little-integer&gt;&gt;;
<a name="1542"/> 1542: <b>do_little_1</b>(3, I) -&gt; &lt;&lt;I:3/little-integer&gt;&gt;;
<a name="1543"/> 1543: <b>do_little_1</b>(4, I) -&gt; &lt;&lt;I:4/little-integer&gt;&gt;;
<a name="1544"/> 1544: <b>do_little_1</b>(5, I) -&gt; &lt;&lt;I:5/little-integer&gt;&gt;;
<a name="1545"/> 1545: <b>do_little_1</b>(6, I) -&gt; &lt;&lt;I:6/little-integer&gt;&gt;;
<a name="1546"/> 1546: <b>do_little_1</b>(7, I) -&gt; &lt;&lt;I:7/little-integer&gt;&gt;;
<a name="1547"/> 1547: <b>do_little_1</b>(8, I) -&gt; &lt;&lt;I:8/little-integer&gt;&gt;;
<a name="1548"/> 1548: <b>do_little_1</b>(9, I) -&gt; &lt;&lt;I:9/little-integer&gt;&gt;;
<a name="1549"/> 1549: <b>do_little_1</b>(10, I) -&gt; &lt;&lt;I:10/little-integer&gt;&gt;;
<a name="1550"/> 1550: <b>do_little_1</b>(11, I) -&gt; &lt;&lt;I:11/little-integer&gt;&gt;;
<a name="1551"/> 1551: <b>do_little_1</b>(12, I) -&gt; &lt;&lt;I:12/little-integer&gt;&gt;;
<a name="1552"/> 1552: <b>do_little_1</b>(13, I) -&gt; &lt;&lt;I:13/little-integer&gt;&gt;;
<a name="1553"/> 1553: <b>do_little_1</b>(14, I) -&gt; &lt;&lt;I:14/little-integer&gt;&gt;;
<a name="1554"/> 1554: <b>do_little_1</b>(15, I) -&gt; &lt;&lt;I:15/little-integer&gt;&gt;;
<a name="1555"/> 1555: <b>do_little_1</b>(16, I) -&gt; &lt;&lt;I:16/little-integer&gt;&gt;;
<a name="1556"/> 1556: <b>do_little_1</b>(17, I) -&gt; &lt;&lt;I:17/little-integer&gt;&gt;;
<a name="1557"/> 1557: <b>do_little_1</b>(18, I) -&gt; &lt;&lt;I:18/little-integer&gt;&gt;;
<a name="1558"/> 1558: <b>do_little_1</b>(19, I) -&gt; &lt;&lt;I:19/little-integer&gt;&gt;;
<a name="1559"/> 1559: <b>do_little_1</b>(20, I) -&gt; &lt;&lt;I:20/little-integer&gt;&gt;;
<a name="1560"/> 1560: <b>do_little_1</b>(21, I) -&gt; &lt;&lt;I:21/little-integer&gt;&gt;;
<a name="1561"/> 1561: <b>do_little_1</b>(22, I) -&gt; &lt;&lt;I:22/little-integer&gt;&gt;;
<a name="1562"/> 1562: <b>do_little_1</b>(23, I) -&gt; &lt;&lt;I:23/little-integer&gt;&gt;;
<a name="1563"/> 1563: <b>do_little_1</b>(24, I) -&gt; &lt;&lt;I:24/little-integer&gt;&gt;;
<a name="1564"/> 1564: <b>do_little_1</b>(25, I) -&gt; &lt;&lt;I:25/little-integer&gt;&gt;;
<a name="1565"/> 1565: <b>do_little_1</b>(26, I) -&gt; &lt;&lt;I:26/little-integer&gt;&gt;;
<a name="1566"/> 1566: <b>do_little_1</b>(27, I) -&gt; &lt;&lt;I:27/little-integer&gt;&gt;;
<a name="1567"/> 1567: <b>do_little_1</b>(28, I) -&gt; &lt;&lt;I:28/little-integer&gt;&gt;;
<a name="1568"/> 1568: <b>do_little_1</b>(29, I) -&gt; &lt;&lt;I:29/little-integer&gt;&gt;;
<a name="1569"/> 1569: <b>do_little_1</b>(30, I) -&gt; &lt;&lt;I:30/little-integer&gt;&gt;;
<a name="1570"/> 1570: <b>do_little_1</b>(31, I) -&gt; &lt;&lt;I:31/little-integer&gt;&gt;;
<a name="1571"/> 1571: <b>do_little_1</b>(32, I) -&gt; &lt;&lt;I:32/little-integer&gt;&gt;;
<a name="1572"/> 1572: <b>do_little_1</b>(33, I) -&gt; &lt;&lt;I:33/little-integer&gt;&gt;;
<a name="1573"/> 1573: <b>do_little_1</b>(34, I) -&gt; &lt;&lt;I:34/little-integer&gt;&gt;;
<a name="1574"/> 1574: <b>do_little_1</b>(35, I) -&gt; &lt;&lt;I:35/little-integer&gt;&gt;;
<a name="1575"/> 1575: <b>do_little_1</b>(36, I) -&gt; &lt;&lt;I:36/little-integer&gt;&gt;;
<a name="1576"/> 1576: <b>do_little_1</b>(37, I) -&gt; &lt;&lt;I:37/little-integer&gt;&gt;;
<a name="1577"/> 1577: <b>do_little_1</b>(38, I) -&gt; &lt;&lt;I:38/little-integer&gt;&gt;;
<a name="1578"/> 1578: <b>do_little_1</b>(39, I) -&gt; &lt;&lt;I:39/little-integer&gt;&gt;;
<a name="1579"/> 1579: <b>do_little_1</b>(40, I) -&gt; &lt;&lt;I:40/little-integer&gt;&gt;;
<a name="1580"/> 1580: <b>do_little_1</b>(41, I) -&gt; &lt;&lt;I:41/little-integer&gt;&gt;;
<a name="1581"/> 1581: <b>do_little_1</b>(42, I) -&gt; &lt;&lt;I:42/little-integer&gt;&gt;;
<a name="1582"/> 1582: <b>do_little_1</b>(43, I) -&gt; &lt;&lt;I:43/little-integer&gt;&gt;;
<a name="1583"/> 1583: <b>do_little_1</b>(44, I) -&gt; &lt;&lt;I:44/little-integer&gt;&gt;;
<a name="1584"/> 1584: <b>do_little_1</b>(45, I) -&gt; &lt;&lt;I:45/little-integer&gt;&gt;;
<a name="1585"/> 1585: <b>do_little_1</b>(46, I) -&gt; &lt;&lt;I:46/little-integer&gt;&gt;;
<a name="1586"/> 1586: <b>do_little_1</b>(47, I) -&gt; &lt;&lt;I:47/little-integer&gt;&gt;;
<a name="1587"/> 1587: <b>do_little_1</b>(48, I) -&gt; &lt;&lt;I:48/little-integer&gt;&gt;;
<a name="1588"/> 1588: <b>do_little_1</b>(49, I) -&gt; &lt;&lt;I:49/little-integer&gt;&gt;;
<a name="1589"/> 1589: <b>do_little_1</b>(50, I) -&gt; &lt;&lt;I:50/little-integer&gt;&gt;;
<a name="1590"/> 1590: <b>do_little_1</b>(51, I) -&gt; &lt;&lt;I:51/little-integer&gt;&gt;;
<a name="1591"/> 1591: <b>do_little_1</b>(52, I) -&gt; &lt;&lt;I:52/little-integer&gt;&gt;;
<a name="1592"/> 1592: <b>do_little_1</b>(53, I) -&gt; &lt;&lt;I:53/little-integer&gt;&gt;;
<a name="1593"/> 1593: <b>do_little_1</b>(54, I) -&gt; &lt;&lt;I:54/little-integer&gt;&gt;;
<a name="1594"/> 1594: <b>do_little_1</b>(55, I) -&gt; &lt;&lt;I:55/little-integer&gt;&gt;;
<a name="1595"/> 1595: <b>do_little_1</b>(56, I) -&gt; &lt;&lt;I:56/little-integer&gt;&gt;;
<a name="1596"/> 1596: <b>do_little_1</b>(57, I) -&gt; &lt;&lt;I:57/little-integer&gt;&gt;;
<a name="1597"/> 1597: <b>do_little_1</b>(58, I) -&gt; &lt;&lt;I:58/little-integer&gt;&gt;;
<a name="1598"/> 1598: <b>do_little_1</b>(59, I) -&gt; &lt;&lt;I:59/little-integer&gt;&gt;;
<a name="1599"/> 1599: <b>do_little_1</b>(60, I) -&gt; &lt;&lt;I:60/little-integer&gt;&gt;;
<a name="1600"/> 1600: <b>do_little_1</b>(61, I) -&gt; &lt;&lt;I:61/little-integer&gt;&gt;;
<a name="1601"/> 1601: <b>do_little_1</b>(62, I) -&gt; &lt;&lt;I:62/little-integer&gt;&gt;;
<a name="1602"/> 1602: <b>do_little_1</b>(63, I) -&gt; &lt;&lt;I:63/little-integer&gt;&gt;;
<a name="1603"/> 1603: <b>do_little_1</b>(64, I) -&gt; &lt;&lt;I:64/little-integer&gt;&gt;;
<a name="1604"/> 1604: <b>do_little_1</b>(65, I) -&gt; &lt;&lt;I:65/little-integer&gt;&gt;;
<a name="1605"/> 1605: <b>do_little_1</b>(66, I) -&gt; &lt;&lt;I:66/little-integer&gt;&gt;;
<a name="1606"/> 1606: <b>do_little_1</b>(67, I) -&gt; &lt;&lt;I:67/little-integer&gt;&gt;;
<a name="1607"/> 1607: <b>do_little_1</b>(68, I) -&gt; &lt;&lt;I:68/little-integer&gt;&gt;;
<a name="1608"/> 1608: <b>do_little_1</b>(69, I) -&gt; &lt;&lt;I:69/little-integer&gt;&gt;;
<a name="1609"/> 1609: <b>do_little_1</b>(70, I) -&gt; &lt;&lt;I:70/little-integer&gt;&gt;;
<a name="1610"/> 1610: <b>do_little_1</b>(71, I) -&gt; &lt;&lt;I:71/little-integer&gt;&gt;;
<a name="1611"/> 1611: <b>do_little_1</b>(72, I) -&gt; &lt;&lt;I:72/little-integer&gt;&gt;;
<a name="1612"/> 1612: <b>do_little_1</b>(73, I) -&gt; &lt;&lt;I:73/little-integer&gt;&gt;;
<a name="1613"/> 1613: <b>do_little_1</b>(74, I) -&gt; &lt;&lt;I:74/little-integer&gt;&gt;;
<a name="1614"/> 1614: <b>do_little_1</b>(75, I) -&gt; &lt;&lt;I:75/little-integer&gt;&gt;;
<a name="1615"/> 1615: <b>do_little_1</b>(76, I) -&gt; &lt;&lt;I:76/little-integer&gt;&gt;;
<a name="1616"/> 1616: <b>do_little_1</b>(77, I) -&gt; &lt;&lt;I:77/little-integer&gt;&gt;;
<a name="1617"/> 1617: <b>do_little_1</b>(78, I) -&gt; &lt;&lt;I:78/little-integer&gt;&gt;;
<a name="1618"/> 1618: <b>do_little_1</b>(79, I) -&gt; &lt;&lt;I:79/little-integer&gt;&gt;;
<a name="1619"/> 1619: <b>do_little_1</b>(80, I) -&gt; &lt;&lt;I:80/little-integer&gt;&gt;;
<a name="1620"/> 1620: <b>do_little_1</b>(81, I) -&gt; &lt;&lt;I:81/little-integer&gt;&gt;;
<a name="1621"/> 1621: <b>do_little_1</b>(82, I) -&gt; &lt;&lt;I:82/little-integer&gt;&gt;;
<a name="1622"/> 1622: <b>do_little_1</b>(83, I) -&gt; &lt;&lt;I:83/little-integer&gt;&gt;;
<a name="1623"/> 1623: <b>do_little_1</b>(84, I) -&gt; &lt;&lt;I:84/little-integer&gt;&gt;;
<a name="1624"/> 1624: <b>do_little_1</b>(85, I) -&gt; &lt;&lt;I:85/little-integer&gt;&gt;;
<a name="1625"/> 1625: <b>do_little_1</b>(86, I) -&gt; &lt;&lt;I:86/little-integer&gt;&gt;;
<a name="1626"/> 1626: <b>do_little_1</b>(87, I) -&gt; &lt;&lt;I:87/little-integer&gt;&gt;;
<a name="1627"/> 1627: <b>do_little_1</b>(88, I) -&gt; &lt;&lt;I:88/little-integer&gt;&gt;;
<a name="1628"/> 1628: <b>do_little_1</b>(89, I) -&gt; &lt;&lt;I:89/little-integer&gt;&gt;;
<a name="1629"/> 1629: <b>do_little_1</b>(90, I) -&gt; &lt;&lt;I:90/little-integer&gt;&gt;;
<a name="1630"/> 1630: <b>do_little_1</b>(91, I) -&gt; &lt;&lt;I:91/little-integer&gt;&gt;;
<a name="1631"/> 1631: <b>do_little_1</b>(92, I) -&gt; &lt;&lt;I:92/little-integer&gt;&gt;;
<a name="1632"/> 1632: <b>do_little_1</b>(93, I) -&gt; &lt;&lt;I:93/little-integer&gt;&gt;;
<a name="1633"/> 1633: <b>do_little_1</b>(94, I) -&gt; &lt;&lt;I:94/little-integer&gt;&gt;;
<a name="1634"/> 1634: <b>do_little_1</b>(95, I) -&gt; &lt;&lt;I:95/little-integer&gt;&gt;;
<a name="1635"/> 1635: <b>do_little_1</b>(96, I) -&gt; &lt;&lt;I:96/little-integer&gt;&gt;;
<a name="1636"/> 1636: <b>do_little_1</b>(97, I) -&gt; &lt;&lt;I:97/little-integer&gt;&gt;;
<a name="1637"/> 1637: <b>do_little_1</b>(98, I) -&gt; &lt;&lt;I:98/little-integer&gt;&gt;;
<a name="1638"/> 1638: <b>do_little_1</b>(99, I) -&gt; &lt;&lt;I:99/little-integer&gt;&gt;;
<a name="1639"/> 1639: <b>do_little_1</b>(100, I) -&gt; &lt;&lt;I:100/little-integer&gt;&gt;;
<a name="1640"/> 1640: <b>do_little_1</b>(101, I) -&gt; &lt;&lt;I:101/little-integer&gt;&gt;;
<a name="1641"/> 1641: <b>do_little_1</b>(102, I) -&gt; &lt;&lt;I:102/little-integer&gt;&gt;;
<a name="1642"/> 1642: <b>do_little_1</b>(103, I) -&gt; &lt;&lt;I:103/little-integer&gt;&gt;;
<a name="1643"/> 1643: <b>do_little_1</b>(104, I) -&gt; &lt;&lt;I:104/little-integer&gt;&gt;;
<a name="1644"/> 1644: <b>do_little_1</b>(105, I) -&gt; &lt;&lt;I:105/little-integer&gt;&gt;;
<a name="1645"/> 1645: <b>do_little_1</b>(106, I) -&gt; &lt;&lt;I:106/little-integer&gt;&gt;;
<a name="1646"/> 1646: <b>do_little_1</b>(107, I) -&gt; &lt;&lt;I:107/little-integer&gt;&gt;;
<a name="1647"/> 1647: <b>do_little_1</b>(108, I) -&gt; &lt;&lt;I:108/little-integer&gt;&gt;;
<a name="1648"/> 1648: <b>do_little_1</b>(109, I) -&gt; &lt;&lt;I:109/little-integer&gt;&gt;;
<a name="1649"/> 1649: <b>do_little_1</b>(110, I) -&gt; &lt;&lt;I:110/little-integer&gt;&gt;;
<a name="1650"/> 1650: <b>do_little_1</b>(111, I) -&gt; &lt;&lt;I:111/little-integer&gt;&gt;;
<a name="1651"/> 1651: <b>do_little_1</b>(112, I) -&gt; &lt;&lt;I:112/little-integer&gt;&gt;;
<a name="1652"/> 1652: <b>do_little_1</b>(113, I) -&gt; &lt;&lt;I:113/little-integer&gt;&gt;;
<a name="1653"/> 1653: <b>do_little_1</b>(114, I) -&gt; &lt;&lt;I:114/little-integer&gt;&gt;;
<a name="1654"/> 1654: <b>do_little_1</b>(115, I) -&gt; &lt;&lt;I:115/little-integer&gt;&gt;;
<a name="1655"/> 1655: <b>do_little_1</b>(116, I) -&gt; &lt;&lt;I:116/little-integer&gt;&gt;;
<a name="1656"/> 1656: <b>do_little_1</b>(117, I) -&gt; &lt;&lt;I:117/little-integer&gt;&gt;;
<a name="1657"/> 1657: <b>do_little_1</b>(118, I) -&gt; &lt;&lt;I:118/little-integer&gt;&gt;;
<a name="1658"/> 1658: <b>do_little_1</b>(119, I) -&gt; &lt;&lt;I:119/little-integer&gt;&gt;;
<a name="1659"/> 1659: <b>do_little_1</b>(120, I) -&gt; &lt;&lt;I:120/little-integer&gt;&gt;;
<a name="1660"/> 1660: <b>do_little_1</b>(121, I) -&gt; &lt;&lt;I:121/little-integer&gt;&gt;;
<a name="1661"/> 1661: <b>do_little_1</b>(122, I) -&gt; &lt;&lt;I:122/little-integer&gt;&gt;;
<a name="1662"/> 1662: <b>do_little_1</b>(123, I) -&gt; &lt;&lt;I:123/little-integer&gt;&gt;;
<a name="1663"/> 1663: <b>do_little_1</b>(124, I) -&gt; &lt;&lt;I:124/little-integer&gt;&gt;;
<a name="1664"/> 1664: <b>do_little_1</b>(125, I) -&gt; &lt;&lt;I:125/little-integer&gt;&gt;;
<a name="1665"/> 1665: <b>do_little_1</b>(126, I) -&gt; &lt;&lt;I:126/little-integer&gt;&gt;;
<a name="1666"/> 1666: <b>do_little_1</b>(127, I) -&gt; &lt;&lt;I:127/little-integer&gt;&gt;;
<a name="do_little_1-last_expr"/><a name="1667"/> 1667: <b>do_little_1</b>(128, I) -&gt; &lt;&lt;I:128/little-integer&gt;&gt;.
<a name="1668"/> 1668: 
<a name="1669"/> 1669: <i>%% GH-7469: The unit of variable-sized segments wasn't checked properly,</i>
<a name="1670"/> 1670: <i>%% resulting in the creation of heap binaries for non-binary bitstrings.</i>
<a name="heap_binary_unit-1"/><a name="1671"/> 1671: <b>heap_binary_unit</b>(_Config) -&gt;
<a name="1672"/> 1672:     {ok, 14524} = heap_binary_unit_1(id(&lt;&lt;184,188,2,66,172,19,0,3&gt;&gt;)),
<a name="heap_binary_unit-last_expr"/><a name="1673"/> 1673:     ok.
<a name="1674"/> 1674: 
<a name="heap_binary_unit_1-1"/><a name="1675"/> 1675: <b>heap_binary_unit_1</b>(&lt;&lt;2:2/integer,Rest:62/bitstring&gt;&gt;) -&gt;
<a name="heap_binary_unit_1-last_expr"/><a name="1676"/> 1676: <b>    heap_binary_unit_2</b>(&lt;&lt;2:2/integer&gt;&gt;, Rest).
<a name="1677"/> 1677: 
<a name="heap_binary_unit_2-2"/><a name="1678"/> 1678: <b>heap_binary_unit_2</b>(Variant, Rest) -&gt;
<a name="1679"/> 1679:     VariantSize = bit_size(Variant),
<a name="1680"/> 1680:     ClockHiSize = 8 - VariantSize,
<a name="1681"/> 1681:     ClockSize = 8 + ClockHiSize,
<a name="heap_binary_unit_2-last_expr"/><a name="1682"/> 1682:     case Rest of
<a name="1683"/> 1683:         &lt;&lt;ClockHi:ClockHiSize/bitstring,
<a name="1684"/> 1684:           ClockLo:8/bitstring,
<a name="1685"/> 1685:           _:48/bitstring&gt;&gt; -&gt;
<a name="1686"/> 1686:             case
<a name="1687"/> 1687:                 &lt;&lt;ClockHi:ClockHiSize/bitstring,
<a name="1688"/> 1688:                   ClockLo:8/bitstring&gt;&gt;
<a name="1689"/> 1689:             of
<a name="1690"/> 1690:                 &lt;&lt;Clock:ClockSize/integer-unsigned&gt;&gt; -&gt;
<a name="1691"/> 1691:                     {ok, Clock};
<a name="1692"/> 1692:                 Bin1 -&gt;
<a name="1693"/> 1693:                     {error1, Bin1}
<a name="1694"/> 1694:             end;
<a name="1695"/> 1695:         Bin2 -&gt;
<a name="1696"/> 1696:             {error2, Bin2}
<a name="1697"/> 1697:     end.
<a name="1698"/> 1698: 
<a name="1699"/> 1699: <i>%%%</i>
<a name="1700"/> 1700: <i>%%% Common utilities.</i>
<a name="1701"/> 1701: <i>%%%</i>
<a name="1702"/> 1702: 
<a name="id-1"/><a name="id-last_expr"/><a name="1703"/> 1703: <b>id</b>(I) -&gt; I.
</pre>
</body>
</html>
