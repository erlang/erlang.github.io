<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/></meta>
<title>/buildroot/otp/lib/compiler/make_test_dir/compiler_test/beam_block_no_copt_SUITE.erl</title>
</head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
<a name="1"/>    1: <i>%%</i>
<a name="2"/>    2: <i>%% %CopyrightBegin%</i>
<a name="3"/>    3: <i>%%</i>
<a name="4"/>    4: <i>%% Copyright Ericsson AB 2015-2023. All Rights Reserved.</i>
<a name="5"/>    5: <i>%%</i>
<a name="6"/>    6: <i>%% Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</i>
<a name="7"/>    7: <i>%% you may not use this file except in compliance with the License.</i>
<a name="8"/>    8: <i>%% You may obtain a copy of the License at</i>
<a name="9"/>    9: <i>%%</i>
<a name="10"/>   10: <i>%%     http://www.apache.org/licenses/LICENSE-2.0</i>
<a name="11"/>   11: <i>%%</i>
<a name="12"/>   12: <i>%% Unless required by applicable law or agreed to in writing, software</i>
<a name="13"/>   13: <i>%% distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</i>
<a name="14"/>   14: <i>%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</i>
<a name="15"/>   15: <i>%% See the License for the specific language governing permissions and</i>
<a name="16"/>   16: <i>%% limitations under the License.</i>
<a name="17"/>   17: <i>%%</i>
<a name="18"/>   18: <i>%% %CopyrightEnd%</i>
<a name="19"/>   19: <i>%%</i>
<a name="20"/>   20: <b>-module</b>(beam_block_no_copt_SUITE).
<a name="21"/>   21: 
<a name="22"/>   22: <b>-export</b>([all/0,suite/0,groups/0,init_per_suite/1,end_per_suite/1,
<a name="23"/>   23: 	 init_per_group/2,end_per_group/2,
<a name="24"/>   24: 	 get_map_elements/1,otp_7345/1,move_opt_across_gc_bif/1,
<a name="25"/>   25: 	 erl_202/1,repro/1,local_cse/1,second_block_pass/1,
<a name="26"/>   26:          coverage/1]).
<a name="27"/>   27: 
<a name="28"/>   28: <i>%% The only test for the following functions is that</i>
<a name="29"/>   29: <i>%% the code compiles and is accepted by beam_validator.</i>
<a name="30"/>   30: <b>-export</b>([encode_wildcards3/4,find_operands/4]).
<a name="31"/>   31: 
<a name="suite-0"/><a name="suite-last_expr"/><a name="32"/>   32: <b>suite</b>() -&gt; [{ct_hooks,[ts_install_cth]}].
<a name="33"/>   33: 
<a name="all-0"/><a name="34"/>   34: <b>all</b>() -&gt;
<a name="all-last_expr"/><a name="35"/>   35:     [{group,p}].
<a name="36"/>   36: 
<a name="groups-0"/><a name="37"/>   37: <b>groups</b>() -&gt;
<a name="groups-last_expr"/><a name="38"/>   38:     [{p,[parallel],
<a name="39"/>   39:       [get_map_elements,
<a name="40"/>   40:        otp_7345,
<a name="41"/>   41:        move_opt_across_gc_bif,
<a name="42"/>   42:        erl_202,
<a name="43"/>   43:        repro,
<a name="44"/>   44:        local_cse,
<a name="45"/>   45:        second_block_pass,
<a name="46"/>   46:        coverage
<a name="47"/>   47:       ]}].
<a name="48"/>   48: 
<a name="init_per_suite-1"/><a name="49"/>   49: <b>init_per_suite</b>(Config) -&gt;
<a name="50"/>   50:     test_lib:recompile(?MODULE),
<a name="init_per_suite-last_expr"/><a name="51"/>   51:     Config.
<a name="52"/>   52: 
<a name="end_per_suite-1"/><a name="53"/>   53: <b>end_per_suite</b>(_Config) -&gt;
<a name="end_per_suite-last_expr"/><a name="54"/>   54:     ok.
<a name="55"/>   55: 
<a name="init_per_group-2"/><a name="56"/>   56: <b>init_per_group</b>(_GroupName, Config) -&gt;
<a name="init_per_group-last_expr"/><a name="57"/>   57:     Config.
<a name="58"/>   58: 
<a name="end_per_group-2"/><a name="59"/>   59: <b>end_per_group</b>(_GroupName, Config) -&gt;
<a name="end_per_group-last_expr"/><a name="60"/>   60:     Config.
<a name="61"/>   61: 
<a name="get_map_elements-1"/><a name="62"/>   62: <b>get_map_elements</b>(_Config) -&gt;
<a name="63"/>   63:     [{pred,var}] = get_map_elements([{pred,var}], #{}, []),
<a name="64"/>   64:     [{pred,var}] = get_map_elements([{pred,var}], #{pred=&gt;[]}, []),
<a name="65"/>   65:     acc = get_map_elements([], #{pred=&gt;[]}, acc),
<a name="get_map_elements-last_expr"/><a name="66"/>   66:     ok.
<a name="67"/>   67: 
<a name="get_map_elements-3"/><a name="68"/>   68: <b>get_map_elements</b>([{Pred,Var}|Left], Map, Acc) -&gt;
<a name="69"/>   69:     case Map of
<a name="70"/>   70:         #{Var := List} -&gt;
<a name="71"/>   71:             case lists:keyfind(Pred, 1, List) of
<a name="72"/>   72:                 false -&gt;
<a name="73"/>   73:                     get_map_elements(Left, Map, [{Pred,Var}|Acc])
<a name="74"/>   74:             end;
<a name="75"/>   75:         #{} -&gt;
<a name="76"/>   76:             get_map_elements(Left, Map, [{Pred,Var}|Acc])
<a name="77"/>   77:     end;
<a name="78"/>   78: <b>get_map_elements</b>([], _Map, Acc) -&gt;
<a name="get_map_elements-last_expr"/><a name="79"/>   79:     Acc.
<a name="80"/>   80: 
<a name="81"/>   81: <i>%% The following code</i>
<a name="82"/>   82: <i>%%</i>
<a name="83"/>   83: <i>%%    {get_list,{x,2},{x,0},{x,1}}.</i>
<a name="84"/>   84: <i>%%    {gc_bif,length,{f,0},1,[{x,0}],{x,0}}.</i>
<a name="85"/>   85: <i>%%    {move,{x,0},{x,1}}.</i>
<a name="86"/>   86: <i>%%</i>
<a name="87"/>   87: <i>%% was incorrectly optimized to</i>
<a name="88"/>   88: <i>%%</i>
<a name="89"/>   89: <i>%%    {get_list,{x,2},{x,0},{y,0}}.</i>
<a name="90"/>   90: <i>%%    {gc_bif,length,{f,0},3,[{x,0}],{x,1}}.</i>
<a name="91"/>   91: <i>%%</i>
<a name="92"/>   92: <i>%% because beam_block:is_transparent({x,1},</i>
<a name="93"/>   93: <i>%%                                  {gc_bif,length,{f,0},3,[{x,0}],{x,1}}</i>
<a name="94"/>   94: <i>%% incorrectly returned true.</i>
<a name="95"/>   95: 
<a name="96"/>   96: <b>-record</b>(contextId,{cid,device_type,contextRef}).
<a name="97"/>   97: <b>-record</b>(dpRef,{cid,tlli,ms_device_context_id}).
<a name="98"/>   98: <b>-record</b>(qosProfileBssgp,{peak_bit_rate_msb,
<a name="99"/>   99:                               peak_bit_rate_lsb,
<a name="100"/>  100:                               t_a_precedence}).
<a name="101"/>  101: <b>-record</b>(llUnitdataReq,{sapi,
<a name="102"/>  102:                             l3_pdu_length,
<a name="103"/>  103:                             pdu_life}).
<a name="104"/>  104: <b>-record</b>(ptmsi,{value}).
<a name="105"/>  105: 
<a name="otp_7345-1"/><a name="106"/>  106: <b>otp_7345</b>(_Config) -&gt;
<a name="otp_7345-last_expr"/><a name="107"/>  107:     #llUnitdataReq{l3_pdu_length=3,pdu_life=4} =
<a name="108"/>  108: 	otp_7345(#contextId{}, 0, [[1,2,3],4,5]).
<a name="109"/>  109: 
<a name="110"/>  110: 
<a name="otp_7345-3"/><a name="111"/>  111: <b>otp_7345</b>(ObjRef, _RdEnv, Args) -&gt;
<a name="112"/>  112:     Cid = ObjRef#contextId.cid,
<a name="113"/>  113:     _ =	#dpRef{cid = Cid,
<a name="114"/>  114: 		     ms_device_context_id = cid_id,
<a name="115"/>  115: 		     tlli = #ptmsi{value = 0}},
<a name="116"/>  116:     _ =	#qosProfileBssgp{peak_bit_rate_msb = 0,
<a name="117"/>  117: 			 peak_bit_rate_lsb = 80,
<a name="118"/>  118: 			 t_a_precedence = 49},
<a name="119"/>  119:     [Cpdu|_] = Args,
<a name="120"/>  120:     LlUnitdataReq =
<a name="121"/>  121: 	#llUnitdataReq{sapi = 7,
<a name="122"/>  122: 		       l3_pdu_length = length(Cpdu),
<a name="123"/>  123: 		       pdu_life =
<a name="124"/>  124: 		       id(42)
<a name="125"/>  125: 		       div
<a name="126"/>  126: 		       10},
<a name="otp_7345-last_expr"/><a name="127"/>  127: <b>    id</b>(LlUnitdataReq).
<a name="128"/>  128: 
<a name="129"/>  129: 
<a name="130"/>  130: <i>%% Doing move optimizations across GC bifs are in general not safe.</i>
<a name="move_opt_across_gc_bif-1"/><a name="131"/>  131: <b>move_opt_across_gc_bif</b>(_Config) -&gt;
<a name="132"/>  132:     [0,true,1] = positive(speaking),
<a name="move_opt_across_gc_bif-last_expr"/><a name="133"/>  133:     ok.
<a name="134"/>  134: 
<a name="positive-1"/><a name="135"/>  135: <b>positive</b>(speaking) -&gt;
<a name="positive-last_expr"/><a name="136"/>  136:     try
<a name="137"/>  137: 	Positive = 0,
<a name="138"/>  138: 	[+Positive, case Positive of _ -&gt; true end, paris([], Positive)]
<a name="139"/>  139:     after
<a name="140"/>  140: 	mailing
<a name="141"/>  141:     end.
<a name="142"/>  142: 
<a name="paris-2"/><a name="paris-last_expr"/><a name="143"/>  143: <b>paris</b>([], P) -&gt; P + 1.
<a name="144"/>  144: 
<a name="145"/>  145: 
<a name="146"/>  146: <i>%% See https://bugs.erlang.org/browse/ERL-202.</i>
<a name="147"/>  147: <i>%% Test that move_allocates/1 in beam_block doesn't move allocate</i>
<a name="148"/>  148: <i>%% when it would not be safe.</i>
<a name="149"/>  149: 
<a name="150"/>  150: <b>-record</b>(erl_202_r1, {y}).
<a name="151"/>  151: <b>-record</b>(erl_202_r2, {x}).
<a name="152"/>  152: 
<a name="erl_202-1"/><a name="153"/>  153: <b>erl_202</b>(_Config) -&gt;
<a name="154"/>  154:     Ref = make_ref(),
<a name="155"/>  155:     Ref = erl_202({{1,2},Ref}, 42),
<a name="156"/>  156: 
<a name="157"/>  157:     {Ref} = erl_202({7,8}, #erl_202_r1{y=#erl_202_r2{x=Ref}}),
<a name="158"/>  158: 
<a name="erl_202-last_expr"/><a name="159"/>  159:     ok.
<a name="160"/>  160: 
<a name="erl_202-2"/><a name="161"/>  161: <b>erl_202</b>({{_, _},X}, _) -&gt;
<a name="162"/>  162:     X;
<a name="163"/>  163: <b>erl_202</b>({_, _}, #erl_202_r1{y=R2}) -&gt;
<a name="erl_202-last_expr"/><a name="164"/>  164:     {R2#erl_202_r2.x}.
<a name="165"/>  165: 
<a name="166"/>  166: <i>%% See https://bugs.erlang.org/browse/ERL-266.</i>
<a name="167"/>  167: <i>%% Instructions with failure labels are not safe to include</i>
<a name="168"/>  168: <i>%% in a block. Including get_map_elements in a block would</i>
<a name="169"/>  169: <i>%% lead to unsafe code.</i>
<a name="170"/>  170: 
<a name="repro-1"/><a name="171"/>  171: <b>repro</b>(_Config) -&gt;
<a name="172"/>  172:     [] = maps:to_list(repro([], #{}, #{})),
<a name="173"/>  173:     [{tmp1,n}] = maps:to_list(repro([{tmp1,0}], #{}, #{})),
<a name="174"/>  174:     [{tmp1,name}] = maps:to_list(repro([{tmp1,0}], #{}, #{0=&gt;name})),
<a name="repro-last_expr"/><a name="175"/>  175:     ok.
<a name="176"/>  176: 
<a name="repro-3"/><a name="177"/>  177: <b>repro</b>([], TempNames, _Slots) -&gt;
<a name="178"/>  178:     TempNames;
<a name="179"/>  179: <b>repro</b>([{Temp, Slot}|Xs], TempNames, Slots0) -&gt;
<a name="180"/>  180:     {Name, Slots} =
<a name="181"/>  181: 	case Slots0 of
<a name="182"/>  182: 	    #{Slot := Name0} -&gt; {Name0, Slots0};
<a name="183"/>  183: 	    #{} -&gt;              {n,     Slots0#{Slot =&gt; n}}
<a name="184"/>  184: 	end,
<a name="repro-last_expr"/><a name="185"/>  185: <b>    repro</b>(Xs, TempNames#{Temp =&gt; Name}, Slots).
<a name="186"/>  186: 
<a name="187"/>  187: <i>%%%</i>
<a name="188"/>  188: <i>%%% The only test of the following code is that it compiles.</i>
<a name="189"/>  189: <i>%%%</i>
<a name="190"/>  190: 
<a name="191"/>  191: <i>%% Slightly simplifed from megaco_binary_term_id_gen.</i>
<a name="192"/>  192: <i>%%  beam_block failed to note that the {gc_bif,'-'...} instruction could</i>
<a name="193"/>  193: <i>%%  fail, and that therefore {y,0} need to be initialized.</i>
<a name="194"/>  194: <i>%%    {allocate,8,6}.</i>
<a name="195"/>  195: <i>%%                     %% {init,{y,0}} needed here.</i>
<a name="196"/>  196: <i>%%    {get_list,{x,1},{x,6},{x,7}}.</i>
<a name="197"/>  197: <i>%%    {'catch',{y,7},{f,3}}.</i>
<a name="198"/>  198: <i>%%    {move,{x,4},{y,1}}.</i>
<a name="199"/>  199: <i>%%    {move,{x,3},{y,2}}.</i>
<a name="200"/>  200: <i>%%    {move,{x,2},{y,3}}.</i>
<a name="201"/>  201: <i>%%    {move,{x,5},{y,4}}.</i>
<a name="202"/>  202: <i>%%    {move,{x,7},{y,5}}.</i>
<a name="203"/>  203: <i>%%    {move,{x,6},{y,6}}.</i>
<a name="204"/>  204: <i>%%    {gc_bif,'-',{f,0},8,[{x,3},{x,6}],{x,0}}.</i>
<a name="205"/>  205: <i>%%    {move,{x,0},{y,0}}.</i>
<a name="206"/>  206: 
<a name="encode_wildcards3-4"/><a name="207"/>  207: <b>encode_wildcards3</b>([],[],_,_) -&gt; [];
<a name="208"/>  208: <b>encode_wildcards3</b>([Level|Levels],[BitsInLevel|BitsRest],LevelNo,TotSize) -&gt;
<a name="encode_wildcards3-last_expr"/><a name="209"/>  209: <b>    case </b>(catch ?MODULE:encode_wildcard(Level,BitsInLevel,TotSize-BitsInLevel,
<a name="210"/>  210: 					length(Levels))) of
<a name="211"/>  211: 	{'EXIT',{Reason,Info}} -&gt;
<a name="212"/>  212: 	    exit({Reason,{LevelNo,Info}});
<a name="213"/>  213: 
<a name="214"/>  214: 	no_wildcard -&gt;
<a name="215"/>  215: 	    encode_wildcards3(Levels,BitsRest,LevelNo+1,TotSize-BitsInLevel);
<a name="216"/>  216: 
<a name="217"/>  217: 	{level,Wl} -&gt;
<a name="218"/>  218: 	    [Wl|
<a name="219"/>  219: 	     encode_wildcards3(Levels,BitsRest,LevelNo+1,TotSize-BitsInLevel)];
<a name="220"/>  220: 
<a name="221"/>  221: 	{recursive,Wr} -&gt;
<a name="222"/>  222: 	    [Wr]
<a name="223"/>  223:     end.
<a name="224"/>  224: 
<a name="225"/>  225: <i>%% Slightly simplified code from hipe_rtl_ssapre.</i>
<a name="226"/>  226: <i>%%  beam_block used to do the following incorrect optimization:</i>
<a name="227"/>  227: <i>%%</i>
<a name="228"/>  228: <i>%%    {gc_bif,length,{f,0},1,[{x,0}],{x,3}}.</i>
<a name="229"/>  229: <i>%%                                   ^^^^^ Was {x,0} - changing to {x,3} is not safe.</i>
<a name="230"/>  230: <i>%%    {gc_bif,'+',{f,0},0,[{y,2},{integer,1}],{x,0}}.</i>
<a name="231"/>  231: <i>%%                     ^^^ Only one register live</i>
<a name="232"/>  232: <i>%%     . . .</i>
<a name="233"/>  233: <i>%%    {call_last,4,{f,2},4}.   %% beam_validator noted that {x,3} wasn't live.</i>
<a name="234"/>  234: 
<a name="find_operands-4"/><a name="235"/>  235: <b>find_operands</b>(Cfg,XsiGraph,[],_Count) -&gt;
<a name="236"/>  236:     {Cfg,XsiGraph};
<a name="237"/>  237: <b>find_operands</b>(Cfg,XsiGraph,ActiveList,Count) -&gt;
<a name="238"/>  238:     {NewCfg,TempActiveList}=?MODULE:find_operands_for_active_list(Cfg,XsiGraph,
<a name="239"/>  239: 								  ActiveList,[]),
<a name="240"/>  240:     NewActiveList=lists:reverse(TempActiveList),
<a name="241"/>  241:     [Count+1, length(NewActiveList), length(digraph:vertices(XsiGraph))],
<a name="find_operands-last_expr"/><a name="242"/>  242: <b>    find_operands</b>(NewCfg,XsiGraph,NewActiveList,Count+1).
<a name="243"/>  243: 
<a name="244"/>  244: <i>%% Some tests of local common subexpression elimination (CSE).</i>
<a name="245"/>  245: 
<a name="local_cse-1"/><a name="246"/>  246: <b>local_cse</b>(_Config) -&gt;
<a name="247"/>  247:     {Self,{ok,Self}} = local_cse_1(),
<a name="248"/>  248: 
<a name="249"/>  249:     local_cse_2([]),
<a name="250"/>  250:     local_cse_2(lists:seq(1, 512)),
<a name="251"/>  251:     local_cse_2(?MODULE:module_info()),
<a name="252"/>  252: 
<a name="253"/>  253:     {[b],[a,b]} = local_cse_3(a, b),
<a name="254"/>  254: 
<a name="255"/>  255:     {2000,Self,{Self,write_cache}} = local_cse_4(),
<a name="256"/>  256: 
<a name="local_cse-last_expr"/><a name="257"/>  257:     ok.
<a name="258"/>  258: 
<a name="local_cse_1-0"/><a name="259"/>  259: <b>local_cse_1</b>() -&gt;
<a name="260"/>  260:     %% Cover handling of unsafe tuple construction in
<a name="261"/>  261:     %% eliminate_use_of_from_reg/4. It became necessary to handle
<a name="262"/>  262:     %% unsafe tuples when local CSE was introduced.
<a name="263"/>  263: 
<a name="local_cse_1-last_expr"/><a name="264"/>  264: <b>    {self</b>(),{ok,self()}}.
<a name="265"/>  265: 
<a name="local_cse_2-1"/><a name="266"/>  266: <b>local_cse_2</b>(Term) -&gt;
<a name="local_cse_2-last_expr"/><a name="267"/>  267: <b>    case cse_make_binary</b>(Term) of
<a name="268"/>  268:         &lt;&lt;Size:8,BinTerm:Size/binary&gt;&gt; -&gt;
<a name="269"/>  269:             Term = binary_to_term(BinTerm);
<a name="270"/>  270:         &lt;&lt;Size:8,SizeTerm:Size/binary,BinTerm/binary&gt;&gt; -&gt;
<a name="271"/>  271:             {'$size',TermSize} = binary_to_term(SizeTerm),
<a name="272"/>  272:             TermSize = byte_size(BinTerm),
<a name="273"/>  273:             Term = binary_to_term(BinTerm)
<a name="274"/>  274:     end.
<a name="275"/>  275: 
<a name="276"/>  276: <i>%% Copy of observer_backend:ttb_make_binary/1. During development of</i>
<a name="277"/>  277: <i>%% the local CSE optimization this function was incorrectly optimized.</i>
<a name="278"/>  278: 
<a name="cse_make_binary-1"/><a name="279"/>  279: <b>cse_make_binary</b>(Term) -&gt;
<a name="280"/>  280:     B = term_to_binary(Term),
<a name="281"/>  281:     SizeB = byte_size(B),
<a name="cse_make_binary-last_expr"/><a name="282"/>  282:     if SizeB &gt; 255 -&gt;
<a name="283"/>  283:             SB = term_to_binary({'$size',SizeB}),
<a name="284"/>  284:             &lt;&lt;(byte_size(SB)):8, SB/binary, B/binary&gt;&gt;;
<a name="285"/>  285:        true -&gt;
<a name="286"/>  286:             &lt;&lt;SizeB:8, B/binary&gt;&gt;
<a name="287"/>  287:     end.
<a name="288"/>  288: 
<a name="local_cse_3-2"/><a name="289"/>  289: <b>local_cse_3</b>(X, Y) -&gt;
<a name="290"/>  290:     %% The following expression was incorrectly transformed to {[X,Y],[X,Y]}
<a name="291"/>  291:     %% during development of the local CSE optimization.
<a name="292"/>  292: 
<a name="local_cse_3-last_expr"/><a name="293"/>  293:     {[Y],[X,Y]}.
<a name="294"/>  294: 
<a name="local_cse_4-0"/><a name="295"/>  295: <b>local_cse_4</b>() -&gt;
<a name="local_cse_4-last_expr"/><a name="296"/>  296: <b>    do_local_cse_4</b>(2000, self(), {self(), write_cache}).
<a name="297"/>  297: 
<a name="do_local_cse_4-3"/><a name="298"/>  298: <b>do_local_cse_4</b>(X, Y, Z) -&gt;
<a name="do_local_cse_4-last_expr"/><a name="299"/>  299:     {X,Y,Z}.
<a name="300"/>  300: 
<a name="301"/>  301: <i>%% Tests previously found bugs when running beam_block the second time.</i>
<a name="302"/>  302: 
<a name="second_block_pass-1"/><a name="303"/>  303: <b>second_block_pass</b>(_Config) -&gt;
<a name="304"/>  304:     [#{dts:=5.0}] = second_1([#{dts =&gt; 10.0}], 2.0),
<a name="second_block_pass-last_expr"/><a name="305"/>  305:     ok.
<a name="306"/>  306: 
<a name="second_1-2"/><a name="307"/>  307: <b>second_1</b>(Fs, TS) -&gt;
<a name="second_1-last_expr"/><a name="308"/>  308:     [F#{dts=&gt;DTS / TS} || #{dts:=DTS} = F &lt;- Fs].
<a name="309"/>  309: 
<a name="coverage-1"/><a name="310"/>  310: <b>coverage</b>(Config) -&gt;
<a name="311"/>  311:     [] = coverage_1(),
<a name="312"/>  312: 
<a name="313"/>  313:     [42,Config] = (coverage_2(Config))({fun id/1}),
<a name="314"/>  314: 
<a name="315"/>  315:     {b,a,badarith} = coverage_3(a, b),
<a name="316"/>  316:     ok = coverage_3(0, 1),
<a name="317"/>  317: 
<a name="318"/>  318:     {'EXIT',{badarg,_}} = catch coverage_4(a, b),
<a name="319"/>  319: 
<a name="coverage-last_expr"/><a name="320"/>  320:     ok.
<a name="321"/>  321: 
<a name="coverage_1-0"/><a name="322"/>  322: <b>coverage_1</b>() -&gt;
<a name="coverage_1-last_expr"/><a name="323"/>  323: <b>    [</b>(bnot head):bar(hdr, case kind of
<a name="324"/>  324:                               [] -&gt; whatever
<a name="325"/>  325:                           end) || 7 &lt;- []].
<a name="326"/>  326: 
<a name="coverage_2-1"/><a name="327"/>  327: <b>coverage_2</b>(Cmds) -&gt;
<a name="coverage_2-last_expr"/><a name="328"/>  328: <b>    fun</b>({CollecFun}) -&gt;
<a name="329"/>  329:             [id(42), CollecFun(Cmds)]
<a name="330"/>  330:     end.
<a name="331"/>  331: 
<a name="coverage_3-2"/><a name="332"/>  332: <b>coverage_3</b>(Node, Nodes) -&gt;
<a name="coverage_3-last_expr"/><a name="333"/>  333: <b>    try id</b>(Node) + 1 of
<a name="334"/>  334: 	_ -&gt;
<a name="335"/>  335:             ok
<a name="336"/>  336:     catch
<a name="337"/>  337:         _:Reason -&gt;
<a name="338"/>  338: 	    coverage_3(Nodes, Node, Reason)
<a name="339"/>  339:     end.
<a name="340"/>  340: 
<a name="coverage_3-3"/><a name="341"/>  341: <b>coverage_3</b>(A, B, C) -&gt;
<a name="coverage_3-last_expr"/><a name="342"/>  342: <b>    id</b>({A,B,C}).
<a name="343"/>  343: 
<a name="coverage_4-2"/><a name="344"/>  344: <b>coverage_4</b>(A, B) -&gt;
<a name="coverage_4-last_expr"/><a name="345"/>  345: <b>    do_coverage_4</b>(ok, (ok xor ok)#{ok := ok}, B, ok) =:= A.
<a name="346"/>  346: 
<a name="do_coverage_4-4"/><a name="347"/>  347: <b>do_coverage_4</b>(_, _, _, _) -&gt;
<a name="do_coverage_4-last_expr"/><a name="348"/>  348:     ok.
<a name="349"/>  349: 
<a name="350"/>  350: <i>%%%</i>
<a name="351"/>  351: <i>%%% Common functions.</i>
<a name="352"/>  352: <i>%%%</i>
<a name="353"/>  353: 
<a name="id-1"/><a name="id-last_expr"/><a name="354"/>  354: <b>id</b>(I) -&gt; I.
</pre>
<script>
var hash = window.location.hash.substring(1);
var anchor = document.getElementsByName(hash);
anchor[0].style.backgroundColor="orange";
</script>
</body>
</html>
