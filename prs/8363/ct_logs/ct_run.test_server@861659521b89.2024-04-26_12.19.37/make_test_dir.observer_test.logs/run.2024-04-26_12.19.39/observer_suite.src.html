<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/></meta>
<title>/buildroot/otp/lib/observer/make_test_dir/observer_test/observer_SUITE.erl</title>
</head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
<a name="1"/>    1: <i>%%</i>
<a name="2"/>    2: <i>%% %CopyrightBegin%</i>
<a name="3"/>    3: <i>%%</i>
<a name="4"/>    4: <i>%% Copyright Ericsson AB 2006-2023. All Rights Reserved.</i>
<a name="5"/>    5: <i>%%</i>
<a name="6"/>    6: <i>%% Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</i>
<a name="7"/>    7: <i>%% you may not use this file except in compliance with the License.</i>
<a name="8"/>    8: <i>%% You may obtain a copy of the License at</i>
<a name="9"/>    9: <i>%%</i>
<a name="10"/>   10: <i>%%     http://www.apache.org/licenses/LICENSE-2.0</i>
<a name="11"/>   11: <i>%%</i>
<a name="12"/>   12: <i>%% Unless required by applicable law or agreed to in writing, software</i>
<a name="13"/>   13: <i>%% distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</i>
<a name="14"/>   14: <i>%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</i>
<a name="15"/>   15: <i>%% See the License for the specific language governing permissions and</i>
<a name="16"/>   16: <i>%% limitations under the License.</i>
<a name="17"/>   17: <i>%%</i>
<a name="18"/>   18: <i>%% %CopyrightEnd%</i>
<a name="19"/>   19: <i>%%</i>
<a name="20"/>   20: 
<a name="21"/>   21: <b>-module</b>(observer_SUITE).
<a name="22"/>   22: <b>-include_lib</b>(&quot;common_test/include/ct.hrl&quot;).
<a name="23"/>   23: <b>-include_lib</b>(&quot;wx/include/wx.hrl&quot;).
<a name="24"/>   24: <b>-include_lib</b>(&quot;observer/src/observer_tv.hrl&quot;).
<a name="25"/>   25: 
<a name="26"/>   26: <b>-define</b>(ID_LOGVIEW, 5).
<a name="27"/>   27: 
<a name="28"/>   28: <i>%% Test server specific exports</i>
<a name="29"/>   29: <b>-export</b>([all/0, suite/0,groups/0]).
<a name="30"/>   30: <b>-export</b>([init_per_testcase/2, end_per_testcase/2,
<a name="31"/>   31: 	 init_per_group/2, end_per_group/2,
<a name="32"/>   32: 	 init_per_suite/1, end_per_suite/1
<a name="33"/>   33: 	]).
<a name="34"/>   34: 
<a name="35"/>   35: <i>%% Test cases</i>
<a name="36"/>   36: <b>-export</b>([app_file/1, appup_file/1,
<a name="37"/>   37: 	 basic/1, process_win/1, table_win/1,
<a name="38"/>   38:          port_win_when_tab_not_initiated/1,
<a name="39"/>   39:          blocking_start/1, remote_node/1
<a name="40"/>   40: 	]).
<a name="41"/>   41: 
<a name="42"/>   42: <i>%% Default timetrap timeout (set in init_per_testcase)</i>
<a name="43"/>   43: <b>-define</b>(default_timeout, test_server:minutes(2)).
<a name="44"/>   44: 
<a name="45"/>   45: <b>-define</b>(SECS(__S__), timer:seconds(__S__)).
<a name="46"/>   46: 
<a name="47"/>   47: <b>-define</b>(P(F),    print(F)).
<a name="48"/>   48: <b>-define</b>(P(F, A), print(F, A)).
<a name="49"/>   49: 
<a name="50"/>   50: 
<a name="suite-0"/><a name="suite-last_expr"/><a name="51"/>   51: <b>suite</b>() -&gt; [{timetrap, {minutes, 5}},
<a name="52"/>   52:             {ct_hooks,[ts_install_cth]}].
<a name="53"/>   53: 
<a name="all-0"/><a name="54"/>   54: <b>all</b>() -&gt;
<a name="all-last_expr"/><a name="55"/>   55:     [app_file, appup_file, {group, gui}].
<a name="56"/>   56: 
<a name="groups-0"/><a name="57"/>   57: <b>groups</b>() -&gt;
<a name="groups-last_expr"/><a name="58"/>   58:     [{gui, [],
<a name="59"/>   59:       [basic,
<a name="60"/>   60:        process_win,
<a name="61"/>   61:        table_win,
<a name="62"/>   62:        port_win_when_tab_not_initiated,
<a name="63"/>   63:        blocking_start,
<a name="64"/>   64:        remote_node
<a name="65"/>   65:       ]
<a name="66"/>   66:      }].
<a name="67"/>   67: 
<a name="68"/>   68: 
<a name="init_per_suite-1"/><a name="69"/>   69: <b>init_per_suite</b>(Config) -&gt;
<a name="70"/>   70:     ?P(&quot;init_per_suite -&gt; entry with&quot;
<a name="71"/>   71:        &quot;~n   Config: ~p&quot;, [Config]),
<a name="init_per_suite-last_expr"/><a name="72"/>   72:     Config.
<a name="73"/>   73: 
<a name="end_per_suite-1"/><a name="74"/>   74: <b>end_per_suite</b>(Config) -&gt;
<a name="75"/>   75:     ?P(&quot;end_per_suite -&gt; entry with&quot;
<a name="76"/>   76:        &quot;~n   Config: ~p&quot;, [Config]),
<a name="end_per_suite-last_expr"/><a name="77"/>   77:     ok.
<a name="78"/>   78: 
<a name="79"/>   79: 
<a name="80"/>   80: <i>%% init_per_testcase(basic = Case, Config) -&gt;</i>
<a name="81"/>   81: <i>%%     ?P(&quot;init_per_testcase(~w) -&gt; entry with&quot;</i>
<a name="82"/>   82: <i>%%        &quot;~n   Config: ~p&quot;, [Case, Config]),</i>
<a name="83"/>   83: <i>%%     {ok, Host} = inet:gethostname(),</i>
<a name="84"/>   84: <i>%%     {ok, IFL}  = inet:getifaddrs(),</i>
<a name="85"/>   85: <i>%%     init_per_testcase2(Case, [{host, Host}, {ifl, IFL} | Config]);</i>
<a name="init_per_testcase-2"/><a name="86"/>   86: <b>init_per_testcase</b>(Case, Config) -&gt;
<a name="87"/>   87:     ?P(&quot;init_per_testcase(~w) -&gt; entry with&quot;
<a name="88"/>   88:        &quot;~n   Config: ~p&quot;, [Case, Config]),
<a name="init_per_testcase-last_expr"/><a name="89"/>   89: <b>    init_per_testcase2</b>(Case, Config).
<a name="90"/>   90: 
<a name="init_per_testcase2-2"/><a name="91"/>   91: <b>init_per_testcase2</b>(Case, Config) -&gt;
<a name="92"/>   92:     ?P(&quot;init_per_testcase(~w) -&gt; entry&quot;, [Case]),
<a name="93"/>   93:     Dog = test_server:timetrap(?default_timeout),
<a name="init_per_testcase2-last_expr"/><a name="94"/>   94:     [{watchdog, Dog} | Config].
<a name="95"/>   95: 
<a name="96"/>   96: <i>%% end_per_testcase(basic = Case, Config) -&gt;</i>
<a name="97"/>   97: <i>%%     ?P(&quot;end_per_testcase(~w) -&gt; entry with&quot;</i>
<a name="98"/>   98: <i>%%        &quot;~n   Config: ~p&quot;, [Case, Config]),</i>
<a name="99"/>   99: <i>%%     case lists:keysearch(tc_status, 1, Config) of</i>
<a name="100"/>  100: <i>%%         {value, {tc_status, ok}} -&gt;</i>
<a name="101"/>  101: <i>%%             ?P(&quot;end_per_testcase(~w) -&gt; successful&quot;, [Case]),</i>
<a name="102"/>  102: <i>%%             ok;</i>
<a name="103"/>  103: <i>%%         {value, _} -&gt;</i>
<a name="104"/>  104: <i>%%             ?P(&quot;end_per_testcase(~w) -&gt; try ensure observer stopped&quot;, [Case]),</i>
<a name="105"/>  105: <i>%%             ensure_observer_stopped();</i>
<a name="106"/>  106: <i>%%         _ -&gt;</i>
<a name="107"/>  107: <i>%%             ?P(&quot;end_per_testcase(~w) -&gt; nop status&quot;, [Case]),</i>
<a name="108"/>  108: <i>%%             ok</i>
<a name="109"/>  109: <i>%%     end,</i>
<a name="110"/>  110: <i>%%     end_per_testcase2(Case, Config);</i>
<a name="end_per_testcase-2"/><a name="111"/>  111: <b>end_per_testcase</b>(Case, Config) -&gt;
<a name="112"/>  112:     ?P(&quot;end_per_testcase(~w) -&gt; entry with&quot;
<a name="113"/>  113:        &quot;~n   Config: ~p&quot;, [Case, Config]),
<a name="end_per_testcase-last_expr"/><a name="114"/>  114: <b>    end_per_testcase2</b>(Case, Config).
<a name="115"/>  115: 
<a name="end_per_testcase2-2"/><a name="116"/>  116: <b>end_per_testcase2</b>(Case, Config) -&gt;
<a name="117"/>  117:     ?P(&quot;end_per_testcase2(~w) -&gt; entry - try cancel watchdog&quot;, [Case]),
<a name="118"/>  118:     Dog = ?config(watchdog, Config),
<a name="119"/>  119:     test_server:timetrap_cancel(Dog),
<a name="120"/>  120:     ?P(&quot;end_per_testcase2(~w) -&gt; done&quot;, [Case]),
<a name="end_per_testcase2-last_expr"/><a name="121"/>  121:     ok.
<a name="122"/>  122: 
<a name="123"/>  123: 
<a name="init_per_group-2"/><a name="124"/>  124: <b>init_per_group</b>(gui = Group, Config) -&gt;
<a name="125"/>  125:     ?P(&quot;init_per_group(~w) -&gt; entry with&quot;
<a name="126"/>  126:        &quot;~n   Config: ~p&quot;, [Group, Config]),
<a name="init_per_group-last_expr"/><a name="127"/>  127:     try
<a name="128"/>  128: 	case os:type() of
<a name="129"/>  129: 	    {unix,darwin} -&gt;
<a name="130"/>  130: 		?P(&quot;init_per_group(~w) -&gt; skip&quot;, [Group]),
<a name="131"/>  131: 		exit(&quot;Can not test on MacOSX&quot;);
<a name="132"/>  132:             {unix,sunos} -&gt;
<a name="133"/>  133:                 exit(&quot;Skip on sunos, for now&quot;);
<a name="134"/>  134: 	    {unix, _} -&gt;
<a name="135"/>  135:                 Display = os:getenv(&quot;DISPLAY&quot;),
<a name="136"/>  136: 		?P(&quot;init_per_group(~w) -&gt; DISPLAY ~s&quot;,
<a name="137"/>  137:                    [Group, Display]),
<a name="138"/>  138: 		case ct:get_config(xserver, none) of
<a name="139"/>  139: 		    none -&gt; ignore;
<a name="140"/>  140:                     Display -&gt; ok;
<a name="141"/>  141: 		    Server -&gt;
<a name="142"/>  142:                         os:putenv(&quot;DISPLAY&quot;, Server), %% Might work if new node is spawned
<a name="143"/>  143:                         io:format(&quot;Config sets other x-server than the DISPLAY\n&quot;
<a name="144"/>  144:                                   &quot;the DISPLAY variable must be set when starting erlang&quot;)
<a name="145"/>  145: 		end;
<a name="146"/>  146: 	    _ -&gt; ignore
<a name="147"/>  147: 	end,
<a name="148"/>  148: 	wx:new(),
<a name="149"/>  149: 	wx:destroy(),
<a name="150"/>  150: 	Config
<a name="151"/>  151:     catch
<a name="152"/>  152: 	_:undef -&gt;
<a name="153"/>  153:             ?P(&quot;init_per_group(~w) -&gt; undef&quot;, [Group]),
<a name="154"/>  154: 	    {skipped, &quot;No wx compiled for this platform&quot;};
<a name="155"/>  155: 	C:Reason:S -&gt;
<a name="156"/>  156:             ?P(&quot;init_per_group(~w) -&gt; &quot;
<a name="157"/>  157:                &quot;~n   Class:  ~p&quot;
<a name="158"/>  158:                &quot;~n   Reason: ~p&quot;
<a name="159"/>  159:                &quot;~n   Stack:  ~p&quot;, [Group, C, Reason, S]),
<a name="160"/>  160: 	    SkipReason = io_lib:format(&quot;Start wx failed: ~p&quot;, [Reason]),
<a name="161"/>  161: 	    {skipped, lists:flatten(SkipReason)}
<a name="162"/>  162:     end.
<a name="163"/>  163: 
<a name="end_per_group-2"/><a name="164"/>  164: <b>end_per_group</b>(_Group, _Config) -&gt;
<a name="165"/>  165:     ?P(&quot;end_per_group(~w) -&gt; entry with&quot;
<a name="166"/>  166:        &quot;~n   Config: ~p&quot;, [_Group, _Config]),
<a name="end_per_group-last_expr"/><a name="167"/>  167:     ok.
<a name="168"/>  168: 
<a name="169"/>  169: 
<a name="app_file-1"/><a name="170"/>  170: <b>app_file</b>(suite) -&gt;
<a name="171"/>  171:     [];
<a name="172"/>  172: <b>app_file</b>(doc) -&gt;
<a name="173"/>  173:     [&quot;Testing .app file&quot;];
<a name="174"/>  174: <b>app_file</b>(Config) when is_list(Config) -&gt;
<a name="175"/>  175:     ok = test_server:app_test(observer),
<a name="app_file-last_expr"/><a name="176"/>  176:     ok.
<a name="177"/>  177: 
<a name="178"/>  178: 
<a name="179"/>  179: <i>%% Testing .appup file</i>
<a name="appup_file-1"/><a name="180"/>  180: <b>appup_file</b>(Config) when is_list(Config) -&gt;
<a name="appup_file-last_expr"/><a name="181"/>  181: <b>    ok = test_server:appup_test</b>(observer).
<a name="182"/>  182: 
<a name="183"/>  183: 
<a name="basic-1"/><a name="184"/>  184: <b>basic</b>(suite) -&gt; [];
<a name="185"/>  185: <b>basic</b>(doc) -&gt; [&quot;&quot;];
<a name="186"/>  186: <b>basic</b>(Config) when is_list(Config) -&gt;
<a name="187"/>  187:     ?P(&quot;basic -&gt; entry with&quot;
<a name="188"/>  188:        &quot;~n   Config: ~p&quot;, [Config]),
<a name="189"/>  189: 
<a name="190"/>  190:     %% Start these before
<a name="191"/>  191:     ?P(&quot;basic -&gt; try wx new&quot;),
<a name="192"/>  192:     wx:new(),
<a name="193"/>  193:     ?P(&quot;basic -&gt; try wx destroy&quot;),
<a name="194"/>  194:     wx:destroy(),
<a name="195"/>  195:     timer:start(),
<a name="196"/>  196:     ?P(&quot;basic -&gt; try start distribution&quot;),
<a name="197"/>  197:     {foo, node@machine} ! dummy_msg,  %% start distribution stuff
<a name="198"/>  198:     %% Otherwise ever lasting servers gets added to procs
<a name="199"/>  199: 
<a name="200"/>  200:     %% It takes some time for all the procs to start,
<a name="201"/>  201:     %% so give it some time.
<a name="202"/>  202:     %% Note that this is a problem *only* if this test suite
<a name="203"/>  203:     %% is run *on its own*. If all the observer suite(s) are run
<a name="204"/>  204:     %% (ex: ts:run(observer, [batch]), then this problem does
<a name="205"/>  205:     %% not occcur.
<a name="206"/>  206:     timer:sleep(5000),
<a name="207"/>  207: 
<a name="208"/>  208:     ?P(&quot;basic -&gt; procs before&quot;),
<a name="209"/>  209:     ProcsBefore = processes(),
<a name="210"/>  210:     ProcInfoBefore = [{P,process_info(P)} || P &lt;- ProcsBefore],
<a name="211"/>  211:     NumProcsBefore = length(ProcsBefore),
<a name="212"/>  212: 
<a name="213"/>  213:     ?P(&quot;basic -&gt; try start observer&quot;),
<a name="214"/>  214:     ok = observer:start(),
<a name="215"/>  215:     Notebook = setup_whitebox_testing(),
<a name="216"/>  216:     ?P(&quot;basic -&gt; Notebook ~p&quot;, [Notebook]),
<a name="217"/>  217: 
<a name="218"/>  218:     Count = wxNotebook:getPageCount(Notebook),
<a name="219"/>  219:     ?P(&quot;basic -&gt; page count ~p&quot;, [Count]),
<a name="220"/>  220:     true = Count &gt;= 7,
<a name="221"/>  221:     ?P(&quot;basic -&gt; check selection (=0)&quot;),
<a name="222"/>  222:     0 = wxNotebook:getSelection(Notebook),
<a name="223"/>  223:     ?P(&quot;basic -&gt; wait some time...&quot;),
<a name="224"/>  224: 
<a name="225"/>  225:     timer:sleep(500),
<a name="226"/>  226:     Check = fun(N, TestMore) -&gt;
<a name="227"/>  227: 		    TestMore andalso
<a name="228"/>  228: 			test_page(wxNotebook:getPageText(Notebook, N),
<a name="229"/>  229: 				  wxNotebook:getCurrentPage(Notebook)),
<a name="230"/>  230: 		    timer:sleep(200),
<a name="231"/>  231: 		    ok = wxNotebook:advanceSelection(Notebook)
<a name="232"/>  232: 	    end,
<a name="233"/>  233:     %% Just verify that we can toggle through all pages
<a name="234"/>  234:     ?P(&quot;basic -&gt; try verify that we can toggle through all pages&quot;),
<a name="235"/>  235:     [_|_] = [Check(N, false) || N &lt;- lists:seq(1, Count)],
<a name="236"/>  236:     %% Cause it to resize
<a name="237"/>  237:     ?P(&quot;basic -&gt; try resize&quot;),
<a name="238"/>  238:     Frame = get_top_level_parent(Notebook),
<a name="239"/>  239:     {W,H} = wxWindow:getSize(Frame),
<a name="240"/>  240:     wxWindow:setSize(Frame, W+10, H+10),
<a name="241"/>  241:     ?P(&quot;basic -&gt; try verify that we resized&quot;),
<a name="242"/>  242:     [_|_] = [Check(N, true) || N &lt;- lists:seq(0, Count-1)],
<a name="243"/>  243: 
<a name="244"/>  244:     ?P(&quot;basic -&gt; try stop observer&quot;),
<a name="245"/>  245:     ok = observer:stop(),
<a name="246"/>  246:     timer:sleep(2000), %% stop is async
<a name="247"/>  247:     ?P(&quot;basic -&gt; try verify observer stopped&quot;),
<a name="248"/>  248:     ProcsAfter = processes(),
<a name="249"/>  249:     NumProcsAfter = length(ProcsAfter),
<a name="250"/>  250:     if NumProcsAfter =/= NumProcsBefore -&gt;
<a name="251"/>  251:             BeforeNotAfter = ProcsBefore -- ProcsAfter,
<a name="252"/>  252:             AfterNotBefore = ProcsAfter -- ProcsBefore,
<a name="253"/>  253:             ?P(&quot;basic -&gt; *not* fully stopped:&quot;
<a name="254"/>  254:                &quot;~n   Number of Procs before: ~p&quot;
<a name="255"/>  255:                &quot;~n   Number of Procs after:  ~p&quot;,
<a name="256"/>  256:                [NumProcsBefore, NumProcsAfter]),
<a name="257"/>  257: 	    ct:log(&quot;Before but not after:~n~p~n&quot;,
<a name="258"/>  258: 		   [[{P,I} || {P,I} &lt;- ProcInfoBefore,
<a name="259"/>  259:                               lists:member(P,BeforeNotAfter)]]),
<a name="260"/>  260: 	    ct:log(&quot;After but not before:~n~p~n&quot;,
<a name="261"/>  261: 		   [[{P,process_info(P)} || P &lt;- AfterNotBefore]]),
<a name="262"/>  262: 	    ensure_observer_stopped(),
<a name="263"/>  263: 	    ct:fail(&quot;leaking processes&quot;);
<a name="264"/>  264:        true -&gt;
<a name="265"/>  265: 	    ok
<a name="266"/>  266:     end,
<a name="267"/>  267:     ?P(&quot;ensure observer stopped&quot;),
<a name="268"/>  268:     ensure_observer_stopped(?SECS(2)),
<a name="269"/>  269:     ?P(&quot;basic -&gt; done&quot;),
<a name="basic-last_expr"/><a name="270"/>  270:     ok.
<a name="271"/>  271: 
<a name="test_page-2"/><a name="272"/>  272: <b>test_page</b>(&quot;Load Charts&quot; ++ _, _Window) -&gt;
<a name="273"/>  273:     ?P(&quot;test_page(load charts) -&gt; entry&quot;),
<a name="274"/>  274:     %% Just let it display some info and hopefully it doesn't crash
<a name="275"/>  275:     timer:sleep(2000),
<a name="276"/>  276:     ok;
<a name="277"/>  277: <b>test_page</b>(&quot;Applications&quot; ++ _, _Window) -&gt;
<a name="278"/>  278:     ?P(&quot;test_page(applications) -&gt; entry&quot;),
<a name="279"/>  279:     ok = application:start(mnesia),
<a name="280"/>  280:     timer:sleep(1000),  %% Give it time to refresh
<a name="281"/>  281:     Active = get_active(),
<a name="282"/>  282:     FakeEv = #wx{event=#wxCommand{type=command_listbox_selected, cmdString=&quot;mnesia&quot;}},
<a name="283"/>  283:     Active ! FakeEv,
<a name="284"/>  284:     timer:sleep(1000),  %% Give it time to refresh
<a name="285"/>  285:     ok = application:stop(mnesia),
<a name="286"/>  286:     timer:sleep(1000),  %% Give it time to refresh
<a name="287"/>  287:     ok;
<a name="288"/>  288: 
<a name="289"/>  289: <b>test_page</b>(&quot;Processes&quot; ++ _, _Window) -&gt;
<a name="290"/>  290:     ?P(&quot;test_page(processes) -&gt; entry&quot;),
<a name="291"/>  291:     timer:sleep(500),  %% Give it time to refresh
<a name="292"/>  292:     Active = get_active(),
<a name="293"/>  293:     Active ! refresh_interval,
<a name="294"/>  294:     ChangeSort = fun(N) -&gt;
<a name="295"/>  295: 			 FakeEv = #wx{event=#wxList{type=command_list_col_click, col=N}},
<a name="296"/>  296: 			 Active ! FakeEv,
<a name="297"/>  297: 			 timer:sleep(200)
<a name="298"/>  298: 		 end,
<a name="299"/>  299:     [ChangeSort(N) || N &lt;- lists:seq(1,5) ++ [0]],
<a name="300"/>  300:     Focus = #wx{event=#wxList{type=command_list_item_focused, itemIndex=2}},
<a name="301"/>  301:     Active ! Focus,
<a name="302"/>  302:     Activate = #wx{event=#wxList{type=command_list_item_activated}},
<a name="303"/>  303:     Active ! Activate,
<a name="304"/>  304:     timer:sleep(1000),  %% Give it time to refresh
<a name="305"/>  305:     ok;
<a name="306"/>  306: 
<a name="307"/>  307: <b>test_page</b>(&quot;Ports&quot; ++ _, _Window) -&gt;
<a name="308"/>  308:     ?P(&quot;test_page(ports) -&gt; entry&quot;),
<a name="309"/>  309:     timer:sleep(500),  %% Give it time to refresh
<a name="310"/>  310:     Active = get_active(),
<a name="311"/>  311:     Active ! refresh_interval,
<a name="312"/>  312:     ChangeSort = fun(N) -&gt;
<a name="313"/>  313: 			 FakeEv = #wx{event=#wxList{type=command_list_col_click, col=N}},
<a name="314"/>  314: 			 Active ! FakeEv,
<a name="315"/>  315: 			 timer:sleep(200)
<a name="316"/>  316: 		 end,
<a name="317"/>  317:     [ChangeSort(N) || N &lt;- lists:seq(1,4) ++ [0]],
<a name="318"/>  318:     Activate = #wx{event=#wxList{type=command_list_item_activated,
<a name="319"/>  319: 				 itemIndex=2}},
<a name="320"/>  320:     Active ! Activate,
<a name="321"/>  321:     timer:sleep(1000),  %% Give it time to refresh
<a name="322"/>  322:     ok;
<a name="323"/>  323: 
<a name="324"/>  324: <b>test_page</b>(&quot;Sockets&quot; ++ _, _Window) -&gt;
<a name="325"/>  325:     ?P(&quot;test_page(sockets) -&gt; entry&quot;),
<a name="326"/>  326:     %% (maybe) We cannot count on having any 'sockets', so create some.
<a name="327"/>  327:     %% We don't actually need more then a 4 open *existing* sockets.
<a name="328"/>  328:     Sockets = sock_create([{[any],         {inet,  stream,    tcp}},
<a name="329"/>  329:                            {[any],         {inet,  stream,    tcp}},
<a name="330"/>  330:                            {[any],         {inet,  dgram,     udp}},
<a name="331"/>  331:                            {[any],         {inet,  dgram,     udp}},
<a name="332"/>  332:                            {[ipv6],        {inet6, stream,    tcp}},
<a name="333"/>  333:                            {[ipv6],        {inet6, dgram,     udp}},
<a name="334"/>  334:                            {[sctp],        {inet,  seqpacket, sctp}},
<a name="335"/>  335:                            {[ipv6, sctp],  {inet6, seqpacket, sctp}}]),
<a name="336"/>  336:     timer:sleep(500),  %% Give it time to refresh
<a name="337"/>  337:     Active = get_active(),
<a name="338"/>  338:     Active ! refresh_interval,
<a name="339"/>  339:     %% And this stuff only works if we actually have some (&gt;= 4) sockets
<a name="340"/>  340:     %% so check that we do
<a name="341"/>  341:     try socket:number_of() of
<a name="342"/>  342:         NumSocks when NumSocks &gt;= 4 -&gt;
<a name="343"/>  343:             ChangeSort =
<a name="344"/>  344:                 fun(N) -&gt;
<a name="345"/>  345:                         FakeEv = #wx{event=#wxList{type=command_list_col_click, col=N}},
<a name="346"/>  346:                         Active ! FakeEv,
<a name="347"/>  347:                         timer:sleep(200)
<a name="348"/>  348:                 end,
<a name="349"/>  349:             [ChangeSort(N) || N &lt;- lists:seq(1,4) ++ [0]],
<a name="350"/>  350:             Activate = #wx{event=#wxList{type=command_list_item_activated,
<a name="351"/>  351:                                          itemIndex=2}},
<a name="352"/>  352:             Active ! Activate,
<a name="353"/>  353:             timer:sleep(1000);  %% Give it time to refresh
<a name="354"/>  354:         _ -&gt;
<a name="355"/>  355:             ?P(&quot;not enough sockets - skip list-col-click test&quot;)
<a name="356"/>  356:     catch
<a name="357"/>  357:         _:_:_ -&gt;
<a name="358"/>  358:             ?P(&quot;'socket' not supported&quot;)
<a name="359"/>  359:     end,
<a name="360"/>  360:     %% (maybe) Cleanup
<a name="361"/>  361:     sock_close(Sockets),
<a name="362"/>  362:     ok;
<a name="363"/>  363: 
<a name="364"/>  364: <b>test_page</b>(&quot;Table&quot; ++ _, _Window) -&gt;
<a name="365"/>  365:     ?P(&quot;test_page(table) -&gt; entry&quot;),
<a name="366"/>  366:     Tables = [ets:new(list_to_atom(&quot;Test-&quot; ++ [C]), [public]) || C &lt;- lists:seq($A, $Z)],
<a name="367"/>  367:     Table = lists:nth(3, Tables),
<a name="368"/>  368:     ets:insert(Table, [{N,100-N} || N &lt;- lists:seq(1,100)]),
<a name="369"/>  369: 
<a name="370"/>  370:     Active = get_active(),
<a name="371"/>  371:     Active ! refresh_interval,
<a name="372"/>  372:     ChangeSort = fun(N) -&gt;
<a name="373"/>  373: 			 FakeEv = #wx{event=#wxList{type=command_list_col_click, col=N}},
<a name="374"/>  374: 			 Active ! FakeEv,
<a name="375"/>  375: 			 timer:sleep(200)
<a name="376"/>  376: 		 end,
<a name="377"/>  377:     [ChangeSort(N) || N &lt;- lists:seq(1,5) ++ [0]],
<a name="378"/>  378:     timer:sleep(1000),
<a name="379"/>  379:     Focus = #wx{event=#wxList{type=command_list_item_selected, itemIndex=2}},
<a name="380"/>  380:     Active ! Focus,
<a name="381"/>  381:     Activate = #wx{event=#wxList{type=command_list_item_activated, itemIndex=2}},
<a name="382"/>  382:     Active ! Activate,
<a name="383"/>  383: 
<a name="384"/>  384:     Info = 407, %% whitebox...
<a name="385"/>  385:     Active ! #wx{id=Info},
<a name="386"/>  386:     timer:sleep(1000),
<a name="387"/>  387:     ok;
<a name="388"/>  388: 
<a name="389"/>  389: <b>test_page</b>(&quot;Trace Overview&quot; ++ _, _Window) -&gt;
<a name="390"/>  390:     ?P(&quot;test_page(trace overview) -&gt; entry&quot;),
<a name="391"/>  391:     timer:sleep(500),  %% Give it time to refresh
<a name="392"/>  392:     Active = get_active(),
<a name="393"/>  393:     Active ! refresh_interval,
<a name="394"/>  394:     timer:sleep(1000),  %% Give it time to refresh
<a name="395"/>  395:     ok;
<a name="396"/>  396: 
<a name="397"/>  397: <b>test_page</b>(Title, Window) -&gt;
<a name="398"/>  398:     ?P(&quot;test_page -&gt; entry with&quot;
<a name="399"/>  399:        &quot;~n   Title:  ~p&quot;
<a name="400"/>  400:        &quot;~n   Window: ~p&quot;, [Title, Window]),
<a name="401"/>  401:     %% Just let it display some info and hopefully it doesn't crash
<a name="402"/>  402:     timer:sleep(1000),
<a name="test_page-last_expr"/><a name="403"/>  403:     ok.
<a name="404"/>  404: 
<a name="405"/>  405: 
<a name="process_win-1"/><a name="406"/>  406: <b>process_win</b>(suite) -&gt; [];
<a name="407"/>  407: <b>process_win</b>(doc) -&gt; [&quot;&quot;];
<a name="408"/>  408: <b>process_win</b>(Config) when is_list(Config) -&gt;
<a name="409"/>  409:     ?P(&quot;process_win -&gt; entry&quot;),
<a name="410"/>  410:     % Stop SASL if already started
<a name="411"/>  411:     SaslStart = case whereis(sasl_sup) of
<a name="412"/>  412:                   undefined -&gt; false;
<a name="413"/>  413:                   _         -&gt; application:stop(sasl),
<a name="414"/>  414:                                true
<a name="415"/>  415:                 end,
<a name="416"/>  416:     % Define custom sasl and log_mf_h app vars
<a name="417"/>  417:     Privdir=?config(priv_dir,Config),
<a name="418"/>  418:     application:set_env(sasl, sasl_error_logger, tty),
<a name="419"/>  419:     application:set_env(sasl, error_logger_mf_dir, Privdir),
<a name="420"/>  420:     application:set_env(sasl, error_logger_mf_maxbytes, 1000),
<a name="421"/>  421:     application:set_env(sasl, error_logger_mf_maxfiles, 5),
<a name="422"/>  422:     application:start(sasl),
<a name="423"/>  423:     ok = observer:start(),
<a name="424"/>  424:     ObserverNB = setup_whitebox_testing(),
<a name="425"/>  425:     Parent = get_top_level_parent(ObserverNB),
<a name="426"/>  426:     % Activate log view
<a name="427"/>  427:     whereis(observer) ! #wx{id = ?ID_LOGVIEW, event = #wxCommand{type = command_menu_selected}},
<a name="428"/>  428:     timer:sleep(1000),
<a name="429"/>  429:     % Process window tests (use sasl_sup for a non empty Log tab)
<a name="430"/>  430:     Frame = observer_procinfo:start(whereis(sasl_sup), Parent, self()),
<a name="431"/>  431:     PIPid = wx_object:get_pid(Frame),
<a name="432"/>  432:     PIPid ! {get_debug_info, self()},
<a name="433"/>  433:     Notebook = receive {procinfo_debug, NB} -&gt; NB end,
<a name="434"/>  434:     Count = wxNotebook:getPageCount(Notebook),
<a name="435"/>  435:     Check = fun(_N) -&gt;
<a name="436"/>  436: 		    ok = wxNotebook:advanceSelection(Notebook),
<a name="437"/>  437: 		    timer:sleep(400)
<a name="438"/>  438: 	    end,
<a name="439"/>  439:     [_|_] = [Check(N) || N &lt;- lists:seq(1, Count)],
<a name="440"/>  440:     PIPid ! #wx{event=#wxClose{type=close_window}},
<a name="441"/>  441:     observer:stop(),
<a name="442"/>  442:     application:stop(sasl),
<a name="443"/>  443:     case SaslStart of
<a name="444"/>  444:          true  -&gt; application:start(sasl);
<a name="445"/>  445:          false -&gt; ok
<a name="446"/>  446:     end,
<a name="447"/>  447:     ?P(&quot;ensure observer stopped&quot;),
<a name="448"/>  448:     ensure_observer_stopped(?SECS(2)),
<a name="449"/>  449:     ?P(&quot;process_win -&gt; done&quot;),
<a name="process_win-last_expr"/><a name="450"/>  450:     ok.
<a name="451"/>  451: 
<a name="table_win-1"/><a name="452"/>  452: <b>table_win</b>(suite) -&gt; [];
<a name="453"/>  453: <b>table_win</b>(doc) -&gt; [&quot;&quot;];
<a name="454"/>  454: <b>table_win</b>(Config) when is_list(Config) -&gt;
<a name="455"/>  455:     ?P(&quot;table_win -&gt; entry&quot;),
<a name="456"/>  456:     Tables = [ets:new(list_to_atom(&quot;Test-&quot; ++ [C]), [public]) || C &lt;- lists:seq($A, $Z)],
<a name="457"/>  457:     Table = lists:nth(3, Tables),
<a name="458"/>  458:     ets:insert(Table, [{N,100-N} || N &lt;- lists:seq(1,100)]),
<a name="459"/>  459:     ok = observer:start(),
<a name="460"/>  460:     Notebook = setup_whitebox_testing(),
<a name="461"/>  461:     Parent = get_top_level_parent(Notebook),
<a name="462"/>  462:     TObj = observer_tv_table:start_link(Parent, [{node,node()}, {type,ets}, {table,#tab{name=foo, id=Table}}]),
<a name="463"/>  463:     %% Modal cannot test edit..
<a name="464"/>  464:     %% TPid = wx_object:get_pid(TObj),
<a name="465"/>  465:     %% TPid ! #wx{event=#wxList{type=command_list_item_activated, itemIndex=12}},
<a name="466"/>  466:     timer:sleep(3000),
<a name="467"/>  467:     wx_object:get_pid(TObj) ! #wx{event=#wxClose{type=close_window}},
<a name="468"/>  468:     observer:stop(),
<a name="469"/>  469:     ?P(&quot;ensure observer stopped&quot;),
<a name="470"/>  470:     ensure_observer_stopped(?SECS(3)),
<a name="471"/>  471:     ?P(&quot;table_win -&gt; done&quot;),
<a name="table_win-last_expr"/><a name="472"/>  472:     ok.
<a name="473"/>  473: 
<a name="remote_node-1"/><a name="474"/>  474: <b>remote_node</b>(_Config) -&gt;
<a name="475"/>  475:     {ok, Peer, Node} = ?CT_PEER(),
<a name="476"/>  476:     ok = observer:start(Node),
<a name="477"/>  477:     timer:sleep(1000),
<a name="478"/>  478:     Node = observer_wx:get_active_node(),
<a name="479"/>  479:     observer:stop(),
<a name="480"/>  480:     ensure_observer_stopped(?SECS(3)),
<a name="remote_node-last_expr"/><a name="481"/>  481: <b>    peer:stop</b>(Peer).
<a name="482"/>  482: 
<a name="blocking_start-1"/><a name="483"/>  483: <b>blocking_start</b>(_Config) -&gt;
<a name="484"/>  484:     {Pid, SpawnerRef} = spawn_monitor(fun observer:start_and_wait/0),
<a name="485"/>  485:     timer:sleep(1000),
<a name="486"/>  486:     ObserverRef = monitor(process, observer),
<a name="487"/>  487:     receive
<a name="488"/>  488:         {'DOWN', ObserverRef, _, _, Reason} -&gt;
<a name="489"/>  489:             error({observer_stopped_unexpectedly, Reason});
<a name="490"/>  490:         {'DOWN', SpawnerRef, _, _, Reason} -&gt;
<a name="491"/>  491:             error({spawner_stopped_unexpectedly, Reason})
<a name="492"/>  492:     after
<a name="493"/>  493:         500 -&gt;
<a name="494"/>  494:             ok
<a name="495"/>  495:     end,
<a name="496"/>  496:     observer:stop(),
<a name="497"/>  497:     ensure_observer_stopped(?SECS(3)),
<a name="498"/>  498:     receive
<a name="499"/>  499:         {'DOWN', ObserverRef, _, _, _} -&gt;
<a name="500"/>  500:             ok
<a name="501"/>  501:     after
<a name="502"/>  502:         500 -&gt;
<a name="503"/>  503:             error(observer_should_have_stopped)
<a name="504"/>  504:     end,
<a name="505"/>  505:     false = erlang:is_process_alive(Pid),
<a name="blocking_start-last_expr"/><a name="506"/>  506:     ok.
<a name="507"/>  507: 
<a name="508"/>  508: <i>%% Test PR-1296/OTP-14151</i>
<a name="509"/>  509: <i>%% Clicking a link to a port before the port tab has been activated the</i>
<a name="510"/>  510: <i>%% first time crashes observer.</i>
<a name="port_win_when_tab_not_initiated-1"/><a name="511"/>  511: <b>port_win_when_tab_not_initiated</b>(_Config) -&gt;
<a name="512"/>  512:     ?P(&quot;port_win_when_tab_not_initiated -&gt; entry&quot;),
<a name="513"/>  513:     {ok,Port} = gen_tcp:listen(0,[]),
<a name="514"/>  514:     ok = observer:start(),
<a name="515"/>  515:     _Notebook = setup_whitebox_testing(),
<a name="516"/>  516:     observer ! {open_link,erlang:port_to_list(Port)},
<a name="517"/>  517:     timer:sleep(1000),
<a name="518"/>  518:     observer:stop(),
<a name="519"/>  519:     ?P(&quot;ensure observer stopped&quot;),
<a name="520"/>  520:     ensure_observer_stopped(?SECS(3)),
<a name="521"/>  521:     ?P(&quot;port_win_when_tab_not_initiated -&gt; done&quot;),
<a name="port_win_when_tab_not_initiated-last_expr"/><a name="522"/>  522:     ok.
<a name="523"/>  523: 
<a name="524"/>  524: 
<a name="525"/>  525: <i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
<a name="526"/>  526: 
<a name="get_top_level_parent-1"/><a name="527"/>  527: <b>get_top_level_parent</b>(Window) -&gt;
<a name="528"/>  528:     Parent =  wxWindow:getParent(Window),
<a name="get_top_level_parent-last_expr"/><a name="529"/>  529: <b>    case wx:is_null</b>(Parent) of
<a name="530"/>  530: 	true -&gt; Window;
<a name="531"/>  531: 	false -&gt; get_top_level_parent(Parent)
<a name="532"/>  532:     end.
<a name="533"/>  533: 
<a name="setup_whitebox_testing-0"/><a name="534"/>  534: <b>setup_whitebox_testing</b>() -&gt;
<a name="535"/>  535:     %% So that if we die observer exists
<a name="536"/>  536:     link(whereis(observer)),
<a name="537"/>  537:     {Env, Notebook, _Active} = get_observer_debug(),
<a name="538"/>  538:     wx:set_env(Env),
<a name="setup_whitebox_testing-last_expr"/><a name="539"/>  539:     Notebook.
<a name="540"/>  540: 
<a name="get_active-0"/><a name="541"/>  541: <b>get_active</b>() -&gt;
<a name="542"/>  542:     {_, _, Active} = get_observer_debug(),
<a name="get_active-last_expr"/><a name="543"/>  543:     Active.
<a name="544"/>  544: 
<a name="get_observer_debug-0"/><a name="545"/>  545: <b>get_observer_debug</b>() -&gt;
<a name="546"/>  546:     observer ! {get_debug_info, self()},
<a name="get_observer_debug-last_expr"/><a name="547"/>  547:     receive
<a name="548"/>  548: 	{observer_debug, Env, Notebook, Active} -&gt;
<a name="549"/>  549: 	    {Env, Notebook, Active}
<a name="550"/>  550:     end.
<a name="551"/>  551: 
<a name="552"/>  552: 
<a name="553"/>  553: <i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
<a name="554"/>  554: 
<a name="ensure_observer_stopped-0"/><a name="555"/>  555: <b>ensure_observer_stopped</b>() -&gt;
<a name="ensure_observer_stopped-last_expr"/><a name="556"/>  556: <b>    ensure_observer_stopped</b>(0).
<a name="557"/>  557: 
<a name="ensure_observer_stopped-1"/><a name="558"/>  558: <b>ensure_observer_stopped</b>(T) when is_integer(T) andalso (T &gt; 0) -&gt;
<a name="559"/>  559:     case erlang:whereis(observer) of
<a name="560"/>  560: 	undefined -&gt;
<a name="561"/>  561: 	    ?P(&quot;observer *not* running&quot;),
<a name="562"/>  562: 	    ok;
<a name="563"/>  563: 	Pid when is_pid(Pid) -&gt;
<a name="564"/>  564: 	    ?P(&quot;observer process still running: &quot;
<a name="565"/>  565: 	       &quot;~n   ~p&quot;, [erlang:process_info(Pid)]),
<a name="566"/>  566: 	    ct:sleep(?SECS(1)),
<a name="567"/>  567: 	    ensure_observer_stopped(T - 1000),
<a name="568"/>  568: 	    ok
<a name="569"/>  569:     end;
<a name="570"/>  570: <b>ensure_observer_stopped</b>(_) -&gt;
<a name="ensure_observer_stopped-last_expr"/><a name="571"/>  571: <b>    case erlang:whereis</b>(observer) of
<a name="572"/>  572: 	undefined -&gt;
<a name="573"/>  573: 	    ?P(&quot;observer *not* running&quot;),
<a name="574"/>  574: 	    ok;
<a name="575"/>  575: 	Pid when is_pid(Pid) -&gt;
<a name="576"/>  576: 	    ?P(&quot;observer process still running: kill&quot;
<a name="577"/>  577: 	       &quot;~n   ~p&quot;, [erlang:process_info(Pid)]),
<a name="578"/>  578: 	    exit(kill, Pid),
<a name="579"/>  579: 	    ok
<a name="580"/>  580:     end.
<a name="581"/>  581: 
<a name="582"/>  582: 
<a name="583"/>  583: <i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
<a name="584"/>  584: 
<a name="sock_create-1"/><a name="585"/>  585: <b>sock_create</b>(Conds) when is_list(Conds) -&gt;
<a name="sock_create-last_expr"/><a name="586"/>  586: <b>    sock_create</b>(Conds, []).
<a name="587"/>  587: 
<a name="sock_create-2"/><a name="588"/>  588: <b>sock_create</b>([], Acc) -&gt;
<a name="589"/>  589:     Acc;
<a name="590"/>  590: <b>sock_create</b>([{Features, Args}|Conds], Acc) -&gt;
<a name="sock_create-last_expr"/><a name="591"/>  591: <b>    case sock_cond_action</b>(Features, fun() -&gt; sock_open(Args) end) of
<a name="592"/>  592:         undefined -&gt;
<a name="593"/>  593:             sock_create(Conds, Acc);
<a name="594"/>  594:         Socket -&gt;
<a name="595"/>  595:             sock_create(Conds, [Socket|Acc])
<a name="596"/>  596:     end.
<a name="597"/>  597: 
<a name="sock_cond_action-2"/><a name="598"/>  598: <b>sock_cond_action</b>(Features, Action) -&gt;
<a name="sock_cond_action-last_expr"/><a name="599"/>  599: <b>    sock_cond_action</b>(Features, Action, undefined).
<a name="600"/>  600: 
<a name="sock_cond_action-3"/><a name="601"/>  601: <b>sock_cond_action</b>(Features, Action, Default) -&gt;
<a name="sock_cond_action-last_expr"/><a name="602"/>  602: <b>    case sock_is_supported</b>(Features) of
<a name="603"/>  603:         true -&gt;
<a name="604"/>  604:             Action();
<a name="605"/>  605:         false -&gt;
<a name="606"/>  606:             Default
<a name="607"/>  607:     end.
<a name="608"/>  608: 
<a name="609"/>  609: 
<a name="sock_is_supported-1"/><a name="610"/>  610: <b>sock_is_supported</b>([]) -&gt;
<a name="611"/>  611:     true;
<a name="612"/>  612: <b>sock_is_supported</b>([Feature|Features]) -&gt;
<a name="613"/>  613:     sock_is_supported(Feature) andalso sock_is_supported(Features);
<a name="614"/>  614: <b>sock_is_supported</b>(any) -&gt;
<a name="615"/>  615:     try socket:supports() of
<a name="616"/>  616:         Features when is_list(Features) -&gt;
<a name="617"/>  617:             true
<a name="618"/>  618:     catch
<a name="619"/>  619:         _:_:_ -&gt;
<a name="620"/>  620:             false
<a name="621"/>  621:     end;
<a name="622"/>  622: <b>sock_is_supported</b>(Feature) -&gt;
<a name="sock_is_supported-last_expr"/><a name="623"/>  623: <b>    try socket:is_supported</b>(Feature)
<a name="624"/>  624:     catch
<a name="625"/>  625:         _:_:_ -&gt;
<a name="626"/>  626:             false
<a name="627"/>  627:     end.
<a name="628"/>  628: 
<a name="629"/>  629: 
<a name="sock_open-1"/><a name="630"/>  630: <b>sock_open</b>({Domain, Type, Proto}) -&gt;
<a name="sock_open-last_expr"/><a name="631"/>  631: <b>    case socket:open</b>(Domain, Type, Proto) of
<a name="632"/>  632:         {ok, Socket} -&gt;
<a name="633"/>  633:             ?P(&quot;created socket: ~w, ~w, ~w&quot;, [Domain, Type, Proto]),
<a name="634"/>  634:             Socket;
<a name="635"/>  635:         {error, _} -&gt;
<a name="636"/>  636:             undefined
<a name="637"/>  637:     end.
<a name="638"/>  638: 
<a name="639"/>  639: 
<a name="sock_close-1"/><a name="640"/>  640: <b>sock_close</b>([]) -&gt;
<a name="641"/>  641:     ok;
<a name="642"/>  642: <b>sock_close</b>([Socket|Sockets]) -&gt;
<a name="643"/>  643:     sock_close(Socket),
<a name="644"/>  644:     sock_close(Sockets);
<a name="645"/>  645: <b>sock_close</b>(undefined) -&gt;
<a name="646"/>  646:     ok;
<a name="647"/>  647: <b>sock_close</b>(Socket) -&gt;
<a name="sock_close-last_expr"/><a name="648"/>  648: <b>    </b>(catch socket:close(Socket)).
<a name="649"/>  649: 
<a name="650"/>  650: 
<a name="651"/>  651: <i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
<a name="652"/>  652: 
<a name="653"/>  653: <i>%% f(F, A) -&gt;</i>
<a name="654"/>  654: <i>%%     lists:flatten(io_lib:format(F, A)).</i>
<a name="655"/>  655: 
<a name="formated_timestamp-0"/><a name="656"/>  656: <b>formated_timestamp</b>() -&gt;
<a name="formated_timestamp-last_expr"/><a name="657"/>  657: <b>    format_timestamp</b>(os:timestamp()).
<a name="658"/>  658: 
<a name="format_timestamp-1"/><a name="659"/>  659: <b>format_timestamp</b>({_N1, _N2, N3} = TS) -&gt;
<a name="660"/>  660:     {_Date, Time}   = calendar:now_to_local_time(TS),
<a name="661"/>  661:     {Hour, Min, Sec} = Time,
<a name="662"/>  662:     FormatTS = io_lib:format(&quot;~.2.0w:~.2.0w:~.2.0w.~.3.0w&quot;,
<a name="663"/>  663:                              [Hour, Min, Sec, N3 div 1000]),  
<a name="format_timestamp-last_expr"/><a name="664"/>  664: <b>    lists:flatten</b>(FormatTS).
<a name="665"/>  665: 
<a name="print-1"/><a name="666"/>  666: <b>print</b>(F) -&gt;
<a name="print-last_expr"/><a name="667"/>  667: <b>    print</b>(F, []).
<a name="668"/>  668: 
<a name="print-2"/><a name="669"/>  669: <b>print</b>(F, A) -&gt;
<a name="print-last_expr"/><a name="670"/>  670: <b>    io:format</b>(&quot;~s ~p &quot; ++ F ++ &quot;~n&quot;, [formated_timestamp(), self() | A]).
<a name="671"/>  671: 
</pre>
<script>
var hash = window.location.hash.substring(1);
var anchor = document.getElementsByName(hash);
anchor[0].style.backgroundColor="orange";
</script>
</body>
</html>
