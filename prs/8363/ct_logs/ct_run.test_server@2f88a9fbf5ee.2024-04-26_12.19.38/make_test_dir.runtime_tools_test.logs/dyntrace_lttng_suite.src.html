<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/></meta>
<title>/buildroot/otp/lib/runtime_tools/make_test_dir/runtime_tools_test/dyntrace_lttng_SUITE.erl</title>
</head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
<a name="1"/>    1: <i>%%</i>
<a name="2"/>    2: <i>%% %CopyrightBegin%</i>
<a name="3"/>    3: <i>%%</i>
<a name="4"/>    4: <i>%% Copyright Ericsson AB 2012-2016. All Rights Reserved.</i>
<a name="5"/>    5: <i>%%</i>
<a name="6"/>    6: <i>%% Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</i>
<a name="7"/>    7: <i>%% you may not use this file except in compliance with the License.</i>
<a name="8"/>    8: <i>%% You may obtain a copy of the License at</i>
<a name="9"/>    9: <i>%%</i>
<a name="10"/>   10: <i>%%     http://www.apache.org/licenses/LICENSE-2.0</i>
<a name="11"/>   11: <i>%%</i>
<a name="12"/>   12: <i>%% Unless required by applicable law or agreed to in writing, software</i>
<a name="13"/>   13: <i>%% distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</i>
<a name="14"/>   14: <i>%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</i>
<a name="15"/>   15: <i>%% See the License for the specific language governing permissions and</i>
<a name="16"/>   16: <i>%% limitations under the License.</i>
<a name="17"/>   17: <i>%%</i>
<a name="18"/>   18: <i>%% %CopyrightEnd%</i>
<a name="19"/>   19: <i>%%</i>
<a name="20"/>   20: <b>-module</b>(dyntrace_lttng_SUITE).
<a name="21"/>   21: <b>-include_lib</b>(&quot;common_test/include/ct.hrl&quot;).
<a name="22"/>   22: 
<a name="23"/>   23: <b>-export</b>([all/0, suite/0]).
<a name="24"/>   24: <b>-export</b>([init_per_suite/1, end_per_suite/1]).
<a name="25"/>   25: <b>-export</b>([init_per_testcase/2, end_per_testcase/2]).
<a name="26"/>   26: 
<a name="27"/>   27: <i>%% Test cases</i>
<a name="28"/>   28: <b>-export</b>([t_lttng_list/1,
<a name="29"/>   29:          t_procs/1,
<a name="30"/>   30:          t_ports/1,
<a name="31"/>   31:          t_running_process/1,
<a name="32"/>   32:          t_running_port/1,
<a name="33"/>   33:          t_call/1,
<a name="34"/>   34:          t_call_return_to/1,
<a name="35"/>   35:          t_call_silent/1,
<a name="36"/>   36:          t_send/1,
<a name="37"/>   37:          t_receive/1,
<a name="38"/>   38:          t_garbage_collection/1,
<a name="39"/>   39:          t_all/1]).
<a name="40"/>   40: 
<a name="suite-0"/><a name="41"/>   41: <b>suite</b>() -&gt;
<a name="suite-last_expr"/><a name="42"/>   42:     [{ct_hooks,[ts_install_cth]},
<a name="43"/>   43:      {timetrap, {seconds, 10}}].
<a name="44"/>   44: 
<a name="all-0"/><a name="45"/>   45: <b>all</b>() -&gt;
<a name="all-last_expr"/><a name="46"/>   46:     [t_lttng_list,
<a name="47"/>   47:      t_procs,
<a name="48"/>   48:      t_ports,
<a name="49"/>   49:      t_running_process,
<a name="50"/>   50:      t_running_port,
<a name="51"/>   51:      t_call,
<a name="52"/>   52:      t_call_return_to,
<a name="53"/>   53:      t_call_silent,
<a name="54"/>   54:      t_send,
<a name="55"/>   55:      t_receive,
<a name="56"/>   56:      t_garbage_collection,
<a name="57"/>   57:      t_all].
<a name="58"/>   58: 
<a name="59"/>   59: 
<a name="init_per_suite-1"/><a name="60"/>   60: <b>init_per_suite</b>(Config) -&gt;
<a name="init_per_suite-last_expr"/><a name="61"/>   61: <b>    case erlang:system_info</b>(dynamic_trace) of
<a name="62"/>   62:         lttng -&gt;
<a name="63"/>   63:             ensure_lttng_stopped(&quot;--all&quot;),
<a name="64"/>   64:             Config;
<a name="65"/>   65:         _ -&gt;
<a name="66"/>   66:             {skip, &quot;No LTTng configured on system.&quot;}
<a name="67"/>   67:     end.
<a name="68"/>   68: 
<a name="end_per_suite-1"/><a name="69"/>   69: <b>end_per_suite</b>(_Config) -&gt;
<a name="70"/>   70:     ensure_lttng_stopped(&quot;--all&quot;),
<a name="end_per_suite-last_expr"/><a name="71"/>   71:     ok.
<a name="72"/>   72: 
<a name="init_per_testcase-2"/><a name="73"/>   73: <b>init_per_testcase</b>(Case, Config) -&gt;
<a name="74"/>   74:     %% ensure loaded
<a name="75"/>   75:     _ = dyntrace:module_info(),
<a name="76"/>   76:     Name = atom_to_list(Case),
<a name="77"/>   77:     ok = ensure_lttng_started(Name, Config),
<a name="init_per_testcase-last_expr"/><a name="78"/>   78:     [{session, Name}|Config].
<a name="79"/>   79: 
<a name="end_per_testcase-2"/><a name="80"/>   80: <b>end_per_testcase</b>(Case, _Config) -&gt;
<a name="81"/>   81:     Name = atom_to_list(Case),
<a name="82"/>   82:     ok = ensure_lttng_stopped(Name),
<a name="end_per_testcase-last_expr"/><a name="83"/>   83:     ok.
<a name="84"/>   84: 
<a name="85"/>   85: <i>%% tracepoints</i>
<a name="86"/>   86: <i>%%</i>
<a name="87"/>   87: <i>%%  org_erlang_dyntrace:gc_major_end</i>
<a name="88"/>   88: <i>%%  org_erlang_dyntrace:gc_major_start</i>
<a name="89"/>   89: <i>%%  org_erlang_dyntrace:gc_minor_end</i>
<a name="90"/>   90: <i>%%  org_erlang_dyntrace:gc_minor_start</i>
<a name="91"/>   91: <i>%%  org_erlang_dyntrace:message_receive</i>
<a name="92"/>   92: <i>%%  org_erlang_dyntrace:message_send</i>
<a name="93"/>   93: <i>%%  -org_erlang_dyntrace:message_queued</i>
<a name="94"/>   94: <i>%%  org_erlang_dyntrace:function_exception</i>
<a name="95"/>   95: <i>%%  org_erlang_dyntrace:function_return</i>
<a name="96"/>   96: <i>%%  org_erlang_dyntrace:function_call</i>
<a name="97"/>   97: <i>%%  org_erlang_dyntrace:port_link</i>
<a name="98"/>   98: <i>%%  org_erlang_dyntrace:port_exit</i>
<a name="99"/>   99: <i>%%  org_erlang_dyntrace:port_open</i>
<a name="100"/>  100: <i>%%  org_erlang_dyntrace:port_scheduled</i>
<a name="101"/>  101: <i>%%  org_erlang_dyntrace:process_scheduled</i>
<a name="102"/>  102: <i>%%  org_erlang_dyntrace:process_register</i>
<a name="103"/>  103: <i>%%  org_erlang_dyntrace:process_exit</i>
<a name="104"/>  104: <i>%%  org_erlang_dyntrace:process_link</i>
<a name="105"/>  105: <i>%%  org_erlang_dyntrace:process_spawn</i>
<a name="106"/>  106: <i>%%</i>
<a name="107"/>  107: <i>%% Testcases</i>
<a name="108"/>  108: <i>%%</i>
<a name="109"/>  109: 
<a name="t_lttng_list-1"/><a name="110"/>  110: <b>t_lttng_list</b>(_Config) -&gt;
<a name="111"/>  111:     {ok, _} = cmd(&quot;lttng list -u&quot;),
<a name="t_lttng_list-last_expr"/><a name="112"/>  112:     ok.
<a name="113"/>  113: 
<a name="t_procs-1"/><a name="114"/>  114: <b>t_procs</b>(Config) when is_list(Config) -&gt;
<a name="115"/>  115:     ok = lttng_start_event(&quot;org_erlang_dyntrace:process_*&quot;, Config),
<a name="116"/>  116:     _ = erlang:trace(new, true, [{tracer, dyntrace, []},procs]),
<a name="117"/>  117: 
<a name="118"/>  118:     Pid = spawn_link(fun() -&gt; waiter() end),
<a name="119"/>  119:     Pid ! {self(), ok},
<a name="120"/>  120:     ok = receive {Pid,ok} -&gt; ok end,
<a name="121"/>  121:     timer:sleep(1000),
<a name="122"/>  122: 
<a name="123"/>  123:     _ = erlang:trace(all, false, [procs]),
<a name="124"/>  124:     Res = lttng_stop_and_view(Config),
<a name="125"/>  125:     ok = check_tracepoint(&quot;org_erlang_dyntrace:process_spawn&quot;, Res),
<a name="126"/>  126:     ok = check_tracepoint(&quot;org_erlang_dyntrace:process_link&quot;, Res),
<a name="127"/>  127:     ok = check_tracepoint(&quot;org_erlang_dyntrace:process_exit&quot;, Res),
<a name="128"/>  128:     ok = check_tracepoint(&quot;org_erlang_dyntrace:process_register&quot;, Res),
<a name="t_procs-last_expr"/><a name="129"/>  129:     ok.
<a name="130"/>  130: 
<a name="t_ports-1"/><a name="131"/>  131: <b>t_ports</b>(Config) when is_list(Config) -&gt;
<a name="132"/>  132:     ok = lttng_start_event(&quot;org_erlang_dyntrace:port_*&quot;, Config),
<a name="133"/>  133:     _ = erlang:trace(new, true, [{tracer, dyntrace, []},ports]),
<a name="134"/>  134: 
<a name="135"/>  135:     _ = os:cmd(&quot;ls&quot;),
<a name="136"/>  136: 
<a name="137"/>  137:     _ = erlang:trace(all, false, [{tracer, dyntrace, []},ports]),
<a name="138"/>  138:     Res = lttng_stop_and_view(Config),
<a name="139"/>  139:     ok = check_tracepoint(&quot;org_erlang_dyntrace:port_open&quot;, Res),
<a name="140"/>  140:     ok = check_tracepoint(&quot;org_erlang_dyntrace:port_link&quot;, Res),
<a name="141"/>  141:     ok = check_tracepoint(&quot;org_erlang_dyntrace:port_exit&quot;, Res),
<a name="t_ports-last_expr"/><a name="142"/>  142:     ok.
<a name="143"/>  143: 
<a name="t_running_process-1"/><a name="144"/>  144: <b>t_running_process</b>(Config) when is_list(Config) -&gt;
<a name="145"/>  145:     ok = lttng_start_event(&quot;org_erlang_dyntrace:process_scheduled&quot;, Config),
<a name="146"/>  146:     _ = erlang:trace(new, true, [{tracer, dyntrace, []},running]),
<a name="147"/>  147: 
<a name="148"/>  148:     Pid = spawn_link(fun() -&gt; waiter() end),
<a name="149"/>  149:     Pid ! {self(), ok},
<a name="150"/>  150:     ok = receive {Pid,ok} -&gt; ok end,
<a name="151"/>  151:     timer:sleep(1000),
<a name="152"/>  152: 
<a name="153"/>  153:     _ = erlang:trace(all, false, [running]),
<a name="154"/>  154:     Res = lttng_stop_and_view(Config),
<a name="155"/>  155:     ok = check_tracepoint(&quot;org_erlang_dyntrace:process_scheduled&quot;, Res),
<a name="t_running_process-last_expr"/><a name="156"/>  156:     ok.
<a name="157"/>  157: 
<a name="t_running_port-1"/><a name="158"/>  158: <b>t_running_port</b>(Config) when is_list(Config) -&gt;
<a name="159"/>  159:     ok = lttng_start_event(&quot;org_erlang_dyntrace:port_scheduled&quot;, Config),
<a name="160"/>  160:     _ = erlang:trace(new, true, [{tracer, dyntrace, []},running_ports]),
<a name="161"/>  161: 
<a name="162"/>  162:     _ = os:cmd(&quot;ls&quot;),
<a name="163"/>  163:     _ = os:cmd(&quot;ls&quot;),
<a name="164"/>  164: 
<a name="165"/>  165:     _ = erlang:trace(all, false, [running_ports]),
<a name="166"/>  166:     Res = lttng_stop_and_view(Config),
<a name="167"/>  167:     ok = check_tracepoint(&quot;org_erlang_dyntrace:port_scheduled&quot;, Res),
<a name="t_running_port-last_expr"/><a name="168"/>  168:     ok.
<a name="169"/>  169: 
<a name="170"/>  170: 
<a name="t_call-1"/><a name="171"/>  171: <b>t_call</b>(Config) when is_list(Config) -&gt;
<a name="172"/>  172:     ok = lttng_start_event(&quot;org_erlang_dyntrace:function_*&quot;, Config),
<a name="173"/>  173:     _ = erlang:trace(new, true, [{tracer, dyntrace, []}, call]),
<a name="174"/>  174:     _ = erlang:trace_pattern({?MODULE, '_', '_'}, [{'_',[],[{exception_trace}]}], [local]),
<a name="175"/>  175: 
<a name="176"/>  176:     DontLink = spawn(fun() -&gt; foo_clause_exception(nope) end),
<a name="177"/>  177:     Pid = spawn_link(fun() -&gt; waiter() end),
<a name="178"/>  178:     Pid ! {self(), ok},
<a name="179"/>  179:     ok = receive {Pid,ok} -&gt; ok end,
<a name="180"/>  180:     
<a name="181"/>  181:     timer:sleep(10),
<a name="182"/>  182:     undefined = erlang:process_info(DontLink),
<a name="183"/>  183: 
<a name="184"/>  184:     _ = erlang:trace_pattern({?MODULE, '_', '_'}, false, [local]),
<a name="185"/>  185:     _ = erlang:trace(all, false, [call]),
<a name="186"/>  186:     Res = lttng_stop_and_view(Config),
<a name="187"/>  187:     ok = check_tracepoint(&quot;org_erlang_dyntrace:function_call&quot;, Res),
<a name="188"/>  188:     ok = check_tracepoint(&quot;org_erlang_dyntrace:function_return&quot;, Res),
<a name="189"/>  189:     ok = check_tracepoint(&quot;org_erlang_dyntrace:function_exception&quot;, Res),
<a name="t_call-last_expr"/><a name="190"/>  190:     ok.
<a name="191"/>  191: 
<a name="t_send-1"/><a name="192"/>  192: <b>t_send</b>(Config) when is_list(Config) -&gt;
<a name="193"/>  193:     ok = lttng_start_event(&quot;org_erlang_dyntrace:message_send&quot;, Config),
<a name="194"/>  194:     _ = erlang:trace(new, true, [{tracer, dyntrace, []},send]),
<a name="195"/>  195: 
<a name="196"/>  196:     Pid = spawn_link(fun() -&gt; waiter() end),
<a name="197"/>  197:     Pid ! {self(), ok},
<a name="198"/>  198:     ok = receive {Pid,ok} -&gt; ok end,
<a name="199"/>  199:     _ = os:cmd(&quot;ls&quot;),
<a name="200"/>  200:     timer:sleep(10),
<a name="201"/>  201: 
<a name="202"/>  202:     _ = erlang:trace(all, false, [send]),
<a name="203"/>  203:     Res = lttng_stop_and_view(Config),
<a name="204"/>  204:     ok = check_tracepoint(&quot;org_erlang_dyntrace:message_send&quot;, Res),
<a name="t_send-last_expr"/><a name="205"/>  205:     ok.
<a name="206"/>  206: 
<a name="t_call_return_to-1"/><a name="207"/>  207: <b>t_call_return_to</b>(Config) when is_list(Config) -&gt;
<a name="208"/>  208:     ok = lttng_start_event(&quot;org_erlang_dyntrace:function_*&quot;, Config),
<a name="209"/>  209:     _ = erlang:trace(new, true, [{tracer, dyntrace, []}, call, return_to]),
<a name="210"/>  210:     _ = erlang:trace_pattern({lists, '_', '_'}, true, [local]),
<a name="211"/>  211:     _ = erlang:trace_pattern({?MODULE, '_', '_'}, true, [local]),
<a name="212"/>  212: 
<a name="213"/>  213:     Pid = spawn_link(fun() -&gt; gcfier(10) end),
<a name="214"/>  214:     Pid ! {self(), ok},
<a name="215"/>  215:     ok = receive {Pid,ok} -&gt; ok end,
<a name="216"/>  216:     timer:sleep(10),
<a name="217"/>  217: 
<a name="218"/>  218:     _ = erlang:trace_pattern({?MODULE, '_', '_'}, false, [local]),
<a name="219"/>  219:     _ = erlang:trace_pattern({lists, '_', '_'}, false, [local]),
<a name="220"/>  220:     _ = erlang:trace(all, false, [call,return_to]),
<a name="221"/>  221:     Res = lttng_stop_and_view(Config),
<a name="222"/>  222:     ok = check_tracepoint(&quot;org_erlang_dyntrace:function_call&quot;, Res),
<a name="t_call_return_to-last_expr"/><a name="223"/>  223:     ok.
<a name="224"/>  224: 
<a name="t_call_silent-1"/><a name="225"/>  225: <b>t_call_silent</b>(Config) when is_list(Config) -&gt;
<a name="226"/>  226:     ok = lttng_start_event(&quot;org_erlang_dyntrace:function_*&quot;, Config),
<a name="227"/>  227:     _ = erlang:trace(new, true, [{tracer, dyntrace, []}, call, silent]),
<a name="228"/>  228:     _ = erlang:trace_pattern({?MODULE, '_', '_'}, [{'_',[],[{exception_trace}]}], [local]),
<a name="229"/>  229: 
<a name="230"/>  230:     DontLink = spawn(fun() -&gt; foo_clause_exception(nope) end),
<a name="231"/>  231:     Pid = spawn_link(fun() -&gt; waiter() end),
<a name="232"/>  232:     Pid ! {self(), ok},
<a name="233"/>  233:     ok = receive {Pid,ok} -&gt; ok end,
<a name="234"/>  234: 
<a name="235"/>  235:     timer:sleep(10),
<a name="236"/>  236:     undefined = erlang:process_info(DontLink),
<a name="237"/>  237: 
<a name="238"/>  238:     _ = erlang:trace_pattern({?MODULE, '_', '_'}, false, [local]),
<a name="239"/>  239:     _ = erlang:trace(all, false, [call]),
<a name="240"/>  240:     Res = lttng_stop_and_view(Config),
<a name="241"/>  241:     notfound = check_tracepoint(&quot;org_erlang_dyntrace:function_call&quot;, Res),
<a name="242"/>  242:     notfound = check_tracepoint(&quot;org_erlang_dyntrace:function_return&quot;, Res),
<a name="243"/>  243:     notfound = check_tracepoint(&quot;org_erlang_dyntrace:function_exception&quot;, Res),
<a name="t_call_silent-last_expr"/><a name="244"/>  244:     ok.
<a name="245"/>  245: 
<a name="246"/>  246: 
<a name="t_receive-1"/><a name="247"/>  247: <b>t_receive</b>(Config) when is_list(Config) -&gt;
<a name="248"/>  248:     ok = lttng_start_event(&quot;org_erlang_dyntrace:message_receive&quot;, Config),
<a name="249"/>  249:     _ = erlang:trace(new, true, [{tracer, dyntrace, []},'receive']),
<a name="250"/>  250:     timer:sleep(20),
<a name="251"/>  251: 
<a name="252"/>  252:     Pid1 = spawn_link(fun() -&gt; waiter() end),
<a name="253"/>  253:     Pid1 ! {self(), ok},
<a name="254"/>  254:     ok = receive {Pid1,ok} -&gt; ok end,
<a name="255"/>  255: 
<a name="256"/>  256:     Pid2 = spawn_link(fun() -&gt; waiter() end),
<a name="257"/>  257:     Pid2 ! {self(), ok},
<a name="258"/>  258:     ok = receive {Pid2,ok} -&gt; ok end,
<a name="259"/>  259: 
<a name="260"/>  260:     timer:sleep(10),
<a name="261"/>  261:     _ = erlang:trace(all, false, ['receive']),
<a name="262"/>  262:     Res = lttng_stop_and_view(Config),
<a name="263"/>  263:     ok = check_tracepoint(&quot;org_erlang_dyntrace:message_receive&quot;, Res),
<a name="t_receive-last_expr"/><a name="264"/>  264:     ok.
<a name="265"/>  265: 
<a name="t_garbage_collection-1"/><a name="266"/>  266: <b>t_garbage_collection</b>(Config) when is_list(Config) -&gt;
<a name="267"/>  267:     ok = lttng_start_event(&quot;org_erlang_dyntrace:gc_*&quot;, Config),
<a name="268"/>  268:     _ = erlang:trace(new, true, [{tracer, dyntrace, []},garbage_collection]),
<a name="269"/>  269: 
<a name="270"/>  270:     Pid = spawn_link(fun() -&gt; gcfier() end),
<a name="271"/>  271:     Pid ! {self(), ok},
<a name="272"/>  272:     ok = receive {Pid,ok} -&gt; ok end,
<a name="273"/>  273:     timer:sleep(10),
<a name="274"/>  274:     _ = erlang:trace(all, false, [garbage_collection]),
<a name="275"/>  275:     Res = lttng_stop_and_view(Config),
<a name="276"/>  276:     ok = check_tracepoint(&quot;org_erlang_dyntrace:gc_major_start&quot;, Res),
<a name="277"/>  277:     ok = check_tracepoint(&quot;org_erlang_dyntrace:gc_major_end&quot;, Res),
<a name="278"/>  278:     ok = check_tracepoint(&quot;org_erlang_dyntrace:gc_minor_start&quot;, Res),
<a name="279"/>  279:     ok = check_tracepoint(&quot;org_erlang_dyntrace:gc_minor_end&quot;, Res),
<a name="t_garbage_collection-last_expr"/><a name="280"/>  280:     ok.
<a name="281"/>  281: 
<a name="t_all-1"/><a name="282"/>  282: <b>t_all</b>(Config) when is_list(Config) -&gt;
<a name="283"/>  283:     ok = lttng_start_event(&quot;org_erlang_dyntrace:*&quot;, Config),
<a name="284"/>  284:     _ = erlang:trace(new, true, [{tracer, dyntrace, []},all]),
<a name="285"/>  285: 
<a name="286"/>  286:     Pid1 = spawn_link(fun() -&gt; waiter() end),
<a name="287"/>  287:     Pid1 ! {self(), ok},
<a name="288"/>  288:     ok = receive {Pid1,ok} -&gt; ok end,
<a name="289"/>  289: 
<a name="290"/>  290:     Pid2 = spawn_link(fun() -&gt; gcfier() end),
<a name="291"/>  291:     Pid2 ! {self(), ok},
<a name="292"/>  292:     ok = receive {Pid2,ok} -&gt; ok end,
<a name="293"/>  293:     _ = os:cmd(&quot;ls&quot;),
<a name="294"/>  294:     _ = os:cmd(&quot;ls&quot;),
<a name="295"/>  295:     timer:sleep(10),
<a name="296"/>  296: 
<a name="297"/>  297:     _ = erlang:trace(all, false, [all]),
<a name="298"/>  298:     Res = lttng_stop_and_view(Config),
<a name="299"/>  299: 
<a name="300"/>  300:     ok = check_tracepoint(&quot;org_erlang_dyntrace:process_spawn&quot;, Res),
<a name="301"/>  301:     ok = check_tracepoint(&quot;org_erlang_dyntrace:process_link&quot;, Res),
<a name="302"/>  302:     ok = check_tracepoint(&quot;org_erlang_dyntrace:process_exit&quot;, Res),
<a name="303"/>  303:     ok = check_tracepoint(&quot;org_erlang_dyntrace:process_register&quot;, Res),
<a name="304"/>  304:     ok = check_tracepoint(&quot;org_erlang_dyntrace:port_open&quot;, Res),
<a name="305"/>  305:     ok = check_tracepoint(&quot;org_erlang_dyntrace:port_link&quot;, Res),
<a name="306"/>  306:     ok = check_tracepoint(&quot;org_erlang_dyntrace:port_exit&quot;, Res),
<a name="307"/>  307:     ok = check_tracepoint(&quot;org_erlang_dyntrace:process_scheduled&quot;, Res),
<a name="308"/>  308:     ok = check_tracepoint(&quot;org_erlang_dyntrace:port_scheduled&quot;, Res),
<a name="309"/>  309:     ok = check_tracepoint(&quot;org_erlang_dyntrace:message_send&quot;, Res),
<a name="310"/>  310:     ok = check_tracepoint(&quot;org_erlang_dyntrace:message_receive&quot;, Res),
<a name="311"/>  311:     ok = check_tracepoint(&quot;org_erlang_dyntrace:gc_major_start&quot;, Res),
<a name="312"/>  312:     ok = check_tracepoint(&quot;org_erlang_dyntrace:gc_major_end&quot;, Res),
<a name="313"/>  313:     ok = check_tracepoint(&quot;org_erlang_dyntrace:gc_minor_start&quot;, Res),
<a name="314"/>  314:     ok = check_tracepoint(&quot;org_erlang_dyntrace:gc_minor_end&quot;, Res),
<a name="t_all-last_expr"/><a name="315"/>  315:     ok.
<a name="316"/>  316: 
<a name="317"/>  317: 
<a name="318"/>  318: <i>%% aux</i>
<a name="319"/>  319: 
<a name="gcfier-0"/><a name="320"/>  320: <b>gcfier</b>() -&gt;
<a name="gcfier-last_expr"/><a name="321"/>  321: <b>    gcfier</b>(10000).
<a name="gcfier-1"/><a name="322"/>  322: <b>gcfier</b>(N) -&gt;
<a name="gcfier-last_expr"/><a name="323"/>  323:     receive
<a name="324"/>  324:         {Pid, ok} -&gt;
<a name="325"/>  325:             _ = lists:reverse(lists:seq(1,N)),
<a name="326"/>  326:             true = erlang:garbage_collect(),
<a name="327"/>  327:             Pid ! {self(), ok}
<a name="328"/>  328:     end.
<a name="329"/>  329: 
<a name="330"/>  330: 
<a name="waiter-0"/><a name="331"/>  331: <b>waiter</b>() -&gt;
<a name="332"/>  332:     true = register(?MODULE, self()),
<a name="waiter-last_expr"/><a name="333"/>  333:     receive
<a name="334"/>  334:         {Pid, ok} -&gt;
<a name="335"/>  335:             Child = spawn(fun() -&gt; receive ok -&gt; ok end end),
<a name="336"/>  336:             link(Child),
<a name="337"/>  337:             unlink(Child),
<a name="338"/>  338:             _ = lists:seq(1,1000),
<a name="339"/>  339:             Child ! ok,
<a name="340"/>  340:             true = unregister(?MODULE),
<a name="341"/>  341:             Pid ! {self(),ok}
<a name="342"/>  342:     end.
<a name="343"/>  343: 
<a name="foo_clause_exception-1"/><a name="foo_clause_exception-last_expr"/><a name="344"/>  344: <b>foo_clause_exception</b>({1,2}) -&gt; badness.
<a name="345"/>  345: 
<a name="346"/>  346: <i>%% lttng</i>
<a name="lttng_stop_and_view-1"/><a name="347"/>  347: <b>lttng_stop_and_view</b>(Config) -&gt;
<a name="348"/>  348:     Path = proplists:get_value(priv_dir, Config),
<a name="349"/>  349:     Name = proplists:get_value(session, Config),
<a name="350"/>  350:     {ok,_} = cmd(&quot;lttng stop &quot; ++ Name),
<a name="351"/>  351:     {ok,Res} = cmd(&quot;lttng view &quot; ++ Name ++ &quot; --trace-path=&quot; ++ Path),
<a name="lttng_stop_and_view-last_expr"/><a name="352"/>  352:     Res.
<a name="353"/>  353: 
<a name="check_tracepoint-2"/><a name="354"/>  354: <b>check_tracepoint</b>(TP, Data) -&gt;
<a name="check_tracepoint-last_expr"/><a name="355"/>  355: <b>    case re:run</b>(Data, TP, [global]) of
<a name="356"/>  356:         {match, _} -&gt; ok;
<a name="357"/>  357:         _ -&gt; notfound
<a name="358"/>  358:     end.
<a name="359"/>  359: 
<a name="lttng_start_event-2"/><a name="360"/>  360: <b>lttng_start_event</b>(Event, Config) -&gt;
<a name="361"/>  361:     Name = proplists:get_value(session, Config),
<a name="362"/>  362:     {ok, _} = cmd(&quot;lttng enable-event -u &quot; ++ Event ++ &quot; --session=&quot; ++ Name),
<a name="363"/>  363:     {ok, _} = cmd(&quot;lttng start &quot; ++ Name),
<a name="lttng_start_event-last_expr"/><a name="364"/>  364:     ok.
<a name="365"/>  365: 
<a name="ensure_lttng_started-2"/><a name="366"/>  366: <b>ensure_lttng_started</b>(Name, Config) -&gt;
<a name="367"/>  367:     Out = case proplists:get_value(priv_dir, Config) of
<a name="368"/>  368:               undefined -&gt; [];
<a name="369"/>  369:               Path -&gt; &quot;--output=&quot;++Path++&quot; &quot;
<a name="370"/>  370:           end,
<a name="371"/>  371:     {ok,_} = cmd(&quot;lttng create &quot; ++ Out ++ Name),
<a name="ensure_lttng_started-last_expr"/><a name="372"/>  372:     ok.
<a name="373"/>  373: 
<a name="ensure_lttng_stopped-1"/><a name="374"/>  374: <b>ensure_lttng_stopped</b>(Name) -&gt;
<a name="375"/>  375:     {ok,_} = cmd(&quot;lttng stop&quot;),
<a name="376"/>  376:     {ok,_} = cmd(&quot;lttng destroy &quot; ++ Name),
<a name="ensure_lttng_stopped-last_expr"/><a name="377"/>  377:     ok.
<a name="378"/>  378: 
<a name="cmd-1"/><a name="379"/>  379: <b>cmd</b>(Cmd) -&gt;
<a name="380"/>  380:     io:format(&quot;&lt;&lt; ~ts~n&quot;, [Cmd]),
<a name="381"/>  381:     Res = os:cmd(Cmd),
<a name="382"/>  382:     io:format(&quot;&gt;&gt; ~ts~n&quot;, [Res]),
<a name="cmd-last_expr"/><a name="383"/>  383:     {ok,Res}.
</pre>
<script>
var hash = window.location.hash.substring(1);
var anchor = document.getElementsByName(hash);
anchor[0].style.backgroundColor="orange";
</script>
</body>
</html>
