<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/></meta>
<title>/buildroot/otp/lib/stdlib/make_test_dir/stdlib_test/array_SUITE.erl</title>
</head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
<a name="1"/>    1: <i>%%</i>
<a name="2"/>    2: <i>%% %CopyrightBegin%</i>
<a name="3"/>    3: <i>%% </i>
<a name="4"/>    4: <i>%% Copyright Ericsson AB 2007-2018. All Rights Reserved.</i>
<a name="5"/>    5: <i>%% </i>
<a name="6"/>    6: <i>%% Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</i>
<a name="7"/>    7: <i>%% you may not use this file except in compliance with the License.</i>
<a name="8"/>    8: <i>%% You may obtain a copy of the License at</i>
<a name="9"/>    9: <i>%%</i>
<a name="10"/>   10: <i>%%     http://www.apache.org/licenses/LICENSE-2.0</i>
<a name="11"/>   11: <i>%%</i>
<a name="12"/>   12: <i>%% Unless required by applicable law or agreed to in writing, software</i>
<a name="13"/>   13: <i>%% distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</i>
<a name="14"/>   14: <i>%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</i>
<a name="15"/>   15: <i>%% See the License for the specific language governing permissions and</i>
<a name="16"/>   16: <i>%% limitations under the License.</i>
<a name="17"/>   17: <i>%% </i>
<a name="18"/>   18: <i>%% %CopyrightEnd%</i>
<a name="19"/>   19: <i>%%</i>
<a name="20"/>   20: 
<a name="21"/>   21: <b>-module</b>(array_SUITE).
<a name="22"/>   22: 
<a name="23"/>   23: <b>-include_lib</b>(&quot;common_test/include/ct.hrl&quot;).
<a name="24"/>   24: 
<a name="25"/>   25: <i>%% Test server specific exports</i>
<a name="26"/>   26: <b>-export</b>([all/0, suite/0,groups/0,init_per_suite/1, end_per_suite/1, 
<a name="27"/>   27: 	 init_per_group/2,end_per_group/2]).
<a name="28"/>   28: <b>-export</b>([init_per_testcase/2, end_per_testcase/2]).
<a name="29"/>   29: 
<a name="30"/>   30: <b>-export</b>([
<a name="31"/>   31:   	 new_test/1,
<a name="32"/>   32: 	 fix_test/1,
<a name="33"/>   33: 	 relax_test/1,
<a name="34"/>   34: 	 resize_test/1,
<a name="35"/>   35:   	 set_get_test/1,
<a name="36"/>   36:   	 to_list_test/1,
<a name="37"/>   37:   	 sparse_to_list_test/1,
<a name="38"/>   38:   	 from_list_test/1,
<a name="39"/>   39:   	 to_orddict_test/1,
<a name="40"/>   40:   	 sparse_to_orddict_test/1,
<a name="41"/>   41:   	 from_orddict_test/1,
<a name="42"/>   42:   	 map_test/1,
<a name="43"/>   43:   	 sparse_map_test/1,
<a name="44"/>   44:   	 foldl_test/1,
<a name="45"/>   45:   	 sparse_foldl_test/1,
<a name="46"/>   46:   	 foldr_test/1,
<a name="47"/>   47:   	 sparse_foldr_test/1
<a name="48"/>   48: 	]).
<a name="49"/>   49: 
<a name="50"/>   50: 
<a name="51"/>   51: <b>-export</b>([t/0,t/1,extract_tests/0]).
<a name="52"/>   52: 
<a name="53"/>   53: <b>-import</b>(array, 
<a name="54"/>   54: 	[new/0, new/1, new/2, is_array/1, set/3, get/2, %size/1,
<a name="55"/>   55: 	 sparse_size/1, default/1, reset/2, to_list/1, sparse_to_list/1,
<a name="56"/>   56: 	 from_list/1, from_list/2, to_orddict/1, sparse_to_orddict/1,
<a name="57"/>   57: 	 from_orddict/1, from_orddict/2, map/2, sparse_map/2, foldl/3,
<a name="58"/>   58: 	 foldr/3, sparse_foldl/3, sparse_foldr/3, fix/1, relax/1, is_fix/1,
<a name="59"/>   59: 	 resize/1, resize/2]).
<a name="60"/>   60: 
<a name="61"/>   61: <i>%%</i>
<a name="62"/>   62: <i>%% all/1</i>
<a name="63"/>   63: <i>%%</i>
<a name="suite-0"/><a name="64"/>   64: <b>suite</b>() -&gt;
<a name="suite-last_expr"/><a name="65"/>   65:     [{ct_hooks,[ts_install_cth]},
<a name="66"/>   66:      {timetrap,{minutes,1}}].
<a name="67"/>   67: 
<a name="all-0"/><a name="68"/>   68: <b>all</b>() -&gt; 
<a name="all-last_expr"/><a name="69"/>   69:     [new_test, fix_test, relax_test, resize_test,
<a name="70"/>   70:      set_get_test, to_list_test, sparse_to_list_test,
<a name="71"/>   71:      from_list_test, to_orddict_test, sparse_to_orddict_test,
<a name="72"/>   72:      from_orddict_test, map_test, sparse_map_test,
<a name="73"/>   73:      foldl_test, sparse_foldl_test, foldr_test,
<a name="74"/>   74:      sparse_foldr_test].
<a name="75"/>   75: 
<a name="groups-0"/><a name="76"/>   76: <b>groups</b>() -&gt; 
<a name="groups-last_expr"/><a name="77"/>   77:     [].
<a name="78"/>   78: 
<a name="init_per_suite-1"/><a name="79"/>   79: <b>init_per_suite</b>(Config) -&gt;
<a name="init_per_suite-last_expr"/><a name="80"/>   80:     Config.
<a name="81"/>   81: 
<a name="end_per_suite-1"/><a name="82"/>   82: <b>end_per_suite</b>(_Config) -&gt;
<a name="end_per_suite-last_expr"/><a name="83"/>   83:     ok.
<a name="84"/>   84: 
<a name="init_per_group-2"/><a name="85"/>   85: <b>init_per_group</b>(_GroupName, Config) -&gt;
<a name="init_per_group-last_expr"/><a name="86"/>   86:     Config.
<a name="87"/>   87: 
<a name="end_per_group-2"/><a name="88"/>   88: <b>end_per_group</b>(_GroupName, Config) -&gt;
<a name="end_per_group-last_expr"/><a name="89"/>   89:     Config.
<a name="90"/>   90: 
<a name="91"/>   91: 
<a name="init_per_testcase-2"/><a name="92"/>   92: <b>init_per_testcase</b>(_Case, Config) -&gt;
<a name="init_per_testcase-last_expr"/><a name="93"/>   93:     Config.
<a name="94"/>   94: 
<a name="end_per_testcase-2"/><a name="95"/>   95: <b>end_per_testcase</b>(_Case, _Config) -&gt;
<a name="end_per_testcase-last_expr"/><a name="96"/>   96:     ok.
<a name="97"/>   97: 
<a name="98"/>   98: <b>-define</b>(LEAFSIZE,10).
<a name="99"/>   99: <b>-define</b>(NODESIZE,?LEAFSIZE).
<a name="100"/>  100: 
<a name="101"/>  101: <b>-record</b>(array,  {size,		%% number of defined entries
<a name="102"/>  102: 		 max,		%% maximum number of entries in current tree
<a name="103"/>  103: 		 default,	%% the default value (usually 'undefined')
<a name="104"/>  104: 		 elements	%% the tuple tree
<a name="105"/>  105: 		}).
<a name="106"/>  106: 
<a name="107"/>  107: <b>-define</b>(_assert(What), 
<a name="108"/>  108: 	begin true = What end
<a name="109"/>  109:        ).
<a name="110"/>  110: <b>-define</b>(_assertNot(What), 
<a name="111"/>  111: 	begin false = What end
<a name="112"/>  112:        ).
<a name="113"/>  113: 
<a name="114"/>  114: <b>-define</b>(_assertMatch(Res,What), 
<a name="115"/>  115: 	begin 
<a name="116"/>  116: 	    case What of Res -&gt; ok end
<a name="117"/>  117: 	end
<a name="118"/>  118:        ).
<a name="119"/>  119: <b>-define</b>(_assertError(Reas,What), 
<a name="120"/>  120: 	begin fun() -&gt;
<a name="121"/>  121: 			    try What of
<a name="122"/>  122: 				A_Success -&gt; exit({test_error, A_Success})
<a name="123"/>  123: 			    catch error:Reas -&gt; ok end
<a name="124"/>  124: 		    end()
<a name="125"/>  125: 	end
<a name="126"/>  126:        ).
<a name="127"/>  127: 
<a name="128"/>  128: <b>-define</b>(LET(Var,Expr, Test), begin fun() -&gt; Var = Expr, Test end() end).
<a name="129"/>  129: 
<a name="130"/>  130: <b>-define</b>(_test(Expr), begin Expr end).
<a name="131"/>  131: 
<a name="132"/>  132: <i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
<a name="133"/>  133: <i>%% Some helpers to be able to run the tests without testserver</i>
<a name="134"/>  134: <i>%%%%%%%%%%%%%%%%%%%%%%%%%</i>
<a name="t-0"/><a name="t-last_expr"/><a name="135"/>  135: <b>t</b>() -&gt; t([all]).
<a name="136"/>  136: 
<a name="t-1"/><a name="137"/>  137: <b>t</b>(What) when not is_list(What) -&gt;
<a name="138"/>  138:     t([What]);
<a name="139"/>  139: <b>t</b>(What) -&gt;
<a name="t-last_expr"/><a name="140"/>  140: <b>    lists:foreach</b>(fun(T) -&gt;
<a name="141"/>  141: 			  io:format(&quot;Test ~p ~n&quot;,[T]),
<a name="142"/>  142: 			  try 
<a name="143"/>  143: 			      ?MODULE:T([])
<a name="144"/>  144: 			  catch _E:_R:_S -&gt;
<a name="145"/>  145: 				  Line = get(test_server_loc),
<a name="146"/>  146: 				  io:format(&quot;Failed ~p:~p ~p ~p~n   ~p~n&quot;, 
<a name="147"/>  147: 					    [T,Line,_E,_R,_S])
<a name="148"/>  148: 			  end
<a name="149"/>  149: 		  end, What).
<a name="150"/>  150: 
<a name="151"/>  151: <i>%%%%% extract tests </i>
<a name="152"/>  152: 
<a name="extract_tests-0"/><a name="153"/>  153: <b>extract_tests</b>() -&gt;
<a name="154"/>  154:     {ok, In} = file:open(&quot;../src/array.erl&quot;, [read]),
<a name="155"/>  155:     {ok, Out} = file:open(&quot;array_temp.erl&quot;, [write]),
<a name="156"/>  156:     try 
<a name="157"/>  157: 	Tests = extract_tests(In,Out,[]),
<a name="158"/>  158: 	Call = fun(Test) -&gt;
<a name="159"/>  159: 		       io:format(Out, &quot;~s(Config) when is_list(Config) -&gt; ~s_(), ok.~n&quot;,
<a name="160"/>  160: 				 [Test, Test])
<a name="161"/>  161: 	       end,
<a name="162"/>  162: 	[Call(Test) || Test &lt;- Tests],
<a name="163"/>  163: 	io:format(&quot;Tests ~p~n&quot;, [Tests])
<a name="164"/>  164:     catch _:Err:Stacktrace -&gt;
<a name="165"/>  165: 	    io:format(&quot;Error: ~p ~p~n&quot;, [Err, Stacktrace])
<a name="166"/>  166:     end,
<a name="167"/>  167:     file:close(In),
<a name="extract_tests-last_expr"/><a name="168"/>  168: <b>    file:close</b>(Out).
<a name="169"/>  169: 
<a name="extract_tests-3"/><a name="170"/>  170: <b>extract_tests</b>(In,Out,Tests) -&gt;
<a name="extract_tests-last_expr"/><a name="171"/>  171: <b>    case io:get_line</b>(In,&quot;&quot;) of
<a name="172"/>  172: 	eof -&gt; lists:reverse(Tests);
<a name="173"/>  173: 	&quot;-ifdef(EUNIT)&quot; ++ _ -&gt;
<a name="174"/>  174: 	    Test = write_test(In,Out),
<a name="175"/>  175: 	    extract_tests(In,Out, [Test|Tests]);
<a name="176"/>  176: 	_E -&gt;
<a name="177"/>  177: 	    extract_tests(In,Out,Tests)
<a name="178"/>  178:     end.
<a name="179"/>  179: 
<a name="write_test-2"/><a name="180"/>  180: <b>write_test</b>(In,Out) -&gt;
<a name="181"/>  181:     Line = io:get_line(In,&quot;&quot;),
<a name="182"/>  182:     io:put_chars(Out, Line),
<a name="183"/>  183:     [$_|Test] = lists:dropwhile(fun($_) -&gt; false;(_) -&gt; true end,lists:reverse(Line)),
<a name="184"/>  184:     write_test_1(In,Out),
<a name="write_test-last_expr"/><a name="185"/>  185: <b>    lists:reverse</b>(Test).
<a name="186"/>  186:    
<a name="write_test_1-2"/><a name="187"/>  187: <b>write_test_1</b>(In,Out) -&gt;
<a name="write_test_1-last_expr"/><a name="188"/>  188: <b>    case io:get_line</b>(In,&quot;&quot;) of
<a name="189"/>  189: 	&quot;-endif&quot; ++ _ -&gt;
<a name="190"/>  190: 	    io:nl(Out),
<a name="191"/>  191: 	    ok;
<a name="192"/>  192: 	Line -&gt;
<a name="193"/>  193: 	    io:put_chars(Out, Line),
<a name="194"/>  194: 	    write_test_1(In,Out)
<a name="195"/>  195:     end.	   
<a name="196"/>  196: 
<a name="197"/>  197: <i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
<a name="198"/>  198: <i>%% Actual tests</i>
<a name="199"/>  199: 
<a name="new_test_-0"/><a name="200"/>  200: <b>new_test_</b>() -&gt;
<a name="201"/>  201:     N0 = ?LEAFSIZE,
<a name="202"/>  202:     N01 = N0+1,
<a name="203"/>  203:     N1 = ?NODESIZE*N0,
<a name="204"/>  204:     N11 = N1+1,
<a name="205"/>  205:     N2 = ?NODESIZE*N1,
<a name="new_test_-last_expr"/><a name="206"/>  206: <b>    [?_test</b>(new()),
<a name="207"/>  207: 
<a name="208"/>  208:      ?_test(new([])),
<a name="209"/>  209:      ?_test(new(10)),
<a name="210"/>  210:      ?_test(new({size,10})),
<a name="211"/>  211:      ?_test(new(fixed)),
<a name="212"/>  212:      ?_test(new({fixed,true})),
<a name="213"/>  213:      ?_test(new({fixed,false})),
<a name="214"/>  214:      ?_test(new({default,undefined})),
<a name="215"/>  215:      ?_test(new([{size,100},{fixed,false},{default,undefined}])),
<a name="216"/>  216:      ?_test(new([100,fixed,{default,0}])),
<a name="217"/>  217: 
<a name="218"/>  218:      ?_assert(new() =:= new([])),
<a name="219"/>  219:      ?_assert(new() =:= new([{size,0},{default,undefined},{fixed,false}])),
<a name="220"/>  220:      ?_assert(new() =:= new(0, {fixed,false})),
<a name="221"/>  221:      ?_assert(new(fixed) =:= new(0)),
<a name="222"/>  222:      ?_assert(new(fixed) =:= new(0, [])),
<a name="223"/>  223:      ?_assert(new(10) =:= new([{size,0},{size,5},{size,10}])),
<a name="224"/>  224:      ?_assert(new(10) =:= new(0, {size,10})),
<a name="225"/>  225:      ?_assert(new(10, []) =:= new(10, [{default,undefined},{fixed,true}])),
<a name="226"/>  226: 
<a name="227"/>  227:      ?_assertError(badarg, new(-1)),
<a name="228"/>  228:      ?_assertError(badarg, new(10.0)),
<a name="229"/>  229:      ?_assertError(badarg, new(undefined)),
<a name="230"/>  230:      ?_assertError(badarg, new([undefined])),
<a name="231"/>  231:      ?_assertError(badarg, new([{default,0} | fixed])),
<a name="232"/>  232: 
<a name="233"/>  233:      ?_assertError(badarg, new(-1, [])),
<a name="234"/>  234:      ?_assertError(badarg, new(10.0, [])),
<a name="235"/>  235:      ?_assertError(badarg, new(undefined, [])),
<a name="236"/>  236: 
<a name="237"/>  237:      ?_assertMatch(#array{size=0,max=N0,default=undefined,elements=N0},
<a name="238"/>  238: 		   new()),
<a name="239"/>  239:      ?_assertMatch(#array{size=0,max=0,default=undefined,elements=N0},
<a name="240"/>  240: 		   new(fixed)),
<a name="241"/>  241:      ?_assertMatch(#array{size=N0,max=N0,elements=N0},
<a name="242"/>  242: 		   new(N0, {fixed,false})),
<a name="243"/>  243:      ?_assertMatch(#array{size=N01,max=N1,elements=N1},
<a name="244"/>  244: 		   new(N01, {fixed,false})),
<a name="245"/>  245:      ?_assertMatch(#array{size=N1,max=N1,elements=N1},
<a name="246"/>  246: 		   new(N1, {fixed,false})),
<a name="247"/>  247:      ?_assertMatch(#array{size=N11,max=N2,elements=N2},
<a name="248"/>  248: 		   new(N11, {fixed,false})),
<a name="249"/>  249:      ?_assertMatch(#array{size=N2, max=N2, default=42,elements=N2},
<a name="250"/>  250: 		   new(N2, [{fixed,false},{default,42}])),
<a name="251"/>  251: 
<a name="252"/>  252:      ?_assert(0 =:= array:size(new())),
<a name="253"/>  253:      ?_assert(17 =:= array:size(new(17))),
<a name="254"/>  254:      ?_assert(100 =:= array:size(array:set(99,0,new()))),
<a name="255"/>  255:      ?_assertError(badarg, array:size({bad_data,gives_error})),
<a name="256"/>  256: 
<a name="257"/>  257:      ?_assert(undefined =:= default(new())),
<a name="258"/>  258:      ?_assert(4711 =:= default(new({default,4711}))),
<a name="259"/>  259:      ?_assert(0 =:= default(new(10, {default,0}))),
<a name="260"/>  260:      ?_assertError(badarg, default({bad_data,gives_error})),
<a name="261"/>  261: 
<a name="262"/>  262:      ?_assert(is_array(new())),
<a name="263"/>  263:      ?_assert(false =:= is_array({foobar, 23, 23})),
<a name="264"/>  264:      ?_assert(false =:= is_array(#array{size=bad})),
<a name="265"/>  265:      ?_assert(false =:= is_array(#array{max=bad})),
<a name="266"/>  266:      ?_assert(is_array(new(10))),
<a name="267"/>  267:      ?_assert(is_array(new(10, {fixed,false})))
<a name="268"/>  268:     ].
<a name="269"/>  269: 
<a name="fix_test_-0"/><a name="270"/>  270: <b>fix_test_</b>() -&gt;
<a name="fix_test_-last_expr"/><a name="271"/>  271: <b>    [?_assert</b>(is_array(fix(new()))),
<a name="272"/>  272:      ?_assert(fix(new()) =:= new(fixed)),
<a name="273"/>  273: 
<a name="274"/>  274:      ?_assertNot(is_fix(new())),
<a name="275"/>  275:      ?_assertNot(is_fix(new([]))),
<a name="276"/>  276:      ?_assertNot(is_fix(new({fixed,false}))),
<a name="277"/>  277:      ?_assertNot(is_fix(new(10, {fixed,false}))),
<a name="278"/>  278:      ?_assert(is_fix(new({fixed,true}))),
<a name="279"/>  279:      ?_assert(is_fix(new(fixed))),
<a name="280"/>  280:      ?_assert(is_fix(new(10))),
<a name="281"/>  281:      ?_assert(is_fix(new(10, []))),
<a name="282"/>  282:      ?_assert(is_fix(new(10, {fixed,true}))),
<a name="283"/>  283:      ?_assert(is_fix(fix(new()))),
<a name="284"/>  284:      ?_assert(is_fix(fix(new({fixed,false})))),
<a name="285"/>  285: 
<a name="286"/>  286:      ?_test(set(0, 17, new())),
<a name="287"/>  287:      ?_assertError(badarg, set(0, 17, new(fixed))),
<a name="288"/>  288:      ?_assertError(badarg, set(1, 42, fix(set(0, 17, new())))),
<a name="289"/>  289: 
<a name="290"/>  290:      ?_test(set(9, 17, new(10))),
<a name="291"/>  291:      ?_assertError(badarg, set(10, 17, new(10))),
<a name="292"/>  292:      ?_assertError(badarg, set(10, 17, fix(new(10, {fixed,false}))))
<a name="293"/>  293:     ].
<a name="294"/>  294: 
<a name="relax_test_-0"/><a name="295"/>  295: <b>relax_test_</b>() -&gt;
<a name="relax_test_-last_expr"/><a name="296"/>  296: <b>    [?_assert</b>(is_array(relax(new(fixed)))),
<a name="297"/>  297:      ?_assertNot(is_fix(relax(fix(new())))),
<a name="298"/>  298:      ?_assertNot(is_fix(relax(new(fixed)))),
<a name="299"/>  299: 
<a name="300"/>  300:      ?_assert(new() =:= relax(new(fixed))),
<a name="301"/>  301:      ?_assert(new() =:= relax(new(0))),
<a name="302"/>  302:      ?_assert(new(17, {fixed,false}) =:= relax(new(17))),
<a name="303"/>  303:      ?_assert(new(100, {fixed,false})
<a name="304"/>  304: 	      =:= relax(fix(new(100, {fixed,false}))))
<a name="305"/>  305:     ].
<a name="306"/>  306: 
<a name="resize_test_-0"/><a name="307"/>  307: <b>resize_test_</b>() -&gt;
<a name="resize_test_-last_expr"/><a name="308"/>  308: <b>    [?_assert</b>(resize(0, new()) =:= new()),
<a name="309"/>  309:      ?_assert(resize(99, new(99)) =:= new(99)),
<a name="310"/>  310:      ?_assert(resize(99, relax(new(99))) =:= relax(new(99))),
<a name="311"/>  311:      ?_assert(is_fix(resize(100, new(10)))),
<a name="312"/>  312:      ?_assertNot(is_fix(resize(100, relax(new(10))))),
<a name="313"/>  313: 
<a name="314"/>  314:      ?_assert(array:size(resize(100, new())) =:= 100),
<a name="315"/>  315:      ?_assert(array:size(resize(0, new(100))) =:= 0),
<a name="316"/>  316:      ?_assert(array:size(resize(99, new(10))) =:= 99),
<a name="317"/>  317:      ?_assert(array:size(resize(99, new(1000))) =:= 99),
<a name="318"/>  318: 
<a name="319"/>  319:      ?_assertError(badarg, set(99, 17, new(10))),
<a name="320"/>  320:      ?_test(set(99, 17, resize(100, new(10)))),
<a name="321"/>  321:      ?_assertError(badarg, set(100, 17, resize(100, new(10)))),
<a name="322"/>  322: 
<a name="323"/>  323:      ?_assert(array:size(resize(new())) =:= 0),
<a name="324"/>  324:      ?_assert(array:size(resize(new(8))) =:= 0),
<a name="325"/>  325:      ?_assert(array:size(resize(array:set(7, 0, new()))) =:= 8),
<a name="326"/>  326:      ?_assert(array:size(resize(array:set(7, 0, new(10)))) =:= 8),
<a name="327"/>  327:      ?_assert(array:size(resize(array:set(99, 0, new(10,{fixed,false}))))
<a name="328"/>  328: 	      =:= 100),
<a name="329"/>  329:      ?_assert(array:size(resize(array:set(7, undefined, new()))) =:= 0),
<a name="330"/>  330:      ?_assert(array:size(resize(array:from_list([1,2,3,undefined])))
<a name="331"/>  331: 	      =:= 3),
<a name="332"/>  332:      ?_assert(array:size(
<a name="333"/>  333: 		resize(array:from_orddict([{3,0},{17,0},{99,undefined}])))
<a name="334"/>  334: 	      =:= 18),
<a name="335"/>  335:      ?_assertError(badarg, resize(foo, bad_argument))
<a name="336"/>  336:     ].
<a name="337"/>  337: 
<a name="set_get_test_-0"/><a name="338"/>  338: <b>set_get_test_</b>() -&gt;
<a name="339"/>  339:     N0 = ?LEAFSIZE,
<a name="340"/>  340:     N1 = ?NODESIZE*N0,
<a name="set_get_test_-last_expr"/><a name="341"/>  341: <b>    [?_assert</b>(array:get(0, new()) =:= undefined),
<a name="342"/>  342:      ?_assert(array:get(1, new()) =:= undefined),
<a name="343"/>  343:      ?_assert(array:get(99999, new()) =:= undefined),
<a name="344"/>  344: 
<a name="345"/>  345:      ?_assert(array:get(0, new(1)) =:= undefined),
<a name="346"/>  346:      ?_assert(array:get(0, new(1,{default,0})) =:= 0),
<a name="347"/>  347:      ?_assert(array:get(9, new(10)) =:= undefined),
<a name="348"/>  348: 
<a name="349"/>  349:      ?_assertError(badarg, array:get(0, new(fixed))),
<a name="350"/>  350:      ?_assertError(badarg, array:get(1, new(1))),
<a name="351"/>  351:      ?_assertError(badarg, array:get(-1, new(1))),
<a name="352"/>  352:      ?_assertError(badarg, array:get(10, new(10))),
<a name="353"/>  353:      ?_assertError(badarg, array:set(-1, foo, new(10))),
<a name="354"/>  354:      ?_assertError(badarg, array:set(10, foo, no_array)),
<a name="355"/>  355: 
<a name="356"/>  356:      ?_assert(array:size(set(0, 17, new())) =:= 1),
<a name="357"/>  357:      ?_assert(array:size(set(N1-1, 17, new())) =:= N1),
<a name="358"/>  358:      ?_assert(array:size(set(0, 42, set(0, 17, new()))) =:= 1),
<a name="359"/>  359:      ?_assert(array:size(set(9, 42, set(0, 17, new()))) =:= 10),
<a name="360"/>  360: 
<a name="361"/>  361:      ?_assert(array:get(0, set(0, 17, new())) =:= 17),
<a name="362"/>  362:      ?_assert(array:get(0, set(1, 17, new())) =:= undefined),
<a name="363"/>  363:      ?_assert(array:get(1, set(1, 17, new())) =:= 17),
<a name="364"/>  364: 
<a name="365"/>  365:      ?_assert(array:get(0, fix(set(0, 17, new()))) =:= 17),
<a name="366"/>  366:      ?_assertError(badarg, array:get(1, fix(set(0, 17, new())))),
<a name="367"/>  367: 
<a name="368"/>  368:      ?_assert(array:get(N1-2, set(N1-1, 17, new())) =:= undefined),
<a name="369"/>  369:      ?_assert(array:get(N1-1, set(N1-1, 17, new())) =:= 17),
<a name="370"/>  370:      ?_assertError(badarg, array:get(N1, fix(set(N1-1, 17, new())))),
<a name="371"/>  371: 
<a name="372"/>  372:      ?_assert(array:get(0, set(0, 42, set(0, 17, new()))) =:= 42),
<a name="373"/>  373: 
<a name="374"/>  374:      ?_assertError(badarg, array:get(0, reset(11, new([{size,10}])))),
<a name="375"/>  375:      ?_assertError(badarg, array:get(0, reset(-1, new([{size,10}])))),
<a name="376"/>  376:      ?_assert(array:get(0, reset(0,  new())) =:= undefined),
<a name="377"/>  377:      ?_assert(array:get(0, reset(0,  set(0,  17, new()))) =:= undefined),
<a name="378"/>  378:      ?_assert(array:get(0, reset(9,  set(9,  17, new()))) =:= undefined),
<a name="379"/>  379:      ?_assert(array:get(0, reset(11, set(11, 17, new()))) =:= undefined),
<a name="380"/>  380:      ?_assert(array:get(0, reset(11, set(12, 17, new()))) =:= undefined),
<a name="381"/>  381:      ?_assert(array:get(0, reset(1,  set(12, 17, new()))) =:= undefined),
<a name="382"/>  382:      ?_assert(array:get(0, reset(11, new())) =:= undefined),
<a name="383"/>  383:      ?_assert(array:get(0, reset(0,  set(0,  17, new({default,42})))) =:= 42),
<a name="384"/>  384:      ?_assert(array:get(0, reset(0,  new({default,42}))) =:= 42)
<a name="385"/>  385:     ].
<a name="386"/>  386: 
<a name="to_list_test_-0"/><a name="387"/>  387: <b>to_list_test_</b>() -&gt;
<a name="388"/>  388:     N0 = ?LEAFSIZE,
<a name="to_list_test_-last_expr"/><a name="389"/>  389: <b>    [?_assert</b>([] =:= to_list(new())),
<a name="390"/>  390:      ?_assert([undefined] =:= to_list(new(1))),
<a name="391"/>  391:      ?_assert([undefined,undefined] =:= to_list(new(2))),
<a name="392"/>  392:      ?_assert(lists:duplicate(N0,0) =:= to_list(new(N0,{default,0}))),
<a name="393"/>  393:      ?_assert(lists:duplicate(N0+1,1) =:= to_list(new(N0+1,{default,1}))),
<a name="394"/>  394:      ?_assert(lists:duplicate(N0+2,2) =:= to_list(new(N0+2,{default,2}))),
<a name="395"/>  395:      ?_assert(lists:duplicate(666,6) =:= to_list(new(666,{default,6}))),
<a name="396"/>  396:      ?_assert([1,2,3] =:= to_list(set(2,3,set(1,2,set(0,1,new()))))),
<a name="397"/>  397:      ?_assert([3,2,1] =:= to_list(set(0,3,set(1,2,set(2,1,new()))))),
<a name="398"/>  398:      ?_assert([1|lists:duplicate(N0-2,0)++[1]] =:= 
<a name="399"/>  399: 	      to_list(set(N0-1,1,set(0,1,new({default,0}))))),
<a name="400"/>  400:      ?_assert([1|lists:duplicate(N0-1,0)++[1]] =:= 
<a name="401"/>  401: 	      to_list(set(N0,1,set(0,1,new({default,0}))))),
<a name="402"/>  402:      ?_assert([1|lists:duplicate(N0,0)++[1]] =:= 
<a name="403"/>  403: 	      to_list(set(N0+1,1,set(0,1,new({default,0}))))),
<a name="404"/>  404:      ?_assert([1|lists:duplicate(N0*3,0)++[1]] =:= 
<a name="405"/>  405: 	      to_list(set((N0*3)+1,1,set(0,1,new({default,0}))))),
<a name="406"/>  406:      ?_assertError(badarg, to_list(no_array))
<a name="407"/>  407:     ].
<a name="408"/>  408: 
<a name="sparse_to_list_test_-0"/><a name="409"/>  409: <b>sparse_to_list_test_</b>() -&gt;
<a name="410"/>  410:     N0 = ?LEAFSIZE,
<a name="sparse_to_list_test_-last_expr"/><a name="411"/>  411: <b>    [?_assert</b>([] =:= sparse_to_list(new())),
<a name="412"/>  412:      ?_assert([] =:= sparse_to_list(new(1))),
<a name="413"/>  413:      ?_assert([] =:= sparse_to_list(new(1,{default,0}))),
<a name="414"/>  414:      ?_assert([] =:= sparse_to_list(new(2))),
<a name="415"/>  415:      ?_assert([] =:= sparse_to_list(new(2,{default,0}))),
<a name="416"/>  416:      ?_assert([] =:= sparse_to_list(new(N0,{default,0}))),
<a name="417"/>  417:      ?_assert([] =:= sparse_to_list(new(N0+1,{default,1}))),
<a name="418"/>  418:      ?_assert([] =:= sparse_to_list(new(N0+2,{default,2}))),
<a name="419"/>  419:      ?_assert([] =:= sparse_to_list(new(666,{default,6}))),
<a name="420"/>  420:      ?_assert([1,2,3] =:= sparse_to_list(set(2,3,set(1,2,set(0,1,new()))))),
<a name="421"/>  421:      ?_assert([3,2,1] =:= sparse_to_list(set(0,3,set(1,2,set(2,1,new()))))),
<a name="422"/>  422:      ?_assert([0,1] =:= sparse_to_list(set(N0-1,1,set(0,0,new())))),
<a name="423"/>  423:      ?_assert([0,1] =:= sparse_to_list(set(N0,1,set(0,0,new())))),
<a name="424"/>  424:      ?_assert([0,1] =:= sparse_to_list(set(N0+1,1,set(0,0,new())))),
<a name="425"/>  425:      ?_assert([0,1,2] =:= sparse_to_list(set(N0*10+1,2,set(N0*2+1,1,set(0,0,new()))))),
<a name="426"/>  426:      ?_assertError(badarg, sparse_to_list(no_array))
<a name="427"/>  427:     ].
<a name="428"/>  428: 
<a name="from_list_test_-0"/><a name="429"/>  429: <b>from_list_test_</b>() -&gt;
<a name="430"/>  430:     N0 = ?LEAFSIZE,
<a name="431"/>  431:     N1 = ?NODESIZE*N0,
<a name="432"/>  432:     N2 = ?NODESIZE*N1,
<a name="433"/>  433:     N3 = ?NODESIZE*N2,
<a name="434"/>  434:     N4 = ?NODESIZE*N3,
<a name="from_list_test_-last_expr"/><a name="435"/>  435: <b>    [?_assert</b>(array:size(from_list([])) =:= 0),
<a name="436"/>  436:      ?_assert(array:is_fix(from_list([])) =:= false),
<a name="437"/>  437:      ?_assert(array:size(from_list([undefined])) =:= 1),
<a name="438"/>  438:      ?_assert(array:is_fix(from_list([undefined])) =:= false),
<a name="439"/>  439:      ?_assert(array:size(from_list(lists:seq(1,N1))) =:= N1),
<a name="440"/>  440:      ?_assert(to_list(from_list(lists:seq(1,N0))) =:= lists:seq(1,N0)),
<a name="441"/>  441:      ?_assert(to_list(from_list(lists:seq(1,N0+1))) =:= lists:seq(1,N0+1)),
<a name="442"/>  442:      ?_assert(to_list(from_list(lists:seq(1,N0+2))) =:= lists:seq(1,N0+2)),
<a name="443"/>  443:      ?_assert(to_list(from_list(lists:seq(1,N2))) =:= lists:seq(1,N2)),
<a name="444"/>  444:      ?_assert(to_list(from_list(lists:seq(1,N2+1))) =:= lists:seq(1,N2+1)),
<a name="445"/>  445:      ?_assert(to_list(from_list(lists:seq(0,N3))) =:= lists:seq(0,N3)),
<a name="446"/>  446:      ?_assert(to_list(from_list(lists:seq(0,N4))) =:= lists:seq(0,N4)),
<a name="447"/>  447:      ?_assertError(badarg, from_list([a,b,a,c|d])),
<a name="448"/>  448:      ?_assertError(badarg, from_list(no_array))     
<a name="449"/>  449:     ].
<a name="450"/>  450: 
<a name="to_orddict_test_-0"/><a name="451"/>  451: <b>to_orddict_test_</b>() -&gt;
<a name="452"/>  452:     N0 = ?LEAFSIZE,
<a name="to_orddict_test_-last_expr"/><a name="453"/>  453: <b>    [?_assert</b>([] =:= to_orddict(new())),
<a name="454"/>  454:      ?_assert([{0,undefined}] =:= to_orddict(new(1))),
<a name="455"/>  455:      ?_assert([{0,undefined},{1,undefined}] =:= to_orddict(new(2))),
<a name="456"/>  456:      ?_assert([{N,0}||N&lt;-lists:seq(0,N0-1)]
<a name="457"/>  457: 	      =:= to_orddict(new(N0,{default,0}))),
<a name="458"/>  458:      ?_assert([{N,1}||N&lt;-lists:seq(0,N0)]
<a name="459"/>  459: 	      =:= to_orddict(new(N0+1,{default,1}))),
<a name="460"/>  460:      ?_assert([{N,2}||N&lt;-lists:seq(0,N0+1)]
<a name="461"/>  461: 	      =:= to_orddict(new(N0+2,{default,2}))),
<a name="462"/>  462:      ?_assert([{N,6}||N&lt;-lists:seq(0,665)]
<a name="463"/>  463: 	      =:= to_orddict(new(666,{default,6}))),
<a name="464"/>  464:      ?_assert([{0,1},{1,2},{2,3}] =:=
<a name="465"/>  465: 	      to_orddict(set(2,3,set(1,2,set(0,1,new()))))),
<a name="466"/>  466:      ?_assert([{0,3},{1,2},{2,1}] =:=
<a name="467"/>  467: 	      to_orddict(set(0,3,set(1,2,set(2,1,new()))))),
<a name="468"/>  468:      ?_assert([{0,1}|[{N,0}||N&lt;-lists:seq(1,N0-2)]++[{N0-1,1}]]
<a name="469"/>  469: 	      =:= to_orddict(set(N0-1,1,set(0,1,new({default,0}))))),
<a name="470"/>  470:      ?_assert([{0,1}|[{N,0}||N&lt;-lists:seq(1,N0-1)]++[{N0,1}]]
<a name="471"/>  471: 	      =:= to_orddict(set(N0,1,set(0,1,new({default,0}))))),
<a name="472"/>  472:      ?_assert([{0,1}|[{N,0}||N&lt;-lists:seq(1,N0)]++[{N0+1,1}]]
<a name="473"/>  473: 	      =:= to_orddict(set(N0+1,1,set(0,1,new({default,0}))))),
<a name="474"/>  474:      ?_assert([{0,0} | [{N,undefined}||N&lt;-lists:seq(1,N0*2)]] ++ 
<a name="475"/>  475: 	      [{N0*2+1,1} | [{N,undefined}||N&lt;-lists:seq(N0*2+2,N0*10)]] ++
<a name="476"/>  476: 	      [{N0*10+1,2}] =:= 
<a name="477"/>  477: 	      to_orddict(set(N0*10+1,2,set(N0*2+1,1,set(0,0,new()))))),
<a name="478"/>  478:      ?_assertError(badarg, to_orddict(no_array))     
<a name="479"/>  479:     ].
<a name="480"/>  480: 
<a name="sparse_to_orddict_test_-0"/><a name="481"/>  481: <b>sparse_to_orddict_test_</b>() -&gt;
<a name="482"/>  482:     N0 = ?LEAFSIZE,
<a name="sparse_to_orddict_test_-last_expr"/><a name="483"/>  483: <b>    [?_assert</b>([] =:= sparse_to_orddict(new())),
<a name="484"/>  484:      ?_assert([] =:= sparse_to_orddict(new(1))),
<a name="485"/>  485:      ?_assert([] =:= sparse_to_orddict(new(1,{default,0}))),
<a name="486"/>  486:      ?_assert([] =:= sparse_to_orddict(new(2))),
<a name="487"/>  487:      ?_assert([] =:= sparse_to_orddict(new(2,{default,0}))),
<a name="488"/>  488:      ?_assert([] =:= sparse_to_orddict(new(N0,{default,0}))),
<a name="489"/>  489:      ?_assert([] =:= sparse_to_orddict(new(N0+1,{default,1}))),
<a name="490"/>  490:      ?_assert([] =:= sparse_to_orddict(new(N0+2,{default,2}))),
<a name="491"/>  491:      ?_assert([] =:= sparse_to_orddict(new(666,{default,6}))),
<a name="492"/>  492:      ?_assert([{0,1},{1,2},{2,3}] =:=
<a name="493"/>  493: 	      sparse_to_orddict(set(2,3,set(1,2,set(0,1,new()))))),
<a name="494"/>  494:      ?_assert([{0,3},{1,2},{2,1}] =:=
<a name="495"/>  495: 	      sparse_to_orddict(set(0,3,set(1,2,set(2,1,new()))))),
<a name="496"/>  496:      ?_assert([{0,1},{N0-1,1}] =:=
<a name="497"/>  497: 	      sparse_to_orddict(set(N0-1,1,set(0,1,new({default,0}))))),
<a name="498"/>  498:      ?_assert([{0,1},{N0,1}] =:=
<a name="499"/>  499: 	      sparse_to_orddict(set(N0,1,set(0,1,new({default,0}))))),
<a name="500"/>  500:      ?_assert([{0,1},{N0+1,1}] =:=
<a name="501"/>  501: 	      sparse_to_orddict(set(N0+1,1,set(0,1,new({default,0}))))),
<a name="502"/>  502:      ?_assert([{0,0},{N0*2+1,1},{N0*10+1,2}] =:= 
<a name="503"/>  503: 	      sparse_to_orddict(set(N0*10+1,2,set(N0*2+1,1,set(0,0,new()))))),
<a name="504"/>  504:      ?_assertError(badarg, sparse_to_orddict(no_array))     
<a name="505"/>  505:     ].
<a name="506"/>  506: 
<a name="from_orddict_test_-0"/><a name="507"/>  507: <b>from_orddict_test_</b>() -&gt;
<a name="508"/>  508:     N0 = ?LEAFSIZE,
<a name="509"/>  509:     N1 = ?NODESIZE*N0,
<a name="510"/>  510:     N2 = ?NODESIZE*N1,
<a name="511"/>  511:     N3 = ?NODESIZE*N2,
<a name="512"/>  512:     N4 = ?NODESIZE*N3,
<a name="from_orddict_test_-last_expr"/><a name="513"/>  513: <b>    [?_assert</b>(array:size(from_orddict([])) =:= 0),
<a name="514"/>  514:      ?_assert(array:is_fix(from_orddict([])) =:= false),
<a name="515"/>  515:      ?_assert(array:size(from_orddict([{0,undefined}])) =:= 1),
<a name="516"/>  516:      ?_assert(array:is_fix(from_orddict([{0,undefined}])) =:= false),
<a name="517"/>  517:      ?_assert(array:size(from_orddict([{N0-1,undefined}])) =:= N0),
<a name="518"/>  518:      ?_assert(array:size(from_orddict([{N,0}||N&lt;-lists:seq(0,N1-1)]))
<a name="519"/>  519: 	      =:= N1),
<a name="520"/>  520:      ?_assertError({badarg,_}, from_orddict([foo])),
<a name="521"/>  521:      ?_assertError({badarg,_}, from_orddict([{200,foo},{1,bar}])),
<a name="522"/>  522:      ?_assertError({badarg,_}, from_orddict([{N,0}||N&lt;-lists:seq(0,N0-1)] ++ not_a_list)),
<a name="523"/>  523:      ?_assertError(badarg, from_orddict(no_array)),
<a name="524"/>  524: 
<a name="525"/>  525: 
<a name="526"/>  526:      ?_assert(?LET(L, [{N,0}||N&lt;-lists:seq(0,N0-1)],
<a name="527"/>  527: 		   L =:= to_orddict(from_orddict(L)))),
<a name="528"/>  528:      ?_assert(?LET(L, [{N,0}||N&lt;-lists:seq(0,N0)],
<a name="529"/>  529: 		   L =:= to_orddict(from_orddict(L)))),
<a name="530"/>  530:      ?_assert(?LET(L, [{N,0}||N&lt;-lists:seq(0,N2-1)],
<a name="531"/>  531: 		   L =:= to_orddict(from_orddict(L)))),
<a name="532"/>  532:      ?_assert(?LET(L, [{N,0}||N&lt;-lists:seq(0,N2)],
<a name="533"/>  533: 		   L =:= to_orddict(from_orddict(L)))),
<a name="534"/>  534:      ?_assert(?LET(L, [{N,0}||N&lt;-lists:seq(0,N3-1)],
<a name="535"/>  535: 		   L =:= to_orddict(from_orddict(L)))),
<a name="536"/>  536:      ?_assert(?LET(L, [{N,0}||N&lt;-lists:seq(0,N4-1)],
<a name="537"/>  537: 		   L =:= to_orddict(from_orddict(L)))),
<a name="538"/>  538: 
<a name="539"/>  539:      %% Hole in the begining
<a name="540"/>  540:      ?_assert(?LET(L, [{0,0}],
<a name="541"/>  541: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="542"/>  542:      ?_assert(?LET(L, [{N0,0}],
<a name="543"/>  543: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="544"/>  544:      ?_assert(?LET(L, [{N1,0}],
<a name="545"/>  545: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="546"/>  546:      ?_assert(?LET(L, [{N3,0}],
<a name="547"/>  547: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="548"/>  548:      ?_assert(?LET(L, [{N4,0}],
<a name="549"/>  549: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="550"/>  550:      ?_assert(?LET(L, [{N0-1,0}],
<a name="551"/>  551: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="552"/>  552:      ?_assert(?LET(L, [{N1-1,0}],
<a name="553"/>  553: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="554"/>  554:      ?_assert(?LET(L, [{N3-1,0}],
<a name="555"/>  555: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="556"/>  556:      ?_assert(?LET(L, [{N4-1,0}],
<a name="557"/>  557: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="558"/>  558: 
<a name="559"/>  559:      %% Hole in middle 
<a name="560"/>  560:      
<a name="561"/>  561:      ?_assert(?LET(L, [{0,0},{N0,0}],
<a name="562"/>  562: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="563"/>  563:      ?_assert(?LET(L, [{0,0},{N1,0}],
<a name="564"/>  564: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="565"/>  565:      ?_assert(?LET(L, [{0,0},{N3,0}],
<a name="566"/>  566: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="567"/>  567:      ?_assert(?LET(L, [{0,0},{N4,0}],
<a name="568"/>  568: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="569"/>  569:      ?_assert(?LET(L, [{0,0},{N0-1,0}],
<a name="570"/>  570: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="571"/>  571:      ?_assert(?LET(L, [{0,0},{N1-1,0}],
<a name="572"/>  572: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="573"/>  573:      ?_assert(?LET(L, [{0,0},{N3-1,0}],
<a name="574"/>  574: 		   L =:= sparse_to_orddict(from_orddict(L)))),
<a name="575"/>  575:      ?_assert(?LET(L, [{0,0},{N4-1,0}],
<a name="576"/>  576: 		   L =:= sparse_to_orddict(from_orddict(L))))
<a name="577"/>  577:      
<a name="578"/>  578:     ].
<a name="579"/>  579: 
<a name="map_test_-0"/><a name="580"/>  580: <b>map_test_</b>() -&gt;
<a name="581"/>  581:     N0 = ?LEAFSIZE,
<a name="582"/>  582:     Id = fun (_,X) -&gt; X end,
<a name="583"/>  583:     Plus = fun(N) -&gt; fun (_,X) -&gt; X+N end end,
<a name="584"/>  584:     Default = fun(_K,undefined) -&gt;  no_value;
<a name="585"/>  585: 		 (K,V) -&gt; K+V
<a name="586"/>  586: 	      end,
<a name="map_test_-last_expr"/><a name="587"/>  587: <b>    [?_assertError</b>(badarg, map([], new())),
<a name="588"/>  588:      ?_assertError(badarg, map([], new(10))),
<a name="589"/>  589:      ?_assert(to_list(map(Id, new())) =:= []),
<a name="590"/>  590:      ?_assert(to_list(map(Id, new(1))) =:= [undefined]),
<a name="591"/>  591:      ?_assert(to_list(map(Id, new(5,{default,0}))) =:= [0,0,0,0,0]),
<a name="592"/>  592:      ?_assert(to_list(map(Id, from_list([1,2,3,4]))) =:= [1,2,3,4]),
<a name="593"/>  593:      ?_assert(to_list(map(Plus(1), from_list([0,1,2,3]))) =:= [1,2,3,4]),
<a name="594"/>  594:      ?_assert(to_list(map(Plus(-1), from_list(lists:seq(1,11))))
<a name="595"/>  595: 	      =:= lists:seq(0,10)),
<a name="596"/>  596:      ?_assert(to_list(map(Plus(11), from_list(lists:seq(0,99999))))
<a name="597"/>  597: 	      =:= lists:seq(11,100010)),
<a name="598"/>  598:      ?_assert([{0,0},{N0*2+1,N0*2+1+1},{N0*100+1,N0*100+1+2}] =:= 
<a name="599"/>  599: 	      sparse_to_orddict((map(Default, 
<a name="600"/>  600: 				     set(N0*100+1,2,
<a name="601"/>  601: 					 set(N0*2+1,1,
<a name="602"/>  602: 					     set(0,0,new())))))#array{default = no_value}))
<a name="603"/>  603:     ].
<a name="604"/>  604: 
<a name="sparse_map_test_-0"/><a name="605"/>  605: <b>sparse_map_test_</b>() -&gt;
<a name="606"/>  606:     N0 = ?LEAFSIZE,
<a name="607"/>  607:     Id = fun (_,X) -&gt; X end,
<a name="608"/>  608:     Plus = fun(N) -&gt; fun (_,X) -&gt; X+N end end,
<a name="609"/>  609:     KeyPlus = fun (K,X) -&gt; K+X end,
<a name="sparse_map_test_-last_expr"/><a name="610"/>  610: <b>    [?_assertError</b>(badarg, sparse_map([], new())),
<a name="611"/>  611:      ?_assertError(badarg, sparse_map([], new(10))),
<a name="612"/>  612:      ?_assert(to_list(sparse_map(Id, new())) =:= []),
<a name="613"/>  613:      ?_assert(to_list(sparse_map(Id, new(1))) =:= [undefined]),
<a name="614"/>  614:      ?_assert(to_list(sparse_map(Id, new(5,{default,0}))) =:= [0,0,0,0,0]),
<a name="615"/>  615:      ?_assert(to_list(sparse_map(Id, from_list([1,2,3,4]))) =:= [1,2,3,4]),
<a name="616"/>  616:      ?_assert(to_list(sparse_map(Plus(1), from_list([0,1,2,3])))
<a name="617"/>  617: 	      =:= [1,2,3,4]),
<a name="618"/>  618:      ?_assert(to_list(sparse_map(Plus(-1), from_list(lists:seq(1,11))))
<a name="619"/>  619: 	      =:= lists:seq(0,10)),
<a name="620"/>  620:      ?_assert(to_list(sparse_map(Plus(11), from_list(lists:seq(0,99999))))
<a name="621"/>  621: 	      =:= lists:seq(11,100010)),
<a name="622"/>  622:      ?_assert(to_list(sparse_map(Plus(1), set(1,1,new({default,0}))))
<a name="623"/>  623: 	      =:= [0,2]),
<a name="624"/>  624:      ?_assert(to_list(sparse_map(Plus(1),
<a name="625"/>  625: 				 set(3,4,set(0,1,new({default,0})))))
<a name="626"/>  626: 	      =:= [2,0,0,5]),
<a name="627"/>  627:      ?_assert(to_list(sparse_map(Plus(1),
<a name="628"/>  628: 				 set(9,9,set(1,1,new({default,0})))))
<a name="629"/>  629: 	      =:= [0,2,0,0,0,0,0,0,0,10]),
<a name="630"/>  630:      ?_assert([{0,0},{N0*2+1,N0*2+1+1},{N0*100+1,N0*100+1+2}] =:= 
<a name="631"/>  631: 	      sparse_to_orddict(sparse_map(KeyPlus, 
<a name="632"/>  632: 					   set(N0*100+1,2,
<a name="633"/>  633: 					       set(N0*2+1,1,
<a name="634"/>  634: 						   set(0,0,new()))))))
<a name="635"/>  635: 
<a name="636"/>  636:     ].
<a name="637"/>  637: 
<a name="foldl_test_-0"/><a name="638"/>  638: <b>foldl_test_</b>() -&gt;
<a name="639"/>  639:     N0 = ?LEAFSIZE,
<a name="640"/>  640:     Count = fun (_,_,N) -&gt; N+1 end,
<a name="641"/>  641:     Sum = fun (_,X,N) -&gt; N+X end,
<a name="642"/>  642:     Reverse = fun (_,X,L) -&gt; [X|L] end,
<a name="643"/>  643:     Vals = fun(_K,undefined,{C,L}) -&gt; {C+1,L};
<a name="644"/>  644: 	      (K,X,{C,L}) -&gt; {C,[K+X|L]} 
<a name="645"/>  645: 	   end,
<a name="foldl_test_-last_expr"/><a name="646"/>  646: <b>    [?_assertError</b>(badarg, foldl([], 0, new())),
<a name="647"/>  647:      ?_assertError(badarg, foldl([], 0, new(10))),
<a name="648"/>  648:      ?_assert(foldl(Count, 0, new()) =:= 0),
<a name="649"/>  649:      ?_assert(foldl(Count, 0, new(1)) =:= 1),
<a name="650"/>  650:      ?_assert(foldl(Count, 0, new(10)) =:= 10),
<a name="651"/>  651:      ?_assert(foldl(Count, 0, from_list([1,2,3,4])) =:= 4),
<a name="652"/>  652:      ?_assert(foldl(Count, 10, from_list([0,1,2,3,4,5,6,7,8,9])) =:= 20),
<a name="653"/>  653:      ?_assert(foldl(Count, 1000, from_list(lists:seq(0,999))) =:= 2000),
<a name="654"/>  654:      ?_assert(foldl(Sum, 0, from_list(lists:seq(0,10))) =:= 55),
<a name="655"/>  655:      ?_assert(foldl(Reverse, [], from_list(lists:seq(0,1000)))
<a name="656"/>  656: 	      =:= lists:reverse(lists:seq(0,1000))),
<a name="657"/>  657:      ?_assert({999,[N0*100+1+2,N0*2+1+1,0]} =:= 
<a name="658"/>  658: 	      foldl(Vals, {0,[]}, 
<a name="659"/>  659: 		    set(N0*100+1,2,
<a name="660"/>  660: 			set(N0*2+1,1,
<a name="661"/>  661: 			    set(0,0,new())))))
<a name="662"/>  662:      
<a name="663"/>  663:     ].
<a name="664"/>  664: 
<a name="sparse_foldl_test_-0"/><a name="665"/>  665: <b>sparse_foldl_test_</b>() -&gt;
<a name="666"/>  666:     N0 = ?LEAFSIZE,
<a name="667"/>  667:     Count = fun (_,_,N) -&gt; N+1 end,
<a name="668"/>  668:     Sum = fun (_,X,N) -&gt; N+X end,
<a name="669"/>  669:     Reverse = fun (_,X,L) -&gt; [X|L] end,
<a name="670"/>  670:     Vals = fun(_K,undefined,{C,L}) -&gt; {C+1,L};
<a name="671"/>  671: 	      (K,X,{C,L}) -&gt; {C,[K+X|L]} 
<a name="672"/>  672: 	   end,
<a name="sparse_foldl_test_-last_expr"/><a name="673"/>  673: <b>    [?_assertError</b>(badarg, sparse_foldl([], 0, new())),
<a name="674"/>  674:      ?_assertError(badarg, sparse_foldl([], 0, new(10))),
<a name="675"/>  675:      ?_assert(sparse_foldl(Count, 0, new()) =:= 0),
<a name="676"/>  676:      ?_assert(sparse_foldl(Count, 0, new(1)) =:= 0),
<a name="677"/>  677:      ?_assert(sparse_foldl(Count, 0, new(10,{default,1})) =:= 0),
<a name="678"/>  678:      ?_assert(sparse_foldl(Count, 0, from_list([0,1,2,3,4],0)) =:= 4),
<a name="679"/>  679:      ?_assert(sparse_foldl(Count, 0, from_list([0,1,2,3,4,5,6,7,8,9,0],0))
<a name="680"/>  680: 	      =:= 9),
<a name="681"/>  681:      ?_assert(sparse_foldl(Count, 0, from_list(lists:seq(0,999),0))
<a name="682"/>  682: 	      =:= 999),
<a name="683"/>  683:      ?_assert(sparse_foldl(Sum, 0, from_list(lists:seq(0,10), 5)) =:= 50),
<a name="684"/>  684:      ?_assert(sparse_foldl(Reverse, [], from_list(lists:seq(0,1000), 0))
<a name="685"/>  685: 	      =:= lists:reverse(lists:seq(1,1000))),
<a name="686"/>  686:      ?_assert({0,[N0*100+1+2,N0*2+1+1,0]} =:= 
<a name="687"/>  687: 	      sparse_foldl(Vals, {0,[]}, 
<a name="688"/>  688: 			   set(N0*100+1,2,
<a name="689"/>  689: 			       set(N0*2+1,1,
<a name="690"/>  690: 				   set(0,0,new())))))
<a name="691"/>  691:     ].
<a name="692"/>  692: 
<a name="foldr_test_-0"/><a name="693"/>  693: <b>foldr_test_</b>() -&gt;
<a name="694"/>  694:     N0 = ?LEAFSIZE,
<a name="695"/>  695:     Count = fun (_,_,N) -&gt; N+1 end,
<a name="696"/>  696:     Sum = fun (_,X,N) -&gt; N+X end,
<a name="697"/>  697:     List = fun (_,X,L) -&gt; [X|L] end,
<a name="698"/>  698:     Vals = fun(_K,undefined,{C,L}) -&gt; {C+1,L};
<a name="699"/>  699: 	      (K,X,{C,L}) -&gt; {C,[K+X|L]} 
<a name="700"/>  700: 	   end,
<a name="foldr_test_-last_expr"/><a name="701"/>  701: <b>    [?_assertError</b>(badarg, foldr([], 0, new())),
<a name="702"/>  702:      ?_assertError(badarg, foldr([], 0, new(10))),
<a name="703"/>  703:      ?_assert(foldr(Count, 0, new()) =:= 0),
<a name="704"/>  704:      ?_assert(foldr(Count, 0, new(1)) =:= 1),
<a name="705"/>  705:      ?_assert(foldr(Count, 0, new(10)) =:= 10),
<a name="706"/>  706:      ?_assert(foldr(Count, 0, from_list([1,2,3,4])) =:= 4),
<a name="707"/>  707:      ?_assert(foldr(Count, 10, from_list([0,1,2,3,4,5,6,7,8,9])) =:= 20),
<a name="708"/>  708:      ?_assert(foldr(Count, 1000, from_list(lists:seq(0,999))) =:= 2000),
<a name="709"/>  709:      ?_assert(foldr(Sum, 0, from_list(lists:seq(0,10))) =:= 55),
<a name="710"/>  710:      ?_assert(foldr(List, [], from_list(lists:seq(0,1000)))
<a name="711"/>  711:  	      =:= lists:seq(0,1000)),
<a name="712"/>  712:      ?_assert({999,[0,N0*2+1+1,N0*100+1+2]} =:= 
<a name="713"/>  713: 	      foldr(Vals, {0,[]}, 
<a name="714"/>  714: 		    set(N0*100+1,2,
<a name="715"/>  715: 			set(N0*2+1,1,
<a name="716"/>  716: 			    set(0,0,new())))))
<a name="717"/>  717:      
<a name="718"/>  718:     ].
<a name="719"/>  719: 
<a name="sparse_foldr_test_-0"/><a name="720"/>  720: <b>sparse_foldr_test_</b>() -&gt;
<a name="721"/>  721:     N0 = ?LEAFSIZE,
<a name="722"/>  722:     Count = fun (_,_,N) -&gt; N+1 end,
<a name="723"/>  723:     Sum = fun (_,X,N) -&gt; N+X end,
<a name="724"/>  724:     List = fun (_,X,L) -&gt; [X|L] end,
<a name="725"/>  725:     Vals = fun(_K,undefined,{C,L}) -&gt; {C+1,L};
<a name="726"/>  726: 	      (K,X,{C,L}) -&gt; {C,[K+X|L]} 
<a name="727"/>  727: 	   end,
<a name="sparse_foldr_test_-last_expr"/><a name="728"/>  728: <b>    [?_assertError</b>(badarg, sparse_foldr([], 0, new())),
<a name="729"/>  729:      ?_assertError(badarg, sparse_foldr([], 0, new(10))),
<a name="730"/>  730:      ?_assert(sparse_foldr(Count, 0, new()) =:= 0),
<a name="731"/>  731:      ?_assert(sparse_foldr(Count, 0, new(1)) =:= 0),
<a name="732"/>  732:      ?_assert(sparse_foldr(Count, 0, new(10,{default,1})) =:= 0),
<a name="733"/>  733:      ?_assert(sparse_foldr(Count, 0, from_list([0,1,2,3,4],0)) =:= 4),
<a name="734"/>  734:      ?_assert(sparse_foldr(Count, 0, from_list([0,1,2,3,4,5,6,7,8,9,0],0))
<a name="735"/>  735: 	      =:= 9),
<a name="736"/>  736:      ?_assert(sparse_foldr(Count, 0, from_list(lists:seq(0,999),0))
<a name="737"/>  737: 	      =:= 999),
<a name="738"/>  738:      ?_assert(sparse_foldr(Sum, 0, from_list(lists:seq(0,10),5)) =:= 50),
<a name="739"/>  739:      ?_assert(sparse_foldr(List, [], from_list(lists:seq(0,1000),0))
<a name="740"/>  740:  	      =:= lists:seq(1,1000)),
<a name="741"/>  741: 
<a name="742"/>  742:      ?_assert(sparse_size(new()) =:= 0),
<a name="743"/>  743:      ?_assert(sparse_size(new(8)) =:= 0),
<a name="744"/>  744:      ?_assert(sparse_size(array:set(7, 0, new())) =:= 8),
<a name="745"/>  745:      ?_assert(sparse_size(array:set(7, 0, new(10))) =:= 8),
<a name="746"/>  746:      ?_assert(sparse_size(array:set(99, 0, new(10,{fixed,false})))
<a name="747"/>  747: 	      =:= 100),
<a name="748"/>  748:      ?_assert(sparse_size(array:set(7, undefined, new())) =:= 0),
<a name="749"/>  749:      ?_assert(sparse_size(array:from_list([1,2,3,undefined])) =:= 3),
<a name="750"/>  750:      ?_assert(sparse_size(array:from_orddict([{3,0},{17,0},{99,undefined}]))
<a name="751"/>  751: 			  =:= 18),
<a name="752"/>  752:      ?_assert({0,[0,N0*2+1+1,N0*100+1+2]} =:= 
<a name="753"/>  753: 	      sparse_foldr(Vals, {0,[]}, 
<a name="754"/>  754: 			   set(N0*100+1,2,
<a name="755"/>  755: 			       set(N0*2+1,1,
<a name="756"/>  756: 				   set(0,0,new())))))     
<a name="757"/>  757:     ].
<a name="758"/>  758: 
<a name="new_test-1"/><a name="new_test-last_expr"/><a name="759"/>  759: <b>new_test</b>(Config) when is_list(Config) -&gt; new_test_(), ok.
<a name="fix_test-1"/><a name="fix_test-last_expr"/><a name="760"/>  760: <b>fix_test</b>(Config) when is_list(Config) -&gt; fix_test_(), ok.
<a name="relax_test-1"/><a name="relax_test-last_expr"/><a name="761"/>  761: <b>relax_test</b>(Config) when is_list(Config) -&gt; relax_test_(), ok.
<a name="resize_test-1"/><a name="resize_test-last_expr"/><a name="762"/>  762: <b>resize_test</b>(Config) when is_list(Config) -&gt; resize_test_(), ok.
<a name="set_get_test-1"/><a name="set_get_test-last_expr"/><a name="763"/>  763: <b>set_get_test</b>(Config) when is_list(Config) -&gt; set_get_test_(), ok.
<a name="to_list_test-1"/><a name="to_list_test-last_expr"/><a name="764"/>  764: <b>to_list_test</b>(Config) when is_list(Config) -&gt; to_list_test_(), ok.
<a name="sparse_to_list_test-1"/><a name="sparse_to_list_test-last_expr"/><a name="765"/>  765: <b>sparse_to_list_test</b>(Config) when is_list(Config) -&gt; sparse_to_list_test_(), ok.
<a name="from_list_test-1"/><a name="from_list_test-last_expr"/><a name="766"/>  766: <b>from_list_test</b>(Config) when is_list(Config) -&gt; from_list_test_(), ok.
<a name="to_orddict_test-1"/><a name="to_orddict_test-last_expr"/><a name="767"/>  767: <b>to_orddict_test</b>(Config) when is_list(Config) -&gt; to_orddict_test_(), ok.
<a name="sparse_to_orddict_test-1"/><a name="sparse_to_orddict_test-last_expr"/><a name="768"/>  768: <b>sparse_to_orddict_test</b>(Config) when is_list(Config) -&gt; sparse_to_orddict_test_(), ok.
<a name="from_orddict_test-1"/><a name="from_orddict_test-last_expr"/><a name="769"/>  769: <b>from_orddict_test</b>(Config) when is_list(Config) -&gt; from_orddict_test_(), ok.
<a name="map_test-1"/><a name="map_test-last_expr"/><a name="770"/>  770: <b>map_test</b>(Config) when is_list(Config) -&gt; map_test_(), ok.
<a name="sparse_map_test-1"/><a name="sparse_map_test-last_expr"/><a name="771"/>  771: <b>sparse_map_test</b>(Config) when is_list(Config) -&gt; sparse_map_test_(), ok.
<a name="foldl_test-1"/><a name="foldl_test-last_expr"/><a name="772"/>  772: <b>foldl_test</b>(Config) when is_list(Config) -&gt; foldl_test_(), ok.
<a name="sparse_foldl_test-1"/><a name="sparse_foldl_test-last_expr"/><a name="773"/>  773: <b>sparse_foldl_test</b>(Config) when is_list(Config) -&gt; sparse_foldl_test_(), ok.
<a name="foldr_test-1"/><a name="foldr_test-last_expr"/><a name="774"/>  774: <b>foldr_test</b>(Config) when is_list(Config) -&gt; foldr_test_(), ok.
<a name="sparse_foldr_test-1"/><a name="sparse_foldr_test-last_expr"/><a name="775"/>  775: <b>sparse_foldr_test</b>(Config) when is_list(Config) -&gt; sparse_foldr_test_(), ok.
</pre>
</body>
</html>
