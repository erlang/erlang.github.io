<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/></meta>
<title>/buildroot/otp/lib/debugger/make_test_dir/debugger_test/dbg_ui_SUITE.erl</title>
</head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
<a name="1"/>    1: <i>%%</i>
<a name="2"/>    2: <i>%% %CopyrightBegin%</i>
<a name="3"/>    3: <i>%%</i>
<a name="4"/>    4: <i>%% Copyright Ericsson AB 1998-2021. All Rights Reserved.</i>
<a name="5"/>    5: <i>%%</i>
<a name="6"/>    6: <i>%% Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</i>
<a name="7"/>    7: <i>%% you may not use this file except in compliance with the License.</i>
<a name="8"/>    8: <i>%% You may obtain a copy of the License at</i>
<a name="9"/>    9: <i>%%</i>
<a name="10"/>   10: <i>%%     http://www.apache.org/licenses/LICENSE-2.0</i>
<a name="11"/>   11: <i>%%</i>
<a name="12"/>   12: <i>%% Unless required by applicable law or agreed to in writing, software</i>
<a name="13"/>   13: <i>%% distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</i>
<a name="14"/>   14: <i>%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</i>
<a name="15"/>   15: <i>%% See the License for the specific language governing permissions and</i>
<a name="16"/>   16: <i>%% limitations under the License.</i>
<a name="17"/>   17: <i>%%</i>
<a name="18"/>   18: <i>%% %CopyrightEnd%</i>
<a name="19"/>   19: <i>%%</i>
<a name="20"/>   20: 
<a name="21"/>   21: <i>%%</i>
<a name="22"/>   22: <b>-module</b>(dbg_ui_SUITE).
<a name="23"/>   23: 
<a name="24"/>   24: 
<a name="25"/>   25: <b>-include_lib</b>(&quot;common_test/include/ct.hrl&quot;).
<a name="26"/>   26: 
<a name="27"/>   27: 
<a name="28"/>   28: <i>%% Test server specific exports</i>
<a name="29"/>   29: <b>-export</b>([all/0, suite/0,groups/0,init_per_suite/1, end_per_suite/1, 
<a name="30"/>   30: 	 init_per_group/2,end_per_group/2]).
<a name="31"/>   31: 
<a name="32"/>   32: <i>%% Test cases must be exported.</i>
<a name="33"/>   33: <b>-export </b>([dbg_ui/1]).
<a name="34"/>   34: 
<a name="35"/>   35: <i>%% Manual test suites/cases exports</i>
<a name="36"/>   36: <b>-export</b>([start1/1, interpret1/1, quit1/1,
<a name="37"/>   37: 	 start2/1, interpret2/1, break2/1, options2/1, quit2/1,
<a name="38"/>   38: 	 interpret3/1, all_step3/1,all_next3/1,save3/1,restore3/1,finish3/1,
<a name="39"/>   39: 	 killinit3/1, killone3/1, killall3/1, deleteone3/1, deleteall3/1,
<a name="40"/>   40: 	 viewbreak4/1, delete4/1,
<a name="41"/>   41: 	 attach5/1, normal5/1, exit5/1, options5/1,
<a name="42"/>   42: 	 distsetup6/1, all_step6/1, all_next6/1]).
<a name="43"/>   43: 
<a name="44"/>   44: <b>-export</b>([init_per_testcase/2, end_per_testcase/2]).
<a name="45"/>   45: 
<a name="init_per_testcase-2"/><a name="46"/>   46: <b>init_per_testcase</b>(_Func, Config) -&gt;
<a name="init_per_testcase-last_expr"/><a name="47"/>   47:     Config.
<a name="48"/>   48: 
<a name="end_per_testcase-2"/><a name="49"/>   49: <b>end_per_testcase</b>(_Func, _Config) -&gt;
<a name="end_per_testcase-last_expr"/><a name="50"/>   50:     ok.
<a name="51"/>   51: 
<a name="suite-0"/><a name="52"/>   52: <b>suite</b>() -&gt;
<a name="suite-last_expr"/><a name="53"/>   53:     [{ct_hooks,[ts_install_cth]},
<a name="54"/>   54:      {timetrap,{minutes,1}}].
<a name="55"/>   55: 
<a name="all-0"/><a name="56"/>   56: <b>all</b>() -&gt; 
<a name="all-last_expr"/><a name="57"/>   57:     [dbg_ui, {group, manual_tests}].
<a name="58"/>   58: 
<a name="groups-0"/><a name="59"/>   59: <b>groups</b>() -&gt; 
<a name="groups-last_expr"/><a name="60"/>   60:     [{manual_tests, [],
<a name="61"/>   61:       [start1, interpret1, quit1, start2, interpret2, break2,
<a name="62"/>   62:        options2, interpret3, all_step3, all_next3, save3,
<a name="63"/>   63:        restore3, finish3, killinit3, killone3, killall3,
<a name="64"/>   64:        deleteone3, deleteall3, viewbreak4, delete4, attach5,
<a name="65"/>   65:        normal5, exit5, options5, distsetup6, all_step6,
<a name="66"/>   66:        all_next6]}].
<a name="67"/>   67: 
<a name="init_per_suite-1"/><a name="68"/>   68: <b>init_per_suite</b>(Config) -&gt;
<a name="init_per_suite-last_expr"/><a name="69"/>   69:     Config.
<a name="70"/>   70: 
<a name="end_per_suite-1"/><a name="71"/>   71: <b>end_per_suite</b>(_Config) -&gt;
<a name="end_per_suite-last_expr"/><a name="72"/>   72:     ok.
<a name="73"/>   73: 
<a name="init_per_group-2"/><a name="74"/>   74: <b>init_per_group</b>(_GroupName, Config) -&gt;
<a name="init_per_group-last_expr"/><a name="75"/>   75:     Config.
<a name="76"/>   76: 
<a name="end_per_group-2"/><a name="77"/>   77: <b>end_per_group</b>(_GroupName, Config) -&gt;
<a name="end_per_group-last_expr"/><a name="78"/>   78:     Config.
<a name="79"/>   79: 
<a name="80"/>   80: <i>%% Test Debugger GUI.</i>
<a name="dbg_ui-1"/><a name="81"/>   81: <b>dbg_ui </b>(_Config) -&gt;
<a name="dbg_ui-last_expr"/><a name="82"/>   82: <b>    case os:getenv</b>(&quot;DISPLAY&quot;) of
<a name="83"/>   83: 	false -&gt;
<a name="84"/>   84: 	    {skipped,&quot;No display&quot;};
<a name="85"/>   85: 	Other when is_list(Other) -&gt;
<a name="86"/>   86: 	    %%	    {ok, Pid} = debugger:start (),
<a name="87"/>   87: 	    %%	    ok = is_pid (Pid),
<a name="88"/>   88: 	    %%	    true = erlang:is_process_alive(Pid),
<a name="89"/>   89: 	    %%	    ok = debugger:stop(),
<a name="90"/>   90: 	    %%	    false = erlang:is_process_alive(Pid)
<a name="91"/>   91: 	    {skipped,&quot;Gunilla: Workaround&quot;}
<a name="92"/>   92:     end.
<a name="93"/>   93: 
<a name="94"/>   94: <i>%% check/2 - returns the result for the specified testcase.</i>
<a name="95"/>   95: <i>%% pass - means the user has run the case, and it passed</i>
<a name="96"/>   96: <i>%% fail - means the user has run the case, and it failed</i>
<a name="97"/>   97: <i>%% unknown - means the user has (tried to) run the case, and the result is unclear.</i>
<a name="98"/>   98: <i>%% skip - means the user has not yet run the case.</i>
<a name="99"/>   99: 
<a name="check-2"/><a name="100"/>  100: <b>check</b>(Case, Config) -&gt;
<a name="101"/>  101: 
<a name="102"/>  102:     DataDir = proplists:get_value(data_dir, Config),
<a name="103"/>  103:     ResultFileName =  filename:join([DataDir, &quot;manual_results.erl&quot;]),
<a name="check-last_expr"/><a name="104"/>  104: <b>    case file:consult</b>(ResultFileName) of
<a name="105"/>  105: 	{ok, Results} -&gt;
<a name="106"/>  106: 	    io:format(&quot;Results: ~p~n&quot;,[Results]),
<a name="107"/>  107: 	    case Results of
<a name="108"/>  108: 		[] -&gt;
<a name="109"/>  109: 		    no_result;
<a name="110"/>  110: 		%% Incomplete &quot;sanity&quot; check of file contents.
<a name="111"/>  111: 		[{_Key,_Value}|_Rest] -&gt;
<a name="112"/>  112: 		    case lists:keysearch(Case, 1, Results) of
<a name="113"/>  113: 			{value, {Case, Value}} -&gt;
<a name="114"/>  114: 			    Value;		% pass, fail, unknown
<a name="115"/>  115: 			false -&gt;
<a name="116"/>  116: 			    no_result;				% skip
<a name="117"/>  117: 			_Otherwise -&gt;
<a name="118"/>  118: 			    {error, &quot;Contents of results file not valid&quot;}
<a name="119"/>  119: 		    end;
<a name="120"/>  120: 		_Otherwise2 -&gt;
<a name="121"/>  121: 		    {error, &quot;Contents of results file not valid&quot;}
<a name="122"/>  122: 	    end;
<a name="123"/>  123: 	_Otherwise3 -&gt;
<a name="124"/>  124: 	    {error, &quot;Problems reading results file&quot;}
<a name="125"/>  125:     end.
<a name="126"/>  126: 
<a name="127"/>  127: 
<a name="128"/>  128: 
<a name="129"/>  129: 
<a name="130"/>  130: 
<a name="131"/>  131: 
<a name="132"/>  132: <b>-define</b>(MAN_CASE(Name,Doc, Description),
<a name="133"/>  133: 	Name(Config) -&gt;
<a name="134"/>  134: 	       io:format(&quot;Checking ~p~n&quot;,[Name]),
<a name="135"/>  135: 	       io:format(&quot;Config = ~p~n&quot;,[Config]),
<a name="136"/>  136: 	       case check(Name, Config) of
<a name="137"/>  137: 		   pass -&gt;
<a name="138"/>  138: 		       ok;
<a name="139"/>  139: 		   fail -&gt;
<a name="140"/>  140: 		       ct:fail(&quot;Manual test failed&quot;);
<a name="141"/>  141: 		   unknown -&gt;
<a name="142"/>  142: 		       {skipped, &quot;Manual test result unknown&quot;};
<a name="143"/>  143: 
<a name="144"/>  144: 		   no_result -&gt;
<a name="145"/>  145: 		       {skipped, Description};
<a name="146"/>  146: 
<a name="147"/>  147: 		   {error, _Reason} -&gt;
<a name="148"/>  148: 		       %%		       Text = lists:flatten(
<a name="149"/>  149: 		       %%				io_lib:format(&quot;[File problem: ~s]~s&quot;,
<a name="150"/>  150: 		       %%		       [Reason,Description])),
<a name="151"/>  151: 		       {skipped, Description}
<a name="152"/>  152: 	       end
<a name="153"/>  153: 		   ).
<a name="154"/>  154: 
<a name="155"/>  155: 
<a name="156"/>  156: <i>%% SET 1</i>
<a name="start1-1"/><a name="start1-last_expr"/><a name="157"/>  157: <b>?MAN_CASE</b>(start1, &quot;Start the debugger from the toolbar&quot;,
<a name="158"/>  158: 	  &quot;Before proceeding with the test cases, please move or remove
<a name="159"/>  159: the directory .erlang_tools/debugger in your home directory. Next,
<a name="160"/>  160: please start the debugger from the toolbar&quot;).
<a name="161"/>  161: 
<a name="interpret1-1"/><a name="interpret1-last_expr"/><a name="162"/>  162: <b>?MAN_CASE</b>(interpret1, &quot;Interpreting modules&quot;,
<a name="163"/>  163: 	  &quot;In this test case and all of the ones following, the source code
<a name="164"/>  164: files to use can be found in the test data directory for this debugger test
<a name="165"/>  165: 	  suite (probably in
<a name="166"/>  166: 		 /clearcase/otp/tools/debugger/test/dbg_ui_SUITE_data/manual_data/src ).
<a name="167"/>  167: Interpret one module&quot;).
<a name="168"/>  168: 
<a name="quit1-1"/><a name="quit1-last_expr"/><a name="169"/>  169: <b>?MAN_CASE</b>(quit1, &quot;Quit the debugger&quot;,
<a name="170"/>  170: 	  &quot;Quit the debugger using File-&gt;Exit in the main window&quot;).
<a name="171"/>  171: 
<a name="172"/>  172: 
<a name="173"/>  173: <i>%% SET 2</i>
<a name="start2-1"/><a name="start2-last_expr"/><a name="174"/>  174: <b>?MAN_CASE</b>(start2, &quot;Start the debugger from the shell&quot;,
<a name="175"/>  175: 	  &quot;Start the debugger from the shell. Use debugger:start()&quot;).
<a name="176"/>  176: 
<a name="interpret2-1"/><a name="interpret2-last_expr"/><a name="177"/>  177: <b>?MAN_CASE</b>(interpret2, &quot;Interpret all modules&quot;,
<a name="178"/>  178: 	  &quot;Interpret all modules&quot;).
<a name="179"/>  179: 
<a name="break2-1"/><a name="break2-last_expr"/><a name="180"/>  180: <b>?MAN_CASE</b>(break2, &quot;Set break points&quot;,
<a name="181"/>  181: 	  &quot;Set break points&quot;).
<a name="182"/>  182: 
<a name="options2-1"/><a name="options2-last_expr"/><a name="183"/>  183: <b>?MAN_CASE</b>(options2, &quot;Set options to attach on break&quot;,
<a name="184"/>  184: 	  &quot;Set options to attach on break&quot;).
<a name="185"/>  185: 
<a name="quit2-1"/><a name="quit2-last_expr"/><a name="186"/>  186: <b>?MAN_CASE</b>(quit2, &quot;Quit the debugger&quot;,
<a name="187"/>  187: 	  &quot;Quit the debugger using the close box in the main window title frame&quot;).
<a name="188"/>  188: 
<a name="189"/>  189: 
<a name="190"/>  190: <i>%% SET3</i>
<a name="interpret3-1"/><a name="interpret3-last_expr"/><a name="191"/>  191: <b>?MAN_CASE</b>(interpret3, &quot;Test attach options&quot;,
<a name="192"/>  192: 	  &quot;Start the debugger and interpret the modules [test, lists1, ordsets1]. Close the Interpret dialog. Set Attach on First Call and Attach on Break.&quot;).
<a name="193"/>  193: 
<a name="all_step3-1"/><a name="all_step3-last_expr"/><a name="194"/>  194: <b>?MAN_CASE</b>(all_step3, &quot;Click Step through all evaluation&quot;,
<a name="195"/>  195: 	  &quot;In the shell, call test:test1(). Use the Step button, the Process-&gt;Step menu item and the ctrl-s shortcut to step through the *entire* execution of the call. (Approx 36 steps). Then close the Attach window. The result printed in the shell should be: {\&quot;peter\&quot;,[1,2,4,a,b,c],\&quot;olin\&quot;}&quot;).
<a name="196"/>  196: 
<a name="all_next3-1"/><a name="all_next3-last_expr"/><a name="197"/>  197: <b>?MAN_CASE</b>(all_next3,&quot;Click Next through all evaluation&quot;,
<a name="198"/>  198: 	  &quot;Again call test:test1() in the shell. This time Use the Next button,  the Process-&gt;Next menu and the ctrl-n shortcut to quickly step over the execution of the four lines in the test1-function. The result printed in the shell should be: {\&quot;peter\&quot;,[1,2,4,a,b,c],\&quot;olin\&quot;}&quot;).
<a name="199"/>  199: 
<a name="save3-1"/><a name="save3-last_expr"/><a name="200"/>  200: <b>?MAN_CASE</b>(save3, &quot;Save the debugger state&quot;,
<a name="201"/>  201: 	  &quot;Use File-&gt;Save Settings to save the debugger state with the name 'three.state'&quot;).
<a name="202"/>  202: 
<a name="restore3-1"/><a name="restore3-last_expr"/><a name="203"/>  203: <b>?MAN_CASE</b>(restore3,&quot;Quit the debugger, restart and restore the state&quot;,
<a name="204"/>  204: 	  &quot;Quit the debugger. Start it again. Use File-&gt;Load Settings to restore the state saved in 'three.state'. Check that the Attach-options are the same as what you set them to in the interpret3 test case. Check that the three modules [test,lists1,ordsets1] are interpreted.&quot;).
<a name="205"/>  205: 
<a name="206"/>  206: 
<a name="finish3-1"/><a name="finish3-last_expr"/><a name="207"/>  207: <b>?MAN_CASE</b>(finish3, &quot;Finish the current function body&quot;,
<a name="208"/>  208: 	  &quot;Call the function test:test1() from the shell. Press Finish to evaluate the remaining lines in the function. The result printed in the shell should be: {\&quot;peter\&quot;,[1,2,4,a,b,c],\&quot;olin\&quot;}&quot;).
<a name="209"/>  209: 
<a name="killinit3-1"/><a name="killinit3-last_expr"/><a name="210"/>  210: <b>?MAN_CASE</b>(killinit3,&quot;Set up for killing and clearing processes&quot;,
<a name="211"/>  211: 	  &quot;Call test:test2() from the shell. Set a break point at the last line of test:test2. Click Continue. This should open three new attach windows. One for each spawn called in test:test2/0.   &quot;).
<a name="212"/>  212: 
<a name="killone3-1"/><a name="killone3-last_expr"/><a name="213"/>  213: <b>?MAN_CASE</b>(killone3, &quot;Kill a process and clear it&quot;,
<a name="214"/>  214: 	  &quot;In one of the newly opened Attach windows: select Process-&gt;Kill. A message should appear above the Code Area in the Attach window. Use Windows-&gt;Monitor to verify that the Monitor window also shows that the process has been killed. In the Monitor window: select Edit-&gt;Clear. This should do two things: 1) close/remove the window of the killed process. 2) Remove the entry of the killed process from the monitor window.&quot;).
<a name="215"/>  215: 
<a name="killall3-1"/><a name="killall3-last_expr"/><a name="216"/>  216: <b>?MAN_CASE</b>(killall3,&quot;KIll all processes, and clear them&quot;,
<a name="217"/>  217: 	  &quot;In the Monitor window: Select Edit-&gt;Kill All. Verify that all processes have been killed (in their respective windows and in the monitor window). Windows will be raised as their processes die. Next select, Edit-&gt;Clear. All attach windows should now be closed. Their entris should also disappear from the monitor window. The shell should have reported: ** exited: killed **&quot;).
<a name="218"/>  218: 
<a name="deleteone3-1"/><a name="deleteone3-last_expr"/><a name="219"/>  219: <b>?MAN_CASE</b>(deleteone3,&quot;Delete/uniterpret one module&quot;,
<a name="220"/>  220: 	  &quot;In the Monitor window: Select Module-&gt;test-&gt;Delete. This should remove the breakpoints set in the test module, and the test module should disappear from the Module menu.&quot;).
<a name="221"/>  221: 
<a name="deleteall3-1"/><a name="deleteall3-last_expr"/><a name="222"/>  222: <b>?MAN_CASE</b>(deleteall3,&quot;Delete/uniterpret all modules&quot;,
<a name="223"/>  223: 	  &quot;In the Monitor window: Select Module-&gt;Delete All Modules. This should remove all modules from the Module menu. &quot;).
<a name="224"/>  224: 
<a name="225"/>  225: <i>%% SET 4</i>
<a name="226"/>  226: 
<a name="227"/>  227: 
<a name="228"/>  228: 
<a name="viewbreak4-1"/><a name="viewbreak4-last_expr"/><a name="229"/>  229: <b>?MAN_CASE</b>(viewbreak4, &quot;Test the View window&quot;,
<a name="230"/>  230: 	  &quot;Restore the settings from the three.state file again. In the Monitor window: Use Module-&gt;test-&gt;View to view the source code of the test module. In the View window, select Break-&gt;Line Break and set a break at line 53. Check that it appears in the View window and in the Monitor Window Break-menu. Also in the View window, select Break-&gt;Function Break and set a break at function test:test4. Check that the break (at line 59) appears in the View Window and in the Monitor Window Break-menu.&quot;).
<a name="231"/>  231: 
<a name="delete4-1"/><a name="delete4-last_expr"/><a name="232"/>  232: <b>?MAN_CASE</b>(delete4, &quot;Remove breaks&quot;,
<a name="233"/>  233: 	  &quot;Use the Break-&gt;Delete All function in the View window to remove all breaks in the test module. Check that they are all removed. Close the View window.&quot;).
<a name="234"/>  234: 
<a name="235"/>  235: <i>%% SET 5</i>
<a name="236"/>  236: 
<a name="attach5-1"/><a name="attach5-last_expr"/><a name="237"/>  237: <b>?MAN_CASE</b>(attach5,&quot;Set attach options&quot;,
<a name="238"/>  238: 	  &quot;Set the attach options to only attach on exit&quot;).
<a name="239"/>  239: 
<a name="normal5-1"/><a name="normal5-last_expr"/><a name="240"/>  240: <b>?MAN_CASE</b>(normal5, &quot;Test normal exit&quot;,
<a name="241"/>  241: 	  &quot;Call test:test12(normal) in the shell. This should return the atom 'done', and no windows should be opened.&quot;).
<a name="242"/>  242: 
<a name="exit5-1"/><a name="exit5-last_expr"/><a name="243"/>  243: <b>?MAN_CASE</b>(exit5, &quot;Test abnormal exit&quot;,
<a name="244"/>  244: 	  &quot;Call test:test12(crash) in the shell. This should give the error message ** exited: crash **, and an attach window should be opened highlighting the last line in the test12-function.&quot;).
<a name="245"/>  245: 
<a name="options5-1"/><a name="options5-last_expr"/><a name="246"/>  246: <b>?MAN_CASE</b>(options5, &quot;Experiment with the frames in the attach window&quot;,
<a name="247"/>  247: 	  &quot;Try all possible configurations of the [Button, Evaluator, Bindings, Trace] Frames in the attach window and see that the expected frames are shown/hidden.&quot;).
<a name="248"/>  248: 
<a name="249"/>  249: 
<a name="250"/>  250: <i>%% SET 6 (Distribution)</i>
<a name="251"/>  251: 
<a name="distsetup6-1"/><a name="distsetup6-last_expr"/><a name="252"/>  252: <b>?MAN_CASE</b>(distsetup6,&quot;Set up distribution&quot;,
<a name="253"/>  253: 	  &quot;Start two erlang systems [foo,bar] (with option -sname), make them aware of each other using net_adm:ping/1. Start the debugger on foo. Interpret the modules [test, lists1, ordsets1]. Set attach on First call.  &quot;).
<a name="254"/>  254: 
<a name="255"/>  255: 
<a name="256"/>  256: 
<a name="257"/>  257: 
<a name="all_step6-1"/><a name="all_step6-last_expr"/><a name="258"/>  258: <b>?MAN_CASE</b>(all_step6, &quot;Click Step through all evaluation&quot;,
<a name="259"/>  259: 	  &quot;In the bar shell, call test:test1().This should open an attach window. Use the Step button, the Process-&gt;Step menu item and the ctrl-s shortcut to step through the *entire* execution of the call. (Approx 36 steps). Then close the Attach window. The result printed in the bar shell should be: {\&quot;peter\&quot;,[1,2,4,a,b,c],\&quot;olin\&quot;}&quot;).
<a name="260"/>  260: 
<a name="all_next6-1"/><a name="all_next6-last_expr"/><a name="261"/>  261: <b>?MAN_CASE</b>(all_next6,&quot;Click Next through all evaluation&quot;,
<a name="262"/>  262: 	  &quot;Again, in the bar shell, call test:test1(). This time Use the Next button,  the Process-&gt;Next menu and the ctrl-n shortcut to quickly step over the execution of the four lines in the test1-function. The result printed in the shell should be: {\&quot;peter\&quot;,[1,2,4,a,b,c],\&quot;olin\&quot;}&quot;).
</pre>
<script>
var hash = window.location.hash.substring(1);
var anchor = document.getElementsByName(hash);
anchor[0].style.backgroundColor="orange";
</script>
</body>
</html>
