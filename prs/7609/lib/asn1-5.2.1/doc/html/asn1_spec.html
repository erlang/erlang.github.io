<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:erl="http://erlang.org" xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<link rel="stylesheet" href="../../../../doc/otp_doc.css" type="text/css">
<title>Erlang -- Specialized Decodes</title>
</head>
<body>
<div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../../../../doc/js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../../../../doc/js/erlresolvelinks.js"></script><script id="js3" type="text/javascript" src="../../../../doc/js/topbar.js"></script><script language="JavaScript" type="text/javascript">
            <!--
              function setscrollpos() {
                var objf = document.getElementById('loadscrollpos');
                if (objf) {
                  document.getElementById("leftnav").firstChild.scrollTop = objf.offsetTop - 10;
                }
              }

              function addEvent(obj, evType, fn){
                if (obj.addEventListener){
                obj.addEventListener(evType, fn, true);
                return true;
              } else if (obj.attachEvent){
                var r = obj.attachEvent("on"+evType, fn);
                return r;
              } else {
                return false;
              }
             }

             addEvent(window, 'load', setscrollpos);

             //-->
</script><div class="topbar">
<div class="topbar-expand "><button onclick="toggleDisplay();"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="Capa_1" viewBox="0 0 54 54" width="24" height="24"><g><path style="fill:#000000;" d="M27,54c-0.552,0-1-0.448-1-1V8c0-0.552,0.448-1,1-1s1,0.448,1,1v45C28,53.552,27.552,54,27,54z"></path><path style="fill:#000000;" d="M11,25c-0.256,0-0.512-0.098-0.707-0.293c-0.391-0.391-0.391-1.023,0-1.414l16-16                                      c0.391-0.391,1.023-0.391,1.414,0s0.391,1.023,0,1.414l-16,16C11.512,24.902,11.256,25,11,25z"></path><path style="fill:#000000;" d="M43,25c-0.256,0-0.512-0.098-0.707-0.293l-16-16c-0.391-0.391-0.391-1.023,0-1.414                                      s1.023-0.391,1.414,0l16,16c0.391,0.391,0.391,1.023,0,1.414C43.512,24.902,43.256,25,43,25z"></path><path style="fill:#000000;" d="M43,2H11c-0.552,0-1-0.448-1-1s0.448-1,1-1h32c0.552,0,1,0.448,1,1S43.552,2,43,2z"></path></g></svg></button></div>
<div class="topbar-title"><h1 id="Specialized Decodes">4 
                Specialized Decodes</h1></div>
<div class="search-expand "></div>
</div>
<aside class="hide-mobile" id="leftnav"><nav class="leftnav-tube"><div class="erlang-logo-wrapper"><a href="../../../../doc/index.html"><img alt="Erlang Logo" src="../../../../doc/erlang-logo.png" class="erlang-logo"></a></div>
<p class="section-title">ASN.1</p>
<p class="section-subtitle">User's Guide</p>
<p class="section-version">Version 5.2.1</p>
<ul class="panel-sections">
<li><a href="users_guide.html">User's Guide</a></li>
<li><a href="index.html">Reference Manual</a></li>
<li><a href="notes.html">Release Notes</a></li>
<li><a href="../pdf/asn1-5.2.1.pdf">PDF</a></li>
<li><a href="../../../../doc/index.html">Top</a></li>
</ul>
<ul class="expand-collapse-items">
<li><a href="javascript:openAllFlips()">Expand All</a></li>
<li><a href="javascript:closeAllFlips()">Contract All</a></li>
</ul>
<h3 id="chapters">Chapters</h3>
<ul class="flipMenu" imagepath="../../../../doc/js/flipmenu">
<li id="no" title="Introduction" expanded="false">Introduction<ul>
<li><a href="asn1_introduction.html">
              Top of chapter
            </a></li>
<li title="Scope"><a href="asn1_introduction.html#scope">Scope</a></li>
<li title="Prerequisites"><a href="asn1_introduction.html#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li id="no" title="ASN.1" expanded="false">ASN.1<ul>
<li><a href="asn1_overview.html">
              Top of chapter
            </a></li>
<li title="Introduction"><a href="asn1_overview.html#introduction">Introduction</a></li>
</ul>
</li>
<li id="no" title="Getting Started" expanded="false">Getting Started<ul>
<li><a href="asn1_getting_started.html">
              Top of chapter
            </a></li>
<li title="Example"><a href="asn1_getting_started.html#example">Example</a></li>
<li title="ASN.1 Application User Interface"><a href="asn1_getting_started.html#asn.1-application-user-interface">ASN.1 Application User Interface</a></li>
<li title="Multi-File Compilation"><a href="asn1_getting_started.html#multi-file-compilation">Multi-File Compilation</a></li>
<li title="Remark about Tags"><a href="asn1_getting_started.html#remark-about-tags">Remark about Tags</a></li>
<li title="ASN.1 Types"><a href="asn1_getting_started.html#asn.1-types">ASN.1 Types</a></li>
<li title="Naming of Records in .hrl Files"><a href="asn1_getting_started.html#naming-of-records-in-.hrl-files">Naming of Records in .hrl Files</a></li>
<li title="ASN.1 Values"><a href="asn1_getting_started.html#asn.1-values">ASN.1 Values</a></li>
<li title="Macros"><a href="asn1_getting_started.html#macros">Macros</a></li>
<li title="ASN.1 Information Objects (X.681)"><a href="asn1_getting_started.html#asn.1-information-objects--x.681-">ASN.1 Information Objects (X.681)</a></li>
<li title="Parameterization (X.683)"><a href="asn1_getting_started.html#parameterization--x.683-">Parameterization (X.683)</a></li>
</ul>
</li>
<li id="loadscrollpos" title="Specialized Decodes" expanded="true">Specialized Decodes<ul>
<li><a href="asn1_spec.html">
              Top of chapter
            </a></li>
<li title="Exclusive Decode"><a href="asn1_spec.html#exclusive-decode">Exclusive Decode</a></li>
<li title="Selective Decode"><a href="asn1_spec.html#selective-decode">Selective Decode</a></li>
</ul>
</li>
</ul></nav></aside><div id="content">
<div class="innertube">
<h1 id="Specialized Decodes">4 Specialized Decodes</h1>
  
  <a name="SpecializedDecodes"></a>
  <p>When performance is of highest priority and one is interested in
  a limited part of the ASN.1 encoded message before deciding what to
  do with the rest of it, an option is to decode only a part of the
  message. This situation can be a server that has to decide the
  addressee of a message. The addressee can be interested in the
  entire message, but the server can be a bottleneck that you want to
  spare any unnecessary load.</p>
  <p>Instead of making two <strong>complete decodes</strong> (the normal case of
    decode), one in the server and one in the addressee, it is only
    necessary to make one <strong>specialized decode</strong> (in the server)
    and another complete decode (in the addressee). This section
    describes the following specialized decode functionality:</p>
    <ul>
      <li><strong>Exclusive decode</strong></li>
      <li><strong>Selected decode</strong></li>
    </ul>
  <p>This functionality is only provided when using <span class="code">BER</span>
  (option <span class="code">ber</span>).</p>

  <h3 id="exclusive-decode" class="title-link" onMouseOver="document.getElementById('ghlink-exclusive-decode-idm911').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-exclusive-decode-idm911').style.visibility = 'hidden';">
<div class="title-name">4.1 
        Exclusive Decode</div>
<div class="title-anchors"><span id="ghlink-exclusive-decode-idm911" class="ghlink-after"><a href="#exclusive-decode" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/asn1/doc/src/asn1_spec.xmlsrc#L52" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>The basic idea with exclusive decode is to specify which parts
    of the message you want to exclude from being decoded. These parts
    remain encoded and are returned in the value structure as
    binaries. The undecoded parts can be decoded later by calling the
    <span class="code">decode_part/2</span> function.</p>

    <h4 id="procedure" class="title-link" onMouseOver="document.getElementById('ghlink-procedure-idm915').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-procedure-idm915').style.visibility = 'hidden';">
<div class="title-name">Procedure</div>
<div class="title-anchors"><span id="ghlink-procedure-idm915" class="ghlink-after"><a href="#procedure" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/asn1/doc/src/asn1_spec.xmlsrc#L60" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>To perform an exclusive decode:
        </p>
      <ul>
        <li>
<strong>Step 1:</strong> Decide the name of the function for the
	 exclusive decode.</li>
        <li>
<p><strong>Step 2:</strong> Include the following instructions in
	 a configuration file:</p>
	 <ul>
	   <li>The name of the exclusive decode function</li>
	   <li>The name of the ASN.1 specification</li>
	   <li>A notation that tells which parts of the message
	   structure to be excluded from decode</li>
	   </ul>
</li>
        <li>
<strong>Step 3</strong> Compile with the additional option
         <span class="code">asn1config</span>. The compiler searches for a configuration
         file with the same name as the ASN.1 specification but with
         extension <span class="code">.asn1config</span>. This configuration file is not
	 the same as used for compilation of a set of files. See Section
	 <span class="bold_code bc-17"><a href="#UndecodedPart">Writing an Exclusive Decode
	 Instruction.</a></span>
</li>
      </ul>
    

    <h4 id="user-interface" class="title-link" onMouseOver="document.getElementById('ghlink-user-interface-idm933').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-user-interface-idm933').style.visibility = 'hidden';">
<div class="title-name">User Interface</div>
<div class="title-anchors"><span id="ghlink-user-interface-idm933" class="ghlink-after"><a href="#user-interface" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/asn1/doc/src/asn1_spec.xmlsrc#L85" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>The runtime user interface for exclusive decode consists of
        the following two functions:</p>
	<ul>
	  <li>A function for an exclusive decode, whose name the user
	  decides in the configuration file</li>
	  <li>The compiler generates a <span class="code">decode_part/2</span>
          function when exclusive decode is chosen. This function decodes
          the parts that were left undecoded during the exclusive
          decode.</li>
	</ul>
      <p>Both functions are described in the following.</p>
      <p>If the exclusive decode function has, for example, the name
        <span class="code">decode_exclusive</span> and an ASN.1 encoded message
        <span class="code">Bin</span> is to be exclusive decoded, the call is as follows:</p>
      <div class="example"><pre>
{ok,ExclMessage} = 'MyModule':decode_exclusive(Bin)</pre></div>
      <a name="UndecodedPart"></a>
      <p>The result <span class="code">ExclMessage</span> has the same structure as a
        complete decode would have, except for the parts of the top type
        that were not decoded. The undecoded parts are on their places
        in the structure on format <span class="code">{TypeKey,UndecodedValue}</span>.
        </p>
      <p>Each undecoded part that is to be decoded must be fed into
        function <span class="code">decode_part/2</span> as follows:</p>
      <div class="example"><pre>
{ok,PartMessage} = 'MyModule':decode_part(TypeKey, UndecodedValue)</pre></div>
    

    <a name="Exclusive%20Instruction"></a><h4 id="writing-an-exclusive-decode-instruction" class="title-link" onMouseOver="document.getElementById('ghlink-writing-an-exclusive-decode-instruction-idm952').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-writing-an-exclusive-decode-instruction-idm952').style.visibility = 'hidden';">
<div class="title-name">Writing an Exclusive Decode Instruction</div>
<div class="title-anchors"><span id="ghlink-writing-an-exclusive-decode-instruction-idm952" class="ghlink-after"><a href="#writing-an-exclusive-decode-instruction" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/asn1/doc/src/asn1_spec.xmlsrc#L115" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      
      <p>This instruction is written in the configuration file
        in the following format:</p>
      <div class="example"><pre>
ExclusiveDecodeInstruction = {exclusive_decode,{ModuleName,DecodeInstructions}}.

ModuleName = atom()

DecodeInstructions = [DecodeInstruction]+

DecodeInstruction = {ExclusiveDecodeFunctionName,TypeList}

ExclusiveDecodeFunctionName = atom()

TypeList = [TopType,ElementList]

ElementList = [Element]+

Element = {Name,parts} |
          {Name,undecoded} |
          {Name,ElementList}

TopType = atom()

Name = atom()</pre></div>
      <p>The instruction must be a valid Erlang term ended by a dot.
        </p>
      <p>In <span class="code">TypeList</span> the path from the top type to each
      undecoded subcomponent is described. <span class="code">TopType</span> is the name
      of a top-level type in the ASN.1 specification. The action for
      each component in <span class="code">ElementList</span> is described by one of:</p>

      <ul>
        <li><span class="code">{Name,parts}</span></li>
        <li><span class="code">{Name,undecoded}</span></li>
        <li><span class="code">{Name,ElementList}</span></li>
      </ul>
      <p>The use and effect of the actions are as follows:</p>
      <dl>
        <dt class="title-link"><strong><span class="code">{Name,undecoded}</span></strong></dt>
        <dd>Leaves the element undecoded. The type of <span class="code">Name</span> can
        be any ASN.1 type. The value of element <span class="code">Name</span> is
        returned as a tuple (as mentioned in the previous section) in
        the value structure of the top type.</dd>

        <dt class="title-link"><strong><span class="code">{Name,parts}</span></strong></dt>
        <dd>The type of <span class="code">Name</span> must be either <span class="code">SEQUENCE OF</span>
        or <span class="code">SET OF</span>. The action implies that the different
        components of <span class="code">Name</span> are left undecoded. The value of
        <span class="code">Name</span> is returned as a tuple (as mentioned in the
        previous section) where the second element is a list of
        binaries. This is because the representation of a <span class="code">SEQUENCE
        OF</span> or a <span class="code">SET OF</span> in Erlang is a list of its internal
        type. Any of the elements in this list or the entire list can
        be decoded by function <span class="code">decodepart</span>.</dd>

        <dt class="title-link"><strong><span class="code">{Name,ElementList}</span></strong></dt>
        <dd>This action is used when one or more of the subtypes of
        <span class="code">Name</span> is exclusively decoded.</dd>
      </dl>
      <p><span class="code">Name</span> in these actions can be a component name of a
        <span class="code">SEQUENCE OF</span> or a <span class="code">SET OF</span>, or a name of an alternative
         in a <span class="code">CHOICE</span>.
        </p>
    

    <h4 id="example" class="title-link" onMouseOver="document.getElementById('ghlink-example-idm996').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-example-idm996').style.visibility = 'hidden';">
<div class="title-name">Example</div>
<div class="title-anchors"><span id="ghlink-example-idm996" class="ghlink-after"><a href="#example" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/asn1/doc/src/asn1_spec.xmlsrc#L183" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>In this examples, the definitions from the following ASN.1
        specification are used:</p>
      <a name="Asn1spec"></a>
<div class="example example-none"><pre>GUI DEFINITIONS AUTOMATIC TAGS ::= BEGIN

  Action ::= SEQUENCE {
    number  INTEGER DEFAULT 15,
    handle  Handle DEFAULT {number 12, on TRUE}
  }

  Key ::= Button
  Handle ::= Key

  Button ::= SEQUENCE {
    number INTEGER,
    on     BOOLEAN
  }

  Window ::= CHOICE {
    vsn INTEGER,
    status Status
  }

  Status ::= SEQUENCE {
    state INTEGER,
    buttonList SEQUENCE OF Button,
    enabled BOOLEAN OPTIONAL,
    actions CHOICE {
      possibleActions SEQUENCE OF Action,
      noOfActions INTEGER
    }
  }

END</pre></div>
      <p>If <span class="code">Button</span> is a top type and it is needed to exclude
        component <span class="code">number</span> from decode, <span class="code">TypeList</span> in the
        instruction in the configuration file is
        <span class="code">['Button',[{number,undecoded}]]</span>. If you call the decode
        function <span class="code">decode_Button_exclusive</span>, <span class="code">DecodeInstruction</span> is
        <span class="code">{decode_Button_exclusive,['Button',[{number,undecoded}]]}</span>.
        </p>
      <p>Another top type is <span class="code">Window</span> whose subcomponent
        actions in type <span class="code">Status</span> and the parts of component
        <span class="code">buttonList</span> are to be left undecoded. For this type, the
        function is named <span class="code">decode__Window_exclusive</span>. The complete
        <span class="code">Exclusive_Decode_Instruction</span> configuration is as follows:</p>
<div class="example example-none"><pre>{exclusive_decode,
 {'GUI',
  [{decode_Window_exclusive,
    ['Window',[{status,[{buttonList,parts},{actions,undecoded}]}]]},
   {decode_Button_exclusive,
    ['Button',[{number,undecoded}]]}]}}.</pre></div>
      <p>The following figure shows the bytes of a <span class="code">Window:status</span>
        message. The components <span class="code">buttonList</span> and <span class="code">actions</span> are
	excluded from decode. Only <span class="code">state</span> and <span class="code">enabled</span> are decoded
	when <span class="code">decode__Window_exclusive</span> is called.</p>
      <p></p>
      <div class="doc-image-wrapper">
<img alt="IMAGE MISSING" src="exclusive_Win_But.gif" class="doc-image">
        <p class="doc-image-caption">Figure
        4.1:
         
        Bytes of a Window:status Message</p>
      </div>
      <p></p>
      <p>Here follows an example of how the module. Note that option <span class="code">no_ok_wrapper</span>
      is used to make the make example more concise.</p>
      <div class="example"><pre>
1&gt; <span class="bold_code bc-12">asn1ct:compile('GUI', [ber,asn1config,no_ok_wrapper]).</span>
ok
2&gt; <span class="bold_code bc-12">rr('GUI').</span>
['Action','Button','Status']
3&gt; <span class="bold_code bc-12">ButtonMsg = #'Button'{number=123,on=true}.</span>
#'Button'{number = 123,on = true}
4&gt; <span class="bold_code bc-12">ButtonBytes = 'GUI':encode('Button', ButtonMsg).</span>
&lt;&lt;48,6,128,1,123,129,1,255&gt;&gt;
5&gt; <span class="bold_code bc-12">ExclusiveMsgButton = 'GUI':decode_Button_exclusive(ButtonBytes).</span>
#'Button'{number = {'Button_number',&lt;&lt;128,1,123&gt;&gt;},
          on = true}
6&gt; <span class="bold_code bc-12">{UndecKey,UndecBytes} = ExclusiveMsgButton#'Button'.number.</span>
{'Button_number',&lt;&lt;128,1,123&gt;&gt;}
7&gt; <span class="bold_code bc-12">'GUI':decode_part(UndecKey, UndecBytes).</span>
123
8&gt; <span class="bold_code bc-12">WindowMsg =
{status,{'Status',35,
   [{'Button',3,true},
    {'Button',4,false},
    {'Button',5,true},
    {'Button',6,true},
    {'Button',7,false}],
   false,
   {possibleActions,[{'Action',16,{'Button',17,true}}]}}}.</span>
{status,#'Status'{state = 35,
        buttonList = [#'Button'{number = 3,on = true},
                      #'Button'{number = 4,on = false},
                      #'Button'{number = 5,on = true},
                      #'Button'{number = 6,on = true},
                      #'Button'{number = 7,on = false}],
        enabled = false,
        actions = {possibleActions,[#'Action'{number = 16,
                                              handle = #'Button'{number = 17,on = true}}]}}}
9&gt; <span class="bold_code bc-12">WindowBytes = 'GUI':encode('Window', WindowMsg).</span>
&lt;&lt;161,65,128,1,35,161,40,48,6,128,1,3,129,1,255,48,6,128,
  1,4,129,1,0,48,6,128,1,5,129,...&gt;&gt;
10&gt; <span class="bold_code bc-12">{status,#'Status'{buttonList={UndecWindowKey,UndecWindowParts}}} =
'GUI':decode_Window_exclusive(WindowBytes).</span>
{status,#'Status'{state = 35,
                  buttonList = {'Status_buttonList',[&lt;&lt;48,6,128,1,3,129,1,
                                                       255&gt;&gt;,
                                                     &lt;&lt;48,6,128,1,4,129,1,0&gt;&gt;,
                                                     &lt;&lt;48,6,128,1,5,129,1,255&gt;&gt;,
                                                     &lt;&lt;48,6,128,1,6,129,1,255&gt;&gt;,
                                                     &lt;&lt;48,6,128,1,7,129,1,0&gt;&gt;]},
                  enabled = false,
                  actions = {'Status_actions',&lt;&lt;163,15,160,13,48,11,128,
                                                1,16,161,6,128,1,17,129,
                                                1,255&gt;&gt;}}}
11&gt; <span class="bold_code bc-12">'GUI':decode_part(UndecWindowKey, UndecWindowParts).</span>
[#'Button'{number = 3,on = true},
 #'Button'{number = 4,on = false},
 #'Button'{number = 5,on = true},
 #'Button'{number = 6,on = true},
 #'Button'{number = 7,on = false}]
12&gt; <span class="bold_code bc-12">'GUI':decode_part(UndecWindowKey, hd(UndecWindowParts)).</span>
#'Button'{number = 3,on = true}
13&gt; <span class="bold_code bc-12">{status,#'Status'{actions={ChoiceKey,ChoiceUndec}}} = v(10).</span>
{status,#'Status'{state = 35,
                  buttonList = {'Status_buttonList',[&lt;&lt;48,6,128,1,3,129,1,
                                                       255&gt;&gt;,
                                                     &lt;&lt;48,6,128,1,4,129,1,0&gt;&gt;,
                                                     &lt;&lt;48,6,128,1,5,129,1,255&gt;&gt;,
                                                     &lt;&lt;48,6,128,1,6,129,1,255&gt;&gt;,
                                                     &lt;&lt;48,6,128,1,7,129,1,0&gt;&gt;]},
                  enabled = false,
                  actions = {'Status_actions',&lt;&lt;163,15,160,13,48,11,128,
                                                1,16,161,6,128,1,17,129,
                                                1,255&gt;&gt;}}}
14&gt; <span class="bold_code bc-12">'GUI':decode_part(ChoiceKey, ChoiceUndec).</span>
{possibleActions,[#'Action'{number = 16,
                            handle = #'Button'{number = 17,on = true}}]}</pre></div>
    
  

  <h3 id="selective-decode" class="title-link" onMouseOver="document.getElementById('ghlink-selective-decode-idm1044').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-selective-decode-idm1044').style.visibility = 'hidden';">
<div class="title-name">4.2 
        Selective Decode</div>
<div class="title-anchors"><span id="ghlink-selective-decode-idm1044" class="ghlink-after"><a href="#selective-decode" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/asn1/doc/src/asn1_spec.xmlsrc#L289" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h3>
    
    <p>Selective decode decodes a single subtype of a constructed
    value. This is the fastest method to extract a subvalue. Selective
    decode is typically used when one want to inspect, for example, a
    version number to be able to decide what to do with the entire
    value.</p>

    <h4 id="procedure" class="title-link" onMouseOver="document.getElementById('ghlink-procedure-idm1047').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-procedure-idm1047').style.visibility = 'hidden';">
<div class="title-name">Procedure</div>
<div class="title-anchors"><span id="ghlink-procedure-idm1047" class="ghlink-after"><a href="#procedure" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/asn1/doc/src/asn1_spec.xmlsrc#L297" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>To perform a selective decode:
        </p>
      <ul>
        <li>
<p><strong>Step 1:</strong> Include the following instructions in
	 the configuration file:</p>
         <ul>
           <li>The name of the user function</li>
           <li>The name of the ASN.1 specification</li>
           <li>A notation that tells which part of the type to be
           decoded</li>
	 </ul>
</li>
        <li>
<strong>Step 2:</strong> Compile with the additional option
         <span class="code">asn1config</span>. The compiler searches for a configuration file
         with the same name as the ASN.1 specification, but with extension
         <span class="code">.asn1config</span>. In the same file you can also provide
	 configuration specifications for exclusive decode.
         The generated Erlang module has the
         usual functionality for encode/decode preserved and the
         specialized decode functionality added. </li>
      </ul>
    

    <h4 id="user-interface" class="title-link" onMouseOver="document.getElementById('ghlink-user-interface-idm1062').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-user-interface-idm1062').style.visibility = 'hidden';">
<div class="title-name">User Interface</div>
<div class="title-anchors"><span id="ghlink-user-interface-idm1062" class="ghlink-after"><a href="#user-interface" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/asn1/doc/src/asn1_spec.xmlsrc#L321" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>The only new user interface function is the one provided by the
        user in the configuration file.</p>
      <p>For example, if the configuration file includes the specification
        <span class="code">{selective_decode,{'ModuleName',[{selected_decode_Window,TypeList}]}}</span>
        do the selective decode by
        <span class="code">{ok,Result} = 'ModuleName':selected_decode_Window(EncodedBinary).</span></p>
    

    <a name="Selective%20Instruction"></a><h4 id="writing-a-selective-decode-instruction" class="title-link" onMouseOver="document.getElementById('ghlink-writing-a-selective-decode-instruction-idm1068').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-writing-a-selective-decode-instruction-idm1068').style.visibility = 'hidden';">
<div class="title-name">Writing a Selective Decode Instruction</div>
<div class="title-anchors"><span id="ghlink-writing-a-selective-decode-instruction-idm1068" class="ghlink-after"><a href="#writing-a-selective-decode-instruction" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/asn1/doc/src/asn1_spec.xmlsrc#L331" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      
      <p>One or more selective decode functions can be described in a
        configuration file. Use the following notation:</p>
      <div class="example"><pre>
SelectiveDecodeInstruction = {selective_decode,{ModuleName,DecodeInstructions}}.

ModuleName = atom()

DecodeInstructions = [DecodeInstruction]+

DecodeInstruction = {SelectiveDecodeFunctionName,TypeList}

SelectiveDecodeFunctionName = atom()

TypeList = [TopType|ElementList]

ElementList = Name|ListSelector

Name = atom()

ListSelector = [integer()]</pre></div>
      <p>The instruction must be a valid Erlang term ended by a dot.
        </p>
      <ul>
        <li>
<span class="code">ModuleName</span> is the same as the name of the ASN.1
        specification, but without the extension.</li>
      <li>
<span class="code">DecodeInstruction</span> is a tuple with your chosen
        function name and the components from the top type that leads
        to the single type you want to decode. Ensure to choose a name
        of your function that is not the same as any of the generated
        functions.</li>
      <li> The first element of <span class="code">TypeList</span> is the top type of the
        encoded message. In <span class="code">ElementList</span>, it is followed by
        each of the component names that leads to selected type.</li>
      <li>Each name in <span class="code">ElementList</span> must be a constructed type
        except the last name, which can be any type.</li>
      <li>
<span class="code">ListSelector</span> makes it possible to choose one of the
        encoded components in a <span class="code">SEQUENCE OF</span> or a <span class="code">SET OF</span>.
        It is also possible to go further in that component and pick a
        subtype of that to decode. So, in the <span class="code">TypeList</span>:
        <span class="code">['Window',status,buttonList,[1],number]</span>, component
        <span class="code">buttonList</span> must be of type <span class="code">SEQUENCE OF</span> or
        <span class="code">SET OF</span>.</li>
      </ul>
      <p>In the example, component <span class="code">number</span> of the first of the encoded
        elements in the <span class="code">SEQUENCE OF</span> <span class="code">buttonList</span> is selected.
        This applies on the ASN.1 specification in Section
        <span class="bold_code bc-17"><a href="#Asn1spec">Writing an Exclusive Decode
        Instruction</a></span>.
        </p>
    

    <h4 id="example" class="title-link" onMouseOver="document.getElementById('ghlink-example-idm1098').style.visibility = 'visible';" onMouseOut="document.getElementById('ghlink-example-idm1098').style.visibility = 'hidden';">
<div class="title-name">Example</div>
<div class="title-anchors"><span id="ghlink-example-idm1098" class="ghlink-after"><a href="#example" title="Link to this place!"><span class="paperclip-after"></span></a><a href="https://github.com/erlang/otp/edit/maint/lib/asn1/doc/src/asn1_spec.xmlsrc#L385" title="Found an issue with the documentation? Fix it by clicking here!"><span class="pencil-after"></span></a></span></div>
</h4>
      
      <p>In this example, the same ASN.1 specification as in Section
        <span class="bold_code bc-17"><a href="#Asn1spec">Writing an Exclusive Decode Instruction</a></span>
         is used. The following is a valid selective decode instruction:</p>
      <div class="example"><pre>
{selective_decode,
    {'GUI',
        [{selected_decode_Window1,
            ['Window',status,buttonList, 
             [1],
             number]},
 {selected_decode_Action,
     ['Action',handle,number]},
 {selected_decode_Window2,
     ['Window',
      status,
      actions,
      possibleActions,
      [1],
      handle,number]}]}}.</pre></div>
      <p>The first instruction,
        <span class="code">{selected_decode_Window1,['Window',status,buttonList,[1],number]}</span>
        is described in the previous section.</p>
      <p> The second instruction,
        <span class="code">{selected_decode_Action,['Action',handle,number]}</span>, takes
        component <span class="code">number</span> in the <span class="code">handle</span> component of type
        <span class="code">Action</span>. If the value is
        <span class="code">ValAction = {'Action',17,{'Button',4711,false}}</span>, the internal
        value 4711 is to be picked by <span class="code">selected_decode_Action</span>. In an
        Erlang terminal it looks as follows:</p>
      <div class="example"><pre>
1&gt; <span class="bold_code bc-12">asn1ct:compile('GUI', [ber,asn1config,no_ok_wrapper]).</span>
ok
2&gt; <span class="bold_code bc-12">ValAction = {'Action',17,{'Button',4711,false}}.</span>
{'Action',17,{'Button',4711,false}}
3&gt; <span class="bold_code bc-12">Bytes = 'GUI':encode('Action',ValAction).</span>
&lt;&lt;48,18,2,1,17,160,13,172,11,171,9,48,7,128,2,18,103,129,1,0&gt;&gt;
4&gt; <span class="bold_code bc-12">'GUI':selected_decode_Action(Bytes).</span>
4711</pre></div>
      <p>The third instruction,
        <span class="code">['Window',status,actions,possibleActions,[1],handle,number]</span>,
        works as follows:</p>
      <ul>
        <li>
<strong>Step 1:</strong> Starts with type <span class="code">Window</span>.</li>
        <li>
<strong>Step 2:</strong> Takes component <span class="code">status</span> of <span class="code">Window</span>
         that is of type <span class="code">Status</span>.</li>
        <li>
<strong>Step 3:</strong> Takes <strong>actions</strong> of type
        <span class="code">Status</span>.</li>
        <li>
<strong>Step 4:</strong> Takes <span class="code">possibleActions</span> of the internally
         defined <span class="code">CHOICE</span> type.</li>
        <li>
<strong>Step 5:</strong> Goes into the first component of
         <span class="code">SEQUENCE OF</span> by <span class="code">[1]</span>. That component is of type
         <span class="code">Action</span>.</li>
        <li>
<strong>Step 6:</strong> Takes component <span class="code">handle</span>.</li>
        <li>
<strong>Step 7:</strong> Takes component <span class="code">number</span> of type
        <span class="code">Button</span>.</li>
      </ul>
      <p>The following figure shows which components are in <span class="code">TypeList</span>
        <span class="code">['Window',status,actions,possibleActions,[1],handle,number]</span>:</p>
      <p></p>
      <div class="doc-image-wrapper">
<img alt="IMAGE MISSING" src="selective_TypeList.gif" class="doc-image">
        <p class="doc-image-caption">Figure
        4.2:
         
        Elements Specified in Configuration File for Selective Decode of a Subvalue in a Window Message</p>
      </div>
      <p>In the following figure, only the marked element is decoded by
        <span class="code">selected_decode_Window2</span>:</p>
      <p></p>
      <div class="doc-image-wrapper">
<img alt="IMAGE MISSING" src="selective_Window2.gif" class="doc-image">
        <p class="doc-image-caption">Figure
        4.3:
         
        Bytes of a Window:status Message</p>
      </div>
      <p>With the following example, you can examine that both
        <span class="code">selected_decode_Window2</span> and
        <span class="code">selected_decode_Window1</span> decodes the intended subvalue
        of value <span class="code">Val</span>:</p>
      <div class="example"><pre>
1&gt; <span class="bold_code bc-12">Val = {status,{'Status',12,
                    [{'Button',13,true},
                     {'Button',14,false},
                     {'Button',15,true},
                     {'Button',16,false}],
                    true,
                    {possibleActions,[{'Action',17,{'Button',18,false}},
                                      {'Action',19,{'Button',20,true}},
                                      {'Action',21,{'Button',22,false}}]}}}.</span>
2&gt; <span class="bold_code bc-12">Bin = 'GUI':encode('Window',Val).</span>
&lt;&lt;161,89,128,1,12,161,32,48,6,128,1,13,129,1,255,48,6,128,
  1,14,129,1,0,48,6,128,1,15,129,...&gt;&gt;
4&gt; <span class="bold_code bc-12">'GUI':selected_decode_Window1(Bin).</span>
13
5&gt; <span class="bold_code bc-12">'GUI':selected_decode_Window2(Bin).</span>
18</pre></div>
    
  
</div>
<div class="footer">
<hr>
<p>Copyright © 1997-2023 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script type="text/javascript">window.__otpTopDocDir = '../../../../doc/js/';</script><script type="text/javascript" src="../../../../doc/js/highlight.js"></script>
</body>
</html>
