<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/></meta>
<title>/buildroot/otp/lib/public_key/make_test_dir/public_key_test/public_key_SUITE.erl</title>
</head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
<a name="1"/>    1: <i>%%</i>
<a name="2"/>    2: <i>%% %CopyrightBegin%</i>
<a name="3"/>    3: <i>%%</i>
<a name="4"/>    4: <i>%% Copyright Ericsson AB 2008-2024. All Rights Reserved.</i>
<a name="5"/>    5: <i>%%</i>
<a name="6"/>    6: <i>%% Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</i>
<a name="7"/>    7: <i>%% you may not use this file except in compliance with the License.</i>
<a name="8"/>    8: <i>%% You may obtain a copy of the License at</i>
<a name="9"/>    9: <i>%%</i>
<a name="10"/>   10: <i>%%     http://www.apache.org/licenses/LICENSE-2.0</i>
<a name="11"/>   11: <i>%%</i>
<a name="12"/>   12: <i>%% Unless required by applicable law or agreed to in writing, software</i>
<a name="13"/>   13: <i>%% distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</i>
<a name="14"/>   14: <i>%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</i>
<a name="15"/>   15: <i>%% See the License for the specific language governing permissions and</i>
<a name="16"/>   16: <i>%% limitations under the License.</i>
<a name="17"/>   17: <i>%%</i>
<a name="18"/>   18: <i>%% %CopyrightEnd%</i>
<a name="19"/>   19: <i>%%</i>
<a name="20"/>   20: 
<a name="21"/>   21: <i>%%</i>
<a name="22"/>   22: <b>-module</b>(public_key_SUITE).
<a name="23"/>   23: 
<a name="24"/>   24: <b>-include_lib</b>(&quot;common_test/include/ct.hrl&quot;).
<a name="25"/>   25: <b>-include_lib</b>(&quot;public_key/include/public_key.hrl&quot;).
<a name="26"/>   26: 
<a name="27"/>   27: <b>-export</b>([
<a name="28"/>   28:          suite/0,
<a name="29"/>   29:          all/0,
<a name="30"/>   30:          groups/0,
<a name="31"/>   31:          init_per_suite/1,
<a name="32"/>   32:          end_per_suite/1,
<a name="33"/>   33:          init_per_group/2,
<a name="34"/>   34:          end_per_group/2,
<a name="35"/>   35:          init_per_testcase/2,
<a name="36"/>   36:          init_common_per_testcase/1,
<a name="37"/>   37:          end_per_testcase/2,
<a name="38"/>   38:          app/0,
<a name="39"/>   39:          app/1,
<a name="40"/>   40:          appup/0,
<a name="41"/>   41:          appup/1,
<a name="42"/>   42:          dsa_pem/0,
<a name="43"/>   43:          dsa_pem/1,
<a name="44"/>   44:          dsa_priv_pkcs8/0,
<a name="45"/>   45:          dsa_priv_pkcs8/1,
<a name="46"/>   46:          rsa_pem/0,
<a name="47"/>   47:          rsa_pem/1,
<a name="48"/>   48:          rsa_pss_pss_pem/0,
<a name="49"/>   49:          rsa_pss_pss_pem/1,
<a name="50"/>   50:          rsa_pss_default_pem/0,
<a name="51"/>   51:          rsa_pss_default_pem/1,
<a name="52"/>   52:          rsa_priv_pkcs8/0,
<a name="53"/>   53:          rsa_priv_pkcs8/1,
<a name="54"/>   54:          ec_pem/0,
<a name="55"/>   55:          ec_pem/1,
<a name="56"/>   56:          ec_pem2/0,
<a name="57"/>   57:          ec_pem2/1,
<a name="58"/>   58:          ec_priv_pkcs8/0,
<a name="59"/>   59:          ec_priv_pkcs8/1,
<a name="60"/>   60:          eddsa_priv_pkcs8/0,
<a name="61"/>   61:          eddsa_priv_pkcs8/1,
<a name="62"/>   62:          eddsa_priv_rfc5958/0,
<a name="63"/>   63:          eddsa_priv_rfc5958/1,
<a name="64"/>   64:          eddsa_pub/0,
<a name="65"/>   65:          eddsa_pub/1,
<a name="66"/>   66:          eddsa_sign_verify_24_compat/1,
<a name="67"/>   67:          init_ec_pem_encode_generated/1,
<a name="68"/>   68:          ec_pem_encode_generated/0,
<a name="69"/>   69:          ec_pem_encode_generated/1,
<a name="70"/>   70:          encrypted_pem_pwdstring/0,
<a name="71"/>   71:          encrypted_pem_pwdstring/1,
<a name="72"/>   72:          encrypted_pem_pwdfun/0,
<a name="73"/>   73:          encrypted_pem_pwdfun/1,
<a name="74"/>   74:          dh_pem/0,
<a name="75"/>   75:          dh_pem/1,
<a name="76"/>   76:          pkcs10_pem/0,
<a name="77"/>   77:          pkcs10_pem/1,
<a name="78"/>   78:          pkcs7_pem/0,
<a name="79"/>   79:          pkcs7_pem/1,
<a name="80"/>   80:          cert_pem/0,
<a name="81"/>   81:          cert_pem/1,
<a name="82"/>   82:          encrypt_decrypt/0,
<a name="83"/>   83:          encrypt_decrypt/1,
<a name="84"/>   84:          encrypt_decrypt_sign_fun/0,
<a name="85"/>   85:          encrypt_decrypt_sign_fun/1,
<a name="86"/>   86:          rsa_sign_verify/0,
<a name="87"/>   87:          rsa_sign_verify/1,
<a name="88"/>   88:          rsa_pss_sign_verify/0,
<a name="89"/>   89:          rsa_pss_sign_verify/1,
<a name="90"/>   90:          dsa_sign_verify/0,
<a name="91"/>   91:          dsa_sign_verify/1,
<a name="92"/>   92:          custom_sign_fun_verify/0,
<a name="93"/>   93:          custom_sign_fun_verify/1,
<a name="94"/>   94:          pkix/0,
<a name="95"/>   95:          pkix/1,
<a name="96"/>   96:          pkix_countryname/0,
<a name="97"/>   97:          pkix_countryname/1,
<a name="98"/>   98:          pkix_emailaddress/0,
<a name="99"/>   99:          pkix_emailaddress/1,
<a name="100"/>  100:          pkix_decode_cert/0,
<a name="101"/>  101:          pkix_decode_cert/1,
<a name="102"/>  102:          pkix_path_validation/0,
<a name="103"/>  103:          pkix_path_validation/1,
<a name="104"/>  104:          pkix_path_validation_root_expired/0,
<a name="105"/>  105:          pkix_path_validation_root_expired/1,
<a name="106"/>  106:          pkix_ext_key_usage/0,
<a name="107"/>  107:          pkix_ext_key_usage/1,
<a name="108"/>  108:          pkix_ext_key_usage_any/0,
<a name="109"/>  109:          pkix_ext_key_usage_any/1,
<a name="110"/>  110:          pkix_path_validation_bad_date/0,
<a name="111"/>  111:          pkix_path_validation_bad_date/1,
<a name="112"/>  112:          pkix_verify_hostname_cn/1,
<a name="113"/>  113:          pkix_verify_hostname_subjAltName/1,
<a name="114"/>  114:          pkix_verify_hostname_options/1,
<a name="115"/>  115:          pkix_verify_hostname_subjAltName_IP/1,
<a name="116"/>  116:          pkix_dist_point_uri/0,
<a name="117"/>  117:          pkix_dist_point_uri/1,
<a name="118"/>  118:          pkix_iso_rsa_oid/0,
<a name="119"/>  119:          pkix_iso_rsa_oid/1,
<a name="120"/>  120:          pkix_iso_dsa_oid/0,
<a name="121"/>  121:          pkix_iso_dsa_oid/1,
<a name="122"/>  122:          pkix_dsa_sha2_oid/0,
<a name="123"/>  123:          pkix_dsa_sha2_oid/1,
<a name="124"/>  124:          pkix_crl/0,
<a name="125"/>  125:          pkix_crl/1,
<a name="126"/>  126:          general_name/0,
<a name="127"/>  127:          general_name/1,
<a name="128"/>  128:          pkix_hash_type/0,
<a name="129"/>  129:          pkix_hash_type/1,
<a name="130"/>  130:          pkix_test_data_all_default/0,
<a name="131"/>  131:          pkix_test_data_all_default/1,
<a name="132"/>  132:          pkix_test_data/0,
<a name="133"/>  133:          pkix_test_data/1,
<a name="134"/>  134:          pkix_is_issuer/0,
<a name="135"/>  135:          pkix_is_issuer/1,
<a name="136"/>  136:          pkix_ocsp_validate/0, pkix_ocsp_validate/1,
<a name="137"/>  137:          short_cert_issuer_hash/0,
<a name="138"/>  138:          short_cert_issuer_hash/1,
<a name="139"/>  139:          short_crl_issuer_hash/0,
<a name="140"/>  140:          short_crl_issuer_hash/1,
<a name="141"/>  141:          gen_ec_param_prime_field/0,
<a name="142"/>  142:          gen_ec_param_prime_field/1,
<a name="143"/>  143:          gen_ec_param_char_2_field/0,
<a name="144"/>  144:          gen_ec_param_char_2_field/1,
<a name="145"/>  145:          cacerts_load/0, cacerts_load/1,
<a name="146"/>  146:          ocsp_extensions/0, ocsp_extensions/1
<a name="147"/>  147:         ]).
<a name="148"/>  148: 
<a name="149"/>  149: <b>-export</b>([list_cacerts/0]).  % debug exports
<a name="150"/>  150: 
<a name="151"/>  151: 
<a name="152"/>  152: <b>-define</b>(TIMEOUT, 120000). % 2 min
<a name="153"/>  153: <b>-define</b>(PASSWORD1, &quot;1234abcd&quot;).
<a name="154"/>  154: <b>-define</b>(PASSWORD2, &quot;4567efgh&quot;).
<a name="155"/>  155: 
<a name="156"/>  156: <i>%%--------------------------------------------------------------------</i>
<a name="157"/>  157: <i>%% Common Test interface functions -----------------------------------</i>
<a name="158"/>  158: <i>%%--------------------------------------------------------------------</i>
<a name="159"/>  159: 
<a name="suite-0"/><a name="160"/>  160: <b>suite</b>() -&gt; 
<a name="suite-last_expr"/><a name="161"/>  161:     [].
<a name="162"/>  162: 
<a name="all-0"/><a name="163"/>  163: <b>all</b>() -&gt; 
<a name="all-last_expr"/><a name="164"/>  164:     [app, 
<a name="165"/>  165:      appup,
<a name="166"/>  166:      {group, pem_decode_encode},
<a name="167"/>  167:      encrypt_decrypt,
<a name="168"/>  168:      encrypt_decrypt_sign_fun,
<a name="169"/>  169:      {group, sign_verify},
<a name="170"/>  170:      pkix, 
<a name="171"/>  171:      pkix_countryname, 
<a name="172"/>  172:      pkix_emailaddress, 
<a name="173"/>  173:      pkix_decode_cert,
<a name="174"/>  174:      pkix_path_validation,
<a name="175"/>  175:      pkix_path_validation_root_expired,
<a name="176"/>  176:      pkix_ext_key_usage,
<a name="177"/>  177:      pkix_ext_key_usage_any,
<a name="178"/>  178:      pkix_path_validation_bad_date,
<a name="179"/>  179:      pkix_iso_rsa_oid, 
<a name="180"/>  180:      pkix_iso_dsa_oid, 
<a name="181"/>  181:      pkix_dsa_sha2_oid,
<a name="182"/>  182:      pkix_crl, 
<a name="183"/>  183:      pkix_hash_type,
<a name="184"/>  184:      general_name,
<a name="185"/>  185:      pkix_verify_hostname_cn,
<a name="186"/>  186:      pkix_verify_hostname_subjAltName,
<a name="187"/>  187:      pkix_verify_hostname_subjAltName_IP,
<a name="188"/>  188:      pkix_verify_hostname_options,
<a name="189"/>  189:      pkix_dist_point_uri,
<a name="190"/>  190:      pkix_test_data_all_default,
<a name="191"/>  191:      pkix_test_data,
<a name="192"/>  192:      pkix_is_issuer,
<a name="193"/>  193:      short_cert_issuer_hash, 
<a name="194"/>  194:      short_crl_issuer_hash,
<a name="195"/>  195:      cacerts_load,
<a name="196"/>  196:      ocsp_extensions,
<a name="197"/>  197:      pkix_ocsp_validate
<a name="198"/>  198:     ].
<a name="199"/>  199: 
<a name="groups-0"/><a name="200"/>  200: <b>groups</b>() -&gt; 
<a name="groups-last_expr"/><a name="201"/>  201:     [{pem_decode_encode, [], [dsa_pem, rsa_pem, rsa_pss_pss_pem, 
<a name="202"/>  202:                               rsa_pss_default_pem, ec_pem,
<a name="203"/>  203: 			      encrypted_pem_pwdstring, encrypted_pem_pwdfun,
<a name="204"/>  204: 			      dh_pem, cert_pem, pkcs7_pem, pkcs10_pem, ec_pem2,
<a name="205"/>  205: 			      rsa_priv_pkcs8, dsa_priv_pkcs8, ec_priv_pkcs8,
<a name="206"/>  206: 			      eddsa_priv_pkcs8, eddsa_priv_rfc5958,
<a name="207"/>  207: 			      ec_pem_encode_generated, gen_ec_param_prime_field,
<a name="208"/>  208: 			      gen_ec_param_char_2_field]},
<a name="209"/>  209:      {sign_verify, [], [rsa_sign_verify, rsa_pss_sign_verify, dsa_sign_verify,
<a name="210"/>  210:                         eddsa_sign_verify_24_compat, custom_sign_fun_verify]}
<a name="211"/>  211:     ].
<a name="212"/>  212: <i>%%-------------------------------------------------------------------</i>
<a name="init_per_suite-1"/><a name="213"/>  213: <b>init_per_suite</b>(Config) -&gt;
<a name="214"/>  214:     application:stop(crypto),
<a name="init_per_suite-last_expr"/><a name="215"/>  215: <b>    try crypto:start</b>() of
<a name="216"/>  216:         ok -&gt;
<a name="217"/>  217:             application:start(asn1),
<a name="218"/>  218:             Config
<a name="219"/>  219:     catch _:_ -&gt;
<a name="220"/>  220: 	    {skip, &quot;Crypto did not start&quot;}
<a name="221"/>  221:     end.
<a name="222"/>  222: 
<a name="end_per_suite-1"/><a name="223"/>  223: <b>end_per_suite</b>(_Config) -&gt;
<a name="224"/>  224:     application:stop(asn1),
<a name="end_per_suite-last_expr"/><a name="225"/>  225: <b>    application:stop</b>(crypto).
<a name="226"/>  226: 
<a name="227"/>  227: <i>%%-------------------------------------------------------------------</i>
<a name="init_per_group-2"/><a name="228"/>  228: <b>init_per_group</b>(_GroupName, Config) -&gt;
<a name="init_per_group-last_expr"/><a name="229"/>  229:     Config.
<a name="230"/>  230: 
<a name="end_per_group-2"/><a name="231"/>  231: <b>end_per_group</b>(_GroupName, Config) -&gt;
<a name="end_per_group-last_expr"/><a name="232"/>  232:     Config.
<a name="233"/>  233: <i>%%-------------------------------------------------------------------</i>
<a name="234"/>  234: 
<a name="init_per_testcase-2"/><a name="235"/>  235: <b>init_per_testcase</b>(pkix_test_data_all_default, Config) -&gt;
<a name="236"/>  236:      case crypto:ec_curves() of
<a name="237"/>  237:          [] -&gt;
<a name="238"/>  238:              {skip, missing_ecc_support};
<a name="239"/>  239:          _ -&gt;
<a name="240"/>  240:              init_common_per_testcase(Config)
<a name="241"/>  241:      end;
<a name="242"/>  242: 
<a name="243"/>  243: <b>init_per_testcase</b>(gen_ec_param_prime_field=TC, Config) -&gt;
<a name="244"/>  244:     init_per_testcase_gen_ec_param(TC, secp521r1, Config);
<a name="245"/>  245: 
<a name="246"/>  246: <b>init_per_testcase</b>(gen_ec_param_char_2_field=TC, Config) -&gt;
<a name="247"/>  247:     init_per_testcase_gen_ec_param(TC, sect571r1, Config);
<a name="248"/>  248: 
<a name="249"/>  249: <b>init_per_testcase</b>(rsa_pss_sign_verify, Config) -&gt;
<a name="250"/>  250:     Supports = crypto:supports(),
<a name="251"/>  251:     RSAOpts = proplists:get_value(rsa_opts, Supports),
<a name="252"/>  252: 
<a name="253"/>  253:     case lists:member(rsa_pkcs1_pss_padding, RSAOpts) 
<a name="254"/>  254:         andalso lists:member(rsa_pss_saltlen, RSAOpts) 
<a name="255"/>  255:         andalso lists:member(rsa_mgf1_md, RSAOpts) of
<a name="256"/>  256:         true -&gt;
<a name="257"/>  257:             Config;
<a name="258"/>  258:         false -&gt;
<a name="259"/>  259:             {skip, not_supported_by_crypto}
<a name="260"/>  260:     end;
<a name="261"/>  261: 
<a name="262"/>  262: <b>init_per_testcase</b>(eddsa_sign_verify_24_compat, Config) -&gt;
<a name="263"/>  263:     case lists:member(eddsa, crypto:supports(public_keys)) of
<a name="264"/>  264:         true -&gt;
<a name="265"/>  265:             Config;
<a name="266"/>  266:         false -&gt;
<a name="267"/>  267:             {skip, eddsa_not_supported_by_crypto}
<a name="268"/>  268:     end;
<a name="269"/>  269: 
<a name="270"/>  270: <b>init_per_testcase</b>(TestCase, Config) -&gt;
<a name="init_per_testcase-last_expr"/><a name="271"/>  271:     case TestCase of
<a name="272"/>  272:         ec_pem_encode_generated -&gt;
<a name="273"/>  273:             init_ec_pem_encode_generated(Config);
<a name="274"/>  274: 	_ -&gt; init_common_per_testcase(Config)
<a name="275"/>  275:     end.
<a name="276"/>  276: 	
<a name="init_common_per_testcase-1"/><a name="277"/>  277: <b>init_common_per_testcase</b>(Config0) -&gt;
<a name="278"/>  278:     Config = lists:keydelete(watchdog, 1, Config0),
<a name="279"/>  279:     Dog = ct:timetrap(?TIMEOUT),
<a name="init_common_per_testcase-last_expr"/><a name="280"/>  280:     [{watchdog, Dog} | Config].
<a name="281"/>  281: 
<a name="282"/>  282: 
<a name="end_per_testcase-2"/><a name="283"/>  283: <b>end_per_testcase</b>(_TestCase, _Config) -&gt;
<a name="end_per_testcase-last_expr"/><a name="284"/>  284:     ok.
<a name="285"/>  285: 
<a name="286"/>  286: <i>%%--------------------------------------------------------------------</i>
<a name="287"/>  287: <i>%% Test Cases --------------------------------------------------------</i>
<a name="288"/>  288: <i>%%--------------------------------------------------------------------</i>
<a name="289"/>  289: 
<a name="app-0"/><a name="290"/>  290: <b>app</b>() -&gt;
<a name="app-last_expr"/><a name="291"/>  291:     [{doc, &quot;Test that the public_key app file is ok&quot;}].
<a name="app-1"/><a name="292"/>  292: <b>app</b>(Config) when is_list(Config) -&gt;
<a name="app-last_expr"/><a name="293"/>  293: <b>    ok = test_server:app_test</b>(public_key).
<a name="294"/>  294: 
<a name="295"/>  295: <i>%%--------------------------------------------------------------------</i>
<a name="296"/>  296: 
<a name="appup-0"/><a name="297"/>  297: <b>appup</b>() -&gt;
<a name="appup-last_expr"/><a name="298"/>  298:     [{doc, &quot;Test that the public_key appup file is ok&quot;}].
<a name="appup-1"/><a name="299"/>  299: <b>appup</b>(Config) when is_list(Config) -&gt;
<a name="appup-last_expr"/><a name="300"/>  300: <b>    ok = test_server:appup_test</b>(public_key).
<a name="301"/>  301: 
<a name="302"/>  302: <i>%%--------------------------------------------------------------------</i>
<a name="303"/>  303: 
<a name="dsa_pem-0"/><a name="304"/>  304: <b>dsa_pem</b>() -&gt;
<a name="dsa_pem-last_expr"/><a name="305"/>  305:     [{doc, &quot;DSA PEM-file decode/encode&quot;}].
<a name="dsa_pem-1"/><a name="306"/>  306: <b>dsa_pem</b>(Config) when is_list(Config) -&gt;
<a name="307"/>  307:     Datadir = proplists:get_value(data_dir, Config),
<a name="308"/>  308: 
<a name="309"/>  309:      [{'DSAPrivateKey', DerDSAKey, not_encrypted} = Entry0 ] =
<a name="310"/>  310: 	erl_make_certs:pem_to_der(filename:join(Datadir, &quot;dsa.pem&quot;)),
<a name="311"/>  311: 
<a name="312"/>  312:     DSAKey = public_key:der_decode('DSAPrivateKey', DerDSAKey),
<a name="313"/>  313: 
<a name="314"/>  314:     DSAKey = public_key:pem_entry_decode(Entry0),
<a name="315"/>  315: 
<a name="316"/>  316:     {ok, DSAPubPem} = file:read_file(filename:join(Datadir, &quot;dsa_pub.pem&quot;)),
<a name="317"/>  317:     [{'SubjectPublicKeyInfo', _, _} = PubEntry0] =
<a name="318"/>  318:         public_key:pem_decode(DSAPubPem),
<a name="319"/>  319:     DSAPubKey = public_key:pem_entry_decode(PubEntry0),
<a name="320"/>  320:     true = check_entry_type(DSAPubKey, 'DSAPublicKey'),
<a name="321"/>  321:     PubEntry0 = public_key:pem_entry_encode('SubjectPublicKeyInfo', DSAPubKey),
<a name="322"/>  322:     DSAPubPemNoEndNewLines = strip_superfluous_newlines(DSAPubPem),
<a name="dsa_pem-last_expr"/><a name="323"/>  323: <b>    DSAPubPemNoEndNewLines = strip_superfluous_newlines</b>(public_key:pem_encode([PubEntry0])).
<a name="324"/>  324: 
<a name="dsa_priv_pkcs8-0"/><a name="325"/>  325: <b>dsa_priv_pkcs8</b>() -&gt;
<a name="dsa_priv_pkcs8-last_expr"/><a name="326"/>  326:     [{doc, &quot;DSA PKCS8 private key decode/encode&quot;}].
<a name="dsa_priv_pkcs8-1"/><a name="327"/>  327: <b>dsa_priv_pkcs8</b>(Config) when is_list(Config) -&gt;
<a name="328"/>  328:     Datadir = proplists:get_value(data_dir, Config),
<a name="329"/>  329:     {ok, DsaPem} = file:read_file(filename:join(Datadir, &quot;dsa_key_pkcs8.pem&quot;)),
<a name="330"/>  330:     [{'PrivateKeyInfo', DerDSAKey, not_encrypted} = Entry0 ] = public_key:pem_decode(DsaPem),
<a name="331"/>  331:     DSAKey = public_key:der_decode('PrivateKeyInfo', DerDSAKey),
<a name="332"/>  332:     DSAKey = public_key:pem_entry_decode(Entry0),
<a name="333"/>  333:     true = check_entry_type(DSAKey, 'DSAPrivateKey'),
<a name="334"/>  334:     PrivEntry0 = public_key:pem_entry_encode('PrivateKeyInfo', DSAKey),
<a name="335"/>  335:     DSAPemNoEndNewLines = strip_superfluous_newlines(DsaPem),
<a name="dsa_priv_pkcs8-last_expr"/><a name="336"/>  336: <b>    DSAPemNoEndNewLines = strip_superfluous_newlines</b>(public_key:pem_encode([PrivEntry0])).
<a name="337"/>  337: 
<a name="338"/>  338: <i>%%--------------------------------------------------------------------</i>
<a name="339"/>  339: 
<a name="rsa_pem-0"/><a name="340"/>  340: <b>rsa_pem</b>() -&gt;
<a name="rsa_pem-last_expr"/><a name="341"/>  341:     [{doc, &quot;RSA PEM-file decode/encode&quot;}].
<a name="rsa_pem-1"/><a name="342"/>  342: <b>rsa_pem</b>(Config) when is_list(Config) -&gt;
<a name="343"/>  343:     Datadir = proplists:get_value(data_dir, Config),
<a name="344"/>  344:     [{'RSAPrivateKey', DerRSAKey, not_encrypted} =  Entry0 ] =
<a name="345"/>  345: 	erl_make_certs:pem_to_der(filename:join(Datadir, &quot;client_key.pem&quot;)),
<a name="346"/>  346: 
<a name="347"/>  347:     RSAKey0 = public_key:der_decode('RSAPrivateKey', DerRSAKey),
<a name="348"/>  348: 
<a name="349"/>  349:     RSAKey0 = public_key:pem_entry_decode(Entry0),
<a name="350"/>  350:     
<a name="351"/>  351:     [{'RSAPrivateKey', _, {_,_}} = Entry1] =
<a name="352"/>  352: 	erl_make_certs:pem_to_der(filename:join(Datadir, &quot;rsa.pem&quot;)),
<a name="353"/>  353: 
<a name="354"/>  354:     true = check_entry_type(public_key:pem_entry_decode(Entry1, &quot;abcd1234&quot;),
<a name="355"/>  355: 			    'RSAPrivateKey'),
<a name="356"/>  356: 
<a name="357"/>  357:     {ok, RSAPubPem} = file:read_file(filename:join(Datadir, &quot;rsa_pub.pem&quot;)),
<a name="358"/>  358:     [{'SubjectPublicKeyInfo', _, _} = PubEntry0] =
<a name="359"/>  359:         public_key:pem_decode(RSAPubPem),
<a name="360"/>  360:     RSAPubKey = public_key:pem_entry_decode(PubEntry0),
<a name="361"/>  361:     true = check_entry_type(RSAPubKey, 'RSAPublicKey'),
<a name="362"/>  362:     PubEntry0 = public_key:pem_entry_encode('SubjectPublicKeyInfo', RSAPubKey),
<a name="363"/>  363:     RSAPubPemNoEndNewLines = strip_superfluous_newlines(RSAPubPem),
<a name="364"/>  364:     RSAPubPemNoEndNewLines = strip_superfluous_newlines(public_key:pem_encode([PubEntry0])),
<a name="365"/>  365: 
<a name="366"/>  366:     {ok, RSARawPem} = file:read_file(filename:join(Datadir, &quot;rsa_pub_key.pem&quot;)),
<a name="367"/>  367:     [{'RSAPublicKey', _, _} = PubEntry1] =
<a name="368"/>  368:         public_key:pem_decode(RSARawPem),
<a name="369"/>  369:     RSAPubKey = public_key:pem_entry_decode(PubEntry1),
<a name="370"/>  370:     RSARawPemNoEndNewLines = strip_superfluous_newlines(RSARawPem),
<a name="rsa_pem-last_expr"/><a name="371"/>  371: <b>    RSARawPemNoEndNewLines = strip_superfluous_newlines</b>(public_key:pem_encode([PubEntry1])).
<a name="372"/>  372: 
<a name="rsa_pss_pss_pem-0"/><a name="373"/>  373: <b>rsa_pss_pss_pem</b>() -&gt;
<a name="rsa_pss_pss_pem-last_expr"/><a name="374"/>  374:     [{doc, &quot;RSA PKCS8 RSASSA-PSS private key decode/encode&quot;}].
<a name="rsa_pss_pss_pem-1"/><a name="375"/>  375: <b>rsa_pss_pss_pem</b>(Config) when is_list(Config) -&gt;
<a name="376"/>  376:     Datadir = proplists:get_value(data_dir, Config),
<a name="377"/>  377:     {ok, RsaPem} = file:read_file(filename:join(Datadir, &quot;rsa_pss_pss_key.pem&quot;)),
<a name="378"/>  378:     [{'PrivateKeyInfo', DerRSAKey, not_encrypted} = Entry0 ] = public_key:pem_decode(RsaPem),
<a name="379"/>  379:     {RSAKey, Parms} = public_key:der_decode('PrivateKeyInfo', DerRSAKey),
<a name="380"/>  380:     {RSAKey, Parms} = public_key:pem_entry_decode(Entry0),
<a name="381"/>  381:     true = check_entry_type(RSAKey, 'RSAPrivateKey'),
<a name="382"/>  382:     PrivEntry0 = public_key:pem_entry_encode('PrivateKeyInfo', {RSAKey, Parms}),
<a name="383"/>  383:     RSAPemNoEndNewLines = strip_superfluous_newlines(RsaPem),
<a name="rsa_pss_pss_pem-last_expr"/><a name="384"/>  384: <b>    RSAPemNoEndNewLines = strip_superfluous_newlines</b>(public_key:pem_encode([PrivEntry0])).
<a name="385"/>  385: 
<a name="rsa_pss_default_pem-0"/><a name="386"/>  386: <b>rsa_pss_default_pem</b>() -&gt;
<a name="rsa_pss_default_pem-last_expr"/><a name="387"/>  387:     [{doc, &quot;RSA PKCS8 RSASSA-PSS private key with default params decode/encode&quot;}].
<a name="rsa_pss_default_pem-1"/><a name="388"/>  388: <b>rsa_pss_default_pem</b>(Config) when is_list(Config) -&gt;
<a name="389"/>  389:     Datadir = proplists:get_value(data_dir, Config),
<a name="390"/>  390:     {ok, RsaPem} = file:read_file(filename:join(Datadir, &quot;pss_default.pem&quot;)),
<a name="391"/>  391:     [{'PrivateKeyInfo', DerRSAKey, not_encrypted} = Entry0 ] = public_key:pem_decode(RsaPem),
<a name="392"/>  392:     #'RSASSA-AlgorithmIdentifier'{parameters = Params} = ?'rSASSA-PSS-Default-Identifier',
<a name="393"/>  393:     {RSAKey, Params} = public_key:der_decode('PrivateKeyInfo', DerRSAKey),
<a name="394"/>  394:     {RSAKey, Parms} = public_key:pem_entry_decode(Entry0),
<a name="395"/>  395:     true = check_entry_type(RSAKey, 'RSAPrivateKey'),
<a name="396"/>  396:     PrivEntry0 = public_key:pem_entry_encode('PrivateKeyInfo', {RSAKey, Parms}),
<a name="397"/>  397:     RSAPemNoEndNewLines = strip_superfluous_newlines(RsaPem),
<a name="rsa_pss_default_pem-last_expr"/><a name="398"/>  398: <b>    RSAPemNoEndNewLines = strip_superfluous_newlines</b>(public_key:pem_encode([PrivEntry0])).
<a name="399"/>  399: 
<a name="rsa_priv_pkcs8-0"/><a name="400"/>  400: <b>rsa_priv_pkcs8</b>() -&gt;
<a name="rsa_priv_pkcs8-last_expr"/><a name="401"/>  401:     [{doc, &quot;RSA PKCS8 private key decode/encode&quot;}].
<a name="rsa_priv_pkcs8-1"/><a name="402"/>  402: <b>rsa_priv_pkcs8</b>(Config) when is_list(Config) -&gt;
<a name="403"/>  403:     Datadir = proplists:get_value(data_dir, Config),
<a name="404"/>  404:     {ok, RsaPem} = file:read_file(filename:join(Datadir, &quot;rsa_key_pkcs8.pem&quot;)),
<a name="405"/>  405:     [{'PrivateKeyInfo', DerRSAKey, not_encrypted} = Entry0 ] = public_key:pem_decode(RsaPem),
<a name="406"/>  406:     RSAKey = public_key:der_decode('PrivateKeyInfo', DerRSAKey),
<a name="407"/>  407:     RSAKey = public_key:pem_entry_decode(Entry0),
<a name="408"/>  408:     true = check_entry_type(RSAKey, 'RSAPrivateKey'),
<a name="409"/>  409:     PrivEntry0 = public_key:pem_entry_encode('PrivateKeyInfo', RSAKey),
<a name="410"/>  410:     RSAPemNoEndNewLines = strip_superfluous_newlines(RsaPem),
<a name="rsa_priv_pkcs8-last_expr"/><a name="411"/>  411: <b>    RSAPemNoEndNewLines = strip_superfluous_newlines</b>(public_key:pem_encode([PrivEntry0])).
<a name="412"/>  412: 
<a name="413"/>  413: <i>%%--------------------------------------------------------------------</i>
<a name="414"/>  414: 
<a name="ec_pem-0"/><a name="415"/>  415: <b>ec_pem</b>() -&gt;
<a name="ec_pem-last_expr"/><a name="416"/>  416:     [{doc, &quot;EC key PEM-file decode/encode&quot;}].
<a name="ec_pem-1"/><a name="417"/>  417: <b>ec_pem</b>(Config) when is_list(Config) -&gt;
<a name="418"/>  418:     Datadir = proplists:get_value(data_dir, Config),
<a name="419"/>  419:     {ok, ECPubPem} = file:read_file(filename:join(Datadir, &quot;ec_pubkey.pem&quot;)),
<a name="420"/>  420:     [{'SubjectPublicKeyInfo', _, _} = PubEntry0] =
<a name="421"/>  421:         public_key:pem_decode(ECPubPem),
<a name="422"/>  422:     ECPubKey = public_key:pem_entry_decode(PubEntry0),
<a name="423"/>  423:     true = check_entry_type(ECPubKey, 'ECPoint'),
<a name="424"/>  424:     PubEntry0 = public_key:pem_entry_encode('SubjectPublicKeyInfo', ECPubKey),
<a name="425"/>  425:     ECPubPemNoEndNewLines = strip_superfluous_newlines(ECPubPem),
<a name="426"/>  426:     ECPubPemNoEndNewLines = strip_superfluous_newlines(public_key:pem_encode([PubEntry0])),
<a name="427"/>  427:     
<a name="428"/>  428:     {ok, ECPrivPem} = file:read_file(filename:join(Datadir, &quot;ec_key.pem&quot;)),
<a name="429"/>  429:     [{'EcpkParameters', _, not_encrypted} = Entry1,
<a name="430"/>  430:      {'ECPrivateKey', _, not_encrypted} = Entry2] = public_key:pem_decode(ECPrivPem),
<a name="431"/>  431:     
<a name="432"/>  432:     ECParams = public_key:pem_entry_decode(Entry1),
<a name="433"/>  433:     true = check_entry_type(ECParams, 'EcpkParameters'),
<a name="434"/>  434:     ECPrivKey = public_key:pem_entry_decode(Entry2),
<a name="435"/>  435:     true = check_entry_type(ECPrivKey, 'ECPrivateKey'),
<a name="436"/>  436:     true = check_entry_type(ECPrivKey#'ECPrivateKey'.parameters, 'EcpkParameters'),
<a name="437"/>  437:     ECPemNoEndNewLines = strip_superfluous_newlines(ECPrivPem),
<a name="ec_pem-last_expr"/><a name="438"/>  438: <b>    ECPemNoEndNewLines = strip_superfluous_newlines</b>(public_key:pem_encode([Entry1, Entry2])).
<a name="439"/>  439:     
<a name="ec_pem2-0"/><a name="440"/>  440: <b>ec_pem2</b>() -&gt;
<a name="ec_pem2-last_expr"/><a name="441"/>  441:     [{doc, &quot;EC key w/explicit params PEM-file decode/encode&quot;}].
<a name="ec_pem2-1"/><a name="442"/>  442: <b>ec_pem2</b>(Config) when is_list(Config) -&gt;
<a name="443"/>  443:     Datadir = proplists:get_value(data_dir, Config),
<a name="444"/>  444: 
<a name="445"/>  445:     %% Load key with explicit curve parameters.  Generated with...
<a name="446"/>  446:     %% openssl ecparam -name secp521r1 -genkey -param_enc explicit -out ec_key2.pem
<a name="447"/>  447:     {ok, ECPrivPem} = file:read_file(filename:join(Datadir, &quot;ec_key2.pem&quot;)),
<a name="448"/>  448:     [{'EcpkParameters', _, not_encrypted} = Entry1,
<a name="449"/>  449:      {'ECPrivateKey', _, not_encrypted} = Entry2] = public_key:pem_decode(ECPrivPem),
<a name="450"/>  450: 
<a name="451"/>  451:     ECParams = public_key:pem_entry_decode(Entry1),
<a name="452"/>  452:     true = check_entry_type(ECParams, 'EcpkParameters'),
<a name="453"/>  453:     ECPrivKey = public_key:pem_entry_decode(Entry2),
<a name="454"/>  454:     true = check_entry_type(ECPrivKey, 'ECPrivateKey'),
<a name="455"/>  455:     true = check_entry_type(ECPrivKey#'ECPrivateKey'.parameters, 'EcpkParameters'),
<a name="456"/>  456:     ECPemNoEndNewLines = strip_superfluous_newlines(ECPrivPem),
<a name="ec_pem2-last_expr"/><a name="457"/>  457: <b>    ECPemNoEndNewLines = strip_superfluous_newlines</b>(public_key:pem_encode([Entry1, Entry2])).
<a name="458"/>  458: 
<a name="ec_priv_pkcs8-0"/><a name="459"/>  459: <b>ec_priv_pkcs8</b>() -&gt;
<a name="ec_priv_pkcs8-last_expr"/><a name="460"/>  460:     [{doc, &quot;EC PKCS8 private key decode/encode&quot;}].
<a name="ec_priv_pkcs8-1"/><a name="461"/>  461: <b>ec_priv_pkcs8</b>(Config) when is_list(Config) -&gt;
<a name="462"/>  462:     Datadir = proplists:get_value(data_dir, Config),
<a name="463"/>  463:     {ok, ECPrivPem} = file:read_file(filename:join(Datadir, &quot;ec_key_pkcs8.pem&quot;)),
<a name="464"/>  464:     [{'PrivateKeyInfo', _, not_encrypted} = PKCS8Key] = public_key:pem_decode(ECPrivPem),
<a name="465"/>  465:     ECPrivKey = public_key:pem_entry_decode(PKCS8Key),
<a name="466"/>  466:     true = check_entry_type(ECPrivKey, 'ECPrivateKey'),
<a name="467"/>  467:     true = check_entry_type(ECPrivKey#'ECPrivateKey'.parameters, 'EcpkParameters'),
<a name="468"/>  468:     PrivEntry0 = public_key:pem_entry_encode('PrivateKeyInfo', ECPrivKey),
<a name="469"/>  469:     ECPemNoEndNewLines = strip_superfluous_newlines(ECPrivPem),
<a name="ec_priv_pkcs8-last_expr"/><a name="470"/>  470: <b>    ECPemNoEndNewLines = strip_superfluous_newlines</b>(public_key:pem_encode([PrivEntry0])).
<a name="471"/>  471: 
<a name="eddsa_priv_pkcs8-0"/><a name="472"/>  472: <b>eddsa_priv_pkcs8</b>() -&gt;
<a name="eddsa_priv_pkcs8-last_expr"/><a name="473"/>  473:     [{doc, &quot;EDDSA PKCS8 private key decode/encode&quot;}].
<a name="eddsa_priv_pkcs8-1"/><a name="474"/>  474: <b>eddsa_priv_pkcs8</b>(Config) when is_list(Config) -&gt;
<a name="475"/>  475:     Datadir = proplists:get_value(data_dir, Config),
<a name="476"/>  476:     {ok, ECPrivPem} = file:read_file(filename:join(Datadir, &quot;eddsa_key_pkcs8.pem&quot;)),
<a name="477"/>  477:     [{'PrivateKeyInfo', _, not_encrypted} = PKCS8Key] = public_key:pem_decode(ECPrivPem),
<a name="478"/>  478:     ECPrivKey = public_key:pem_entry_decode(PKCS8Key),
<a name="479"/>  479:     true = check_entry_type(ECPrivKey, 'ECPrivateKey'),
<a name="480"/>  480:     true = ECPrivKey#'ECPrivateKey'.parameters == {namedCurve, ?'id-Ed25519'},
<a name="481"/>  481:     true = size(ECPrivKey#'ECPrivateKey'.privateKey) == 32,
<a name="482"/>  482:     PrivEntry0 = public_key:pem_entry_encode('PrivateKeyInfo', ECPrivKey),
<a name="483"/>  483:     ECPemNoEndNewLines = strip_superfluous_newlines(ECPrivPem),
<a name="eddsa_priv_pkcs8-last_expr"/><a name="484"/>  484: <b>    ECPemNoEndNewLines = strip_superfluous_newlines</b>(public_key:pem_encode([PrivEntry0])).
<a name="485"/>  485: 
<a name="eddsa_priv_rfc5958-0"/><a name="486"/>  486: <b>eddsa_priv_rfc5958</b>() -&gt;
<a name="eddsa_priv_rfc5958-last_expr"/><a name="487"/>  487:     [{doc, &quot;EDDSA PKCS8 private key decode/encode&quot;}].
<a name="eddsa_priv_rfc5958-1"/><a name="488"/>  488: <b>eddsa_priv_rfc5958</b>(Config) when is_list(Config) -&gt;
<a name="489"/>  489:     Datadir = proplists:get_value(data_dir, Config),
<a name="490"/>  490:     {ok, ECPrivPem} = file:read_file(filename:join(Datadir, &quot;eddsa_key_rfc5958.pem&quot;)),
<a name="491"/>  491:     [{'PrivateKeyInfo', _, not_encrypted} = PKCS8Key] = public_key:pem_decode(ECPrivPem),
<a name="492"/>  492:     ECPrivKey = public_key:pem_entry_decode(PKCS8Key),
<a name="493"/>  493:     true = check_entry_type(ECPrivKey, 'ECPrivateKey'),
<a name="494"/>  494:     true = ECPrivKey#'ECPrivateKey'.parameters == {namedCurve, ?'id-Ed25519'},
<a name="495"/>  495:     true = size(ECPrivKey#'ECPrivateKey'.privateKey) == 32,
<a name="496"/>  496:     PrivEntry0 = public_key:pem_entry_encode('OneAsymmetricKey', ECPrivKey),
<a name="497"/>  497:     ECPemNoEndNewLines = strip_superfluous_newlines(ECPrivPem),
<a name="eddsa_priv_rfc5958-last_expr"/><a name="498"/>  498: <b>    ECPemNoEndNewLines = strip_superfluous_newlines</b>(public_key:pem_encode([PrivEntry0])).
<a name="499"/>  499: 
<a name="eddsa_pub-0"/><a name="500"/>  500: <b>eddsa_pub</b>() -&gt;
<a name="eddsa_pub-last_expr"/><a name="501"/>  501:     [{doc, &quot;EDDSA PKCS8 public key decode/encode&quot;}].
<a name="eddsa_pub-1"/><a name="502"/>  502: <b>eddsa_pub</b>(Config) when is_list(Config) -&gt;
<a name="503"/>  503:     Datadir = proplists:get_value(data_dir, Config),
<a name="504"/>  504:     {ok, EDDSAPubPem} = file:read_file(filename:join(Datadir, &quot;public_eddsa.pem&quot;)),
<a name="505"/>  505:     [{'SubjectPublicKeyInfo', _, not_encrypted} = Key] = PemEntry =
<a name="506"/>  506:         public_key:pem_decode(EDDSAPubPem),
<a name="507"/>  507:     EDDSAPubKey = public_key:pem_entry_decode(PemEntry),
<a name="508"/>  508:     true = check_entry_type(EDDSAPubKey, 'ECPoint'),
<a name="509"/>  509:     {_, {namedCurve, ?'id-Ed25519'}} = EDDSAPubKey,
<a name="510"/>  510:     PrivEntry0 = public_key:pem_entry_encode('SubjectPublicKeyInfo', EDDSAPubKey),
<a name="511"/>  511:     ECPemNoEndNewLines = strip_superfluous_newlines(EDDSAPubPem),
<a name="eddsa_pub-last_expr"/><a name="512"/>  512: <b>    ECPemNoEndNewLines = strip_superfluous_newlines</b>(public_key:pem_encode([PemEntry])).
<a name="513"/>  513: 
<a name="eddsa_sign_verify_24_compat-1"/><a name="514"/>  514: <b>eddsa_sign_verify_24_compat</b>(_Config) -&gt;
<a name="515"/>  515:     Key =
<a name="516"/>  516:         {'ECPrivateKey',1,
<a name="517"/>  517:          &lt;&lt;15,192,10,239,169,93,9,105,143,13,221,71,191,255,201,
<a name="518"/>  518:            60,8,80,43,234,82,68,151,219,233,144,174,41,227,241,
<a name="519"/>  519:            229,232&gt;&gt;,
<a name="520"/>  520:          {namedCurve,{1,3,101,112}},
<a name="521"/>  521:          &lt;&lt;209,208,142,135,125,251,57,203,2,49,232,74,238,214,170,
<a name="522"/>  522:            181,23,107,221,39,187,225,106,19,34,133,117,198,138,
<a name="523"/>  523:            180,16,70&gt;&gt;,
<a name="524"/>  524:          asn1_NOVALUE},
<a name="525"/>  525:     Body =
<a name="526"/>  526:         &lt;&lt;83,83,72,83,73,71,0,0,0,4,116,101,120,116,0,0,0,0,0,0,0,6,115,104,97,
<a name="527"/>  527:           53,49,50,0,0,0,64,119,199,206,154,93,134,187,56,109,68,59,185,99,144,
<a name="528"/>  528:           250,161,32,99,49,88,105,156,136,68,195,11,19,171,11,249,39,96,183,228,
<a name="529"/>  529:           65,106,234,57,125,185,27,74,192,229,221,86,184,239,126,75,6,97,98,171,
<a name="530"/>  530:           31,220,8,131,25,206,109,239,200,118&gt;&gt;,
<a name="531"/>  531:     ExpectedSignature =
<a name="532"/>  532:         &lt;&lt;203,148,171,54,165,4,216,251,189,124,35,227,88,183,187,225,142,10,132,163,98,
<a name="533"/>  533:           48,167,195,67,12,49,148,85,146,41,14,58,0,198,68,103,114,90,61,31,38,200,198,
<a name="534"/>  534:           64,179,135,138,31,172,236,105,0,71,50,195,168,247,216,110,210,61,159,5&gt;&gt;,
<a name="eddsa_sign_verify_24_compat-last_expr"/><a name="535"/>  535: <b>    lists:foreach</b>(
<a name="536"/>  536:       fun(Sha) -&gt;
<a name="537"/>  537:               ct:log(&quot;Try Sha = ~p&quot;, [Sha]),
<a name="538"/>  538:               try
<a name="539"/>  539:                   case public_key:sign(Body, Sha, Key) of
<a name="540"/>  540:                       ExpectedSignature -&gt;
<a name="541"/>  541:                           ct:log(&quot;sign Sha ~p ok&quot;, [Sha]),
<a name="542"/>  542:                           ExpectedSignature;
<a name="543"/>  543:                       Others -&gt;
<a name="544"/>  544:                           ct:log(&quot;Sha: ~p~nGot:    ~p~nExpect: ~p&quot;, [Sha,Others,ExpectedSignature]),
<a name="545"/>  545:                           ct:fail(&quot;Bad sign result&quot;)
<a name="546"/>  546:                   end
<a name="547"/>  547:               of
<a name="548"/>  548:                   Sig -&gt;
<a name="549"/>  549:                       try
<a name="550"/>  550:                           case public_key:verify(Body, Sha, Sig, Key) of
<a name="551"/>  551:                               true -&gt;
<a name="552"/>  552:                                   ct:log(&quot;verify Sha ~p ok&quot;, [Sha]);
<a name="553"/>  553:                               false -&gt;
<a name="554"/>  554:                                   ct:fail(&quot;Bad verify result for ~p&quot;,[Sha])
<a name="555"/>  555:                           end
<a name="556"/>  556:                       catch
<a name="557"/>  557:                           C:E -&gt;
<a name="558"/>  558:                               ct:log(&quot;Verify: ~p:~p  Sha = ~p&quot;, [C,E,Sha]),
<a name="559"/>  559:                               ct:fail(&quot;Bad verify&quot;,[])
<a name="560"/>  560:                       end
<a name="561"/>  561:               catch
<a name="562"/>  562:                   C:E -&gt;
<a name="563"/>  563:                       ct:log(&quot;Sign: ~p:~p  Sha = ~p&quot;, [C,E,Sha]),
<a name="564"/>  564:                       ct:fail(&quot;Bad sign&quot;,[])
<a name="565"/>  565:               end
<a name="566"/>  566:       end, [undefined, none | crypto:supports(hashs)]).
<a name="567"/>  567: 
<a name="568"/>  568: 
<a name="init_ec_pem_encode_generated-1"/><a name="569"/>  569: <b>init_ec_pem_encode_generated</b>(Config) -&gt;
<a name="init_ec_pem_encode_generated-last_expr"/><a name="570"/>  570: <b>    case catch true = lists:member</b>('secp384r1', crypto:ec_curves()) of
<a name="571"/>  571:         {'EXIT', _} -&gt; {skip, {'secp384r1', not_supported}};
<a name="572"/>  572:         _           -&gt; init_common_per_testcase(Config)
<a name="573"/>  573:     end.
<a name="574"/>  574: 
<a name="ec_pem_encode_generated-0"/><a name="575"/>  575: <b>ec_pem_encode_generated</b>() -&gt;
<a name="ec_pem_encode_generated-last_expr"/><a name="576"/>  576:     [{doc, &quot;PEM-encode generated EC key&quot;}].
<a name="ec_pem_encode_generated-1"/><a name="577"/>  577: <b>ec_pem_encode_generated</b>(_Config) -&gt;
<a name="578"/>  578: 
<a name="579"/>  579:     Key1 = public_key:generate_key({namedCurve, 'secp384r1'}),
<a name="580"/>  580:     public_key:pem_entry_encode('ECPrivateKey', Key1),
<a name="581"/>  581: 
<a name="582"/>  582:     Key2 = public_key:generate_key({namedCurve, ?'secp384r1'}),
<a name="ec_pem_encode_generated-last_expr"/><a name="583"/>  583: <b>    public_key:pem_entry_encode</b>('ECPrivateKey', Key2).
<a name="584"/>  584: 
<a name="585"/>  585: 
<a name="586"/>  586: <i>%%--------------------------------------------------------------------</i>
<a name="587"/>  587: 
<a name="encrypted_pem_pwdstring-0"/><a name="588"/>  588: <b>encrypted_pem_pwdstring</b>() -&gt;
<a name="encrypted_pem_pwdstring-last_expr"/><a name="589"/>  589:     [{doc, &quot;Encrypted PEM-file decode/encode with password string used&quot;}].
<a name="encrypted_pem_pwdstring-1"/><a name="590"/>  590: <b>encrypted_pem_pwdstring</b>(Config) when is_list(Config) -&gt;
<a name="encrypted_pem_pwdstring-last_expr"/><a name="591"/>  591: <b>    encrypted_pem</b>(Config, ?PASSWORD1, ?PASSWORD2).
<a name="592"/>  592: 
<a name="encrypted_pem_pwdfun-0"/><a name="593"/>  593: <b>encrypted_pem_pwdfun</b>() -&gt;
<a name="encrypted_pem_pwdfun-last_expr"/><a name="594"/>  594:     [{doc, &quot;Encrypted PEM-file decode/encode with password fun used&quot;}].
<a name="encrypted_pem_pwdfun-1"/><a name="595"/>  595: <b>encrypted_pem_pwdfun</b>(Config) when is_list(Config) -&gt;
<a name="encrypted_pem_pwdfun-last_expr"/><a name="596"/>  596: <b>    encrypted_pem</b>(Config, fun() -&gt; ?PASSWORD1 end, fun() -&gt; ?PASSWORD2 end).
<a name="597"/>  597: 
<a name="encrypted_pem-3"/><a name="598"/>  598: <b>encrypted_pem</b>(Config, Password1, Password2) -&gt;
<a name="599"/>  599:     Datadir = proplists:get_value(data_dir, Config),
<a name="600"/>  600:     [{'RSAPrivateKey', DerRSAKey, not_encrypted}] =
<a name="601"/>  601:         erl_make_certs:pem_to_der(filename:join(Datadir, &quot;client_key.pem&quot;)),
<a name="602"/>  602:     RSAKey = public_key:der_decode('RSAPrivateKey', DerRSAKey),
<a name="603"/>  603:     SupportedCiphers = crypto:supports(ciphers),
<a name="604"/>  604:     SupportedECB = lists:member(des_ecb, SupportedCiphers),
<a name="605"/>  605:     SupportedDES = lists:member(des_cbc, SupportedCiphers),
<a name="606"/>  606:     case SupportedECB of
<a name="607"/>  607:         true -&gt;
<a name="608"/>  608:             encrypted_pem_des_ede(Datadir, RSAKey, Password1);
<a name="609"/>  609:         false -&gt;
<a name="610"/>  610:             ct:comment(&quot;DES-EDE3-CBC not supported&quot;)
<a name="611"/>  611:     end,
<a name="encrypted_pem-last_expr"/><a name="612"/>  612:     case SupportedDES of
<a name="613"/>  613:         true -&gt;
<a name="614"/>  614:             encrypted_pem_des_cbc(Datadir, RSAKey, Password2);
<a name="615"/>  615:         false -&gt;
<a name="616"/>  616:             ct:comment(&quot;DES-CBC not supported&quot;)
<a name="617"/>  617:     end.
<a name="encrypted_pem_des_ede-3"/><a name="618"/>  618: <b>encrypted_pem_des_ede</b>(Datadir, RSAKey, Password) -&gt;
<a name="619"/>  619:     Salt = crypto:strong_rand_bytes(8),
<a name="620"/>  620:     Entry = public_key:pem_entry_encode('RSAPrivateKey', RSAKey,
<a name="621"/>  621:                                         {{&quot;DES-EDE3-CBC&quot;, Salt}, ?PASSWORD1}),
<a name="622"/>  622:     RSAKey = public_key:pem_entry_decode(Entry, Password),
<a name="623"/>  623:     Des3KeyFile = filename:join(Datadir, &quot;des3_client_key.pem&quot;),
<a name="624"/>  624:     erl_make_certs:der_to_pem(Des3KeyFile, [Entry]),
<a name="encrypted_pem_des_ede-last_expr"/><a name="625"/>  625:     [{'RSAPrivateKey', _, {&quot;DES-EDE3-CBC&quot;, Salt}}] =
<a name="626"/>  626:         erl_make_certs:pem_to_der(Des3KeyFile).
<a name="627"/>  627: 
<a name="encrypted_pem_des_cbc-3"/><a name="628"/>  628: <b>encrypted_pem_des_cbc</b>(Datadir, RSAKey, Password) -&gt;
<a name="629"/>  629:     Salt = crypto:strong_rand_bytes(8),
<a name="630"/>  630:     Entry = public_key:pem_entry_encode('RSAPrivateKey', RSAKey,
<a name="631"/>  631:                                         {{&quot;DES-CBC&quot;, Salt}, ?PASSWORD2}),
<a name="632"/>  632:     DesKeyFile = filename:join(Datadir, &quot;des_client_key.pem&quot;),
<a name="633"/>  633:     erl_make_certs:der_to_pem(DesKeyFile, [Entry]),
<a name="634"/>  634:     [{'RSAPrivateKey', _, {&quot;DES-CBC&quot;, Salt}} = Entry] =
<a name="635"/>  635:         erl_make_certs:pem_to_der(DesKeyFile),
<a name="636"/>  636:     {ok, Pem} = file:read_file(DesKeyFile),
<a name="637"/>  637:     check_encapsulated_header(Pem),
<a name="encrypted_pem_des_cbc-last_expr"/><a name="638"/>  638: <b>    true = check_entry_type</b>(public_key:pem_entry_decode(Entry, Password),
<a name="639"/>  639:                             'RSAPrivateKey').
<a name="640"/>  640: 
<a name="641"/>  641: <i>%%--------------------------------------------------------------------</i>
<a name="642"/>  642: 
<a name="dh_pem-0"/><a name="643"/>  643: <b>dh_pem</b>() -&gt;
<a name="dh_pem-last_expr"/><a name="644"/>  644:     [{doc, &quot;DH parametrs PEM-file decode/encode&quot;}].
<a name="dh_pem-1"/><a name="645"/>  645: <b>dh_pem</b>(Config) when is_list(Config) -&gt;
<a name="646"/>  646:     Datadir = proplists:get_value(data_dir, Config),
<a name="647"/>  647:     [{'DHParameter', _DerDH, not_encrypted} = Entry] =
<a name="648"/>  648: 	erl_make_certs:pem_to_der(filename:join(Datadir, &quot;dh.pem&quot;)),
<a name="dh_pem-last_expr"/><a name="649"/>  649: <b>    asn1_encode_decode</b>(Entry).
<a name="650"/>  650: 
<a name="651"/>  651: <i>%%--------------------------------------------------------------------</i>
<a name="652"/>  652: 
<a name="pkcs10_pem-0"/><a name="653"/>  653: <b>pkcs10_pem</b>() -&gt;
<a name="pkcs10_pem-last_expr"/><a name="654"/>  654:    [{doc, &quot;PKCS-10 PEM-file decode/encode&quot;}].
<a name="pkcs10_pem-1"/><a name="655"/>  655: <b>pkcs10_pem</b>(Config) when is_list(Config) -&gt;
<a name="656"/>  656:     Datadir = proplists:get_value(data_dir, Config),
<a name="657"/>  657:     [{'CertificationRequest', _DerPKCS10, not_encrypted} = Entry] =
<a name="658"/>  658: 	erl_make_certs:pem_to_der(filename:join(Datadir, &quot;req.pem&quot;)),
<a name="pkcs10_pem-last_expr"/><a name="659"/>  659: <b>    asn1_encode_decode</b>(Entry).
<a name="660"/>  660: <i>%%--------------------------------------------------------------------</i>
<a name="pkcs7_pem-0"/><a name="661"/>  661: <b>pkcs7_pem</b>() -&gt;
<a name="pkcs7_pem-last_expr"/><a name="662"/>  662:     [{doc, &quot;PKCS-7 PEM-file decode/encode&quot;}].
<a name="pkcs7_pem-1"/><a name="663"/>  663: <b>pkcs7_pem</b>(Config) when is_list(Config) -&gt;
<a name="664"/>  664:     Datadir = proplists:get_value(data_dir, Config),
<a name="665"/>  665:     [{'ContentInfo', _, not_encrypted} = Entry0] =
<a name="666"/>  666: 	erl_make_certs:pem_to_der(filename:join(Datadir, &quot;pkcs7_cert.pem&quot;)),
<a name="667"/>  667:     [{'ContentInfo', _, not_encrypted} = Entry1] =
<a name="668"/>  668: 	erl_make_certs:pem_to_der(filename:join(Datadir, &quot;pkcs7_ext.pem&quot;)),
<a name="669"/>  669:     asn1_encode_decode(Entry0),
<a name="pkcs7_pem-last_expr"/><a name="670"/>  670: <b>    asn1_encode_decode</b>(Entry1).
<a name="671"/>  671:       
<a name="672"/>  672: <i>%%--------------------------------------------------------------------</i>
<a name="cert_pem-0"/><a name="673"/>  673: <b>cert_pem</b>() -&gt;
<a name="cert_pem-last_expr"/><a name="674"/>  674:     [{doc, &quot;Certificate PEM-file decode/encode&quot;}].
<a name="cert_pem-1"/><a name="675"/>  675: <b>cert_pem</b>(Config) when is_list(Config) -&gt;
<a name="676"/>  676:     Datadir = proplists:get_value(data_dir, Config),
<a name="677"/>  677:    
<a name="678"/>  678:     [{'Certificate', _, not_encrypted} = Entry0] =  
<a name="679"/>  679: 	erl_make_certs:pem_to_der(filename:join(Datadir, &quot;client_cert.pem&quot;)),
<a name="680"/>  680:     
<a name="681"/>  681:     asn1_encode_decode(Entry0),
<a name="682"/>  682:     
<a name="683"/>  683:     [{'Certificate', _, not_encrypted} = Entry1, 
<a name="684"/>  684:      {'Certificate', _, not_encrypted} = Entry2] = 
<a name="685"/>  685:         erl_make_certs:pem_to_der(filename:join(Datadir, &quot;cacerts.pem&quot;)),
<a name="686"/>  686:     
<a name="687"/>  687:     asn1_encode_decode(Entry1),
<a name="cert_pem-last_expr"/><a name="688"/>  688: <b>    asn1_encode_decode</b>(Entry2).
<a name="689"/>  689: 
<a name="690"/>  690: <i>%%--------------------------------------------------------------------</i>
<a name="encrypt_decrypt-0"/><a name="691"/>  691: <b>encrypt_decrypt</b>() -&gt;
<a name="encrypt_decrypt-last_expr"/><a name="692"/>  692:     [{doc, &quot;Test public_key:encrypt_private and public_key:decrypt_public&quot;}].
<a name="encrypt_decrypt-1"/><a name="693"/>  693: <b>encrypt_decrypt</b>(Config) when is_list(Config) -&gt; 
<a name="694"/>  694:     {PrivateKey, _DerKey} = erl_make_certs:gen_rsa(64),
<a name="695"/>  695:     #'RSAPrivateKey'{modulus=Mod, publicExponent=Exp} = PrivateKey,
<a name="696"/>  696:     PublicKey = #'RSAPublicKey'{modulus=Mod, publicExponent=Exp},
<a name="697"/>  697:     Msg = list_to_binary(lists:duplicate(5, &quot;Foo bar 100&quot;)),
<a name="698"/>  698:     RsaEncrypted = public_key:encrypt_private(Msg, PrivateKey),
<a name="699"/>  699:     Msg = public_key:decrypt_public(RsaEncrypted, PublicKey),
<a name="700"/>  700:     RsaEncrypted2 = public_key:encrypt_public(Msg, PublicKey),
<a name="701"/>  701:     Msg = public_key:decrypt_private(RsaEncrypted2, PrivateKey),
<a name="encrypt_decrypt-last_expr"/><a name="702"/>  702:     ok.
<a name="703"/>  703: 
<a name="704"/>  704: <i>%%--------------------------------------------------------------------</i>
<a name="encrypt_decrypt_sign_fun-0"/><a name="705"/>  705: <b>encrypt_decrypt_sign_fun</b>() -&gt;
<a name="encrypt_decrypt_sign_fun-last_expr"/><a name="706"/>  706:     [{doc, &quot;Test public_key:encrypt_private with user provided sign_fun&quot;}].
<a name="encrypt_decrypt_sign_fun-1"/><a name="707"/>  707: <b>encrypt_decrypt_sign_fun</b>(Config) when is_list(Config) -&gt;
<a name="708"/>  708:     {PrivateKey, _DerKey} = erl_make_certs:gen_rsa(64),
<a name="709"/>  709:     #'RSAPrivateKey'{modulus=Mod, publicExponent=Exp} = PrivateKey,
<a name="710"/>  710:     EncryptFun = fun (PlainText, Options) -&gt;
<a name="711"/>  711:             public_key:encrypt_private(PlainText, PrivateKey, Options)
<a name="712"/>  712:         end,
<a name="713"/>  713:     CustomPrivKey = #{encrypt_fun =&gt; EncryptFun},
<a name="714"/>  714:     PublicKey = #'RSAPublicKey'{modulus=Mod, publicExponent=Exp},
<a name="715"/>  715:     Msg = list_to_binary(lists:duplicate(5, &quot;Foo bar 100&quot;)),
<a name="716"/>  716:     RsaEncrypted = public_key:encrypt_private(Msg, CustomPrivKey),
<a name="717"/>  717:     Msg = public_key:decrypt_public(RsaEncrypted, PublicKey),
<a name="encrypt_decrypt_sign_fun-last_expr"/><a name="718"/>  718:     ok.
<a name="719"/>  719:        
<a name="720"/>  720: <i>%%--------------------------------------------------------------------</i>
<a name="rsa_sign_verify-0"/><a name="721"/>  721: <b>rsa_sign_verify</b>() -&gt;
<a name="rsa_sign_verify-last_expr"/><a name="722"/>  722:     [{doc, &quot;Checks that we can sign and verify rsa signatures.&quot;}].
<a name="rsa_sign_verify-1"/><a name="723"/>  723: <b>rsa_sign_verify</b>(Config) when is_list(Config) -&gt;
<a name="724"/>  724:     Ca = {_, CaKey} = erl_make_certs:make_cert([]),
<a name="725"/>  725:     {Cert1, _} = erl_make_certs:make_cert([{key, dsa}, {issuer, Ca}]),
<a name="726"/>  726:     PrivateRSA = #'RSAPrivateKey'{modulus=Mod, publicExponent=Exp} = 
<a name="727"/>  727: 	public_key:pem_entry_decode(CaKey),
<a name="728"/>  728:     PublicRSA = #'RSAPublicKey'{modulus=Mod, publicExponent=Exp},
<a name="729"/>  729:     true = public_key:pkix_verify(Cert1, PublicRSA),
<a name="730"/>  730: 
<a name="731"/>  731:     Msg = list_to_binary(lists:duplicate(5, &quot;Foo bar 100&quot;)),
<a name="732"/>  732:     RSASign = public_key:sign(Msg, sha, PrivateRSA),
<a name="733"/>  733:     true = public_key:verify(Msg, sha, RSASign, PublicRSA), 
<a name="734"/>  734:     false = public_key:verify(&lt;&lt;1:8, Msg/binary&gt;&gt;, sha, RSASign, PublicRSA), 
<a name="735"/>  735:     false = public_key:verify(Msg, sha, &lt;&lt;1:8, RSASign/binary&gt;&gt;, PublicRSA), 
<a name="736"/>  736: 
<a name="737"/>  737:     RSASign1 = public_key:sign(Msg, md5, PrivateRSA),
<a name="rsa_sign_verify-last_expr"/><a name="738"/>  738: <b>    true = public_key:verify</b>(Msg, md5, RSASign1, PublicRSA).
<a name="739"/>  739:     
<a name="740"/>  740: <i>%%--------------------------------------------------------------------</i>
<a name="rsa_pss_sign_verify-0"/><a name="741"/>  741: <b>rsa_pss_sign_verify</b>() -&gt;
<a name="rsa_pss_sign_verify-last_expr"/><a name="742"/>  742:     [{doc, &quot;Checks that we can sign and verify rsa pss signatures.&quot;}].
<a name="rsa_pss_sign_verify-1"/><a name="743"/>  743: <b>rsa_pss_sign_verify</b>(Config) when is_list(Config) -&gt;
<a name="744"/>  744:     CertChainConf  = #{server_chain =&gt; 
<a name="745"/>  745:                            #{root =&gt; [],
<a name="746"/>  746:                              intermediates =&gt; [],
<a name="747"/>  747:                              peer =&gt; []},
<a name="748"/>  748:                        client_chain =&gt; 
<a name="749"/>  749:                            #{root =&gt; [{key, {hardcode_rsa_key(1), pss_params(sha256)}}],
<a name="750"/>  750:                              intermediates =&gt; [],
<a name="751"/>  751:                              peer =&gt; []}},
<a name="752"/>  752:     #{client_config := ClientConf} = public_key:pkix_test_data(CertChainConf),
<a name="753"/>  753:     Cert = proplists:get_value(cert, ClientConf),
<a name="754"/>  754:     {#'RSAPrivateKey'{modulus=Mod, publicExponent=Exp}, Parms} = {hardcode_rsa_key(1), pss_params(sha256)},
<a name="755"/>  755:            
<a name="rsa_pss_sign_verify-last_expr"/><a name="756"/>  756: <b>    true = public_key:pkix_verify</b>(Cert, {#'RSAPublicKey'{modulus=Mod, publicExponent=Exp}, Parms}).
<a name="757"/>  757:     
<a name="758"/>  758: <i>%%--------------------------------------------------------------------</i>
<a name="759"/>  759: 
<a name="dsa_sign_verify-0"/><a name="760"/>  760: <b>dsa_sign_verify</b>() -&gt;
<a name="dsa_sign_verify-last_expr"/><a name="761"/>  761:     [{doc, &quot;Checks that we can sign and verify dsa signatures.&quot;}].
<a name="dsa_sign_verify-1"/><a name="762"/>  762: <b>dsa_sign_verify</b>(Config) when is_list(Config) -&gt;
<a name="763"/>  763:     Ca = erl_make_certs:make_cert([]),
<a name="764"/>  764:     CertInfo = {_,CertKey1} = erl_make_certs:make_cert([{key, dsa}, {issuer, Ca}]),
<a name="765"/>  765:     {Cert2,_CertKey} = erl_make_certs:make_cert([{issuer, CertInfo}]),
<a name="766"/>  766: 
<a name="767"/>  767:     #'DSAPrivateKey'{p=P, q=Q, g=G, y=Y, x=_X} =
<a name="768"/>  768: 	public_key:pem_entry_decode(CertKey1),
<a name="769"/>  769:     true = public_key:pkix_verify(Cert2, {Y, #'Dss-Parms'{p=P, q=Q, g=G}}),
<a name="770"/>  770: 
<a name="771"/>  771:     Datadir = proplists:get_value(data_dir, Config),
<a name="772"/>  772:     [DsaKey = {'DSAPrivateKey', _, _}] = 
<a name="773"/>  773: 	erl_make_certs:pem_to_der(filename:join(Datadir, &quot;dsa.pem&quot;)), 
<a name="774"/>  774:     DSAPrivateKey = public_key:pem_entry_decode(DsaKey),
<a name="775"/>  775:     #'DSAPrivateKey'{p=P1, q=Q1, g=G1, y=Y1, x=_X1} = DSAPrivateKey,
<a name="776"/>  776: 
<a name="777"/>  777:     Msg = list_to_binary(lists:duplicate(5, &quot;Foo bar 100&quot;)),
<a name="778"/>  778:     DSASign = public_key:sign(Msg, sha, DSAPrivateKey),
<a name="779"/>  779:     DSAPublicKey = Y1,
<a name="780"/>  780:     DSAParams = #'Dss-Parms'{p=P1, q=Q1, g=G1},
<a name="781"/>  781:     true = public_key:verify(Msg, sha, DSASign, {DSAPublicKey, DSAParams}), 
<a name="782"/>  782:     false = public_key:verify(&lt;&lt;1:8, Msg/binary&gt;&gt;, sha, DSASign, 
<a name="783"/>  783: 			      {DSAPublicKey, DSAParams}), 
<a name="784"/>  784:     false = public_key:verify(Msg, sha, &lt;&lt;1:8, DSASign/binary&gt;&gt;, 
<a name="785"/>  785: 			      {DSAPublicKey, DSAParams}), 
<a name="786"/>  786:     
<a name="787"/>  787:     Digest = crypto:hash(sha,Msg),
<a name="788"/>  788:     DigestSign = public_key:sign(Digest, none, DSAPrivateKey),
<a name="789"/>  789:     true = public_key:verify(Digest, none, DigestSign, {DSAPublicKey, DSAParams}), 
<a name="790"/>  790:     &lt;&lt;_:8, RestDigest/binary&gt;&gt; = Digest,
<a name="791"/>  791:     false = public_key:verify(&lt;&lt;1:8, RestDigest/binary&gt;&gt;, none, DigestSign, 
<a name="792"/>  792: 			      {DSAPublicKey, DSAParams}), 
<a name="dsa_sign_verify-last_expr"/><a name="793"/>  793: <b>    false = public_key:verify</b>(Digest, none, &lt;&lt;1:8, DigestSign/binary&gt;&gt;, 
<a name="794"/>  794: 			      {DSAPublicKey, DSAParams}).
<a name="795"/>  795: <i>%%--------------------------------------------------------------------</i>
<a name="796"/>  796: 
<a name="custom_sign_fun_verify-0"/><a name="797"/>  797: <b>custom_sign_fun_verify</b>() -&gt;
<a name="custom_sign_fun_verify-last_expr"/><a name="798"/>  798:     [{doc, &quot;Checks that public_key:sign correctly calls the `sign_fun`&quot;}].
<a name="custom_sign_fun_verify-1"/><a name="799"/>  799: <b>custom_sign_fun_verify</b>(Config) when is_list(Config) -&gt;
<a name="800"/>  800:     {_, CaKey} = erl_make_certs:make_cert([{key, rsa}]),
<a name="801"/>  801:     PrivateRSA = public_key:pem_entry_decode(CaKey),
<a name="802"/>  802:     #'RSAPrivateKey'{modulus=Mod, publicExponent=Exp} = PrivateRSA,
<a name="803"/>  803:     PublicRSA = #'RSAPublicKey'{modulus=Mod, publicExponent=Exp},
<a name="804"/>  804:     SignFun = fun (Msg, HashAlgo, Options) -&gt;
<a name="805"/>  805:             public_key:sign(Msg, HashAlgo, PrivateRSA, Options)
<a name="806"/>  806:         end,
<a name="807"/>  807:     CustomKey = #{algorithm =&gt; rsa, sign_fun =&gt; SignFun},
<a name="808"/>  808: 
<a name="809"/>  809:     Msg = list_to_binary(lists:duplicate(5, &quot;Foo bar 100&quot;)),
<a name="810"/>  810:     RSASign = public_key:sign(Msg, sha, CustomKey),
<a name="811"/>  811:     true = public_key:verify(Msg, sha, RSASign, PublicRSA),
<a name="812"/>  812:     false = public_key:verify(&lt;&lt;1:8, Msg/binary&gt;&gt;, sha, RSASign, PublicRSA),
<a name="813"/>  813:     false = public_key:verify(Msg, sha, &lt;&lt;1:8, RSASign/binary&gt;&gt;, PublicRSA),
<a name="814"/>  814: 
<a name="815"/>  815:     RSASign1 = public_key:sign(Msg, md5, CustomKey),
<a name="custom_sign_fun_verify-last_expr"/><a name="816"/>  816: <b>    true = public_key:verify</b>(Msg, md5, RSASign1, PublicRSA).
<a name="817"/>  817: 
<a name="818"/>  818: <i>%%--------------------------------------------------------------------</i>
<a name="pkix-0"/><a name="819"/>  819: <b>pkix</b>() -&gt;
<a name="pkix-last_expr"/><a name="820"/>  820:     [{doc, &quot;Misc pkix tests not covered elsewhere&quot;}].
<a name="pkix-1"/><a name="821"/>  821: <b>pkix</b>(Config) when is_list(Config) -&gt;
<a name="822"/>  822:     Datadir = proplists:get_value(data_dir, Config),
<a name="823"/>  823:     Certs0 = erl_make_certs:pem_to_der(filename:join(Datadir, &quot;cacerts.pem&quot;)),
<a name="824"/>  824:     Certs1 = erl_make_certs:pem_to_der(filename:join(Datadir, &quot;client_cert.pem&quot;)),
<a name="825"/>  825:     TestTransform = fun({'Certificate', CertDer, not_encrypted}) -&gt;
<a name="826"/>  826: 			    PlainCert = public_key:pkix_decode_cert(CertDer, plain),
<a name="827"/>  827: 			    OtpCert = public_key:pkix_decode_cert(CertDer, otp),
<a name="828"/>  828: 			    CertDer = 
<a name="829"/>  829: 				public_key:pkix_encode('OTPCertificate', OtpCert, otp),
<a name="830"/>  830: 			    CertDer = 
<a name="831"/>  831: 				public_key:pkix_encode('Certificate', PlainCert, plain),
<a name="832"/>  832: 			    OTPTBS = OtpCert#'OTPCertificate'.tbsCertificate,
<a name="833"/>  833: 			    OTPSubj = OTPTBS#'OTPTBSCertificate'.subject, 
<a name="834"/>  834: 			    DNEncoded = public_key:pkix_encode('Name', OTPSubj, otp),
<a name="835"/>  835: 			    PlainTBS = PlainCert#'Certificate'.tbsCertificate,
<a name="836"/>  836: 			    Subj2 = PlainTBS#'TBSCertificate'.subject,
<a name="837"/>  837: 			    DNEncoded = public_key:pkix_encode('Name', Subj2, plain),
<a name="838"/>  838: 
<a name="839"/>  839: 			    false = public_key:pkix_is_fixed_dh_cert(CertDer)
<a name="840"/>  840: 		    end,
<a name="841"/>  841:     [TestTransform(Cert) || Cert &lt;- Certs0 ++ Certs1],
<a name="842"/>  842: 
<a name="843"/>  843:     Root = element(2, hd(Certs0)),
<a name="844"/>  844:     Peer = element(2, hd(Certs1)), 
<a name="845"/>  845: 
<a name="846"/>  846:     true = public_key:pkix_is_self_signed(Root),
<a name="847"/>  847:     false = public_key:pkix_is_self_signed(Peer),
<a name="848"/>  848: 
<a name="849"/>  849:     CaIds = [element(2, public_key:pkix_issuer_id(Cert, self)) || 
<a name="850"/>  850: 		{'Certificate', Cert, _} &lt;- Certs0],
<a name="851"/>  851:     {ok, IssuerId} = 
<a name="852"/>  852: 	public_key:pkix_issuer_id(Peer, other),
<a name="853"/>  853:     
<a name="854"/>  854:     {ok, Id} = public_key:pkix_issuer_id(Root, self),
<a name="855"/>  855:     Id = public_key:pkix_subject_id(Root),
<a name="856"/>  856: 
<a name="857"/>  857:     true = lists:member(IssuerId, CaIds),
<a name="858"/>  858: 
<a name="859"/>  859:     %% Should be normalized already
<a name="860"/>  860:     TestStr   = {rdnSequence, 
<a name="861"/>  861: 		 [[{'AttributeTypeAndValue', {2,5,4,3},{printableString,&quot;ERLANGCA&quot;}}],
<a name="862"/>  862: 		  [{'AttributeTypeAndValue', {2,5,4,3},{printableString,&quot; erlang  ca &quot;}}]]},
<a name="863"/>  863:     VerifyStr = {rdnSequence, 
<a name="864"/>  864: 		 [[{'AttributeTypeAndValue', {2,5,4,3},{printableString,&quot;erlangca&quot;}}],
<a name="865"/>  865: 		  [{'AttributeTypeAndValue', {2,5,4,3},{printableString,&quot;erlang ca&quot;}}]]},   
<a name="pkix-last_expr"/><a name="866"/>  866: <b>    VerifyStr = public_key:pkix_normalize_name</b>(TestStr).
<a name="867"/>  867:     
<a name="868"/>  868:   
<a name="869"/>  869: <i>%%--------------------------------------------------------------------</i>
<a name="pkix_countryname-0"/><a name="870"/>  870: <b>pkix_countryname</b>() -&gt;
<a name="pkix_countryname-last_expr"/><a name="871"/>  871:     [{doc, &quot;Test workaround for certs that code x509countryname as utf8&quot;}].
<a name="pkix_countryname-1"/><a name="872"/>  872: <b>pkix_countryname</b>(Config) when is_list(Config) -&gt;
<a name="873"/>  873:     Cert = incorrect_countryname_pkix_cert(),
<a name="874"/>  874:     OTPCert = public_key:pkix_decode_cert(Cert, otp),
<a name="875"/>  875:     TBSCert = OTPCert#'OTPCertificate'.tbsCertificate,
<a name="876"/>  876:     Issuer = TBSCert#'OTPTBSCertificate'.issuer,
<a name="877"/>  877:     Subj   = TBSCert#'OTPTBSCertificate'.subject,
<a name="878"/>  878:     check_countryname(Issuer),
<a name="pkix_countryname-last_expr"/><a name="879"/>  879: <b>    check_countryname</b>(Subj).
<a name="880"/>  880: 
<a name="881"/>  881: <i>%%--------------------------------------------------------------------</i>
<a name="pkix_emailaddress-0"/><a name="882"/>  882: <b>pkix_emailaddress</b>() -&gt;
<a name="pkix_emailaddress-last_expr"/><a name="883"/>  883:     [{doc, &quot;Test workaround for certs that code emailAddress as utf8&quot;}].
<a name="pkix_emailaddress-1"/><a name="884"/>  884: <b>pkix_emailaddress</b>(Config) when is_list(Config) -&gt;
<a name="885"/>  885:     Cert = incorrect_emailaddress_pkix_cert(),
<a name="886"/>  886:     OTPCert = public_key:pkix_decode_cert(Cert, otp),
<a name="887"/>  887:     TBSCert = OTPCert#'OTPCertificate'.tbsCertificate,
<a name="888"/>  888:     Issuer = TBSCert#'OTPTBSCertificate'.issuer,
<a name="889"/>  889:     Subj   = TBSCert#'OTPTBSCertificate'.subject,
<a name="890"/>  890:     check_emailaddress(Issuer),
<a name="pkix_emailaddress-last_expr"/><a name="891"/>  891: <b>    check_emailaddress</b>(Subj).
<a name="892"/>  892: 
<a name="893"/>  893: 
<a name="894"/>  894: <i>%%--------------------------------------------------------------------</i>
<a name="pkix_decode_cert-0"/><a name="895"/>  895: <b>pkix_decode_cert</b>() -&gt;
<a name="pkix_decode_cert-last_expr"/><a name="896"/>  896:     [{doc, &quot;Test that extension IssuerDistributionPoint is not decoded in 'otp' decoding mode. We want to leave it for later &quot;
<a name="897"/>  897:       &quot;to increase interopability for sites that does not use this extension and will not care if it is properly encoded&quot;}].
<a name="pkix_decode_cert-1"/><a name="898"/>  898: <b>pkix_decode_cert</b>(Config) when is_list(Config) -&gt;
<a name="899"/>  899:     Der = base64:decode(
<a name="900"/>  900:             &lt;&lt;&quot;MIICXDCCAgKgAwIBAgIBATAKBggqhkjOPQQDAjApMRkwFwYDVQQFExBjOTY4NDI4OTMyNzUwOGRiMQwwCgYDVQQMDANURUUwHhcNMjIxMDI5MTczMTA3WhcNMjkwNDE2MjAzNDUzWjAfMR0wGwYDVQQDExRBbmRyb2lkIEtleXN0b3JlIEtleTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABFmIQDus/jIZ0cPnRCITCzUUuCjQBw8MetO6154mmTL8O/fFlGgYkZ6C8jSSntKC/lMwaZHxAgW1AGgoCrPuX5ejggEjMIIBHzALBgNVHQ8EBAMCB4AwCAYDVR0fBAEAMIIBBAYKKwYBBAHWeQIBEQSB9TCB8gIBAgoBAQIBAwoBAQQgyvsSa116xqleaXs6xA84wqpAPWFgaaTjCWBnZpHslmoEADBEv4VFQAQ+MDwxFjAUBAxjb20ud2hhdHNhcHACBA0+oAQxIgQgOYfQQ9EK769ahxCzZxQY/lfg4ZtlPJ34JVj+tf/OXUQweqEFMQMCAQKiAwIBA6MEAgIBAKUIMQYCAQYCAQSqAwIBAb+DdwIFAL+FPQgCBgGEJMweob+FPgMCAQC/hUAqMCgEIFNB5rJkaXmnDldlMAeh8xAWlCHsm92fGlZI91reAFrxAQH/CgEAv4VBBQIDAV+Qv4VCBQIDAxUYMAoGCCqGSM49BAMCA0gAMEUCIF0BwvRQipVoaz5SIhsYbIeK+FHbAjWPgOxWgQ6Juq64AiEA83ZLsK37DjZ/tZNRi271VHQqIU8mdqUIMboVUiy3DaM=&quot;&gt;&gt;),
<a name="901"/>  901: 
<a name="pkix_decode_cert-last_expr"/><a name="902"/>  902: <b>    #'OTPCertificate'{} = public_key:pkix_decode_cert</b>(Der, otp).
<a name="903"/>  903: 
<a name="904"/>  904: <i>%%--------------------------------------------------------------------</i>
<a name="pkix_path_validation-0"/><a name="905"/>  905: <b>pkix_path_validation</b>() -&gt;
<a name="pkix_path_validation-last_expr"/><a name="906"/>  906:     [{doc, &quot;Test PKIX path validation&quot;}].
<a name="pkix_path_validation-1"/><a name="907"/>  907: <b>pkix_path_validation</b>(Config) when is_list(Config) -&gt;
<a name="908"/>  908:     CaK = {Trusted,_} = 
<a name="909"/>  909: 	erl_make_certs:make_cert([{key, dsa},
<a name="910"/>  910: 			     {subject, [
<a name="911"/>  911: 					{name, &quot;Public Key&quot;},
<a name="912"/>  912: 					{?'id-at-name', {printableString, &quot;public_key&quot;}},
<a name="913"/>  913: 					{?'id-at-pseudonym', {printableString, &quot;pubkey&quot;}},
<a name="914"/>  914: 					{city, &quot;Stockholm&quot;},
<a name="915"/>  915: 					{country, &quot;SE&quot;},
<a name="916"/>  916: 					{org, &quot;erlang&quot;},
<a name="917"/>  917: 					{org_unit, &quot;testing dep&quot;}
<a name="918"/>  918: 				       ]}
<a name="919"/>  919: 			    ]),
<a name="920"/>  920:     ok = erl_make_certs:write_pem(&quot;./&quot;, &quot;public_key_cacert&quot;, CaK),
<a name="921"/>  921: 
<a name="922"/>  922:     CertK1 = {Cert1, _} = erl_make_certs:make_cert([{issuer, CaK}]),
<a name="923"/>  923:     CertK2 = {Cert2,_} = erl_make_certs:make_cert([{issuer, CertK1}, 
<a name="924"/>  924: 					      {digest, md5}, {extensions, false}]),
<a name="925"/>  925:     ok = erl_make_certs:write_pem(&quot;./&quot;, &quot;public_key_cert&quot;, CertK2),
<a name="926"/>  926:     
<a name="927"/>  927:     {ok, _} = public_key:pkix_path_validation(Trusted, [Cert1], []),
<a name="928"/>  928:     
<a name="929"/>  929:     {error, {bad_cert,invalid_issuer}} = 
<a name="930"/>  930: 	public_key:pkix_path_validation(Trusted, [Cert2], []),
<a name="931"/>  931:    
<a name="932"/>  932:     {ok, _} = public_key:pkix_path_validation(Trusted, [Cert1, Cert2], []),    
<a name="933"/>  933: 
<a name="934"/>  934:     {error, {bad_cert, duplicate_cert_in_path}} =
<a name="935"/>  935: 	public_key:pkix_path_validation(Trusted, [Cert1, Cert1, Cert2], []),
<a name="936"/>  936: 
<a name="937"/>  937:     {error, issuer_not_found} = public_key:pkix_issuer_id(Cert2, other),
<a name="938"/>  938: 
<a name="939"/>  939:     CertK3 = {Cert3,_}  = erl_make_certs:make_cert([{issuer, CertK1}, 
<a name="940"/>  940: 					       {extensions, [{basic_constraints, false}]}]),
<a name="941"/>  941:     {Cert4,_}  = erl_make_certs:make_cert([{issuer, CertK3}, {extensions, [{key_usage, undefined}]}]),
<a name="942"/>  942: 
<a name="943"/>  943:     {error, {bad_cert,missing_basic_constraint}} =
<a name="944"/>  944: 	public_key:pkix_path_validation(Trusted, [Cert1, Cert3,Cert4], []),
<a name="945"/>  945: 
<a name="946"/>  946:     VerifyFunAndState0  = {fun(#'OTPCertificate'{},{bad_cert, missing_basic_constraint}, UserState) -&gt;
<a name="947"/>  947: 				   {valid, UserState};
<a name="948"/>  948: 			      (#'OTPCertificate'{},{bad_cert, _} = Reason, _) -&gt;
<a name="949"/>  949: 				   {fail, Reason};
<a name="950"/>  950: 			      (#'OTPCertificate'{},{extension, _}, UserState) -&gt;
<a name="951"/>  951: 				   {unknown, UserState};
<a name="952"/>  952: 			      (#'OTPCertificate'{}, valid, UserState) -&gt;
<a name="953"/>  953: 				   {valid, UserState};
<a name="954"/>  954: 			      (#'OTPCertificate'{}, valid_peer, UserState) -&gt;
<a name="955"/>  955: 				   {valid, UserState}
<a name="956"/>  956: 			   end, []},
<a name="957"/>  957:     {ok, _} =
<a name="958"/>  958: 	public_key:pkix_path_validation(Trusted, [Cert1, Cert3,Cert4],
<a name="959"/>  959: 					[{verify_fun, VerifyFunAndState0}]),
<a name="960"/>  960: 
<a name="961"/>  961:     {error, {bad_cert, unknown_ca}} =
<a name="962"/>  962: 	public_key:pkix_path_validation(unknown_ca, [Cert1, Cert3, Cert4], []),
<a name="963"/>  963: 
<a name="964"/>  964:     %% Verify verify_fun/4
<a name="965"/>  965:     VerifyFunAndState1 =
<a name="966"/>  966: 	{fun(#'OTPCertificate'{}, Der, {bad_cert, unknown_ca}, UserState) when is_binary(Der) -&gt;
<a name="967"/>  967: 		 {valid, UserState};
<a name="968"/>  968: 	    (#'OTPCertificate'{}, Der, {bad_cert, _} = Reason, _) when is_binary(Der) -&gt;
<a name="969"/>  969: 		 {fail, Reason};
<a name="970"/>  970: 	    (#'OTPCertificate'{}, Der, {extension, _}, UserState) when is_binary(Der) -&gt;
<a name="971"/>  971: 		 {unknown, UserState};
<a name="972"/>  972: 	    (#'OTPCertificate'{}, Der, valid, UserState) when is_binary(Der) -&gt;
<a name="973"/>  973: 		 {valid, UserState}
<a name="974"/>  974: 	 end, []},
<a name="975"/>  975: 
<a name="976"/>  976:     {ok, _} =
<a name="977"/>  977: 	public_key:pkix_path_validation(unknown_ca, [Cert1], [{verify_fun,
<a name="978"/>  978: 							      VerifyFunAndState1}]),
<a name="979"/>  979: 
<a name="980"/>  980:     VerifyFunAndState2 =
<a name="981"/>  981:         {fun(_, {bad_cert, selfsigned_peer}, _UserState) -&gt;
<a name="982"/>  982:                   {fail, custom_reason};
<a name="983"/>  983:             (_,{extension, _}, UserState) -&gt;
<a name="984"/>  984: 		          {unknown, UserState};
<a name="985"/>  985: 	        (_, valid, UserState) -&gt;
<a name="986"/>  986: 		          {valid, UserState}
<a name="987"/>  987:         end, []},
<a name="988"/>  988: 
<a name="989"/>  989:     {error, custom_reason} =
<a name="990"/>  990:         public_key:pkix_path_validation(selfsigned_peer, [Trusted], [{verify_fun,
<a name="991"/>  991:                                                                       VerifyFunAndState2}]),
<a name="992"/>  992:     % check RSASSA-PSS key
<a name="993"/>  993:     % RsaPssKey = {public_key:generate_key({rsa, 1024, 65537}), pss_params(sha256)},
<a name="994"/>  994:     RsaPssKey = {hardcode_rsa_key(1), pss_params(sha256)},
<a name="995"/>  995: 
<a name="996"/>  996:     _CaKPSS = {TrustedPSSCert,_} = erl_make_certs:make_cert([{key, RsaPssKey},
<a name="997"/>  997:                  {subject, [
<a name="998"/>  998:                     {name, &quot;RSASSA-PSS Public Key&quot;},
<a name="999"/>  999:                     {?'id-at-name', {printableString, &quot;public_key&quot;}},
<a name="1000"/> 1000:                     {?'id-at-pseudonym', {printableString, &quot;pubkey&quot;}},
<a name="1001"/> 1001:                     {city, &quot;Stockholm&quot;},
<a name="1002"/> 1002:                     {country, &quot;SE&quot;},
<a name="1003"/> 1003:                     {org, &quot;erlang&quot;},
<a name="1004"/> 1004:                     {org_unit, &quot;testing dep&quot;}
<a name="1005"/> 1005:                        ]}
<a name="1006"/> 1006:                 ]),
<a name="1007"/> 1007:     _ChainPSSCert = {CertPSS, _} = erl_make_certs:make_cert([{issuer, {TrustedPSSCert,RsaPssKey}}]),
<a name="pkix_path_validation-last_expr"/><a name="1008"/> 1008: <b>    {ok, _} = public_key:pkix_path_validation</b>(TrustedPSSCert, [CertPSS], []).
<a name="1009"/> 1009: 
<a name="pkix_path_validation_root_expired-0"/><a name="1010"/> 1010: <b>pkix_path_validation_root_expired</b>() -&gt;
<a name="pkix_path_validation_root_expired-last_expr"/><a name="1011"/> 1011:     [{doc, &quot;Test root expiration so that it does not fall between chairs&quot;}].
<a name="pkix_path_validation_root_expired-1"/><a name="1012"/> 1012: <b>pkix_path_validation_root_expired</b>(Config) when is_list(Config) -&gt;
<a name="1013"/> 1013:     {Year, Month, Day} = date(),
<a name="1014"/> 1014:     SRoot = public_key:pkix_test_root_cert(&quot;OTP test server ROOT&quot;, [{validity, {{Year-2, Month, Day}, 
<a name="1015"/> 1015:                                                                                 {Year-1, Month, Day}}}]),
<a name="1016"/> 1016:     #{server_config := Conf} = public_key:pkix_test_data(#{server_chain =&gt; #{root =&gt; SRoot,
<a name="1017"/> 1017:                                                                              intermediates =&gt; [],
<a name="1018"/> 1018:                                                                              peer =&gt; []},
<a name="1019"/> 1019:                                                            client_chain =&gt; #{root =&gt; [], 
<a name="1020"/> 1020:                                                                              intermediates =&gt; [],
<a name="1021"/> 1021:                                                                              peer =&gt; []}}),
<a name="1022"/> 1022:     [ICA, Root] = proplists:get_value(cacerts, Conf),
<a name="1023"/> 1023:     true = public_key:pkix_is_self_signed(Root),
<a name="1024"/> 1024:     Peer = proplists:get_value(cert, Conf),
<a name="pkix_path_validation_root_expired-last_expr"/><a name="1025"/> 1025: <b>    {error, {bad_cert, cert_expired}} = public_key:pkix_path_validation</b>(Root, [ICA, Peer], []).
<a name="1026"/> 1026:     
<a name="pkix_ext_key_usage-0"/><a name="1027"/> 1027: <b>pkix_ext_key_usage</b>() -&gt;
<a name="pkix_ext_key_usage-last_expr"/><a name="1028"/> 1028: <b>    [{doc, &quot;If extended key usage is a critical extension in a CA </b>(usually not included) make sure it is compatible with keyUsage extension&quot;}].
<a name="pkix_ext_key_usage-1"/><a name="1029"/> 1029: <b>pkix_ext_key_usage</b>(Config) when is_list(Config) -&gt;
<a name="1030"/> 1030:     SRootSpec = public_key:pkix_test_root_cert(&quot;OTP test server ROOT&quot;, []),
<a name="1031"/> 1031:     CRootSpec = public_key:pkix_test_root_cert(&quot;OTP test client ROOT&quot;, []),
<a name="1032"/> 1032: 
<a name="1033"/> 1033:     CAExtServer = [#'Extension'{extnID = ?'id-ce-keyUsage',
<a name="1034"/> 1034:                                 extnValue = [digitalSignature, keyCertSign, cRLSign],
<a name="1035"/> 1035:                                 critical = false},
<a name="1036"/> 1036:                    #'Extension'{extnID = ?'id-ce-extKeyUsage',
<a name="1037"/> 1037:                                 extnValue = [?'id-kp-OCSPSigning', ?'id-kp-emailProtection', ?'id-kp-serverAuth'],
<a name="1038"/> 1038:                                 critical = true}],
<a name="1039"/> 1039: 
<a name="1040"/> 1040:     CAExtClient = [#'Extension'{extnID = ?'id-ce-keyUsage',
<a name="1041"/> 1041:                                 extnValue = [digitalSignature, keyCertSign, cRLSign],
<a name="1042"/> 1042:                                 critical = false},
<a name="1043"/> 1043:                    #'Extension'{extnID = ?'id-ce-extKeyUsage',
<a name="1044"/> 1044:                                 extnValue = [?'id-kp-codeSigning', ?'id-kp-emailProtection', ?'id-kp-clientAuth'],
<a name="1045"/> 1045:                                 critical = true}],
<a name="1046"/> 1046:     #{server_config := SConf,
<a name="1047"/> 1047:       client_config := CConf} = public_key:pkix_test_data(#{server_chain =&gt; #{root =&gt; SRootSpec,
<a name="1048"/> 1048:                                                                               intermediates =&gt; [[{extensions, CAExtServer}]],
<a name="1049"/> 1049:                                                                               peer =&gt; []},
<a name="1050"/> 1050:                                                            client_chain =&gt; #{root =&gt; CRootSpec,
<a name="1051"/> 1051:                                                                              intermediates =&gt; [[{extensions, CAExtClient}]],
<a name="1052"/> 1052:                                                                              peer =&gt; []}}),
<a name="1053"/> 1053:     [_STRoot, SICA, SRoot] = proplists:get_value(cacerts, SConf),
<a name="1054"/> 1054:     [_CTRoot, CICA, CRoot] = proplists:get_value(cacerts, CConf),
<a name="1055"/> 1055:     SPeer = proplists:get_value(cert, SConf),
<a name="1056"/> 1056:     CPeer = proplists:get_value(cert, CConf),
<a name="1057"/> 1057: 
<a name="1058"/> 1058:     {ok, _} = public_key:pkix_path_validation(SRoot, [SICA, SPeer], []),
<a name="1059"/> 1059:     {ok, _} = public_key:pkix_path_validation(CRoot, [CICA, CPeer], []),
<a name="1060"/> 1060: 
<a name="1061"/> 1061:     CAExtServerFail = [#'Extension'{extnID = ?'id-ce-keyUsage',
<a name="1062"/> 1062:                                 extnValue = [keyAgreement, keyCertSign, cRLSign],
<a name="1063"/> 1063:                                     critical = false},
<a name="1064"/> 1064:                        #'Extension'{extnID = ?'id-ce-extKeyUsage',
<a name="1065"/> 1065:                                     extnValue = [?'id-kp-serverAuth', ?'id-kp-timeStamping'],
<a name="1066"/> 1066:                                     critical = true}],
<a name="1067"/> 1067: 
<a name="1068"/> 1068:     CAExtClient1 = [#'Extension'{extnID = ?'id-ce-keyUsage',
<a name="1069"/> 1069:                                 extnValue = [keyEncipherment, keyCertSign, cRLSign],
<a name="1070"/> 1070:                                 critical = false},
<a name="1071"/> 1071:                    #'Extension'{extnID = ?'id-ce-extKeyUsage',
<a name="1072"/> 1072:                                 extnValue = [?'id-kp-emailProtection', ?'id-kp-clientAuth'],
<a name="1073"/> 1073:                                 critical = true}],
<a name="1074"/> 1074: 
<a name="1075"/> 1075:     #{server_config := SConf1,
<a name="1076"/> 1076:       client_config := CConf1} = public_key:pkix_test_data(#{server_chain =&gt; #{root =&gt; SRootSpec,
<a name="1077"/> 1077:                                                                                  intermediates =&gt; [[{extensions, CAExtServerFail}]],
<a name="1078"/> 1078:                                                                                peer =&gt; []},
<a name="1079"/> 1079:                                                                client_chain =&gt; #{root =&gt; CRootSpec,
<a name="1080"/> 1080:                                                                                  intermediates =&gt; [[{extensions, CAExtClient1}]],
<a name="1081"/> 1081:                                                                                  peer =&gt; []}}),
<a name="1082"/> 1082:     [_, SICA1, SRoot1] = proplists:get_value(cacerts, SConf1),
<a name="1083"/> 1083:     SPeer1 = proplists:get_value(cert, SConf1),
<a name="1084"/> 1084: 
<a name="1085"/> 1085:     {error, {bad_cert,{key_usage_mismatch, _}}} = public_key:pkix_path_validation(SRoot1, [SICA1, SPeer1], []),
<a name="1086"/> 1086: 
<a name="1087"/> 1087:     [_, CICA1, CRoot1] = proplists:get_value(cacerts, CConf1),
<a name="1088"/> 1088:     CPeer1 = proplists:get_value(cert, CConf1),
<a name="pkix_ext_key_usage-last_expr"/><a name="1089"/> 1089: <b>    {ok, _} = public_key:pkix_path_validation</b>(CRoot1, [CICA1, CPeer1], []).
<a name="1090"/> 1090: 
<a name="pkix_ext_key_usage_any-0"/><a name="1091"/> 1091: <b>pkix_ext_key_usage_any</b>() -&gt;
<a name="pkix_ext_key_usage_any-last_expr"/><a name="1092"/> 1092:     [{doc, &quot;Extended key usage is usually in end entity certs, may be in CA but should not be critical in such case&quot;}].
<a name="pkix_ext_key_usage_any-1"/><a name="1093"/> 1093: <b>pkix_ext_key_usage_any</b>(Config) when is_list(Config) -&gt;
<a name="1094"/> 1094:     SRootSpec = public_key:pkix_test_root_cert(&quot;OTP test server ROOT&quot;, []),
<a name="1095"/> 1095:     CRootSpec = public_key:pkix_test_root_cert(&quot;OTP test client ROOT&quot;, []),
<a name="1096"/> 1096: 
<a name="1097"/> 1097:     FailCAExt = [#'Extension'{extnID = ?'id-ce-extKeyUsage',
<a name="1098"/> 1098:                               extnValue = [?'anyExtendedKeyUsage'],
<a name="1099"/> 1099:                               critical = true}],
<a name="1100"/> 1100:     CAExt = [#'Extension'{extnID = ?'id-ce-extKeyUsage',
<a name="1101"/> 1101:                           extnValue = [?'anyExtendedKeyUsage'],
<a name="1102"/> 1102:                           critical = false}],
<a name="1103"/> 1103: 
<a name="1104"/> 1104:     #{server_config := SConf,
<a name="1105"/> 1105:       client_config := CConf} = public_key:pkix_test_data(#{server_chain =&gt; #{root =&gt; SRootSpec,
<a name="1106"/> 1106:                                                                              intermediates =&gt; [[{extensions, FailCAExt}]],
<a name="1107"/> 1107:                                                                              peer =&gt; []},
<a name="1108"/> 1108:                                                            client_chain =&gt; #{root =&gt; CRootSpec,
<a name="1109"/> 1109:                                                                              intermediates =&gt; [[{extensions, CAExt}]],
<a name="1110"/> 1110:                                                                              peer =&gt; []}}),
<a name="1111"/> 1111:     [_STRoot, SICA, SRoot] = proplists:get_value(cacerts, SConf),
<a name="1112"/> 1112:     [_CTRoot, CICA, CRoot] = proplists:get_value(cacerts, CConf),
<a name="1113"/> 1113:     SPeer = proplists:get_value(cert, SConf),
<a name="1114"/> 1114:     CPeer = proplists:get_value(cert, CConf),
<a name="1115"/> 1115: 
<a name="1116"/> 1116:     {error, {bad_cert, invalid_ext_key_usage}} = public_key:pkix_path_validation(SRoot, [SICA, SPeer], []),
<a name="1117"/> 1117: 
<a name="pkix_ext_key_usage_any-last_expr"/><a name="1118"/> 1118: <b>    {ok, _} = public_key:pkix_path_validation</b>(CRoot, [CICA, CPeer], []).
<a name="1119"/> 1119: 
<a name="pkix_path_validation_bad_date-0"/><a name="1120"/> 1120: <b>pkix_path_validation_bad_date</b>() -&gt;
<a name="pkix_path_validation_bad_date-last_expr"/><a name="1121"/> 1121:     [{doc, &quot;Ensure bad date formats in `validity` are handled gracefully by verify fun&quot;}].
<a name="pkix_path_validation_bad_date-1"/><a name="1122"/> 1122: <b>pkix_path_validation_bad_date</b>(Config) when is_list(Config) -&gt;
<a name="1123"/> 1123:     % Load PEM certchain from file
<a name="1124"/> 1124:     DataDir = proplists:get_value(data_dir, Config),
<a name="1125"/> 1125:     {ok, Bin} = file:read_file(filename:join(DataDir,&quot;bad_date_certchain.pem&quot;)),
<a name="1126"/> 1126: 
<a name="1127"/> 1127:     % Decode and extract raw der encoded certificates
<a name="1128"/> 1128:     CertificateList = public_key:pem_decode(Bin),
<a name="1129"/> 1129:     [Root | CertificateChain] = lists:map(fun({'Certificate', Der, _}) -&gt; Der end, CertificateList),
<a name="1130"/> 1130: 
<a name="1131"/> 1131:     % First test error `invalid_validity_dates` being returned correctly without `verify_fun` override
<a name="1132"/> 1132:     {error, {bad_cert, invalid_validity_dates}} = public_key:pkix_path_validation(Root, CertificateChain, []),
<a name="1133"/> 1133: 
<a name="1134"/> 1134:     % Then test no exception thrown if verify_fun function traps the date error
<a name="pkix_path_validation_bad_date-last_expr"/><a name="1135"/> 1135: <b>    {ok, _} = public_key:pkix_path_validation</b>(Root, CertificateChain, [
<a name="1136"/> 1136:        {verify_fun, % This is the same as ?DEFAULT_VERIFYFUN, but it handles `invalid_validity_dates` gracefully.
<a name="1137"/> 1137:             {fun
<a name="1138"/> 1138:                 % Test if we can successfully override `invalid_validity_dates`
<a name="1139"/> 1139:                 (_, {bad_cert, invalid_validity_dates}, UserState) -&gt;
<a name="1140"/> 1140:                     {valid, UserState};
<a name="1141"/> 1141:                 (_,{extension, _}, UserState) -&gt;
<a name="1142"/> 1142: 		            {unknown, UserState};
<a name="1143"/> 1143:                 (_, valid_peer, UserState) -&gt;
<a name="1144"/> 1144: 				    {valid, UserState};
<a name="1145"/> 1145:                 (_, valid, UserState) -&gt;
<a name="1146"/> 1146:                     {valid, UserState}
<a name="1147"/> 1147:             end, []}
<a name="1148"/> 1148:         }
<a name="1149"/> 1149:     ]).
<a name="1150"/> 1150: 
<a name="1151"/> 1151: <i>%%--------------------------------------------------------------------</i>
<a name="1152"/> 1152: <i>%% To generate the PEM file contents:</i>
<a name="1153"/> 1153: <i>%%</i>
<a name="1154"/> 1154: <i>%% openssl req -x509 -nodes -newkey rsa:1024 -keyout /dev/null -subj '/C=SE/CN=example.com/CN=*.foo.example.com/CN=a*b.bar.example.com/O=erlang.org' &gt; public_key_SUITE_data/pkix_verify_hostname_cn.pem</i>
<a name="1155"/> 1155: <i>%%</i>
<a name="1156"/> 1156: <i>%% Note that the same pem-file is used in pkix_verify_hostname_options/1</i>
<a name="1157"/> 1157: <i>%%</i>
<a name="1158"/> 1158: <i>%% Subject: C=SE, CN=example.com, CN=*.foo.example.com, CN=a*b.bar.example.com, O=erlang.org</i>
<a name="1159"/> 1159: <i>%% extensions = no subjAltName</i>
<a name="1160"/> 1160: 
<a name="pkix_verify_hostname_cn-1"/><a name="1161"/> 1161: <b>pkix_verify_hostname_cn</b>(Config) -&gt;
<a name="1162"/> 1162:     DataDir = proplists:get_value(data_dir, Config),
<a name="1163"/> 1163:     {ok,Bin} = file:read_file(filename:join(DataDir,&quot;pkix_verify_hostname_cn.pem&quot;)),
<a name="1164"/> 1164:     Cert = public_key:pkix_decode_cert(element(2,hd(public_key:pem_decode(Bin))), otp),
<a name="1165"/> 1165: 
<a name="1166"/> 1166:     %% Check that 1) only CNs are checked,
<a name="1167"/> 1167:     %%            2) an empty label does not match a wildcard and
<a name="1168"/> 1168:     %%            3) a wildcard does not match more than one label
<a name="1169"/> 1169:     false = public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;erlang.org&quot;},
<a name="1170"/> 1170: 						   {dns_id,&quot;foo.EXAMPLE.com&quot;},
<a name="1171"/> 1171: 						   {dns_id,&quot;b.a.foo.EXAMPLE.com&quot;}]),
<a name="1172"/> 1172: 
<a name="1173"/> 1173:     %% Check that a hostname is extracted from a https-uri and used for checking:
<a name="1174"/> 1174:     true =  public_key:pkix_verify_hostname(Cert, [{uri_id,&quot;HTTPS://EXAMPLE.com&quot;}]),
<a name="1175"/> 1175: 
<a name="1176"/> 1176:     %% Check wildcard matching one label:
<a name="1177"/> 1177:     true =  public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;a.foo.EXAMPLE.com&quot;}]),
<a name="1178"/> 1178: 
<a name="1179"/> 1179:     %% Check wildcard with surrounding chars matches one label:
<a name="1180"/> 1180:     true =  public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;accb.bar.EXAMPLE.com&quot;}]),
<a name="1181"/> 1181: 
<a name="1182"/> 1182:     %% Check that a wildcard with surrounding chars matches an empty string:
<a name="pkix_verify_hostname_cn-last_expr"/><a name="1183"/> 1183: <b>    true =  public_key:pkix_verify_hostname</b>(Cert, [{uri_id,&quot;https://ab.bar.EXAMPLE.com&quot;}]).
<a name="1184"/> 1184: 
<a name="1185"/> 1185: <i>%%--------------------------------------------------------------------</i>
<a name="1186"/> 1186: <i>%% To generate the PEM file contents:</i>
<a name="1187"/> 1187: <i>%%</i>
<a name="1188"/> 1188: <i>%% openssl req -x509 -nodes -newkey rsa:1024 -keyout /dev/null -extensions SAN -config  public_key_SUITE_data/verify_hostname.conf 2&gt;/dev/null &gt; public_key_SUITE_data/pkix_verify_hostname_subjAltName.pem</i>
<a name="1189"/> 1189: <i>%%</i>
<a name="1190"/> 1190: <i>%% Subject: C=SE, CN=example.com</i>
<a name="1191"/> 1191: <i>%% Subject Alternative Name: DNS:kb.example.org, DNS:*.example.org, URI:http://www.example.org, URI:https://wws.example.org</i>
<a name="1192"/> 1192: 
<a name="pkix_verify_hostname_subjAltName-1"/><a name="1193"/> 1193: <b>pkix_verify_hostname_subjAltName</b>(Config) -&gt;
<a name="1194"/> 1194:     DataDir = proplists:get_value(data_dir, Config),
<a name="1195"/> 1195:     {ok,Bin} = file:read_file(filename:join(DataDir,&quot;pkix_verify_hostname_subjAltName.pem&quot;)),
<a name="1196"/> 1196:     Cert = public_key:pkix_decode_cert(element(2,hd(public_key:pem_decode(Bin))), otp),
<a name="1197"/> 1197: 
<a name="1198"/> 1198:     %% Check that neither a uri nor dns hostname matches a CN if subjAltName is present:
<a name="1199"/> 1199:     false = public_key:pkix_verify_hostname(Cert, [{uri_id,&quot;https://example.com&quot;},
<a name="1200"/> 1200: 						   {dns_id,&quot;example.com&quot;}]),
<a name="1201"/> 1201: 
<a name="1202"/> 1202:     %% Check that a uri_id matches a URI subjAltName:
<a name="1203"/> 1203:     true =  public_key:pkix_verify_hostname(Cert, [{uri_id,&quot;https://wws.example.org&quot;}]),
<a name="1204"/> 1204: 
<a name="1205"/> 1205:     %% Check that a dns_id does not match a URI subjAltName:
<a name="1206"/> 1206:     false = public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;www.example.org&quot;},
<a name="1207"/> 1207: 						   {dns_id,&quot;wws.example.org&quot;}]),
<a name="1208"/> 1208: 
<a name="1209"/> 1209:     %% Check that a dns_id matches a DNS subjAltName:
<a name="1210"/> 1210:     true =  public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;kb.example.org&quot;}]),
<a name="1211"/> 1211:     true =  public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;KB.EXAMPLE.ORG&quot;}]),
<a name="1212"/> 1212: 
<a name="1213"/> 1213:     %% Check that a dns_id does not match a DNS subjAltName with wildcard
<a name="1214"/> 1214:     false =  public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;other.example.org&quot;}]),
<a name="1215"/> 1215: 
<a name="1216"/> 1216:     %% Check that a dns_id does match a DNS subjAltName with wildcard with matchfun
<a name="1217"/> 1217:     MatchFun = {match_fun, public_key:pkix_verify_hostname_match_fun(https)},
<a name="1218"/> 1218:     true =  public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;other.example.org&quot;}], [MatchFun]),
<a name="1219"/> 1219:     true =  public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;OTHER.EXAMPLE.ORG&quot;}], [MatchFun]),
<a name="1220"/> 1220: 
<a name="1221"/> 1221:     %% Check that a uri_id does not match a DNS subjAltName with wildcard
<a name="1222"/> 1222:     false =  public_key:pkix_verify_hostname(Cert, [{uri_id,&quot;https://other.example.org&quot;}]),
<a name="1223"/> 1223:     false =  public_key:pkix_verify_hostname(Cert, [{uri_id,&quot;https://OTHER.EXAMPLE.ORG&quot;}]),
<a name="1224"/> 1224: 
<a name="1225"/> 1225:     %% Check that a dns_id does match a DNS subjAltName with wildcard with matchfun
<a name="1226"/> 1226:     true =  public_key:pkix_verify_hostname(Cert, [{uri_id,&quot;https://other.example.org&quot;}], [MatchFun]),
<a name="1227"/> 1227:     true =  public_key:pkix_verify_hostname(Cert, [{uri_id,&quot;https://OTHER.EXAMPLE.ORG&quot;}], [MatchFun]),
<a name="1228"/> 1228:     true =  public_key:pkix_verify_hostname(Cert, [{uri_id,&quot;https://OTHER.example.org&quot;}], [MatchFun]),
<a name="1229"/> 1229: 
<a name="pkix_verify_hostname_subjAltName-last_expr"/><a name="1230"/> 1230:     ok.
<a name="1231"/> 1231: 
<a name="1232"/> 1232: <i>%%--------------------------------------------------------------------</i>
<a name="1233"/> 1233: <i>%% Uses the pem-file for pkix_verify_hostname_cn</i>
<a name="1234"/> 1234: <i>%% Subject: C=SE, CN=example.com, CN=*.foo.example.com, CN=a*b.bar.example.com, O=erlang.org</i>
<a name="pkix_verify_hostname_options-1"/><a name="1235"/> 1235: <b>pkix_verify_hostname_options</b>(Config) -&gt;
<a name="1236"/> 1236:     DataDir = proplists:get_value(data_dir, Config),
<a name="1237"/> 1237:     {ok,Bin} = file:read_file(filename:join(DataDir,&quot;pkix_verify_hostname_cn.pem&quot;)),
<a name="1238"/> 1238:     Cert = public_key:pkix_decode_cert(element(2,hd(public_key:pem_decode(Bin))), otp),
<a name="1239"/> 1239:     
<a name="1240"/> 1240:     %% Check that the fail_callback is called and is presented the correct certificate:
<a name="1241"/> 1241:     true = public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;erlang.org&quot;}],
<a name="1242"/> 1242: 					   [{fail_callback,
<a name="1243"/> 1243: 					     fun(#'OTPCertificate'{}=C) when C==Cert -&gt; 
<a name="1244"/> 1244: 						     true; % To test the return value matters
<a name="1245"/> 1245: 						(#'OTPCertificate'{}=C) -&gt; 
<a name="1246"/> 1246: 						     ct:log(&quot;~p:~p: Wrong cert:~n~p~nExpect~n~p&quot;,
<a name="1247"/> 1247: 							    [?MODULE, ?LINE, C, Cert]),
<a name="1248"/> 1248: 						     ct:fail(&quot;Wrong cert, see log&quot;);
<a name="1249"/> 1249: 						(C) -&gt; 
<a name="1250"/> 1250: 						     ct:log(&quot;~p:~p: Bad cert: ~p&quot;,[?MODULE,?LINE,C]),
<a name="1251"/> 1251: 						     ct:fail(&quot;Bad cert, see log&quot;)
<a name="1252"/> 1252: 					     end}]),
<a name="1253"/> 1253:     
<a name="1254"/> 1254:     %% Check the callback for user-provided match functions:
<a name="1255"/> 1255:     true =  public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;very.wrong.domain&quot;}],
<a name="1256"/> 1256: 					    [{match_fun,
<a name="1257"/> 1257: 					      fun(&quot;very.wrong.domain&quot;, {cn,&quot;example.com&quot;}) -&gt;
<a name="1258"/> 1258: 						      true;
<a name="1259"/> 1259: 						 (_, _) -&gt;
<a name="1260"/> 1260: 						      false
<a name="1261"/> 1261: 					      end}]),
<a name="1262"/> 1262:     false = public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;not.example.com&quot;}],
<a name="1263"/> 1263: 					    [{match_fun, fun(_, _) -&gt; default end}]),
<a name="1264"/> 1264:     true =  public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;example.com&quot;}],
<a name="1265"/> 1265: 					    [{match_fun, fun(_, _) -&gt; default end}]),
<a name="1266"/> 1266: 
<a name="1267"/> 1267:     %% Check the callback for user-provided fqdn extraction:
<a name="1268"/> 1268:     true =  public_key:pkix_verify_hostname(Cert, [{uri_id,&quot;some://very.wrong.domain&quot;}],
<a name="1269"/> 1269: 					    [{fqdn_fun,
<a name="1270"/> 1270: 					      fun({uri_id, &quot;some://very.wrong.domain&quot;}) -&gt;
<a name="1271"/> 1271: 						      &quot;example.com&quot;;
<a name="1272"/> 1272: 						 (_) -&gt;
<a name="1273"/> 1273: 						      &quot;&quot;
<a name="1274"/> 1274: 					      end}]),
<a name="1275"/> 1275:     true =  public_key:pkix_verify_hostname(Cert, [{uri_id,&quot;https://example.com&quot;}],
<a name="1276"/> 1276: 					    [{fqdn_fun, fun(_) -&gt; default end}]),
<a name="1277"/> 1277:     false =  public_key:pkix_verify_hostname(Cert, [{uri_id,&quot;some://very.wrong.domain&quot;}]),
<a name="1278"/> 1278: 
<a name="1279"/> 1279:     true = public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;example.com&quot;}]),
<a name="1280"/> 1280:     true = public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;abb.bar.example.com&quot;}]),
<a name="1281"/> 1281:     false = public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;example.com&quot;},
<a name="1282"/> 1282:                                                    {dns_id,&quot;abb.bar.example.com&quot;}],
<a name="1283"/> 1283:                                             [{fqdn_fun,fun(_)-&gt;undefined end}]),
<a name="1284"/> 1284:     %% Test that a common name is matched fully, that is do not allow prefix matches
<a name="1285"/> 1285:     %% with less dots (&quot;.&quot;)
<a name="1286"/> 1286:     {ok, PrefixBin} = file:read_file(filename:join(DataDir,&quot;prefix-dots.pem&quot;)),
<a name="1287"/> 1287:     PrefixCert = public_key:pkix_decode_cert(element(2,hd(public_key:pem_decode(PrefixBin))), otp),
<a name="1288"/> 1288:     true = public_key:pkix_verify_hostname(PrefixCert, [{dns_id,&quot;..a&quot;}]),
<a name="pkix_verify_hostname_options-last_expr"/><a name="1289"/> 1289: <b>    false = public_key:pkix_verify_hostname</b>(PrefixCert, [{dns_id,&quot;.a&quot;}]).
<a name="1290"/> 1290: 
<a name="1291"/> 1291: <i>%%--------------------------------------------------------------------</i>
<a name="1292"/> 1292: <i>%% To generate the PEM file contents:</i>
<a name="1293"/> 1293: <i>%%</i>
<a name="1294"/> 1294: <i>%% openssl req -x509 -nodes -newkey rsa:1024 -keyout /dev/null -extensions SAN -config  public_key_SUITE_data/verify_hostname_ip.conf 2&gt;/dev/null &gt; public_key_SUITE_data/pkix_verify_hostname_subjAltName_IP.pem</i>
<a name="1295"/> 1295: <i>%%</i>
<a name="1296"/> 1296: <i>%% Subject: C=SE, CN=example.com</i>
<a name="1297"/> 1297: <i>%% Subject Alternative Name: DNS:1.2.3.4, DNS: abcd:ef::1, IP:10.67.16.75, URI:https://10.11.12.13</i>
<a name="1298"/> 1298: 
<a name="pkix_verify_hostname_subjAltName_IP-1"/><a name="1299"/> 1299: <b>pkix_verify_hostname_subjAltName_IP</b>(Config) -&gt;
<a name="1300"/> 1300:     DataDir = proplists:get_value(data_dir, Config),
<a name="1301"/> 1301:     {ok,Bin} = file:read_file(filename:join(DataDir,&quot;pkix_verify_hostname_subjAltName_IP.pem&quot;)),
<a name="1302"/> 1302:     Cert = public_key:pkix_decode_cert(element(2,hd(public_key:pem_decode(Bin))), otp),
<a name="1303"/> 1303: 
<a name="1304"/> 1304:     %% Print the tests that a matchfun has to handle
<a name="1305"/> 1305:     catch public_key:pkix_verify_hostname(Cert, [{some_tag,&quot;some.domain&quot;},
<a name="1306"/> 1306:                                                  {ip, {10,67,16,75}}
<a name="1307"/> 1307:                                                 ],
<a name="1308"/> 1308:                                           [{match_fun,
<a name="1309"/> 1309:                                             fun(Ref,Pres) -&gt; 
<a name="1310"/> 1310:                                                     ct:log(&quot;~p:~p:~nRef : ~p~nPres: ~p&quot;,[?MODULE,?LINE,Ref,Pres]),
<a name="1311"/> 1311:                                                     false
<a name="1312"/> 1312:                                             end}]),
<a name="1313"/> 1313: 
<a name="1314"/> 1314:     false =  public_key:pkix_verify_hostname(Cert, [{uri_id,&quot;https://1.2.3.4&quot;}]),
<a name="1315"/> 1315:     true  =  public_key:pkix_verify_hostname(Cert, [{uri_id,&quot;https://10.11.12.13&quot;}]),
<a name="1316"/> 1316:     true  =  public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;1.2.3.4&quot;}]),
<a name="1317"/> 1317:     true  =  public_key:pkix_verify_hostname(Cert, [{dns_id,&lt;&lt;&quot;1.2.3.4&quot;&gt;&gt;}]),
<a name="1318"/> 1318:     false =  public_key:pkix_verify_hostname(Cert, [{dns_id,&quot;10.67.16.75&quot;}]),
<a name="1319"/> 1319:     true  =  public_key:pkix_verify_hostname(Cert, [{ip, &quot;aBcD:ef:0::0:1&quot;}]),
<a name="1320"/> 1320:     true  =  public_key:pkix_verify_hostname(Cert, [{ip, {16#abcd,16#ef,0,0,0,0,0,1}}]),
<a name="1321"/> 1321:     true  =  public_key:pkix_verify_hostname(Cert, [{ip, &quot;10.67.16.75&quot;}]),
<a name="1322"/> 1322:     true  =  public_key:pkix_verify_hostname(Cert, [{ip, &lt;&lt;&quot;10.67.16.75&quot;&gt;&gt;}]),
<a name="1323"/> 1323:     true  =  public_key:pkix_verify_hostname(Cert, [{ip, {10,67,16,75}}]),
<a name="1324"/> 1324:     false =  public_key:pkix_verify_hostname(Cert, [{ip, {1,2,3,4}}]),
<a name="pkix_verify_hostname_subjAltName_IP-last_expr"/><a name="1325"/> 1325: <b>    false =  public_key:pkix_verify_hostname</b>(Cert, [{ip, {10,11,12,13}}]).
<a name="1326"/> 1326: 
<a name="1327"/> 1327: 
<a name="1328"/> 1328: <i>%%--------------------------------------------------------------------</i>
<a name="1329"/> 1329: 
<a name="pkix_dist_point_uri-0"/><a name="1330"/> 1330: <b>pkix_dist_point_uri</b>() -&gt;
<a name="pkix_dist_point_uri-last_expr"/><a name="1331"/> 1331:  [{doc, &quot;Disregard ldap URIs in code path handling HTTP URIs&quot;}].
<a name="pkix_dist_point_uri-1"/><a name="1332"/> 1332: <b>pkix_dist_point_uri</b>(Config) when is_list(Config) -&gt;
<a name="1333"/> 1333:     Datadir = proplists:get_value(data_dir, Config),
<a name="1334"/> 1334:     {ok, PemCert} = file:read_file(filename:join(Datadir, &quot;ldap_uri_cert.pem&quot;)),
<a name="1335"/> 1335:     [{_, Cert, _}] = public_key:pem_decode(PemCert),
<a name="1336"/> 1336:     #'OTPCertificate'{tbsCertificate = TBSCert} = public_key:pkix_decode_cert(Cert, otp),
<a name="1337"/> 1337: 
<a name="1338"/> 1338:     Extensions = pubkey_cert:extensions_list(TBSCert#'OTPTBSCertificate'.extensions),
<a name="1339"/> 1339:     DpExt = pubkey_cert:select_extension(?'id-ce-cRLDistributionPoints', Extensions),
<a name="1340"/> 1340:     #'Extension'{extnValue = DPs} = DpExt,
<a name="1341"/> 1341:     [#'DistributionPoint'{distributionPoint = {fullName, DPNames}}|_] = DPs,
<a name="1342"/> 1342:     ct:log(&quot;~p&quot;, [DPNames]),
<a name="pkix_dist_point_uri-last_expr"/><a name="1343"/> 1343: <b>    true = pubkey_crl:match_one</b>(DPNames, [{uniformResourceIdentifier, &quot;http://ca.eait.uq.edu.au/crl/labs-LILY-CA&quot;}]).
<a name="1344"/> 1344: 
<a name="1345"/> 1345: <i>%%--------------------------------------------------------------------</i>
<a name="1346"/> 1346: 
<a name="pkix_iso_rsa_oid-0"/><a name="1347"/> 1347: <b>pkix_iso_rsa_oid</b>() -&gt;
<a name="pkix_iso_rsa_oid-last_expr"/><a name="1348"/> 1348:  [{doc, &quot;Test workaround for supporting certs that use ISO oids&quot;
<a name="1349"/> 1349:    &quot; 1.3.14.3.2.29 instead of PKIX/PKCS oid&quot;}].
<a name="pkix_iso_rsa_oid-1"/><a name="1350"/> 1350: <b>pkix_iso_rsa_oid</b>(Config) when is_list(Config) -&gt;
<a name="1351"/> 1351:     Datadir = proplists:get_value(data_dir, Config),
<a name="1352"/> 1352:     {ok, PemCert} = file:read_file(filename:join(Datadir, &quot;rsa_ISO.pem&quot;)),
<a name="1353"/> 1353:     [{_, Cert, _}] = public_key:pem_decode(PemCert),
<a name="1354"/> 1354:     OTPCert = public_key:pkix_decode_cert(Cert, otp),
<a name="1355"/> 1355:     SigAlg = OTPCert#'OTPCertificate'.signatureAlgorithm,
<a name="pkix_iso_rsa_oid-last_expr"/><a name="1356"/> 1356: <b>    {_, rsa} = public_key:pkix_sign_types</b>(SigAlg#'SignatureAlgorithm'.algorithm).
<a name="1357"/> 1357: 
<a name="1358"/> 1358: <i>%%--------------------------------------------------------------------</i>
<a name="pkix_iso_dsa_oid-0"/><a name="1359"/> 1359: <b>pkix_iso_dsa_oid</b>() -&gt;
<a name="pkix_iso_dsa_oid-last_expr"/><a name="1360"/> 1360:  [{doc, &quot;Test workaround for supporting certs that use ISO oids&quot;
<a name="1361"/> 1361:    &quot;1.3.14.3.2.27 instead of PKIX/PKCS oid&quot;}].
<a name="pkix_iso_dsa_oid-1"/><a name="1362"/> 1362: <b>pkix_iso_dsa_oid</b>(Config) when is_list(Config) -&gt;
<a name="1363"/> 1363:     Datadir = proplists:get_value(data_dir, Config),
<a name="1364"/> 1364:     {ok, PemCert} = file:read_file(filename:join(Datadir, &quot;dsa_ISO.pem&quot;)),
<a name="1365"/> 1365:     [{_, Cert, _}] = public_key:pem_decode(PemCert),
<a name="1366"/> 1366:     OTPCert = public_key:pkix_decode_cert(Cert, otp),
<a name="1367"/> 1367:     SigAlg = OTPCert#'OTPCertificate'.signatureAlgorithm,
<a name="pkix_iso_dsa_oid-last_expr"/><a name="1368"/> 1368: <b>    {_, dsa} = public_key:pkix_sign_types</b>(SigAlg#'SignatureAlgorithm'.algorithm).
<a name="1369"/> 1369: 
<a name="1370"/> 1370: <i>%%--------------------------------------------------------------------</i>
<a name="pkix_dsa_sha2_oid-0"/><a name="1371"/> 1371: <b>pkix_dsa_sha2_oid</b>() -&gt;
<a name="pkix_dsa_sha2_oid-last_expr"/><a name="1372"/> 1372:  [{doc, &quot;Test support dsa_sha2 oid&quot;}].
<a name="pkix_dsa_sha2_oid-1"/><a name="1373"/> 1373: <b>pkix_dsa_sha2_oid</b>(Config) when is_list(Config) -&gt;
<a name="1374"/> 1374:     {sha224, dsa} = public_key:pkix_sign_types(?'id-dsa-with-sha224'),
<a name="pkix_dsa_sha2_oid-last_expr"/><a name="1375"/> 1375: <b>    {sha256, dsa} = public_key:pkix_sign_types</b>(?'id-dsa-with-sha256').
<a name="1376"/> 1376:     
<a name="1377"/> 1377: <i>%%--------------------------------------------------------------------</i>
<a name="1378"/> 1378: 
<a name="pkix_crl-0"/><a name="1379"/> 1379: <b>pkix_crl</b>() -&gt;
<a name="pkix_crl-last_expr"/><a name="1380"/> 1380:     [{doc, &quot;test pkix_crl_* functions&quot;}].
<a name="1381"/> 1381: 
<a name="pkix_crl-1"/><a name="1382"/> 1382: <b>pkix_crl</b>(Config) when is_list(Config) -&gt;
<a name="1383"/> 1383:     Datadir = proplists:get_value(data_dir, Config),
<a name="1384"/> 1384:     {ok, PemCRL} = file:read_file(filename:join(Datadir, &quot;idp_crl.pem&quot;)),
<a name="1385"/> 1385:     [{_, CRL, _}] = public_key:pem_decode(PemCRL),
<a name="1386"/> 1386:     
<a name="1387"/> 1387:     {ok, IDPPemCert} = file:read_file(filename:join(Datadir, &quot;idp_cert.pem&quot;)),
<a name="1388"/> 1388:     [{_, IDPCert, _}] = public_key:pem_decode(IDPPemCert),
<a name="1389"/> 1389: 
<a name="1390"/> 1390:     {ok, SignPemCert} = file:read_file(filename:join(Datadir, &quot;crl_signer.pem&quot;)),
<a name="1391"/> 1391:     [{_, SignCert, _}] = public_key:pem_decode(SignPemCert),
<a name="1392"/> 1392:     
<a name="1393"/> 1393:     OTPIDPCert = public_key:pkix_decode_cert(IDPCert, otp),
<a name="1394"/> 1394:     OTPSignCert = public_key:pkix_decode_cert(SignCert, otp),
<a name="1395"/> 1395:     ERLCRL = public_key:der_decode('CertificateList',CRL),
<a name="1396"/> 1396: 
<a name="1397"/> 1397:     {rdnSequence,_} = public_key:pkix_crl_issuer(CRL),
<a name="1398"/> 1398:     {rdnSequence,_} = public_key:pkix_crl_issuer(ERLCRL),
<a name="1399"/> 1399:     
<a name="1400"/> 1400:     true = public_key:pkix_crl_verify(CRL, SignCert),
<a name="1401"/> 1401:     true = public_key:pkix_crl_verify(ERLCRL, OTPSignCert),
<a name="1402"/> 1402: 
<a name="1403"/> 1403:     [#'DistributionPoint'{}|_] = public_key:pkix_dist_points(IDPCert),
<a name="1404"/> 1404:     [#'DistributionPoint'{}|_] = public_key:pkix_dist_points(OTPIDPCert),
<a name="1405"/> 1405: 
<a name="1406"/> 1406:     #'DistributionPoint'{cRLIssuer = asn1_NOVALUE,
<a name="1407"/> 1407:      			 reasons = asn1_NOVALUE,
<a name="1408"/> 1408: 			 distributionPoint =  Point} = public_key:pkix_dist_point(IDPCert),
<a name="pkix_crl-last_expr"/><a name="1409"/> 1409:     #'DistributionPoint'{cRLIssuer = asn1_NOVALUE,
<a name="1410"/> 1410: 			 reasons = asn1_NOVALUE,
<a name="1411"/> 1411: 			 distributionPoint =  Point} = public_key:pkix_dist_point(OTPIDPCert).
<a name="1412"/> 1412: 
<a name="general_name-0"/><a name="1413"/> 1413: <b>general_name</b>() -&gt;
<a name="general_name-last_expr"/><a name="1414"/> 1414:     [{doc, &quot;Test that decoding of general name filed may have other values&quot;
<a name="1415"/> 1415:       &quot; than {rdnSequence,  Seq}&quot;}].
<a name="1416"/> 1416: 
<a name="general_name-1"/><a name="1417"/> 1417: <b>general_name</b>(Config) when is_list(Config) -&gt;
<a name="1418"/> 1418:     DummyRfc822Name = &quot;CN=CNDummy, OU=OUDummy, O=ODummy, C=SE&quot;,
<a name="general_name-last_expr"/><a name="1419"/> 1419:     {ok, {1,  DummyRfc822Name}} = 
<a name="1420"/> 1420: 	pubkey_cert:cert_auth_key_id(
<a name="1421"/> 1421: 	  #'AuthorityKeyIdentifier'{authorityCertIssuer = 
<a name="1422"/> 1422: 					[{rfc822Name, DummyRfc822Name}],
<a name="1423"/> 1423: 				    authorityCertSerialNumber = 
<a name="1424"/> 1424: 					1}).
<a name="1425"/> 1425: 
<a name="1426"/> 1426: <i>%%--------------------------------------------------------------------</i>
<a name="1427"/> 1427: 
<a name="pkix_hash_type-0"/><a name="1428"/> 1428: <b>pkix_hash_type</b>() -&gt;
<a name="pkix_hash_type-last_expr"/><a name="1429"/> 1429:      [{doc, &quot;Test API function pkix_hash_type/1&quot;}].
<a name="1430"/> 1430: 
<a name="pkix_hash_type-1"/><a name="1431"/> 1431: <b>pkix_hash_type</b>(Config) when is_list(Config) -&gt;
<a name="1432"/> 1432:     sha = public_key:pkix_hash_type(?'id-sha1'), 
<a name="1433"/> 1433:     sha512 = public_key:pkix_hash_type(?'id-sha512'),
<a name="1434"/> 1434:     sha384 = public_key:pkix_hash_type(?'id-sha384'),
<a name="1435"/> 1435:     sha256 = public_key:pkix_hash_type(?'id-sha256'), 
<a name="1436"/> 1436:     sha224 = public_key:pkix_hash_type('id-sha224'),
<a name="pkix_hash_type-last_expr"/><a name="1437"/> 1437: <b>    md5 = public_key:pkix_hash_type</b>('id-md5').
<a name="1438"/> 1438: 
<a name="1439"/> 1439: 
<a name="1440"/> 1440: <i>%%--------------------------------------------------------------------</i>
<a name="1441"/> 1441: 
<a name="pkix_test_data_all_default-0"/><a name="1442"/> 1442: <b>pkix_test_data_all_default</b>() -&gt;
<a name="pkix_test_data_all_default-last_expr"/><a name="1443"/> 1443:     [{doc, &quot;Test API function pkix_test_data/1&quot;}].
<a name="1444"/> 1444: 
<a name="pkix_test_data_all_default-1"/><a name="1445"/> 1445: <b>pkix_test_data_all_default</b>(Config) when is_list(Config) -&gt;
<a name="1446"/> 1446:     #{server_config := ServerConf0,
<a name="1447"/> 1447:       client_config := ClientConf0} = public_key:pkix_test_data(#{server_chain =&gt; 
<a name="1448"/> 1448:                                                                      #{root =&gt; [],
<a name="1449"/> 1449:                                                                        intermediates =&gt; [[]],
<a name="1450"/> 1450:                                                                        peer =&gt; []},
<a name="1451"/> 1451:                                                                  client_chain =&gt; 
<a name="1452"/> 1452:                                                                      #{root =&gt; [],
<a name="1453"/> 1453:                                                                        intermediates =&gt; [[]],
<a name="1454"/> 1454:                                                                        peer =&gt; []}}),
<a name="1455"/> 1455:     check_conf_member(ServerConf0, [key, cert, cacerts]),
<a name="1456"/> 1456:     check_conf_member(ClientConf0, [key, cert, cacerts]),
<a name="1457"/> 1457:     
<a name="1458"/> 1458:     3 = length(proplists:get_value(cacerts, ServerConf0)),
<a name="1459"/> 1459:     3 = length(proplists:get_value(cacerts, ServerConf0)),
<a name="1460"/> 1460: 
<a name="1461"/> 1461:     #{server_config := ServerConf1,
<a name="1462"/> 1462:       client_config := ClientConf1} = public_key:pkix_test_data(#{server_chain =&gt; 
<a name="1463"/> 1463:                                                                      #{root =&gt; [],
<a name="1464"/> 1464:                                                                        peer =&gt; []},
<a name="1465"/> 1465:                                                                  client_chain =&gt; 
<a name="1466"/> 1466:                                                                      #{root =&gt; [],
<a name="1467"/> 1467:                                                                        peer =&gt; []}}),
<a name="1468"/> 1468:     2 = length(proplists:get_value(cacerts, ServerConf1)),
<a name="1469"/> 1469:     2 = length(proplists:get_value(cacerts, ServerConf1)),
<a name="1470"/> 1470:     
<a name="1471"/> 1471:     check_conf_member(ServerConf1, [key, cert, cacerts]),
<a name="pkix_test_data_all_default-last_expr"/><a name="1472"/> 1472: <b>    check_conf_member</b>(ClientConf1, [key, cert, cacerts]).
<a name="1473"/> 1473:     
<a name="1474"/> 1474: <i>%%--------------------------------------------------------------------</i>
<a name="1475"/> 1475: 
<a name="pkix_test_data-0"/><a name="1476"/> 1476: <b>pkix_test_data</b>() -&gt;
<a name="pkix_test_data-last_expr"/><a name="1477"/> 1477:     [{doc, &quot;Test API function pkix_test_data/1&quot;}].
<a name="1478"/> 1478: 
<a name="pkix_test_data-1"/><a name="1479"/> 1479: <b>pkix_test_data</b>(Config) when is_list(Config) -&gt;
<a name="1480"/> 1480:     {Year, Month, Day} = date(),
<a name="1481"/> 1481:     Keygen = 
<a name="1482"/> 1482:         case crypto:ec_curves() of
<a name="1483"/> 1483:         [] -&gt;
<a name="1484"/> 1484:             {rsa, 2048, 17};
<a name="1485"/> 1485:         [Curve |_] -&gt;
<a name="1486"/> 1486:             Oid = pubkey_cert_records:namedCurves(Curve),
<a name="1487"/> 1487:             {namedCurve, Oid}
<a name="1488"/> 1488:         end,
<a name="1489"/> 1489:     #{server_config := ServerConf0,
<a name="1490"/> 1490:       client_config := ClientConf0} = 
<a name="1491"/> 1491:         public_key:pkix_test_data(#{server_chain =&gt; 
<a name="1492"/> 1492:                                         #{root =&gt; [],
<a name="1493"/> 1493:                                           intermediates =&gt; [],
<a name="1494"/> 1494:                                           peer =&gt; [{key, hardcode_rsa_key(1)}]},
<a name="1495"/> 1495:                                     client_chain =&gt; 
<a name="1496"/> 1496:                                         #{root =&gt; [{validity, {{Year-2, Month, Day}, 
<a name="1497"/> 1497:                                                                {Year-1, Month, Day}}}],
<a name="1498"/> 1498:                                           intermediates =&gt; 
<a name="1499"/> 1499:                                               [[{extensions, [#'Extension'{extnID = ?'id-ce-basicConstraints',
<a name="1500"/> 1500:                                                                            extnValue = #'BasicConstraints'{cA=true, 
<a name="1501"/> 1501:                                                                                              pathLenConstraint = 1},
<a name="1502"/> 1502:                                                                            critical = true}]}]],
<a name="1503"/> 1503:                                                peer =&gt; [{key, Keygen}, {digest, sha1}]}}),
<a name="1504"/> 1504:     check_conf_member(ServerConf0, [key, cert, cacerts]),
<a name="pkix_test_data-last_expr"/><a name="1505"/> 1505: <b>    check_conf_member</b>(ClientConf0, [key, cert, cacerts]).
<a name="1506"/> 1506: 
<a name="1507"/> 1507:    
<a name="1508"/> 1508:                                  
<a name="check_conf_member-2"/><a name="1509"/> 1509: <b>check_conf_member</b>(_, []) -&gt;
<a name="1510"/> 1510:     true;
<a name="1511"/> 1511: <b>check_conf_member</b>(Conf, [Member | Rest]) -&gt;
<a name="check_conf_member-last_expr"/><a name="1512"/> 1512: <b>    case lists:keymember</b>(Member, 1, Conf) of
<a name="1513"/> 1513:         true -&gt;
<a name="1514"/> 1514:             check_conf_member(Conf, Rest);
<a name="1515"/> 1515:         false -&gt;
<a name="1516"/> 1516:             ct:fail({misssing_conf, Member})
<a name="1517"/> 1517:     end.
<a name="1518"/> 1518:                               
<a name="1519"/> 1519: <i>%%--------------------------------------------------------------------</i>
<a name="pkix_is_issuer-0"/><a name="1520"/> 1520: <b>pkix_is_issuer</b>() -&gt;
<a name="pkix_is_issuer-last_expr"/><a name="1521"/> 1521:     [{doc, &quot;Test pubkey_cert:pkix_is_issuer with cert that have diffent cases on countryname&quot;}].
<a name="1522"/> 1522: 
<a name="pkix_is_issuer-1"/><a name="1523"/> 1523: <b>pkix_is_issuer</b>(Config) when is_list(Config) -&gt;
<a name="1524"/> 1524:     Upper = {rdnSequence,
<a name="1525"/> 1525:              [[{'AttributeTypeAndValue',{2,5,4,6},&quot;GB&quot;}],
<a name="1526"/> 1526:               [{'AttributeTypeAndValue',{2,5,4,10},{utf8String,&lt;&lt;&quot;MYORG&quot;&gt;&gt;}}],
<a name="1527"/> 1527:               [{'AttributeTypeAndValue',{2,5,4,11},{utf8String,&lt;&lt;&quot;INTERMEDIATE&quot;&gt;&gt;}}],
<a name="1528"/> 1528:               [{'AttributeTypeAndValue',{2,5,4,3},{utf8String,&lt;&lt;&quot;INTERMEDIATE&quot;&gt;&gt;}}]]},
<a name="1529"/> 1529:     Lower = {rdnSequence,
<a name="1530"/> 1530:              [[{'AttributeTypeAndValue',{2,5,4,6},&quot;gb&quot;}],
<a name="1531"/> 1531:               [{'AttributeTypeAndValue',{2,5,4,10},{utf8String,&lt;&lt;&quot;MYORG&quot;&gt;&gt;}}],
<a name="1532"/> 1532:               [{'AttributeTypeAndValue',{2,5,4,11},{utf8String,&lt;&lt;&quot;INTERMEDIATE&quot;&gt;&gt;}}],
<a name="1533"/> 1533:               [{'AttributeTypeAndValue',{2,5,4,3},{utf8String,&lt;&lt;&quot;INTERMEDIATE&quot;&gt;&gt;}}]]},
<a name="pkix_is_issuer-last_expr"/><a name="1534"/> 1534: <b>    true = pubkey_cert:is_issuer</b>(Upper, Lower).
<a name="1535"/> 1535: 
<a name="1536"/> 1536: <i>%%--------------------------------------------------------------------</i>
<a name="short_cert_issuer_hash-0"/><a name="1537"/> 1537: <b>short_cert_issuer_hash</b>() -&gt;
<a name="short_cert_issuer_hash-last_expr"/><a name="1538"/> 1538:     [{doc, &quot;Test OpenSSL-style hash for certificate issuer&quot;}].
<a name="1539"/> 1539: 
<a name="short_cert_issuer_hash-1"/><a name="1540"/> 1540: <b>short_cert_issuer_hash</b>(Config) when is_list(Config) -&gt;
<a name="1541"/> 1541:     Datadir = ?config(data_dir, Config),
<a name="1542"/> 1542:     [{'Certificate', CertDER, _}] =
<a name="1543"/> 1543: 	erl_make_certs:pem_to_der(filename:join(Datadir, &quot;client_cert.pem&quot;)),
<a name="1544"/> 1544: 
<a name="1545"/> 1545:     %% This hash value was obtained by running:
<a name="1546"/> 1546:     %% openssl x509 -in client_cert.pem -issuer_hash -noout
<a name="1547"/> 1547:     CertIssuerHash = &quot;d4c8d7e5&quot;,
<a name="1548"/> 1548: 
<a name="1549"/> 1549:     #'OTPCertificate'{tbsCertificate = #'OTPTBSCertificate'{issuer = Issuer}} =
<a name="1550"/> 1550: 	public_key:pkix_decode_cert(CertDER, otp),
<a name="1551"/> 1551: 
<a name="short_cert_issuer_hash-last_expr"/><a name="1552"/> 1552: <b>    CertIssuerHash = public_key:short_name_hash</b>(Issuer).
<a name="1553"/> 1553: 
<a name="1554"/> 1554: <i>%%--------------------------------------------------------------------</i>
<a name="short_crl_issuer_hash-0"/><a name="1555"/> 1555: <b>short_crl_issuer_hash</b>() -&gt;
<a name="short_crl_issuer_hash-last_expr"/><a name="1556"/> 1556:     [{doc, &quot;Test OpenSSL-style hash for CRL issuer&quot;}].
<a name="1557"/> 1557: 
<a name="short_crl_issuer_hash-1"/><a name="1558"/> 1558: <b>short_crl_issuer_hash</b>(Config) when is_list(Config) -&gt;
<a name="1559"/> 1559:     Datadir = ?config(data_dir, Config),
<a name="1560"/> 1560:     [{'CertificateList', CrlDER, _}] =
<a name="1561"/> 1561: 	erl_make_certs:pem_to_der(filename:join(Datadir, &quot;idp_crl.pem&quot;)),
<a name="1562"/> 1562: 
<a name="1563"/> 1563:     %% This hash value was obtained by running:
<a name="1564"/> 1564:     %% openssl crl -in idp_crl.pem -hash -noout
<a name="1565"/> 1565:     CrlIssuerHash = &quot;d6134ed3&quot;,
<a name="1566"/> 1566: 
<a name="1567"/> 1567:     Issuer = public_key:pkix_crl_issuer(CrlDER),
<a name="1568"/> 1568: 
<a name="short_crl_issuer_hash-last_expr"/><a name="1569"/> 1569: <b>    CrlIssuerHash = public_key:short_name_hash</b>(Issuer).
<a name="1570"/> 1570: 
<a name="1571"/> 1571: <i>%%--------------------------------------------------------------------</i>
<a name="gen_ec_param_prime_field-0"/><a name="1572"/> 1572: <b>gen_ec_param_prime_field</b>() -&gt;
<a name="gen_ec_param_prime_field-last_expr"/><a name="1573"/> 1573:     [{doc, &quot;Generate key with EC prime_field parameters&quot;}].
<a name="gen_ec_param_prime_field-1"/><a name="1574"/> 1574: <b>gen_ec_param_prime_field</b>(Config) when is_list(Config) -&gt;
<a name="1575"/> 1575:     Datadir = proplists:get_value(data_dir, Config),
<a name="gen_ec_param_prime_field-last_expr"/><a name="1576"/> 1576: <b>    do_gen_ec_param</b>(filename:join(Datadir, &quot;ec_key_param0.pem&quot;)).
<a name="1577"/> 1577: 
<a name="1578"/> 1578: <i>%%--------------------------------------------------------------------</i>
<a name="gen_ec_param_char_2_field-0"/><a name="1579"/> 1579: <b>gen_ec_param_char_2_field</b>() -&gt;
<a name="gen_ec_param_char_2_field-last_expr"/><a name="1580"/> 1580:     [{doc, &quot;Generate key with EC characteristic_two_field parameters&quot;}].
<a name="gen_ec_param_char_2_field-1"/><a name="1581"/> 1581: <b>gen_ec_param_char_2_field</b>(Config) when is_list(Config) -&gt;
<a name="1582"/> 1582:     Datadir = proplists:get_value(data_dir, Config),
<a name="gen_ec_param_char_2_field-last_expr"/><a name="1583"/> 1583: <b>    do_gen_ec_param</b>(filename:join(Datadir, &quot;ec_key_param1.pem&quot;)).
<a name="1584"/> 1584: 
<a name="1585"/> 1585: <i>%%--------------------------------------------------------------------</i>
<a name="ocsp_extensions-0"/><a name="1586"/> 1586: <b>ocsp_extensions</b>() -&gt;
<a name="ocsp_extensions-last_expr"/><a name="1587"/> 1587:     [{doc, &quot;Check OCSP extensions&quot;}].
<a name="ocsp_extensions-1"/><a name="1588"/> 1588: <b>ocsp_extensions</b>(_Config) -&gt;
<a name="1589"/> 1589:     Nonce = &lt;&lt;4,8,66,243,220,236,16,118,51,215&gt;&gt;,
<a name="1590"/> 1590:     ExpectedExtentions =
<a name="1591"/> 1591:         [{'Extension',
<a name="1592"/> 1592:           ?'id-pkix-ocsp-nonce',
<a name="1593"/> 1593:           asn1_DEFAULT,
<a name="1594"/> 1594:           &lt;&lt;4,8,66,243,220,236,16,118,51,215&gt;&gt;}],
<a name="ocsp_extensions-last_expr"/><a name="1595"/> 1595: <b>    ExpectedExtentions = public_key:ocsp_extensions</b>(Nonce).
<a name="1596"/> 1596: 
<a name="pkix_ocsp_validate-0"/><a name="1597"/> 1597: <b>pkix_ocsp_validate</b>() -&gt;
<a name="pkix_ocsp_validate-last_expr"/><a name="1598"/> 1598:     [{doc, &quot;Check OCSP extensions&quot;}].
<a name="pkix_ocsp_validate-1"/><a name="1599"/> 1599: <b>pkix_ocsp_validate</b>(_Config) -&gt;
<a name="1600"/> 1600:     Cert =
<a name="1601"/> 1601:         {'OTPCertificate',{'OTPTBSCertificate',v3,9,
<a name="1602"/> 1602:                            {'SignatureAlgorithm',{1,2,840,113549,1,1,11},'NULL'},
<a name="1603"/> 1603:                            {rdnSequence,[[{'AttributeTypeAndValue',{2,5,4,3},{utf8String,&lt;&lt;&quot;otpCA&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{2,5,4,11},{utf8String,&lt;&lt;&quot;Erlang OTP&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{2,5,4,10},{utf8String,&lt;&lt;&quot;Ericsson AB&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{2,5,4,6},&quot;SE&quot;}],[{'AttributeTypeAndValue',{2,5,4,7},{utf8String,&lt;&lt;&quot;Stockholm&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{1,2,840,113549,1,9,1},&quot;peter@erix.ericsson.se&quot;}]]},
<a name="1604"/> 1604:                            {'Validity',{utcTime,&quot;230721110721Z&quot;},{utcTime,&quot;330529110721Z&quot;}},
<a name="1605"/> 1605:                            {rdnSequence,[[{'AttributeTypeAndValue',{2,5,4,3},{utf8String,&lt;&lt;&quot;a.server&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{2,5,4,11},{utf8String,&lt;&lt;&quot;Erlang OTP&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{2,5,4,10},{utf8String,&lt;&lt;&quot;Ericsson AB&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{2,5,4,6},&quot;SE&quot;}],[{'AttributeTypeAndValue',{2,5,4,7},{utf8String,&lt;&lt;&quot;Stockholm&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{1,2,840,113549,1,9,1},&quot;peter@erix.ericsson.se&quot;}]]},
<a name="1606"/> 1606:                            {'OTPSubjectPublicKeyInfo',{'PublicKeyAlgorithm',{1,2,840,113549,1,1,1},'NULL'},
<a name="1607"/> 1607:                             {'RSAPublicKey',19254743747256260264207569423711759377779938665145630924415701722071839009286238971264967781043993434178803001083069740412920664146137571550852074547463946025114390093775800702438227109245066854329070921351832849321692114677809046259034306196616912261365770291322044071697789183279204771685063580949070504947864713748039312242300503875879444809664605423001542854874228001872895975468648787616073960661286876663709764410812833966560999459482926236332297043685455899393823175706646393051956438518613689798667608292659880957737510004003274559865311466147775473832468655042097383293967251824412697382839864114388741712057,
<a name="1608"/> 1608:                              65537}},
<a name="1609"/> 1609:                            asn1_NOVALUE,asn1_NOVALUE,
<a name="1610"/> 1610:                            [{'Extension',{2,5,29,19},false,{'BasicConstraints',false,asn1_NOVALUE}},
<a name="1611"/> 1611:                             {'Extension',{2,5,29,15},false,[digitalSignature,nonRepudiation,keyEncipherment]},
<a name="1612"/> 1612:                             {'Extension',{2,5,29,14},false,&lt;&lt;175,14,85,35,212,170,133,20,114,234,90,223,163,49,255,87,86,93,165,56&gt;&gt;},
<a name="1613"/> 1613:                             {'Extension',{2,5,29,35},
<a name="1614"/> 1614:                              false,
<a name="1615"/> 1615:                              {'AuthorityKeyIdentifier',&lt;&lt;123,93,133,100,41,175,227,134,140,47,217,84,132,181,89,186,102,41,30,255&gt;&gt;,
<a name="1616"/> 1616:                               [{directoryName,{rdnSequence,[[{'AttributeTypeAndValue',{2,5,4,3},{utf8String,&lt;&lt;&quot;erlangCA&quot;&gt;&gt;}}],
<a name="1617"/> 1617:                                                             [{'AttributeTypeAndValue',{2,5,4,11},{utf8String,&lt;&lt;&quot;Erlang OTP&quot;&gt;&gt;}}],
<a name="1618"/> 1618:                                                             [{'AttributeTypeAndValue',{2,5,4,10},{utf8String,&lt;&lt;&quot;Ericsson AB&quot;&gt;&gt;}}],
<a name="1619"/> 1619:                                                             [{'AttributeTypeAndValue',{2,5,4,7},{utf8String,&lt;&lt;&quot;Stockholm&quot;&gt;&gt;}}],
<a name="1620"/> 1620:                                                             [{'AttributeTypeAndValue',{2,5,4,6},&quot;SE&quot;}],
<a name="1621"/> 1621:                                                             [{'AttributeTypeAndValue',{1,2,840,113549,1,9,1},&quot;peter@erix.ericsson.se&quot;}]]}}],
<a name="1622"/> 1622:                               1}},
<a name="1623"/> 1623:                             {'Extension',{2,5,29,17},false,[{dNSName,&quot;host.example.com&quot;}]},
<a name="1624"/> 1624:                             {'Extension',{2,5,29,18},false,[{rfc822Name,&quot;peter@erix.ericsson.se&quot;}]}]},
<a name="1625"/> 1625:          {'SignatureAlgorithm',{1,2,840,113549,1,1,11},'NULL'},
<a name="1626"/> 1626:          &lt;&lt;23,196,208,23,144,187,135,84,233,168,123,81,115,112,33,52,77,238,239,70,248,131,119,160,178,216,252,166,176,20,252,211,108,160,202,140,96,84,98,209,7,149,30,184,0,196,139,48,122,36,45,10,198,106,98,33,183,254,48,11,88,64,93,232,152,233,133,216,191,128,35,96,183,221,122,87,230,30,191,199,226,203,164,217,236,101,83,158,113,211,177,52,217,39,96,108,242,87,70,44,246,68,124,122,121,88,188,254,22,48,98,121,238,158,4,160,141,249,255,93,147,83,42,86,62,5,118,164,54,75,87,49,111,
<a name="1627"/> 1627:            126,197,89,32,226,89,40,154,70,165,118,239,26,249,59,48,52,237,152,240,131,100,187,14,157,201,103,102,27,81,198,226,121,221,68,244,119,130,149,231,179,35,64,96,254,245,5,199,112,145,65,69,80,87,235,140,137,20,220,148,157,94,123,177,186,187,66,99,92,150,213,147,129,36,126,93,4,10,123,70,238,175,247,102,91,42,201,27,123,76,212,45,115,11,31,114,173,124,27,156,248,36,37,195,111,206,236,43,224,157,50,98,109,179,87,223,187,8,204,197,202,155,60&gt;&gt;},
<a name="1628"/> 1628:     IssuerCert =
<a name="1629"/> 1629:         {'OTPCertificate',{'OTPTBSCertificate',v3,1,
<a name="1630"/> 1630:                            {'SignatureAlgorithm',{1,2,840,113549,1,1,11},'NULL'},
<a name="1631"/> 1631:                            {rdnSequence,[[{'AttributeTypeAndValue',{2,5,4,3},{utf8String,&lt;&lt;&quot;erlangCA&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{2,5,4,11},{utf8String,&lt;&lt;&quot;Erlang OTP&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{2,5,4,10},{utf8String,&lt;&lt;&quot;Ericsson AB&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{2,5,4,7},{utf8String,&lt;&lt;&quot;Stockholm&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{2,5,4,6},&quot;SE&quot;}],[{'AttributeTypeAndValue',{1,2,840,113549,1,9,1},&quot;peter@erix.ericsson.se&quot;}]]},
<a name="1632"/> 1632:                            {'Validity',{utcTime,&quot;230721110720Z&quot;},{utcTime,&quot;330529110720Z&quot;}},
<a name="1633"/> 1633:                            {rdnSequence,[[{'AttributeTypeAndValue',{2,5,4,3},{utf8String,&lt;&lt;&quot;otpCA&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{2,5,4,11},{utf8String,&lt;&lt;&quot;Erlang OTP&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{2,5,4,10},{utf8String,&lt;&lt;&quot;Ericsson AB&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{2,5,4,6},&quot;SE&quot;}],[{'AttributeTypeAndValue',{2,5,4,7},{utf8String,&lt;&lt;&quot;Stockholm&quot;&gt;&gt;}}],[{'AttributeTypeAndValue',{1,2,840,113549,1,9,1},&quot;peter@erix.ericsson.se&quot;}]]},
<a name="1634"/> 1634:                            {'OTPSubjectPublicKeyInfo',{'PublicKeyAlgorithm',{1,2,840,113549,1,1,1},'NULL'},
<a name="1635"/> 1635:                             {'RSAPublicKey',21858379260819365313885475389172639523863567481982302063462584029790343874819317972475546206568963022785252583910194728269078148431804871680312638323851125861707159230343297343111968246731095811513561212201088276841624533346998017512000090901290490304174895932870845288899008429347052837949441312958652271962356020302617279856538736007013593572768976262766464136388094144122584736630529987720049486299302127652434926700165727330943325372510516379103006575448279898129379834740761468401572505064753618409945975591285059206889943804512145915054818226570266582909516966602868100682823910151957272535898084374557112395143,
<a name="1636"/> 1636:                              65537}},
<a name="1637"/> 1637:                            asn1_NOVALUE,asn1_NOVALUE,
<a name="1638"/> 1638:                            [{'Extension',{2,5,29,19},true,{'BasicConstraints',true,asn1_NOVALUE}},
<a name="1639"/> 1639:                             {'Extension',{2,5,29,15},false,[keyCertSign,cRLSign]},
<a name="1640"/> 1640:                             {'Extension',{2,5,29,14},false,&lt;&lt;123,93,133,100,41,175,227,134,140,47,217,84,132,181,89,186,102,41,30,255&gt;&gt;},
<a name="1641"/> 1641:                             {'Extension',{2,5,29,35},
<a name="1642"/> 1642:                              false,
<a name="1643"/> 1643:                              {'AuthorityKeyIdentifier',&lt;&lt;229,159,14,81,153,72,30,27,33,37,234,91,103,205,230,72,95,185,112,95&gt;&gt;,
<a name="1644"/> 1644:                               [{directoryName,{rdnSequence,[[{'AttributeTypeAndValue',{2,5,4,3},{utf8String,&lt;&lt;&quot;erlangCA&quot;&gt;&gt;}}],
<a name="1645"/> 1645:                                                             [{'AttributeTypeAndValue',{2,5,4,11},{utf8String,&lt;&lt;&quot;Erlang OTP&quot;&gt;&gt;}}],
<a name="1646"/> 1646:                                                             [{'AttributeTypeAndValue',{2,5,4,10},{utf8String,&lt;&lt;&quot;Ericsson AB&quot;&gt;&gt;}}],
<a name="1647"/> 1647:                                                             [{'AttributeTypeAndValue',{2,5,4,7},{utf8String,&lt;&lt;&quot;Stockholm&quot;&gt;&gt;}}],
<a name="1648"/> 1648:                                                             [{'AttributeTypeAndValue',{2,5,4,6},&quot;SE&quot;}],
<a name="1649"/> 1649:                                                             [{'AttributeTypeAndValue',{1,2,840,113549,1,9,1},&quot;peter@erix.ericsson.se&quot;}]]}}],
<a name="1650"/> 1650:                               674805639123712796695508479052504582494838106155}},
<a name="1651"/> 1651:                             {'Extension',{2,5,29,17},false,[{rfc822Name,&quot;peter@erix.ericsson.se&quot;}]},
<a name="1652"/> 1652:                             {'Extension',{2,5,29,18},false,[{rfc822Name,&quot;peter@erix.ericsson.se&quot;}]}]},
<a name="1653"/> 1653:          {'SignatureAlgorithm',{1,2,840,113549,1,1,11},'NULL'},
<a name="1654"/> 1654:          &lt;&lt;44,128,75,220,253,223,223,77,33,57,30,205,101,103,200,211,254,81,122,195,123,239,98,5,118,58,179,193,24,93,12,243,124,194,160,163,206,243,199,49,143,11,73,192,218,193,154,93,146,232,1,191,99,201,129,94,131,59,107,227,216,17,31,101,67,153,177,189,164,194,224,164,78,160,42,79,131,65,37,78,226,201,200,180,128,38,101,164,193,72,82,196,88,204,145,94,235,84,13,243,0,149,99,175,203,211,108,177,156,17,27,40,87,195,19,56,39,102,103,42,27,60,30,44,204,157,107,121,128,68,93,216,123,
<a name="1655"/> 1655:            106,112,105,74,7,142,155,171,1,8,31,123,245,78,142,111,142,178,127,169,202,110,125,35,192,199,23,203,201,103,44,99,100,192,156,214,62,109,71,205,66,32,81,252,124,138,238,225,88,247,85,255,65,141,131,234,184,248,20,51,81,71,19,98,102,114,96,49,77,1,79,27,18,218,79,37,232,194,204,172,54,124,167,188,158,43,54,183,230,40,230,152,216,12,27,56,66,104,238,235,52,176,110,159,88,151,7,228,201,248,195,82,131,220,31,104,44,239,147,61,71,35,245&gt;&gt;},
<a name="1656"/> 1656:     OcspRespDer =
<a name="1657"/> 1657:         &lt;&lt;48,130,7,36,10,1,0,160,130,7,29,48,130,7,25,6,9,43,6,1,5,5,7,48,1,1,4,130,7,10,48,130,7,6,48,130,1,10,161,129,134,48,129,131,49,14,48,12,6,3,85,4,3,12,5,111,116,112,67,65,49,19,48,17,6,3,85,4,11,12,10,69,114,108,97,110,103,32,79,84,80,49,20,48,18,6,3,85,4,10,12,11,69,114,105,99,115,115,111,110,32,65,66,49,11,48,9,6,3,85,4,6,19,2,83,69,49,18,48,16,6,3,85,4,7,12,9,83,116,111,99,107,104,111,108,109,49,37,48,35,6,9,42,134,72,134,247,13,1,9,1,22,22,112,101,116,101,114,64,101,114,105,120,46,101,
<a name="1658"/> 1658:           114,105,99,115,115,111,110,46,115,101,24,15,50,48,50,51,48,55,50,49,49,49,48,55,50,53,90,48,81,48,79,48,58,48,9,6,5,43,14,3,2,26,5,0,4,20,227,147,252,182,155,101,129,45,194,162,22,93,127,46,112,193,196,28,241,232,4,20,123,93,133,100,41,175,227,134,140,47,217,84,132,181,89,186,102,41,30,255,2,1,9,128,0,24,15,50,48,50,51,48,55,50,49,49,49,48,55,50,53,90,161,27,48,25,48,23,6,9,43,6,1,5,5,7,48,1,2,4,10,4,8,244,183,192,191,230,8,236,82,48,13,6,9,42,134,72,134,247,13,1,1,11,5,0,3,130,1,1,0,151,99,
<a name="1659"/> 1659:           102,238,65,164,80,97,143,115,223,2,201,56,75,220,145,150,17,27,9,169,149,158,40,226,29,109,8,35,234,24,59,113,1,26,123,144,32,68,235,210,36,55,61,215,0,183,49,156,52,153,132,237,180,231,43,45,18,138,126,118,173,130,246,213,225,216,15,85,248,146,35,220,27,100,93,232,234,91,206,224,98,18,48,52,95,213,129,117,11,174,228,48,220,235,82,141,157,179,13,119,17,244,189,21,77,102,114,166,227,25,160,113,148,244,142,33,232,161,77,189,187,72,196,144,82,70,200,250,222,68,154,153,20,33,60,4,252,151,16,64,
<a name="1660"/> 1660:           207,109,4,30,49,47,75,150,122,24,90,22,226,156,91,30,83,141,79,29,116,58,13,185,66,215,89,19,64,194,190,72,113,112,136,61,75,5,138,239,108,222,87,212,193,155,108,150,47,180,73,3,110,216,68,189,146,8,179,94,110,147,207,86,2,65,251,193,111,254,43,200,77,72,154,214,13,40,48,209,104,42,105,175,163,52,160,39,92,238,240,174,145,3,33,49,33,231,26,14,5,32,33,220,74,149,25,163,131,65,30,63,134,148,160,130,4,224,48,130,4,220,48,130,4,216,48,130,3,192,160,3,2,1,2,2,1,1,48,13,6,9,42,134,72,134,247,13,1,
<a name="1661"/> 1661:           1,11,5,0,48,129,134,49,17,48,15,6,3,85,4,3,12,8,101,114,108,97,110,103,67,65,49,19,48,17,6,3,85,4,11,12,10,69,114,108,97,110,103,32,79,84,80,49,20,48,18,6,3,85,4,10,12,11,69,114,105,99,115,115,111,110,32,65,66,49,18,48,16,6,3,85,4,7,12,9,83,116,111,99,107,104,111,108,109,49,11,48,9,6,3,85,4,6,19,2,83,69,49,37,48,35,6,9,42,134,72,134,247,13,1,9,1,22,22,112,101,116,101,114,64,101,114,105,120,46,101,114,105,99,115,115,111,110,46,115,101,48,30,23,13,50,51,48,55,50,49,49,49,48,55,50,48,90,23,13,
<a name="1662"/> 1662:           51,51,48,53,50,57,49,49,48,55,50,48,90,48,129,131,49,14,48,12,6,3,85,4,3,12,5,111,116,112,67,65,49,19,48,17,6,3,85,4,11,12,10,69,114,108,97,110,103,32,79,84,80,49,20,48,18,6,3,85,4,10,12,11,69,114,105,99,115,115,111,110,32,65,66,49,11,48,9,6,3,85,4,6,19,2,83,69,49,18,48,16,6,3,85,4,7,12,9,83,116,111,99,107,104,111,108,109,49,37,48,35,6,9,42,134,72,134,247,13,1,9,1,22,22,112,101,116,101,114,64,101,114,105,120,46,101,114,105,99,115,115,111,110,46,115,101,48,130,1,34,48,13,6,9,42,134,72,134,247,
<a name="1663"/> 1663:           13,1,1,1,5,0,3,130,1,15,0,48,130,1,10,2,130,1,1,0,173,38,214,237,131,195,86,49,85,177,225,21,254,222,227,229,5,62,193,131,224,141,51,233,36,68,108,11,164,68,95,160,243,171,55,43,32,228,15,5,179,194,124,9,53,219,33,15,243,77,206,104,255,63,250,231,185,218,111,190,98,34,71,38,139,51,202,112,110,85,248,177,207,156,210,51,28,18,236,236,4,188,58,33,169,250,181,59,114,133,246,82,217,36,166,28,3,70,49,82,68,36,134,32,57,142,168,231,193,73,219,102,49,13,97,199,40,138,118,250,244,41,206,121,115,208,
<a name="1664"/> 1664:           19,230,5,243,38,239,1,36,41,13,232,86,191,182,144,86,6,211,57,117,243,216,229,51,99,224,126,39,125,40,127,104,11,72,234,205,113,200,92,92,16,19,136,114,193,132,13,94,240,242,21,211,46,12,85,64,205,36,26,63,69,187,206,233,0,170,217,10,160,20,147,236,233,244,66,234,133,95,84,34,109,40,107,163,119,22,202,156,112,153,240,188,17,145,105,157,23,239,140,106,7,155,196,161,187,21,174,181,169,137,91,242,134,9,35,52,159,36,160,30,169,36,130,60,61,61,245,235,229,135,2,3,1,0,1,163,130,1,80,48,130,1,76,48,
<a name="1665"/> 1665:           15,6,3,85,29,19,1,1,255,4,5,48,3,1,1,255,48,11,6,3,85,29,15,4,4,3,2,1,6,48,29,6,3,85,29,14,4,22,4,20,123,93,133,100,41,175,227,134,140,47,217,84,132,181,89,186,102,41,30,255,48,129,198,6,3,85,29,35,4,129,190,48,129,187,128,20,229,159,14,81,153,72,30,27,33,37,234,91,103,205,230,72,95,185,112,95,161,129,140,164,129,137,48,129,134,49,17,48,15,6,3,85,4,3,12,8,101,114,108,97,110,103,67,65,49,19,48,17,6,3,85,4,11,12,10,69,114,108,97,110,103,32,79,84,80,49,20,48,18,6,3,85,4,10,12,11,69,114,105,99,
<a name="1666"/> 1666:           115,115,111,110,32,65,66,49,18,48,16,6,3,85,4,7,12,9,83,116,111,99,107,104,111,108,109,49,11,48,9,6,3,85,4,6,19,2,83,69,49,37,48,35,6,9,42,134,72,134,247,13,1,9,1,22,22,112,101,116,101,114,64,101,114,105,120,46,101,114,105,99,115,115,111,110,46,115,101,130,20,118,51,84,213,187,124,136,133,219,84,17,35,72,97,52,24,238,100,168,43,48,33,6,3,85,29,17,4,26,48,24,129,22,112,101,116,101,114,64,101,114,105,120,46,101,114,105,99,115,115,111,110,46,115,101,48,33,6,3,85,29,18,4,26,48,24,129,22,112,101,
<a name="1667"/> 1667:           116,101,114,64,101,114,105,120,46,101,114,105,99,115,115,111,110,46,115,101,48,13,6,9,42,134,72,134,247,13,1,1,11,5,0,3,130,1,1,0,44,128,75,220,253,223,223,77,33,57,30,205,101,103,200,211,254,81,122,195,123,239,98,5,118,58,179,193,24,93,12,243,124,194,160,163,206,243,199,49,143,11,73,192,218,193,154,93,146,232,1,191,99,201,129,94,131,59,107,227,216,17,31,101,67,153,177,189,164,194,224,164,78,160,42,79,131,65,37,78,226,201,200,180,128,38,101,164,193,72,82,196,88,204,145,94,235,84,13,243,0,149,
<a name="1668"/> 1668:           99,175,203,211,108,177,156,17,27,40,87,195,19,56,39,102,103,42,27,60,30,44,204,157,107,121,128,68,93,216,123,106,112,105,74,7,142,155,171,1,8,31,123,245,78,142,111,142,178,127,169,202,110,125,35,192,199,23,203,201,103,44,99,100,192,156,214,62,109,71,205,66,32,81,252,124,138,238,225,88,247,85,255,65,141,131,234,184,248,20,51,81,71,19,98,102,114,96,49,77,1,79,27,18,218,79,37,232,194,204,172,54,124,167,188,158,43,54,183,230,40,230,152,216,12,27,56,66,104,238,235,52,176,110,159,88,151,7,228,201,
<a name="1669"/> 1669:           248,195,82,131,220,31,104,44,239,147,61,71,35,245&gt;&gt;,
<a name="1670"/> 1670:     NonceExt = &lt;&lt;4,8,244,183,192,191,230,8,236,82&gt;&gt;,
<a name="pkix_ocsp_validate-last_expr"/><a name="1671"/> 1671:     {ok, []} =
<a name="1672"/> 1672:         public_key:pkix_ocsp_validate(Cert, IssuerCert, OcspRespDer, NonceExt, []).
<a name="1673"/> 1673: 
<a name="1674"/> 1674: <i>%%--------------------------------------------------------------------</i>
<a name="cacerts_load-0"/><a name="1675"/> 1675: <b>cacerts_load</b>() -&gt;
<a name="cacerts_load-last_expr"/><a name="1676"/> 1676:     [{doc, &quot;Basic tests of cacerts functionality&quot;}].
<a name="cacerts_load-1"/><a name="1677"/> 1677: <b>cacerts_load</b>(Config) -&gt;
<a name="1678"/> 1678:     Datadir = proplists:get_value(data_dir, Config),
<a name="1679"/> 1679:     {error, enoent} = public_key:cacerts_load(&quot;/dummy.file&quot;),
<a name="1680"/> 1680: 
<a name="1681"/> 1681:     %% White box testing of paths loading
<a name="1682"/> 1682:     %% TestDirs
<a name="1683"/> 1683:     ok = pubkey_os_cacerts:load([filename:join(Datadir, &quot;non_existing_dir&quot;),
<a name="1684"/> 1684:                                  Datadir,
<a name="1685"/> 1685:                                  filename:join(Datadir, &quot;cacerts.pem&quot;)
<a name="1686"/> 1686:                                 ]),
<a name="1687"/> 1687:     true = 10 &lt; length(public_key:cacerts_get()),
<a name="1688"/> 1688:     %% We currently pick the first found in input order
<a name="1689"/> 1689:     ok = pubkey_os_cacerts:load([filename:join(Datadir, &quot;non_existing_file&quot;),
<a name="1690"/> 1690:                                  filename:join(Datadir, &quot;ldap_uri_cert.pem&quot;),
<a name="1691"/> 1691:                                  filename:join(Datadir, &quot;cacerts.pem&quot;)]),
<a name="1692"/> 1692:     1 = length(public_key:cacerts_get()),
<a name="1693"/> 1693:     ok = pubkey_os_cacerts:load([filename:join(Datadir, &quot;non_existing_file&quot;),
<a name="1694"/> 1694:                                  filename:join(Datadir, &quot;cacerts.pem&quot;),
<a name="1695"/> 1695:                                  filename:join(Datadir, &quot;ldap_uri_cert.pem&quot;)]),
<a name="1696"/> 1696:     2 = length(public_key:cacerts_get()),
<a name="1697"/> 1697: 
<a name="1698"/> 1698:     true = public_key:cacerts_clear(),
<a name="1699"/> 1699: 
<a name="1700"/> 1700:     LinkedCaCerts = filename:join(Datadir, &quot;link_to_cacerts.pem&quot;),
<a name="1701"/> 1701:     case file:make_symlink(filename:join(Datadir, &quot;cacerts.pem&quot;), LinkedCaCerts) of
<a name="1702"/> 1702:         ok -&gt;
<a name="1703"/> 1703:             ok = pubkey_os_cacerts:load([LinkedCaCerts]),
<a name="1704"/> 1704:             2 = length(public_key:cacerts_get()),
<a name="1705"/> 1705:             true = public_key:cacerts_clear(),
<a name="1706"/> 1706:             ok = file:delete(LinkedCaCerts);
<a name="1707"/> 1707:         _ -&gt;
<a name="1708"/> 1708:             ok
<a name="1709"/> 1709:     end,
<a name="1710"/> 1710: 
<a name="1711"/> 1711:     %% Load from application environment
<a name="1712"/> 1712:     application:set_env(public_key, cacerts_path, filename:join(Datadir, &quot;cacerts.pem&quot;)),
<a name="1713"/> 1713:     2 = length(public_key:cacerts_get()),
<a name="1714"/> 1714:     application:unset_env(public_key, cacerts_path),
<a name="1715"/> 1715:     true = public_key:cacerts_clear(),
<a name="1716"/> 1716: 
<a name="1717"/> 1717:     %% Load default OS certs
<a name="1718"/> 1718:     %%    there is no default installed OS certs on netbsd
<a name="1719"/> 1719:     %%    can be installed with 'pkgin install mozilla-rootcerts'
<a name="1720"/> 1720:     IsNetBsd = element(2, os:type()) =:= netbsd,
<a name="1721"/> 1721:     OsCerts = try
<a name="1722"/> 1722:                   Certs = public_key:cacerts_get(),
<a name="1723"/> 1723:                   true = public_key:cacerts_clear(),
<a name="1724"/> 1724:                   Certs
<a name="1725"/> 1725:               catch _:{badmatch, {error, enoent}} when IsNetBsd -&gt; netbsd
<a name="1726"/> 1726:               end,
<a name="1727"/> 1727: 
<a name="1728"/> 1728:     false = public_key:cacerts_clear(),
<a name="1729"/> 1729: 
<a name="1730"/> 1730:     %% Reload from file
<a name="1731"/> 1731:     ok = public_key:cacerts_load(filename:join(Datadir, &quot;cacerts.pem&quot;)),
<a name="1732"/> 1732:     [_TestCert1, _TestCert2] = public_key:cacerts_get(),
<a name="1733"/> 1733: 
<a name="1734"/> 1734:     %% Reload default OS certs
<a name="cacerts_load-last_expr"/><a name="1735"/> 1735:     try
<a name="1736"/> 1736:         process_flag(trap_exit, true),
<a name="1737"/> 1737:         flush(),
<a name="1738"/> 1738:         ok = public_key:cacerts_load(),
<a name="1739"/> 1739:         [] = flush(),
<a name="1740"/> 1740:         ct:log(&quot;~p: ~p~n&quot;, [os:type(), length(OsCerts)]),
<a name="1741"/> 1741:         OsCerts = public_key:cacerts_get(),
<a name="1742"/> 1742:         Ids = cert_info(OsCerts),
<a name="1743"/> 1743:         Check = fun(ShouldBeThere) -&gt;
<a name="1744"/> 1744:                         lists:any(fun(#{id:=Id}) -&gt; lists:prefix(ShouldBeThere, Id) end, Ids)
<a name="1745"/> 1745:                 end,
<a name="1746"/> 1746:         case lists:partition(Check, [&quot;digicert&quot;, &quot;globalsign&quot;]) of
<a name="1747"/> 1747:             {_, []} -&gt; ok;
<a name="1748"/> 1748:             {_, Fail} -&gt;
<a name="1749"/> 1749:                 cert_info(OsCerts),
<a name="1750"/> 1750:                 [] = Fail
<a name="1751"/> 1751:         end,
<a name="1752"/> 1752:         ok
<a name="1753"/> 1753:     catch _:{badmatch, {error, enoent}} when IsNetBsd -&gt;
<a name="1754"/> 1754:             ok
<a name="1755"/> 1755:     end.
<a name="1756"/> 1756: 
<a name="flush-0"/><a name="1757"/> 1757: <b>flush</b>() -&gt;
<a name="flush-last_expr"/><a name="1758"/> 1758: <b>    receive Msg -&gt; [Msg|flush</b>()]
<a name="1759"/> 1759:     after 500 -&gt; []
<a name="1760"/> 1760:     end.
<a name="1761"/> 1761: 
<a name="cert_info-1"/><a name="1762"/> 1762: <b>cert_info</b>([#cert{der=Der, otp=#'OTPCertificate'{tbsCertificate = C0}=Cert}|Rest]) when is_binary(Der) -&gt;
<a name="1763"/> 1763:     #'OTPTBSCertificate'{subject = Subject, serialNumber = _Nr, issuer = Issuer0} = C0,
<a name="1764"/> 1764:     C = case public_key:pkix_is_self_signed(Cert) of
<a name="1765"/> 1765:             true  -&gt; #{id =&gt; subject(Subject), ss =&gt; true};
<a name="1766"/> 1766:             false -&gt;
<a name="1767"/> 1767:                 case public_key:pkix_issuer_id(Cert, other) of
<a name="1768"/> 1768:                     {ok, {_IsNr, Issuer}} -&gt;
<a name="1769"/> 1769:                         #{id =&gt; subject(Subject), ss =&gt; false, issuer =&gt; subject(Issuer)};
<a name="1770"/> 1770:                     {error, _} -&gt;
<a name="1771"/> 1771:                         #{id =&gt; subject(Subject), ss =&gt; false, issuer =&gt; subject(Issuer0)}
<a name="1772"/> 1772:                 end
<a name="1773"/> 1773:         end,
<a name="1774"/> 1774:     [C|cert_info(Rest)];
<a name="1775"/> 1775: <b>cert_info</b>([]) -&gt;
<a name="cert_info-last_expr"/><a name="1776"/> 1776:     [].
<a name="1777"/> 1777: 
<a name="1778"/> 1778: 
<a name="subject-1"/><a name="1779"/> 1779: <b>subject</b>(S) -&gt;
<a name="subject-last_expr"/><a name="1780"/> 1780: <b>    string:lowercase</b>(subject(public_key:pkix_normalize_name(S), &quot;unknown&quot;)).
<a name="1781"/> 1781: 
<a name="subject-2"/><a name="1782"/> 1782: <b>subject</b>({rdnSequence, Seq}, Def) -&gt;
<a name="1783"/> 1783:     subject(Seq, Def);
<a name="1784"/> 1784: <b>subject</b>([[{'AttributeTypeAndValue', ?'id-at-commonName', Name0}]|_], _Def) -&gt;
<a name="1785"/> 1785:     case Name0 of
<a name="1786"/> 1786:         {printableString, Name} -&gt; Name;
<a name="1787"/> 1787:         {utf8String, Name} -&gt; unicode:characters_to_list(Name);
<a name="1788"/> 1788:         Name -&gt; Name
<a name="1789"/> 1789:     end;
<a name="1790"/> 1790: <b>subject</b>([[{'AttributeTypeAndValue', ?'id-at-organizationName', Name0}]|Rest], _Def) -&gt;
<a name="1791"/> 1791:     Name = case Name0 of
<a name="1792"/> 1792:                {printableString, Name1} -&gt; Name1;
<a name="1793"/> 1793:                {utf8String, Name1} -&gt; unicode:characters_to_list(Name1);
<a name="1794"/> 1794:                Name1 -&gt; Name1
<a name="1795"/> 1795:            end,
<a name="1796"/> 1796:     subject(Rest, Name);
<a name="1797"/> 1797: <b>subject</b>([_|R], Def) -&gt;
<a name="1798"/> 1798:     subject(R, Def);
<a name="1799"/> 1799: <b>subject</b>([], Def) -&gt;
<a name="subject-last_expr"/><a name="1800"/> 1800:     Def.
<a name="1801"/> 1801: 
<a name="list_cacerts-0"/><a name="1802"/> 1802: <b>list_cacerts</b>() -&gt;
<a name="1803"/> 1803:     Certs = public_key:cacerts_get(),
<a name="1804"/> 1804:     %% io:format(&quot;~P~n&quot;,[Certs, 20]),
<a name="1805"/> 1805:     IO = fun(C, N) -&gt; io:format(&quot;~.3w:~0p~n&quot;, [N,C]), N+1 end,
<a name="1806"/> 1806:     lists:foldl(IO, 0, lists:sort(cert_info(Certs))),
<a name="list_cacerts-last_expr"/><a name="1807"/> 1807:     ok.
<a name="1808"/> 1808: 
<a name="1809"/> 1809: 
<a name="1810"/> 1810: <i>%%--------------------------------------------------------------------</i>
<a name="1811"/> 1811: <i>%% Internal functions ------------------------------------------------</i>
<a name="1812"/> 1812: <i>%%--------------------------------------------------------------------</i>
<a name="asn1_encode_decode-1"/><a name="1813"/> 1813: <b>asn1_encode_decode</b>({Asn1Type, Der, not_encrypted} = Entry) -&gt;
<a name="1814"/> 1814:     Decoded = public_key:der_decode(Asn1Type, Der),
<a name="1815"/> 1815:     Decoded = public_key:pem_entry_decode(Entry),
<a name="1816"/> 1816:     Entry = public_key:pem_entry_encode(Asn1Type, Decoded),
<a name="asn1_encode_decode-last_expr"/><a name="1817"/> 1817:     ok.
<a name="1818"/> 1818:     
<a name="check_countryname-1"/><a name="1819"/> 1819: <b>check_countryname</b>({rdnSequence,DirName}) -&gt;
<a name="check_countryname-last_expr"/><a name="1820"/> 1820: <b>    do_check_countryname</b>(DirName).
<a name="do_check_countryname-1"/><a name="1821"/> 1821: <b>do_check_countryname</b>([]) -&gt;
<a name="1822"/> 1822:     ok;
<a name="1823"/> 1823: <b>do_check_countryname</b>([#'AttributeTypeAndValue'{type = ?'id-at-countryName',
<a name="1824"/> 1824: 					       value = &quot;US&quot;}|_]) -&gt;
<a name="1825"/> 1825:     ok;
<a name="1826"/> 1826: <b>do_check_countryname</b>([#'AttributeTypeAndValue'{type = ?'id-at-countryName',
<a name="1827"/> 1827: 					       value =  Value}|_]) -&gt;
<a name="1828"/> 1828:     ct:fail({incorrect_country_name, Value});
<a name="1829"/> 1829: <b>do_check_countryname</b>([_| Rest]) -&gt;
<a name="do_check_countryname-last_expr"/><a name="1830"/> 1830: <b>    do_check_countryname</b>(Rest).
<a name="1831"/> 1831: 
<a name="check_emailaddress-1"/><a name="1832"/> 1832: <b>check_emailaddress</b>({rdnSequence,DirName}) -&gt;
<a name="check_emailaddress-last_expr"/><a name="1833"/> 1833: <b>    do_check_emailaddress</b>(DirName).
<a name="do_check_emailaddress-1"/><a name="1834"/> 1834: <b>do_check_emailaddress</b>([]) -&gt;
<a name="1835"/> 1835:     ok;
<a name="1836"/> 1836: <b>do_check_emailaddress</b>([#'AttributeTypeAndValue'{type = ?'id-emailAddress',
<a name="1837"/> 1837: 					       value = &quot;invalid@email.com&quot;}|_]) -&gt;
<a name="1838"/> 1838:     ok;
<a name="1839"/> 1839: <b>do_check_emailaddress</b>([#'AttributeTypeAndValue'{type = ?'id-emailAddress',
<a name="1840"/> 1840: 					       value =  Value}|_]) -&gt;
<a name="1841"/> 1841:     ct:fail({incorrect_email_address, Value});
<a name="1842"/> 1842: <b>do_check_emailaddress</b>([_| Rest]) -&gt;
<a name="do_check_emailaddress-last_expr"/><a name="1843"/> 1843: <b>    do_check_emailaddress</b>(Rest).
<a name="1844"/> 1844: 
<a name="check_entry_type-2"/><a name="1845"/> 1845: <b>check_entry_type</b>(#'DSAPrivateKey'{}, 'DSAPrivateKey') -&gt;
<a name="1846"/> 1846:     true;
<a name="1847"/> 1847: <b>check_entry_type</b>(#'RSAPrivateKey'{}, 'RSAPrivateKey') -&gt;
<a name="1848"/> 1848:     true;
<a name="1849"/> 1849: <b>check_entry_type</b>(#'RSAPublicKey'{}, 'RSAPublicKey') -&gt;
<a name="1850"/> 1850:     true;
<a name="1851"/> 1851: <b>check_entry_type</b>({_Int, #'Dss-Parms'{}}, 'DSAPublicKey') when is_integer(_Int) -&gt;
<a name="1852"/> 1852:     true;
<a name="1853"/> 1853: <b>check_entry_type</b>(#'DHParameter'{}, 'DHParameter') -&gt;
<a name="1854"/> 1854:     true;
<a name="1855"/> 1855: <b>check_entry_type</b>(#'Certificate'{}, 'Certificate') -&gt;
<a name="1856"/> 1856:     true;
<a name="1857"/> 1857: <b>check_entry_type</b>({#'ECPoint'{}, _}, 'ECPoint') -&gt;
<a name="1858"/> 1858:     true;
<a name="1859"/> 1859: <b>check_entry_type</b>(#'ECPrivateKey'{}, 'ECPrivateKey') -&gt;
<a name="1860"/> 1860:     true;
<a name="1861"/> 1861: <b>check_entry_type</b>({namedCurve, _}, 'EcpkParameters') -&gt;
<a name="1862"/> 1862:     true;
<a name="1863"/> 1863: <b>check_entry_type</b>({ecParameters, #'ECParameters'{}}, 'EcpkParameters') -&gt;
<a name="1864"/> 1864:     true;
<a name="1865"/> 1865: <b>check_entry_type</b>(_,_) -&gt;
<a name="check_entry_type-last_expr"/><a name="1866"/> 1866:     false.
<a name="1867"/> 1867: 
<a name="check_encapsulated_header-1"/><a name="1868"/> 1868: <b>check_encapsulated_header</b>(Pem) when is_binary(Pem)-&gt;
<a name="1869"/> 1869:     check_encapsulated_header( binary:split(Pem, &lt;&lt;&quot;\n&quot;&gt;&gt;, [global]));
<a name="1870"/> 1870: <b>check_encapsulated_header</b>([&lt;&lt;&quot;DEK-Info: DES-CBC,FB7577791A9056A1&quot;&gt;&gt;, &lt;&lt;&gt;&gt; | _]) -&gt;
<a name="1871"/> 1871:     true;
<a name="1872"/> 1872: <b>check_encapsulated_header</b>([ _ | Rest]) -&gt;
<a name="1873"/> 1873:     check_encapsulated_header(Rest);
<a name="1874"/> 1874: <b>check_encapsulated_header</b>([]) -&gt;
<a name="check_encapsulated_header-last_expr"/><a name="1875"/> 1875:     false.
<a name="1876"/> 1876: 
<a name="strip_superfluous_newlines-1"/><a name="1877"/> 1877: <b>strip_superfluous_newlines</b>(Bin) -&gt;
<a name="1878"/> 1878:     Str = string:strip(binary_to_list(Bin), right, 10),
<a name="1879"/> 1879:     Str1 = remove_license_header(Str),
<a name="strip_superfluous_newlines-last_expr"/><a name="1880"/> 1880: <b>    re:replace</b>(Str1,&quot;\n\n&quot;,&quot;\n&quot;, [{return,list}, global]).
<a name="1881"/> 1881: 
<a name="remove_license_header-1"/><a name="1882"/> 1882: <b>remove_license_header</b>(&quot;##&quot; ++ _=String) -&gt;
<a name="1883"/> 1883:     case string:split(String, &quot;\n&quot;) of
<a name="1884"/> 1884:         [_, Tail] -&gt;
<a name="1885"/> 1885:             remove_license_header(Tail);
<a name="1886"/> 1886:         [Other] -&gt;
<a name="1887"/> 1887:             Other
<a name="1888"/> 1888:     end;
<a name="1889"/> 1889: <b>remove_license_header</b>(Code) -&gt;
<a name="remove_license_header-last_expr"/><a name="1890"/> 1890:     Code.
<a name="1891"/> 1891: 
<a name="do_gen_ec_param-1"/><a name="1892"/> 1892: <b>do_gen_ec_param</b>(File) -&gt;    
<a name="1893"/> 1893:     {ok, KeyPem} = file:read_file(File),
<a name="1894"/> 1894:     Entries = public_key:pem_decode(KeyPem),
<a name="1895"/> 1895:     [ParamInfo] = [Entry || Entry={'EcpkParameters', _, not_encrypted} &lt;- Entries],
<a name="1896"/> 1896:     {ecParameters, Params} = public_key:pem_entry_decode(ParamInfo),
<a name="1897"/> 1897:     Key = public_key:generate_key(Params),
<a name="do_gen_ec_param-last_expr"/><a name="1898"/> 1898: <b>    case check_entry_type</b>(Key, 'ECPrivateKey') of
<a name="1899"/> 1899:         true -&gt;
<a name="1900"/> 1900:             ok;
<a name="1901"/> 1901:         false -&gt;
<a name="1902"/> 1902:             ct:fail({key_gen_fail, File})
<a name="1903"/> 1903:     end.
<a name="1904"/> 1904: 
<a name="init_per_testcase_gen_ec_param-3"/><a name="1905"/> 1905: <b>init_per_testcase_gen_ec_param</b>(_TC, Curve, Config) -&gt;
<a name="init_per_testcase_gen_ec_param-last_expr"/><a name="1906"/> 1906: <b>    case crypto:ec_curves</b>() of
<a name="1907"/> 1907:         [] -&gt;
<a name="1908"/> 1908:             {skip, missing_ec_support};
<a name="1909"/> 1909:         Curves -&gt;
<a name="1910"/> 1910:             case lists:member(Curve, Curves)
<a name="1911"/> 1911:                 andalso crypto_supported_curve(Curve, Curves)
<a name="1912"/> 1912:             of
<a name="1913"/> 1913:                 true -&gt;
<a name="1914"/> 1914:                     init_common_per_testcase(Config);
<a name="1915"/> 1915:                 false -&gt;
<a name="1916"/> 1916:                     {skip, {missing_ec_support, Curve}}
<a name="1917"/> 1917:             end
<a name="1918"/> 1918:     end.
<a name="1919"/> 1919: 
<a name="1920"/> 1920: 
<a name="crypto_supported_curve-2"/><a name="1921"/> 1921: <b>crypto_supported_curve</b>(Curve, _Curves) -&gt;
<a name="crypto_supported_curve-last_expr"/><a name="1922"/> 1922: <b>    try crypto:generate_key</b>(ecdh, Curve) of
<a name="1923"/> 1923:         {error,_} -&gt; false; % Just in case crypto is changed in the future...
<a name="1924"/> 1924:         _-&gt; true
<a name="1925"/> 1925:     catch
<a name="1926"/> 1926:         _:_-&gt; false
<a name="1927"/> 1927:     end.
<a name="1928"/> 1928: 
<a name="1929"/> 1929: 
<a name="incorrect_countryname_pkix_cert-0"/><a name="1930"/> 1930: <b>incorrect_countryname_pkix_cert</b>() -&gt;
<a name="incorrect_countryname_pkix_cert-last_expr"/><a name="1931"/> 1931:     &lt;&lt;48,130,5,186,48,130,4,162,160,3,2,1,2,2,7,7,250,61,63,6,140,137,48,13,6,9,42, 134,72,134,247,13,1,1,5,5,0,48,129,220,49,11,48,9,6,3,85,4,6,19,2,85,83,49, 16,48,14,6,3,85,4,8,19,7,65,114,105,122,111,110,97,49,19,48,17,6,3,85,4,7,19, 10,83,99,111,116,116,115,100,97,108,101,49,37,48,35,6,3,85,4,10,19,28,83,116, 97,114,102,105,101,108,100,32,84,101,99,104,110,111,108,111,103,105,101,115, 44,32,73,110,99,46,49,57,48,55,6,3,85,4,11,19,48,104,116,116,112,58,47,47,99, 101,114,116,105,102,105,99,97,116,101,115,46,115,116,97,114,102,105,101,108, 100,116,101,99,104,46,99,111,109,47,114,101,112,111,115,105,116,111,114,121, 49,49,48,47,6,3,85,4,3,19,40,83,116,97,114,102,105,101,108,100,32,83,101,99, 117,114,101,32,67,101,114,116,105,102,105,99,97,116,105,111,110,32,65,117, 116,104,111,114,105,116,121,49,17,48,15,6,3,85,4,5,19,8,49,48,54,56,56,52,51, 53,48,30,23,13,49,48,49,48,50,51,48,49,51,50,48,53,90,23,13,49,50,49,48,50, 51,48,49,51,50,48,53,90,48,122,49,11,48,9,6,3,85,4,6,12,2,85,83,49,11,48,9,6, 3,85,4,8,12,2,65,90,49,19,48,17,6,3,85,4,7,12,10,83,99,111,116,116,115,100, 97,108,101,49,38,48,36,6,3,85,4,10,12,29,83,112,101,99,105,97,108,32,68,111, 109,97,105,110,32,83,101,114,118,105,99,101,115,44,32,73,110,99,46,49,33,48, 31,6,3,85,4,3,12,24,42,46,108,111,103,105,110,46,115,101,99,117,114,101,115, 101,114,118,101,114,46,110,101,116,48,130,1,34,48,13,6,9,42,134,72,134,247, 13,1,1,1,5,0,3,130,1,15,0,48,130,1,10,2,130,1,1,0,185,136,240,80,141,36,124, 245,182,130,73,19,188,74,166,117,72,228,185,209,43,129,244,40,44,193,231,11, 209,12,234,88,43,142,1,162,48,122,17,95,230,105,171,131,12,147,46,204,36,80, 250,171,33,253,35,62,83,22,71,212,186,141,14,198,89,89,121,204,224,122,246, 127,110,188,229,162,67,95,6,74,231,127,99,131,7,240,85,102,203,251,50,58,58, 104,245,103,181,183,134,32,203,121,232,54,32,188,139,136,112,166,126,14,91, 223,153,172,164,14,61,38,163,208,215,186,210,136,213,143,70,147,173,109,217, 250,169,108,31,211,104,238,103,93,182,59,165,43,196,189,218,241,30,148,240, 109,90,69,176,194,52,116,173,151,135,239,10,209,179,129,192,102,75,11,25,168, 223,32,174,84,223,134,70,167,55,172,143,27,130,123,226,226,7,34,142,166,39, 48,246,96,231,150,84,220,106,133,193,55,95,159,227,24,249,64,36,1,142,171,16, 202,55,126,7,156,15,194,22,116,53,113,174,104,239,203,120,45,131,57,87,84, 163,184,27,83,57,199,91,200,34,43,98,61,180,144,76,65,170,177,2,3,1,0,1,163, 130,1,224,48,130,1,220,48,15,6,3,85,29,19,1,1,255,4,5,48,3,1,1,0,48,29,6,3, 85,29,37,4,22,48,20,6,8,43,6,1,5,5,7,3,1,6,8,43,6,1,5,5,7,3,2,48,14,6,3,85, 29,15,1,1,255,4,4,3,2,5,160,48,56,6,3,85,29,31,4,49,48,47,48,45,160,43,160, 41,134,39,104,116,116,112,58,47,47,99,114,108,46,115,116,97,114,102,105,101, 108,100,116,101,99,104,46,99,111,109,47,115,102,115,50,45,48,46,99,114,108, 48,83,6,3,85,29,32,4,76,48,74,48,72,6,11,96,134,72,1,134,253,110,1,7,23,2,48, 57,48,55,6,8,43,6,1,5,5,7,2,1,22,43,104,116,116,112,115,58,47,47,99,101,114, 116,115,46,115,116,97,114,102,105,101,108,100,116,101,99,104,46,99,111,109, 47,114,101,112,111,115,105,116,111,114,121,47,48,129,141,6,8,43,6,1,5,5,7,1, 1,4,129,128,48,126,48,42,6,8,43,6,1,5,5,7,48,1,134,30,104,116,116,112,58,47, 47,111,99,115,112,46,115,116,97,114,102,105,101,108,100,116,101,99,104,46,99, 111,109,47,48,80,6,8,43,6,1,5,5,7,48,2,134,68,104,116,116,112,58,47,47,99, 101,114,116,105,102,105,99,97,116,101,115,46,115,116,97,114,102,105,101,108, 100,116,101,99,104,46,99,111,109,47,114,101,112,111,115,105,116,111,114,121, 47,115,102,95,105,110,116,101,114,109,101,100,105,97,116,101,46,99,114,116, 48,31,6,3,85,29,35,4,24,48,22,128,20,73,75,82,39,209,27,188,242,161,33,106, 98,123,81,66,122,138,215,213,86,48,59,6,3,85,29,17,4,52,48,50,130,24,42,46, 108,111,103,105,110,46,115,101,99,117,114,101,115,101,114,118,101,114,46,110, 101,116,130,22,108,111,103,105,110,46,115,101,99,117,114,101,115,101,114,118, 101,114,46,110,101,116,48,29,6,3,85,29,14,4,22,4,20,138,233,191,208,157,203, 249,85,242,239,20,195,48,10,148,49,144,101,255,116,48,13,6,9,42,134,72,134, 247,13,1,1,5,5,0,3,130,1,1,0,82,31,121,162,49,50,143,26,167,202,143,61,71, 189,201,199,57,81,122,116,90,192,88,24,102,194,174,48,157,74,27,87,210,223, 253,93,3,91,150,109,120,1,110,27,11,200,198,141,222,246,14,200,71,105,41,138, 13,114,122,106,63,17,197,181,234,121,61,89,74,65,41,231,248,219,129,83,176, 219,55,107,55,211,112,98,38,49,69,77,96,221,108,123,152,12,210,159,157,141, 43,226,55,187,129,3,82,49,136,66,81,196,91,234,196,10,82,48,6,80,163,83,71, 127,102,177,93,209,129,26,104,2,84,24,255,248,161,3,244,169,234,92,122,110, 43,4,17,113,185,235,108,219,210,236,132,216,177,227,17,169,58,162,159,182, 162,93,160,229,200,9,163,229,110,121,240,168,232,14,91,214,188,196,109,210, 164,222,0,109,139,132,113,91,16,118,173,178,176,80,132,34,41,199,51,206,250, 224,132,60,115,192,94,107,163,219,212,226,225,65,169,148,108,213,46,174,173, 103,110,189,229,166,149,254,31,51,44,144,108,187,182,11,251,201,206,86,138, 208,59,51,86,132,235,81,225,88,34,190,8,184&gt;&gt;.
<a name="1932"/> 1932: 
<a name="incorrect_emailaddress_pkix_cert-0"/><a name="1933"/> 1933: <b>incorrect_emailaddress_pkix_cert</b>() -&gt;
<a name="incorrect_emailaddress_pkix_cert-last_expr"/><a name="1934"/> 1934:     &lt;&lt;48,130,3,74,48,130,2,50,2,9,0,133,49,203,25,198,156,252,230,48,13,6,9,42,134, 72,134,247,13,1,1,5,5,0,48,103,49,11,48,9,6,3,85,4,6,19,2,65,85,49,19,48,17, 6,3,85,4,8,12,10,83,111,109,101,45,83,116,97,116,101,49,33,48,31,6,3,85,4,10, 12,24,73,110,116,101,114,110,101,116,32,87,105,100,103,105,116,115,32,80,116, 121,32,76,116,100,49,32,48,30,6,9,42,134,72,134,247,13,1,9,1,12,17,105,110, 118,97,108,105,100,64,101,109,97,105,108,46,99,111,109,48,30,23,13,49,51,49, 49,48,55,50,48,53,54,49,56,90,23,13,49,52,49,49,48,55,50,48,53,54,49,56,90, 48,103,49,11,48,9,6,3,85,4,6,19,2,65,85,49,19,48,17,6,3,85,4,8,12,10,83,111, 109,101,45,83,116,97,116,101,49,33,48,31,6,3,85,4,10,12,24,73,110,116,101, 114,110,101,116,32,87,105,100,103,105,116,115,32,80,116,121,32,76,116,100,49, 32,48,30,6,9,42,134,72,134,247,13,1,9,1,12,17,105,110,118,97,108,105,100,64, 101,109,97,105,108,46,99,111,109,48,130,1,34,48,13,6,9,42,134,72,134,247,13, 1,1,1,5,0,3,130,1,15,0,48,130,1,10,2,130,1,1,0,190,243,49,213,219,60,232,105, 1,127,126,9,130,15,60,190,78,100,148,235,246,223,21,91,238,200,251,84,55,212, 78,32,120,61,85,172,0,144,248,5,165,29,143,79,64,178,51,153,203,76,115,238, 192,49,173,37,121,203,89,62,157,13,181,166,30,112,154,40,202,140,104,211,157, 73,244,9,78,236,70,153,195,158,233,141,42,238,2,143,160,225,249,27,30,140, 151,176,43,211,87,114,164,108,69,47,39,195,123,185,179,219,28,218,122,53,83, 77,48,81,184,14,91,243,12,62,146,86,210,248,228,171,146,225,87,51,146,155, 116,112,238,212,36,111,58,41,67,27,6,61,61,3,84,150,126,214,121,57,38,12,87, 121,67,244,37,45,145,234,131,115,134,58,194,5,36,166,52,59,229,32,47,152,80, 237,190,58,182,248,98,7,165,198,211,5,31,231,152,116,31,108,71,218,64,188, 178,143,27,167,79,15,112,196,103,116,212,65,197,94,37,4,132,103,91,217,73, 223,207,185,7,153,221,240,232,31,44,102,108,82,83,56,242,210,214,74,71,246, 177,217,148,227,220,230,4,176,226,74,194,37,2,3,1,0,1,48,13,6,9,42,134,72, 134,247,13,1,1,5,5,0,3,130,1,1,0,89,247,141,154,173,123,123,203,143,85,28,79, 73,37,164,6,17,89,171,224,149,22,134,17,198,146,158,192,241,41,253,58,230, 133,71,189,43,66,123,88,15,242,119,227,249,99,137,61,200,54,161,0,177,167, 169,114,80,148,90,22,97,78,162,181,75,93,209,116,245,46,81,232,64,157,93,136, 52,57,229,113,197,218,113,93,42,161,213,104,205,137,30,144,183,58,10,98,47, 227,177,96,40,233,98,150,209,217,68,22,221,133,27,161,152,237,46,36,179,59, 172,97,134,194,205,101,137,71,192,57,153,20,114,27,173,233,166,45,56,0,61, 205,45,202,139,7,132,103,248,193,157,184,123,43,62,172,236,110,49,62,209,78, 249,83,219,133,1,213,143,73,174,16,113,143,189,41,84,60,128,222,30,177,104, 134,220,52,239,171,76,59,176,36,113,176,214,118,16,44,235,21,167,199,216,200, 76,219,142,248,13,70,145,205,216,230,226,148,97,223,216,179,68,209,222,63, 140,137,24,164,192,149,194,79,119,247,75,159,49,116,70,241,70,116,11,40,119, 176,157,36,160,102,140,255,34,248,25,231,136,59&gt;&gt;.
<a name="1935"/> 1935: 
<a name="hardcode_rsa_key-1"/><a name="1936"/> 1936: <b>hardcode_rsa_key</b>(1) -&gt;
<a name="1937"/> 1937:     #'RSAPrivateKey'{
<a name="1938"/> 1938:        version = 'two-prime',
<a name="1939"/> 1939:        modulus = 23995666614853919027835084074500048897452890537492185072956789802729257783422306095699263934587064480357348855732149402060270996295002843755712064937715826848741191927820899197493902093529581182351132392364214171173881547273475904587683433713767834856230531387991145055273426806331200574039205571401702219159773947658558490957010003143162250693492642996408861265758000254664396313741422909188635443907373976005987612936763564996605457102336549804831742940035613780926178523017685712710473543251580072875247250504243621640157403744718833162626193206685233710319205099867303242759099560438381385658382486042995679707669,
<a name="1940"/> 1940:        publicExponent = 17,
<a name="1941"/> 1941:        privateExponent = 11292078406990079542510627799764728892919007311761028269626724613049062486316379339152594792746853873109340637991599718616598115903530750002688030558925094987642913848386305504703012749896273497577003478759630198199473669305165131570674557041773098755873191241407597673069847908861741446606684974777271632545629600685952292605647052193819136445675100211504432575554351515262198132231537860917084269870590492135731720141577986787033006338680118008484613510063003323516659048210893001173583018220214626635609151105287049126443102976056146630518124476470236027123782297108342869049542023328584384300970694412006494684657,
<a name="1942"/> 1942:        prime1 = 169371138592582642967021557955633494538845517070305333860805485424261447791289944610138334410987654265476540480228705481960508520379619587635662291973699651583489223555422528867090299996446070521801757353675026048850480903160224210802452555900007597342687137394192939372218903554801584969667104937092080815197,
<a name="1943"/> 1943:        prime2 = 141675062317286527042995673340952251894209529891636708844197799307963834958115010129693036021381525952081167155681637592199810112261679449166276939178032066869788822014115556349519329537177920752776047051833616197615329017439297361972726138285974555338480581117881706656603857310337984049152655480389797687577,
<a name="1944"/> 1944:        exponent1 = 119556097830058336212015217380447172615655659108450823901745048534772786676204666783627059584226579481512852103690850928442711896738555003036938088452023283470698275450886490965004917644550167427154181661417665446247398284583687678213495921811770068712485038160606780733330990744565824684470897602653233516609,
<a name="1945"/> 1945:        exponent2 = 41669135975672507953822256864985956439473391144599032012999352737636422046504414744027363535700448809435637398729893409470532385959317485048904982111185902020526124121798693043976273393287623750816484427009887116945685005129205106462566511260580751570141347387612266663707016855981760014456663376585234613993,
<a name="1946"/> 1946:        coefficient = 76837684977089699359024365285678488693966186052769523357232308621548155587515525857011429902602352279058920284048929101483304120686557782043616693940283344235057989514310975192908256494992960578961614059245280827077951132083993754797053182279229469590276271658395444955906108899267024101096069475145863928441,
<a name="1947"/> 1947:        otherPrimeInfos = asn1_NOVALUE};
<a name="1948"/> 1948: 
<a name="1949"/> 1949: <b>hardcode_rsa_key</b>(2) -&gt;
<a name="1950"/> 1950:     #'RSAPrivateKey'{
<a name="1951"/> 1951:        version = 'two-prime',
<a name="1952"/> 1952:        modulus = 21343679768589700771839799834197557895311746244621307033143551583788179817796325695589283169969489517156931770973490560582341832744966317712674900833543896521418422508485833901274928542544381247956820115082240721897193055368570146764204557110415281995205343662628196075590438954399631753508888358737971039058298703003743872818150364935790613286541190842600031570570099801682794056444451081563070538409720109449780410837763602317050353477918147758267825417201591905091231778937606362076129350476690460157227101296599527319242747999737801698427160817755293383890373574621116766934110792127739174475029121017282777887777,
<a name="1953"/> 1953:        publicExponent = 17,
<a name="1954"/> 1954:        privateExponent = 18832658619343853622211588088997845201745658451136447382185486691577805721584993260814073385267196632785528033211903435807948675951440868570007265441362261636545666919252206383477878125774454042314841278013741813438699754736973658909592256273895837054592950290554290654932740253882028017801960316533503857992358685308186680144968293076156011747178275038098868263178095174694099811498968993700538293188879611375604635940554394589807673542938082281934965292051746326331046224291377703201248790910007232374006151098976879987912446997911775904329728563222485791845480864283470332826504617837402078265424772379987120023773,
<a name="1955"/> 1955:        prime1 = 146807662748886761089048448970170315054939768171908279335181627815919052012991509112344782731265837727551849787333310044397991034789843793140419387740928103541736452627413492093463231242466386868459637115999163097726153692593711599245170083315894262154838974616739452594203727376460632750934355508361223110419,
<a name="1956"/> 1956:        prime2 = 145385325050081892763917667176962991350872697916072592966410309213561884732628046256782356731057378829876640317801978404203665761131810712267778698468684631707642938779964806354584156202882543264893826268426566901882487709510744074274965029453915224310656287149777603803201831202222853023280023478269485417083,
<a name="1957"/> 1957:        exponent1 = 51814469205489445090252393754177758254684624060673510353593515699736136004585238510239335081623236845018299924941168250963996835808180162284853901555621683602965806809675350150634081614988136541809283687999704622726877773856604093851236499993845033701707873394143336209718962603456693912094478414715725803677,
<a name="1958"/> 1958:        exponent2 = 51312467664734785681382706062457526359131540440966797517556579722433606376221663384746714140373192528191755406283051201483646739222992016094510128871300458249756331334105225772206172777487956446433115153562317730076172132768497908567634716277852432109643395464627389577600646306666889302334125933506877206029,
<a name="1959"/> 1959:        coefficient = 30504662229874176232343608562807118278893368758027179776313787938167236952567905398252901545019583024374163153775359371298239336609182249464886717948407152570850677549297935773605431024166978281486607154204888016179709037883348099374995148481968169438302456074511782717758301581202874062062542434218011141540,
<a name="1960"/> 1960:        otherPrimeInfos = asn1_NOVALUE};
<a name="1961"/> 1961: <b>hardcode_rsa_key</b>(3) -&gt; 
<a name="1962"/> 1962:     #'RSAPrivateKey'{ 
<a name="1963"/> 1963:        version = 'two-prime',
<a name="1964"/> 1964:        modulus = 25089040456112869869472694987833070928503703615633809313972554887193090845137746668197820419383804666271752525807484521370419854590682661809972833718476098189250708650325307850184923546875260207894844301992963978994451844985784504212035958130279304082438876764367292331581532569155681984449177635856426023931875082020262146075451989132180409962870105455517050416234175675478291534563995772675388370042873175344937421148321291640477650173765084699931690748536036544188863178325887393475703801759010864779559318631816411493486934507417755306337476945299570726975433250753415110141783026008347194577506976486290259135429,
<a name="1965"/> 1965:        publicExponent = 17,
<a name="1966"/> 1966:        privateExponent = 8854955455098659953931539407470495621824836570223697404931489960185796768872145882893348383311931058684147950284994536954265831032005645344696294253579799360912014817761873358888796545955974191021709753644575521998041827642041589721895044045980930852625485916835514940558187965584358347452650930302268008446431977397918214293502821599497633970075862760001650736520566952260001423171553461362588848929781360590057040212831994258783694027013289053834376791974167294527043946669963760259975273650548116897900664646809242902841107022557239712438496384819445301703021164043324282687280801738470244471443835900160721870265,
<a name="1967"/> 1967:        prime1 = 171641816401041100605063917111691927706183918906535463031548413586331728772311589438043965564336865070070922328258143588739626712299625805650832695450270566547004154065267940032684307994238248203186986569945677705100224518137694769557564475390859269797990555863306972197736879644001860925483629009305104925823,
<a name="1968"/> 1968:        prime2 =146170909759497809922264016492088453282310383272504533061020897155289106805616042710009332510822455269704884883705830985184223718261139908416790475825625309815234508695722132706422885088219618698987115562577878897003573425367881351537506046253616435685549396767356003663417208105346307649599145759863108910523,
<a name="1969"/> 1969:        exponent1 = 60579464612132153154728441333538327425711971378777222246428851853999433684345266860486105493295364142377972586444050678378691780811632637288529186629507258781295583787741625893888579292084087601124818789392592131211843947578009918667375697196773859928702549128225990187436545756706539150170692591519448797349,
<a name="1970"/> 1970:        exponent2 = 137572620950115585809189662580789132500998007785886619351549079675566218169991569609420548245479957900898715184664311515467504676010484619686391036071176762179044243478326713135456833024206699951987873470661533079532774988581535389682358631768109586527575902839864474036157372334443583670210960715165278974609,
<a name="1971"/> 1971:        coefficient = 15068630434698373319269196003209754243798959461311186548759287649485250508074064775263867418602372588394608558985183294561315208336731894947137343239541687540387209051236354318837334154993136528453613256169847839789803932725339395739618592522865156272771578671216082079933457043120923342632744996962853951612,
<a name="1972"/> 1972:        otherPrimeInfos = asn1_NOVALUE};
<a name="1973"/> 1973: <b>hardcode_rsa_key</b>(4) -&gt;
<a name="hardcode_rsa_key-last_expr"/><a name="1974"/> 1974:     #'RSAPrivateKey'{
<a name="1975"/> 1975:        version ='two-prime',
<a name="1976"/> 1976:        modulus = 28617237755030755643854803617273584643843067580642149032833640135949799721163782522787597288521902619948688786051081993247908700824196122780349730169173433743054172191054872553484065655968335396052034378669869864779940355219732200954630251223541048434478476115391643898092650304645086338265930608997389611376417609043761464100338332976874588396803891301015812818307951159858145399281035705713082131199940309445719678087542976246147777388465712394062188801177717719764254900022006288880246925156931391594131839991579403409541227225173269459173129377291869028712271737734702830877034334838181789916127814298794576266389,
<a name="1977"/> 1977:        publicExponent = 17,
<a name="1978"/> 1978:        privateExponent = 26933870828264240605980991639786903194205240075898493207372837775011576208154148256741268036255908348187001210401018346586267012540419880263858569570986761169933338532757527109161473558558433313931326474042230460969355628442100895016122589386862163232450330461545076609969553227901257730132640573174013751883368376011370428995523268034111482031427024082719896108094847702954695363285832195666458915142143884210891427766607838346722974883433132513540317964796373298134261669479023445911856492129270184781873446960437310543998533283339488055776892320162032014809906169940882070478200435536171854883284366514852906334641,
<a name="1979"/> 1979:        prime1 = 177342190816702392178883147766999616783253285436834252111702533617098994535049411784501174309695427674025956656849179054202187436663487378682303508229883753383891163725167367039879190685255046547908384208614573353917213168937832054054779266431207529839577747601879940934691505396807977946728204814969824442867,
<a name="1980"/> 1980:        prime2 = 161367340863680900415977542864139121629424927689088951345472941851682581254789586032968359551717004797621579428672968948552429138154521719743297455351687337112710712475376510559020211584326773715482918387500187602625572442687231345855402020688502483137168684570635690059254866684191216155909970061793538842967,
<a name="1981"/> 1981:        exponent1 = 62591361464718491357252875682470452982324688977706206627659717747211409835899792394529826226951327414362102349476180842659595565881230839534930649963488383547255704844176717778780890830090016428673547367746320007264898765507470136725216211681602657590439205035957626212244060728285168687080542875871702744541,
<a name="1982"/> 1982:        exponent2 = 28476589564178982426348978152495139111074987239250991413906989738532220221433456358759122273832412611344984605059935696803369847909621479954699550944415412431654831613301737157474154985469430655673456186029444871051571607533040825739188591886206320553618003159523945304574388238386685203984112363845918619347,
<a name="1983"/> 1983:        coefficient = 34340318160575773065401929915821192439103777558577109939078671096408836197675640654693301707202885840826672396546056002756167635035389371579540325327619480512374920136684787633921441576901246290213545161954865184290700344352088099063404416346968182170720521708773285279884132629954461545103181082503707725012,
<a name="1984"/> 1984:        otherPrimeInfos = asn1_NOVALUE}.
<a name="1985"/> 1985: 
<a name="pss_params-1"/><a name="1986"/> 1986: <b>pss_params</b>(sha256) -&gt;
<a name="pss_params-last_expr"/><a name="1987"/> 1987:     #'RSASSA-PSS-params'{
<a name="1988"/> 1988:        hashAlgorithm = #'HashAlgorithm'{algorithm = ?'id-sha256'},
<a name="1989"/> 1989:        maskGenAlgorithm = #'MaskGenAlgorithm'{algorithm = ?'id-mgf1',
<a name="1990"/> 1990:                                               parameters = #'HashAlgorithm'{algorithm = ?'id-sha256'}
<a name="1991"/> 1991:                                              },
<a name="1992"/> 1992:        saltLength = 32,
<a name="1993"/> 1993:        trailerField = 1}.
</pre>
<script>
var hash = window.location.hash.substring(1);
var anchor = document.getElementsByName(hash);
anchor[0].style.backgroundColor="orange";
</script>
</body>
</html>
