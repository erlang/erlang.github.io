<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/></meta>
<title>/buildroot/otp/lib/ssl/make_test_dir/ssl_test/tls_1_3_record_SUITE.erl</title>
</head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
<a name="1"/>    1: <i>%%</i>
<a name="2"/>    2: <i>%% %CopyrightBegin%</i>
<a name="3"/>    3: <i>%%</i>
<a name="4"/>    4: <i>%% Copyright Ericsson AB 2008-2024. All Rights Reserved.</i>
<a name="5"/>    5: <i>%%</i>
<a name="6"/>    6: <i>%% Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</i>
<a name="7"/>    7: <i>%% you may not use this file except in compliance with the License.</i>
<a name="8"/>    8: <i>%% You may obtain a copy of the License at</i>
<a name="9"/>    9: <i>%%</i>
<a name="10"/>   10: <i>%%     http://www.apache.org/licenses/LICENSE-2.0</i>
<a name="11"/>   11: <i>%%</i>
<a name="12"/>   12: <i>%% Unless required by applicable law or agreed to in writing, software</i>
<a name="13"/>   13: <i>%% distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</i>
<a name="14"/>   14: <i>%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</i>
<a name="15"/>   15: <i>%% See the License for the specific language governing permissions and</i>
<a name="16"/>   16: <i>%% limitations under the License.</i>
<a name="17"/>   17: <i>%%</i>
<a name="18"/>   18: <i>%% %CopyrightEnd%</i>
<a name="19"/>   19: <i>%%</i>
<a name="20"/>   20: 
<a name="21"/>   21: <b>-module</b>(tls_1_3_record_SUITE).
<a name="22"/>   22: 
<a name="23"/>   23: <b>-include</b>(&quot;ssl_test_lib.hrl&quot;).
<a name="24"/>   24: <b>-include_lib</b>(&quot;common_test/include/ct.hrl&quot;).
<a name="25"/>   25: <b>-include_lib</b>(&quot;ssl/src/tls_record.hrl&quot;).
<a name="26"/>   26: <b>-include_lib</b>(&quot;ssl/src/tls_handshake.hrl&quot;).
<a name="27"/>   27: <b>-include_lib</b>(&quot;ssl/src/tls_handshake_1_3.hrl&quot;).
<a name="28"/>   28: <b>-include_lib</b>(&quot;ssl/src/ssl_cipher.hrl&quot;).
<a name="29"/>   29: <b>-include_lib</b>(&quot;ssl/src/ssl_internal.hrl&quot;).
<a name="30"/>   30: 
<a name="31"/>   31: <i>%% Callback functions</i>
<a name="32"/>   32: <b>-export</b>([all/0,
<a name="33"/>   33:          init_per_suite/1,
<a name="34"/>   34:          end_per_suite/1]).
<a name="35"/>   35: 
<a name="36"/>   36: <i>%% Testcases</i>
<a name="37"/>   37: <b>-export</b>([encode_decode/0,
<a name="38"/>   38:          encode_decode/1,
<a name="39"/>   39:          finished_verify_data/0,
<a name="40"/>   40:          finished_verify_data/1,
<a name="41"/>   41:          '1_RTT_handshake'/0,
<a name="42"/>   42:          '1_RTT_handshake'/1,
<a name="43"/>   43:          '0_RTT_handshake'/0,
<a name="44"/>   44:          '0_RTT_handshake'/1
<a name="45"/>   45:         ]).
<a name="46"/>   46: 
<a name="47"/>   47: <i>%%--------------------------------------------------------------------</i>
<a name="48"/>   48: <i>%% Common Test interface functions -----------------------------------</i>
<a name="49"/>   49: <i>%%--------------------------------------------------------------------</i>
<a name="50"/>   50: 
<a name="all-0"/><a name="51"/>   51: <b>all</b>() -&gt;
<a name="all-last_expr"/><a name="52"/>   52:     [encode_decode,
<a name="53"/>   53:      finished_verify_data,
<a name="54"/>   54:      '1_RTT_handshake',
<a name="55"/>   55:      '0_RTT_handshake'].
<a name="56"/>   56: 
<a name="init_per_suite-1"/><a name="57"/>   57: <b>init_per_suite</b>(Config) -&gt;
<a name="58"/>   58:     catch crypto:stop(),
<a name="init_per_suite-last_expr"/><a name="59"/>   59: <b>    try </b>(ok == crypto:start()) andalso ssl_test_lib:sufficient_crypto_support('tlsv1.3') of
<a name="60"/>   60: 	true -&gt;
<a name="61"/>   61: 	    ssl_test_lib:clean_start(),
<a name="62"/>   62:             Config;
<a name="63"/>   63:         false -&gt;
<a name="64"/>   64:             {skip, &quot;Not enough crypto support for TLS-1.3&quot;} 
<a name="65"/>   65:     catch _:_ -&gt;
<a name="66"/>   66: 	    {skip, &quot;Crypto did not start&quot;}
<a name="67"/>   67:     end.
<a name="68"/>   68: 
<a name="end_per_suite-1"/><a name="69"/>   69: <b>end_per_suite</b>(_Config) -&gt;
<a name="70"/>   70:     ssl:stop(),
<a name="71"/>   71:     application:unload(ssl),
<a name="end_per_suite-last_expr"/><a name="72"/>   72: <b>    application:stop</b>(crypto).
<a name="73"/>   73: <i>%%--------------------------------------------------------------------</i>
<a name="74"/>   74: <i>%% Test Cases --------------------------------------------------------</i>
<a name="75"/>   75: <i>%%--------------------------------------------------------------------</i>
<a name="76"/>   76: 
<a name="encode_decode-0"/><a name="77"/>   77: <b>encode_decode</b>() -&gt;
<a name="encode_decode-last_expr"/><a name="78"/>   78:      [{doc,&quot;Test TLS 1.3 record encode/decode functions&quot;}].
<a name="79"/>   79: 
<a name="encode_decode-1"/><a name="80"/>   80: <b>encode_decode</b>(_Config) -&gt;
<a name="81"/>   81:     ConnectionStates =
<a name="82"/>   82:         #{current_read =&gt;
<a name="83"/>   83:               #{beast_mitigation =&gt; one_n_minus_one,
<a name="84"/>   84:                 cipher_state =&gt;
<a name="85"/>   85:                     {cipher_state,
<a name="86"/>   86:                      &lt;&lt;14,172,111,243,199,170,242,203,126,205,34,93,122,115,226,14,
<a name="87"/>   87:                        15,117,155,48,24,112,61,15,113,208,127,51,179,227,194,232&gt;&gt;,
<a name="88"/>   88:                      &lt;&lt;197,54,168,218,54,91,157,58,30,201,197,142,51,58,53,231,228,
<a name="89"/>   89:                        131,57,122,170,78,82,196,30,48,23,16,95,255,185,236&gt;&gt;,
<a name="90"/>   90:                      undefined,undefined,undefined,16},
<a name="91"/>   91:                 mac_secret =&gt; undefined,
<a name="92"/>   92:                 reneg =&gt; #{secure_renegotiation =&gt; undefined,
<a name="93"/>   93:                            client_verify_data =&gt; undefined,
<a name="94"/>   94:                            server_verify_data =&gt; undefined},
<a name="95"/>   95:                 security_parameters =&gt;
<a name="96"/>   96:                     #security_parameters{
<a name="97"/>   97:                        cipher_suite          = &lt;&lt;19,2&gt;&gt;,
<a name="98"/>   98:                        connection_end        = 0,
<a name="99"/>   99:                        bulk_cipher_algorithm = 8,
<a name="100"/>  100:                        cipher_type           = 2,
<a name="101"/>  101:                        prf_algorithm         = sha384,
<a name="102"/>  102:                        master_secret         =
<a name="103"/>  103:                            {handshake_secret,
<a name="104"/>  104:                             &lt;&lt;128,229,186,211,62,127,182,20,62,166,233,23,135,64,121,
<a name="105"/>  105:                               3,104,251,214,161,253,31,3,2,232,37,8,221,189,72,64,218,
<a name="106"/>  106:                               121,41,112,148,254,34,68,164,228,60,161,201,132,55,56,
<a name="107"/>  107:                               157&gt;&gt;},
<a name="108"/>  108:                        server_random         =
<a name="109"/>  109:                            &lt;&lt;92,24,205,75,244,60,136,212,250,32,214,20,37,3,213,87,61,207,
<a name="110"/>  110:                              147,61,168,145,177,118,160,153,33,53,48,108,191,174&gt;&gt;},
<a name="111"/>  111:                 sequence_number =&gt; 0,
<a name="112"/>  112:                 early_data =&gt; #{
<a name="113"/>  113:                                 pending_early_data_size =&gt; 0,
<a name="114"/>  114:                                 trial_decryption =&gt; false,
<a name="115"/>  115:                                 early_data_accepted =&gt; false}
<a name="116"/>  116:                },
<a name="117"/>  117:           current_write =&gt;
<a name="118"/>  118:               #{beast_mitigation =&gt; one_n_minus_one,
<a name="119"/>  119:                 cipher_state =&gt;
<a name="120"/>  120:                     {cipher_state,
<a name="121"/>  121:                      &lt;&lt;14,172,111,243,199,170,242,203,126,205,34,93,122,115,226,14,
<a name="122"/>  122:                        15,117,155,48,24,112,61,15,113,208,127,51,179,227,194,232&gt;&gt;,
<a name="123"/>  123:                      &lt;&lt;197,54,168,218,54,91,157,58,30,201,197,142,51,58,53,231,228,
<a name="124"/>  124:                        131,57,122,170,78,82,196,30,48,23,16,95,255,185,236&gt;&gt;,
<a name="125"/>  125:                      undefined,undefined,undefined,16},
<a name="126"/>  126:                 mac_secret =&gt; undefined,
<a name="127"/>  127:                 reneg =&gt; #{secure_renegotiation =&gt; undefined,
<a name="128"/>  128:                            client_verify_data =&gt; undefined,
<a name="129"/>  129:                            server_verify_data =&gt; undefined},
<a name="130"/>  130:                 security_parameters =&gt;
<a name="131"/>  131:                     #security_parameters{
<a name="132"/>  132:                        cipher_suite          = &lt;&lt;19,2&gt;&gt;,
<a name="133"/>  133:                        connection_end        = 0,
<a name="134"/>  134:                        bulk_cipher_algorithm = 8,
<a name="135"/>  135:                        cipher_type           = 2,
<a name="136"/>  136:                        prf_algorithm         = sha384,
<a name="137"/>  137:                        master_secret         =
<a name="138"/>  138:                            {handshake_secret,
<a name="139"/>  139:                             &lt;&lt;128,229,186,211,62,127,182,20,62,166,233,23,135,64,121,
<a name="140"/>  140:                               3,104,251,214,161,253,31,3,2,232,37,8,221,189,72,64,218,
<a name="141"/>  141:                               121,41,112,148,254,34,68,164,228,60,161,201,132,55,56,
<a name="142"/>  142:                               157&gt;&gt;},
<a name="143"/>  143:                      server_random         =
<a name="144"/>  144:                            &lt;&lt;92,24,205,75,244,60,136,212,250,32,214,20,37,3,213,87,61,207,
<a name="145"/>  145:                              147,61,168,145,177,118,160,153,33,53,48,108,191,174&gt;&gt;},
<a name="146"/>  146:                 sequence_number =&gt; 0},max_fragment_length =&gt; undefined},
<a name="147"/>  147: 
<a name="148"/>  148:     PlainText = [11,
<a name="149"/>  149:                  &lt;&lt;0,2,175&gt;&gt;,
<a name="150"/>  150:                  &lt;&lt;0,0,2,171,0,2,166,48,130,2,162,48,130,1,138,2,9,0,186,57,220,137,88,255,
<a name="151"/>  151:                    191,235,48,13,6,9,42,134,72,134,247,13,1,1,11,5,0,48,18,49,16,48,14,6,3,85,
<a name="152"/>  152:                    4,3,12,7,84,101,115,116,32,67,65,48,30,23,13,49,56,48,53,48,52,49,52,49,50,
<a name="153"/>  153:                    51,56,90,23,13,50,56,48,50,48,52,49,52,49,50,51,56,90,48,20,49,18,48,16,6,
<a name="154"/>  154:                    3,85,4,3,12,9,108,111,99,97,108,104,111,115,116,48,130,1,34,48,13,6,9,42,
<a name="155"/>  155:                    134,72,134,247,13,1,1,1,5,0,3,130,1,15,0,48,130,1,10,2,130,1,1,0,169,40,
<a name="156"/>  156:                    144,176,121,63,134,97,144,126,243,183,225,157,37,131,183,225,87,243,23,88,
<a name="157"/>  157:                    230,70,9,134,32,147,7,27,167,98,51,81,224,75,199,12,229,251,195,207,75,179,
<a name="158"/>  158:                    181,78,128,3,255,44,58,39,43,172,142,45,186,58,51,65,187,199,154,153,245,
<a name="159"/>  159:                    70,133,137,1,27,87,42,116,65,251,129,109,145,233,97,171,71,54,213,185,74,
<a name="160"/>  160:                    209,166,11,218,189,119,206,86,170,60,212,213,85,189,30,50,215,23,185,53,
<a name="161"/>  161:                    132,238,132,176,198,250,139,251,198,221,225,128,109,113,23,220,39,143,71,
<a name="162"/>  162:                    30,59,189,51,244,61,158,214,146,180,196,103,169,189,221,136,78,129,216,148,
<a name="163"/>  163:                    2,9,8,65,37,224,215,233,13,209,21,235,20,143,33,74,59,53,208,90,152,94,251,
<a name="164"/>  164:                    54,114,171,39,88,230,227,158,211,135,37,182,67,205,161,59,20,138,58,253,15,
<a name="165"/>  165:                    53,48,8,157,9,95,197,9,177,116,21,54,9,125,78,109,182,83,20,16,234,223,116,
<a name="166"/>  166:                    41,155,123,87,77,17,120,153,246,239,124,130,105,219,166,146,242,151,66,198,
<a name="167"/>  167:                    75,72,63,28,246,86,16,244,223,22,36,50,15,247,222,98,6,152,136,154,72,150,
<a name="168"/>  168:                    73,127,2,3,1,0,1,48,13,6,9,42,134,72,134,247,13,1,1,11,5,0,3,130,1,1,0,76,
<a name="169"/>  169:                    33,54,160,229,219,219,193,150,116,245,252,18,39,235,145,86,12,167,171,52,
<a name="170"/>  170:                    117,166,30,83,5,216,245,177,217,247,95,1,136,94,246,212,108,248,230,111,
<a name="171"/>  171:                    225,202,189,6,129,8,70,128,245,18,204,215,87,82,129,253,227,122,66,182,184,
<a name="172"/>  172:                    189,30,193,169,144,218,216,109,105,110,215,144,60,104,162,178,101,164,218,
<a name="173"/>  173:                    122,60,37,41,143,57,150,52,59,51,112,238,113,239,168,114,69,183,143,154,73,
<a name="174"/>  174:                    61,58,80,247,172,95,251,55,28,186,28,200,206,230,118,243,92,202,189,49,76,
<a name="175"/>  175:                    124,252,76,0,247,112,85,194,69,59,222,163,228,103,49,110,104,109,251,155,
<a name="176"/>  176:                    138,9,37,167,49,189,48,134,52,158,185,129,24,96,153,196,251,90,206,76,239,
<a name="177"/>  177:                    175,119,174,165,133,108,222,125,237,125,187,149,152,83,190,16,202,94,202,
<a name="178"/>  178:                    201,40,218,22,254,63,189,41,174,97,140,203,70,18,196,118,237,175,134,79,78,
<a name="179"/>  179:                    246,2,61,54,77,186,112,32,17,193,192,188,217,252,215,200,7,245,180,179,132,
<a name="180"/>  180:                    183,212,229,155,15,152,206,135,56,81,88,3,123,244,149,110,182,72,109,70,62,
<a name="181"/>  181:                    146,152,146,151,107,126,216,210,9,93,0,0&gt;&gt;],
<a name="182"/>  182: 
<a name="183"/>  183:     {[_Header|Encoded], _} = tls_record_1_3:encode_plain_text(22, PlainText, ConnectionStates),
<a name="184"/>  184:     CipherText = #ssl_tls{type = 23, version = ?TLS_1_2, fragment = Encoded},
<a name="185"/>  185: 
<a name="186"/>  186:     {#ssl_tls{type = 22, version = ?TLS_1_3, fragment = DecodedText}, _} =
<a name="187"/>  187:         tls_record_1_3:decode_cipher_text(CipherText, ConnectionStates),
<a name="188"/>  188: 
<a name="189"/>  189:     DecodedText = iolist_to_binary(PlainText),
<a name="190"/>  190:     ?CT_LOG(&quot;Decoded: ~p ~n&quot;, [DecodedText]),
<a name="encode_decode-last_expr"/><a name="191"/>  191:     ok.
<a name="192"/>  192: <i>%%--------------------------------------------------------------------</i>
<a name="1_RTT_handshake-0"/><a name="193"/>  193: <b>'1_RTT_handshake'</b>() -&gt;
<a name="1_RTT_handshake-last_expr"/><a name="194"/>  194:      [{doc,&quot;Test TLS 1.3 1-RTT Handshake&quot;}].
<a name="195"/>  195: 
<a name="1_RTT_handshake-1"/><a name="196"/>  196: <b>'1_RTT_handshake'</b>(_Config) -&gt;
<a name="197"/>  197:     %% ConnectionStates with NULL cipher
<a name="198"/>  198:     ConnStatesNull =
<a name="199"/>  199:        #{current_write =&gt;
<a name="200"/>  200:              #{security_parameters =&gt;
<a name="201"/>  201:                    #security_parameters{cipher_suite = ?TLS_NULL_WITH_NULL_NULL},
<a name="202"/>  202:                sequence_number =&gt; 0,
<a name="203"/>  203:                max_fragment_length =&gt; undefined
<a name="204"/>  204:               }
<a name="205"/>  205:         },
<a name="206"/>  206: 
<a name="207"/>  207:     %% {client}  construct a ClientHello handshake message:
<a name="208"/>  208:     %%
<a name="209"/>  209:     %%    ClientHello (196 octets):  01 00 00 c0 03 03 cb 34 ec b1 e7 81 63
<a name="210"/>  210:     %%       ba 1c 38 c6 da cb 19 6a 6d ff a2 1a 8d 99 12 ec 18 a2 ef 62 83
<a name="211"/>  211:     %%       02 4d ec e7 00 00 06 13 01 13 03 13 02 01 00 00 91 00 00 00 0b
<a name="212"/>  212:     %%       00 09 00 00 06 73 65 72 76 65 72 ff 01 00 01 00 00 0a 00 14 00
<a name="213"/>  213:     %%       12 00 1d 00 17 00 18 00 19 01 00 01 01 01 02 01 03 01 04 00 23
<a name="214"/>  214:     %%       00 00 00 33 00 26 00 24 00 1d 00 20 99 38 1d e5 60 e4 bd 43 d2
<a name="215"/>  215:     %%       3d 8e 43 5a 7d ba fe b3 c0 6e 51 c1 3c ae 4d 54 13 69 1e 52 9a
<a name="216"/>  216:     %%       af 2c 00 2b 00 03 02 03 04 00 0d 00 20 00 1e 04 03 05 03 06 03
<a name="217"/>  217:     %%       02 03 08 04 08 05 08 06 04 01 05 01 06 01 02 01 04 02 05 02 06
<a name="218"/>  218:     %%       02 02 02 00 2d 00 02 01 01 00 1c 00 02 40 01
<a name="219"/>  219:     %%
<a name="220"/>  220:     %% {client}  send handshake record:
<a name="221"/>  221:     %%
<a name="222"/>  222:     %%    payload (196 octets):  01 00 00 c0 03 03 cb 34 ec b1 e7 81 63 ba
<a name="223"/>  223:     %%       1c 38 c6 da cb 19 6a 6d ff a2 1a 8d 99 12 ec 18 a2 ef 62 83 02
<a name="224"/>  224:     %%       4d ec e7 00 00 06 13 01 13 03 13 02 01 00 00 91 00 00 00 0b 00
<a name="225"/>  225:     %%       09 00 00 06 73 65 72 76 65 72 ff 01 00 01 00 00 0a 00 14 00 12
<a name="226"/>  226:     %%       00 1d 00 17 00 18 00 19 01 00 01 01 01 02 01 03 01 04 00 23 00
<a name="227"/>  227:     %%       00 00 33 00 26 00 24 00 1d 00 20 99 38 1d e5 60 e4 bd 43 d2 3d
<a name="228"/>  228:     %%       8e 43 5a 7d ba fe b3 c0 6e 51 c1 3c ae 4d 54 13 69 1e 52 9a af
<a name="229"/>  229:     %%       2c 00 2b 00 03 02 03 04 00 0d 00 20 00 1e 04 03 05 03 06 03 02
<a name="230"/>  230:     %%       03 08 04 08 05 08 06 04 01 05 01 06 01 02 01 04 02 05 02 06 02
<a name="231"/>  231:     %%       02 02 00 2d 00 02 01 01 00 1c 00 02 40 01
<a name="232"/>  232:     %%
<a name="233"/>  233:     %%    complete record (201 octets):  16 03 01 00 c4 01 00 00 c0 03 03 cb
<a name="234"/>  234:     %%       34 ec b1 e7 81 63 ba 1c 38 c6 da cb 19 6a 6d ff a2 1a 8d 99 12
<a name="235"/>  235:     %%       ec 18 a2 ef 62 83 02 4d ec e7 00 00 06 13 01 13 03 13 02 01 00
<a name="236"/>  236:     %%       00 91 00 00 00 0b 00 09 00 00 06 73 65 72 76 65 72 ff 01 00 01
<a name="237"/>  237:     %%       00 00 0a 00 14 00 12 00 1d 00 17 00 18 00 19 01 00 01 01 01 02
<a name="238"/>  238:     %%       01 03 01 04 00 23 00 00 00 33 00 26 00 24 00 1d 00 20 99 38 1d
<a name="239"/>  239:     %%       e5 60 e4 bd 43 d2 3d 8e 43 5a 7d ba fe b3 c0 6e 51 c1 3c ae 4d
<a name="240"/>  240:     %%       54 13 69 1e 52 9a af 2c 00 2b 00 03 02 03 04 00 0d 00 20 00 1e
<a name="241"/>  241:     %%       04 03 05 03 06 03 02 03 08 04 08 05 08 06 04 01 05 01 06 01 02
<a name="242"/>  242:     %%       01 04 02 05 02 06 02 02 02 00 2d 00 02 01 01 00 1c 00 02 40 01
<a name="243"/>  243:     ClientHello =
<a name="244"/>  244:         hexstr2bin(&quot;01 00 00 c0 03 03 cb 34 ec b1 e7 81 63
<a name="245"/>  245:           ba 1c 38 c6 da cb 19 6a 6d ff a2 1a 8d 99 12 ec 18 a2 ef 62 83
<a name="246"/>  246:           02 4d ec e7 00 00 06 13 01 13 03 13 02 01 00 00 91 00 00 00 0b
<a name="247"/>  247:           00 09 00 00 06 73 65 72 76 65 72 ff 01 00 01 00 00 0a 00 14 00
<a name="248"/>  248:           12 00 1d 00 17 00 18 00 19 01 00 01 01 01 02 01 03 01 04 00 23
<a name="249"/>  249:           00 00 00 33 00 26 00 24 00 1d 00 20 99 38 1d e5 60 e4 bd 43 d2
<a name="250"/>  250:           3d 8e 43 5a 7d ba fe b3 c0 6e 51 c1 3c ae 4d 54 13 69 1e 52 9a
<a name="251"/>  251:           af 2c 00 2b 00 03 02 03 04 00 0d 00 20 00 1e 04 03 05 03 06 03
<a name="252"/>  252:           02 03 08 04 08 05 08 06 04 01 05 01 06 01 02 01 04 02 05 02 06
<a name="253"/>  253:           02 02 02 00 2d 00 02 01 01 00 1c 00 02 40 01&quot;),
<a name="254"/>  254: 
<a name="255"/>  255:     ClientHelloRecord =
<a name="256"/>  256:         %% Current implementation always sets
<a name="257"/>  257:         %% legacy_record_version to Ox0303
<a name="258"/>  258:         hexstr2bin(&quot;16 03 03 00 c4 01 00 00 c0 03 03 cb
<a name="259"/>  259:           34 ec b1 e7 81 63 ba 1c 38 c6 da cb 19 6a 6d ff a2 1a 8d 99 12
<a name="260"/>  260:           ec 18 a2 ef 62 83 02 4d ec e7 00 00 06 13 01 13 03 13 02 01 00
<a name="261"/>  261:           00 91 00 00 00 0b 00 09 00 00 06 73 65 72 76 65 72 ff 01 00 01
<a name="262"/>  262:           00 00 0a 00 14 00 12 00 1d 00 17 00 18 00 19 01 00 01 01 01 02
<a name="263"/>  263:           01 03 01 04 00 23 00 00 00 33 00 26 00 24 00 1d 00 20 99 38 1d
<a name="264"/>  264:           e5 60 e4 bd 43 d2 3d 8e 43 5a 7d ba fe b3 c0 6e 51 c1 3c ae 4d
<a name="265"/>  265:           54 13 69 1e 52 9a af 2c 00 2b 00 03 02 03 04 00 0d 00 20 00 1e
<a name="266"/>  266:           04 03 05 03 06 03 02 03 08 04 08 05 08 06 04 01 05 01 06 01 02
<a name="267"/>  267:           01 04 02 05 02 06 02 02 02 00 2d 00 02 01 01 00 1c 00 02 40 01&quot;),
<a name="268"/>  268: 
<a name="269"/>  269:     {CHEncrypted, _} =
<a name="270"/>  270: 	tls_record:encode_handshake(ClientHello, ?TLS_1_3, ConnStatesNull),
<a name="271"/>  271:     ClientHelloRecord = iolist_to_binary(CHEncrypted),
<a name="272"/>  272: 
<a name="273"/>  273:     %% {server}  extract secret &quot;early&quot;:
<a name="274"/>  274:     %%
<a name="275"/>  275:     %%    salt:  0 (all zero octets)
<a name="276"/>  276:     %%
<a name="277"/>  277:     %%    IKM (32 octets):  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="278"/>  278:     %%                      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="279"/>  279:     %%
<a name="280"/>  280:     %%    secret (32 octets):  33 ad 0a 1c 60 7e c0 3b 09 e6 cd 98 93 68 0c
<a name="281"/>  281:     %%       e2 10 ad f3 00 aa 1f 26 60 e1 b2 2e 10 f1 70 f9 2a
<a name="282"/>  282:     HKDFAlgo = sha256,
<a name="283"/>  283:     Salt = binary:copy(&lt;&lt;?BYTE(0)&gt;&gt;, 32),
<a name="284"/>  284:     _IKM = binary:copy(&lt;&lt;?BYTE(0)&gt;&gt;, 32),
<a name="285"/>  285:     EarlySecret =
<a name="286"/>  286:         hexstr2bin(&quot;33 ad 0a 1c 60 7e c0 3b 09 e6 cd 98 93 68 0c
<a name="287"/>  287:           e2 10 ad f3 00 aa 1f 26 60 e1 b2 2e 10 f1 70 f9 2a&quot;),
<a name="288"/>  288: 
<a name="289"/>  289:     {early_secret, EarlySecret} = tls_v1:key_schedule(early_secret, HKDFAlgo, {psk, Salt}),
<a name="290"/>  290: 
<a name="291"/>  291:     %% {client}  create an ephemeral x25519 key pair:
<a name="292"/>  292:     %%
<a name="293"/>  293:     %%    private key (32 octets):  49 af 42 ba 7f 79 94 85 2d 71 3e f2 78
<a name="294"/>  294:     %%       4b cb ca a7 91 1d e2 6a dc 56 42 cb 63 45 40 e7 ea 50 05
<a name="295"/>  295:     %%
<a name="296"/>  296:     %%    public key (32 octets):  99 38 1d e5 60 e4 bd 43 d2 3d 8e 43 5a 7d
<a name="297"/>  297:     %%       ba fe b3 c0 6e 51 c1 3c ae 4d 54 13 69 1e 52 9a af 2c
<a name="298"/>  298:     CPublicKey =
<a name="299"/>  299:         hexstr2bin(&quot;99 38 1d e5 60 e4 bd 43 d2 3d 8e 43 5a 7d
<a name="300"/>  300:           ba fe b3 c0 6e 51 c1 3c ae 4d 54 13 69 1e 52 9a af 2c&quot;),
<a name="301"/>  301: 
<a name="302"/>  302:     %% {server}  create an ephemeral x25519 key pair:
<a name="303"/>  303:     %%
<a name="304"/>  304:     %%   private key (32 octets):  b1 58 0e ea df 6d d5 89 b8 ef 4f 2d 56
<a name="305"/>  305:     %%      52 57 8c c8 10 e9 98 01 91 ec 8d 05 83 08 ce a2 16 a2 1e
<a name="306"/>  306:     %%
<a name="307"/>  307:     %%   public key (32 octets):  c9 82 88 76 11 20 95 fe 66 76 2b db f7 c6
<a name="308"/>  308:     %%      72 e1 56 d6 cc 25 3b 83 3d f1 dd 69 b1 b0 4e 75 1f 0f
<a name="309"/>  309:     SPrivateKey =
<a name="310"/>  310:         hexstr2bin(&quot;b1 58 0e ea df 6d d5 89 b8 ef 4f 2d 56
<a name="311"/>  311:          52 57 8c c8 10 e9 98 01 91 ec 8d 05 83 08 ce a2 16 a2 1e&quot;),
<a name="312"/>  312: 
<a name="313"/>  313:     _SPublicKey =
<a name="314"/>  314:         hexstr2bin(&quot;c9 82 88 76 11 20 95 fe 66 76 2b db f7 c6
<a name="315"/>  315:          72 e1 56 d6 cc 25 3b 83 3d f1 dd 69 b1 b0 4e 75 1f 0f&quot;),
<a name="316"/>  316: 
<a name="317"/>  317:     %% {server}  construct a ServerHello handshake message:
<a name="318"/>  318:     %%
<a name="319"/>  319:     %%    ServerHello (90 octets):  02 00 00 56 03 03 a6 af 06 a4 12 18 60
<a name="320"/>  320:     %%       dc 5e 6e 60 24 9c d3 4c 95 93 0c 8a c5 cb 14 34 da c1 55 77 2e
<a name="321"/>  321:     %%       d3 e2 69 28 00 13 01 00 00 2e 00 33 00 24 00 1d 00 20 c9 82 88
<a name="322"/>  322:     %%       76 11 20 95 fe 66 76 2b db f7 c6 72 e1 56 d6 cc 25 3b 83 3d f1
<a name="323"/>  323:     %%       dd 69 b1 b0 4e 75 1f 0f 00 2b 00 02 03 04
<a name="324"/>  324:     ServerHello =
<a name="325"/>  325:         hexstr2bin(&quot;02 00 00 56 03 03 a6 af 06 a4 12 18 60
<a name="326"/>  326:           dc 5e 6e 60 24 9c d3 4c 95 93 0c 8a c5 cb 14 34 da c1 55 77 2e
<a name="327"/>  327:           d3 e2 69 28 00 13 01 00 00 2e 00 33 00 24 00 1d 00 20 c9 82 88
<a name="328"/>  328:           76 11 20 95 fe 66 76 2b db f7 c6 72 e1 56 d6 cc 25 3b 83 3d f1
<a name="329"/>  329:           dd 69 b1 b0 4e 75 1f 0f 00 2b 00 02 03 04&quot;),
<a name="330"/>  330: 
<a name="331"/>  331:     %% {server}  derive secret for handshake &quot;tls13 derived&quot;:
<a name="332"/>  332:     %%
<a name="333"/>  333:     %%    PRK (32 octets):  33 ad 0a 1c 60 7e c0 3b 09 e6 cd 98 93 68 0c e2
<a name="334"/>  334:     %%       10 ad f3 00 aa 1f 26 60 e1 b2 2e 10 f1 70 f9 2a
<a name="335"/>  335:     %%
<a name="336"/>  336:     %%    hash (32 octets):  e3 b0 c4 42 98 fc 1c 14 9a fb f4 c8 99 6f b9 24
<a name="337"/>  337:     %%       27 ae 41 e4 64 9b 93 4c a4 95 99 1b 78 52 b8 55
<a name="338"/>  338:     %%
<a name="339"/>  339:     %%    info (49 octets):  00 20 0d 74 6c 73 31 33 20 64 65 72 69 76 65 64
<a name="340"/>  340:     %%       20 e3 b0 c4 42 98 fc 1c 14 9a fb f4 c8 99 6f b9 24 27 ae 41 e4
<a name="341"/>  341:     %%       64 9b 93 4c a4 95 99 1b 78 52 b8 55
<a name="342"/>  342:     %%
<a name="343"/>  343:     %%    expanded (32 octets):  6f 26 15 a1 08 c7 02 c5 67 8f 54 fc 9d ba
<a name="344"/>  344:     %%       b6 97 16 c0 76 18 9c 48 25 0c eb ea c3 57 6c 36 11 ba
<a name="345"/>  345:     Hash =
<a name="346"/>  346:         hexstr2bin(&quot;e3 b0 c4 42 98 fc 1c 14 9a fb f4 c8 99 6f b9 24
<a name="347"/>  347:           27 ae 41 e4 64 9b 93 4c a4 95 99 1b 78 52 b8 55&quot;),
<a name="348"/>  348: 
<a name="349"/>  349:     Hash = crypto:hash(HKDFAlgo, &lt;&lt;&gt;&gt;),
<a name="350"/>  350: 
<a name="351"/>  351:     Info =
<a name="352"/>  352:         hexstr2bin(&quot;00 20 0d 74 6c 73 31 33 20 64 65 72 69 76 65 64
<a name="353"/>  353:           20 e3 b0 c4 42 98 fc 1c 14 9a fb f4 c8 99 6f b9 24 27 ae 41 e4
<a name="354"/>  354:           64 9b 93 4c a4 95 99 1b 78 52 b8 55&quot;),
<a name="355"/>  355: 
<a name="356"/>  356:     Info = create_info(&lt;&lt;&quot;derived&quot;&gt;&gt;, Hash,  ssl_cipher:hash_size(HKDFAlgo)),
<a name="357"/>  357: 
<a name="358"/>  358:     Expanded =
<a name="359"/>  359:         hexstr2bin(&quot;6f 26 15 a1 08 c7 02 c5 67 8f 54 fc 9d ba
<a name="360"/>  360:           b6 97 16 c0 76 18 9c 48 25 0c eb ea c3 57 6c 36 11 ba&quot;),
<a name="361"/>  361: 
<a name="362"/>  362:     Expanded = tls_v1:derive_secret(EarlySecret, &lt;&lt;&quot;derived&quot;&gt;&gt;, &lt;&lt;&gt;&gt;, HKDFAlgo),
<a name="363"/>  363: 
<a name="364"/>  364:     %% {server}  extract secret &quot;handshake&quot;:
<a name="365"/>  365:     %%
<a name="366"/>  366:     %%    salt (32 octets):  6f 26 15 a1 08 c7 02 c5 67 8f 54 fc 9d ba b6 97
<a name="367"/>  367:     %%       16 c0 76 18 9c 48 25 0c eb ea c3 57 6c 36 11 ba
<a name="368"/>  368:     %%
<a name="369"/>  369:     %%    IKM (32 octets):  8b d4 05 4f b5 5b 9d 63 fd fb ac f9 f0 4b 9f 0d
<a name="370"/>  370:     %%       35 e6 d6 3f 53 75 63 ef d4 62 72 90 0f 89 49 2d
<a name="371"/>  371:     %%
<a name="372"/>  372:     %%    secret (32 octets):  1d c8 26 e9 36 06 aa 6f dc 0a ad c1 2f 74 1b
<a name="373"/>  373:     %%       01 04 6a a6 b9 9f 69 1e d2 21 a9 f0 ca 04 3f be ac
<a name="374"/>  374: 
<a name="375"/>  375:     %% salt = Expanded
<a name="376"/>  376:     HandshakeIKM =
<a name="377"/>  377:         hexstr2bin(&quot;8b d4 05 4f b5 5b 9d 63 fd fb ac f9 f0 4b 9f 0d
<a name="378"/>  378:           35 e6 d6 3f 53 75 63 ef d4 62 72 90 0f 89 49 2d&quot;),
<a name="379"/>  379: 
<a name="380"/>  380:     HandshakeSecret =
<a name="381"/>  381:         hexstr2bin(&quot;1d c8 26 e9 36 06 aa 6f dc 0a ad c1 2f 74 1b
<a name="382"/>  382:           01 04 6a a6 b9 9f 69 1e d2 21 a9 f0 ca 04 3f be ac&quot;),
<a name="383"/>  383: 
<a name="384"/>  384:     HandshakeIKM = crypto:compute_key(ecdh, CPublicKey, SPrivateKey, x25519),
<a name="385"/>  385: 
<a name="386"/>  386:     {handshake_secret, HandshakeSecret} =
<a name="387"/>  387:         tls_v1:key_schedule(handshake_secret, HKDFAlgo, HandshakeIKM,
<a name="388"/>  388:                             {early_secret, EarlySecret}),
<a name="389"/>  389: 
<a name="390"/>  390:     %% {server}  derive secret &quot;tls13 c hs traffic&quot;:
<a name="391"/>  391:     %%
<a name="392"/>  392:     %%    PRK (32 octets):  1d c8 26 e9 36 06 aa 6f dc 0a ad c1 2f 74 1b 01
<a name="393"/>  393:     %%       04 6a a6 b9 9f 69 1e d2 21 a9 f0 ca 04 3f be ac
<a name="394"/>  394:     %%
<a name="395"/>  395:     %%    hash (32 octets):  86 0c 06 ed c0 78 58 ee 8e 78 f0 e7 42 8c 58 ed
<a name="396"/>  396:     %%       d6 b4 3f 2c a3 e6 e9 5f 02 ed 06 3c f0 e1 ca d8
<a name="397"/>  397:     %%
<a name="398"/>  398:     %%    info (54 octets):  00 20 12 74 6c 73 31 33 20 63 20 68 73 20 74 72
<a name="399"/>  399:     %%       61 66 66 69 63 20 86 0c 06 ed c0 78 58 ee 8e 78 f0 e7 42 8c 58
<a name="400"/>  400:     %%       ed d6 b4 3f 2c a3 e6 e9 5f 02 ed 06 3c f0 e1 ca d8
<a name="401"/>  401:     %%
<a name="402"/>  402:     %%    expanded (32 octets):  b3 ed db 12 6e 06 7f 35 a7 80 b3 ab f4 5e
<a name="403"/>  403:     %%       2d 8f 3b 1a 95 07 38 f5 2e 96 00 74 6a 0e 27 a5 5a 21
<a name="404"/>  404: 
<a name="405"/>  405:     %% PRK = HandshakeSecret
<a name="406"/>  406:     CHSTHash =
<a name="407"/>  407:         hexstr2bin(&quot;86 0c 06 ed c0 78 58 ee 8e 78 f0 e7 42 8c 58 ed
<a name="408"/>  408:           d6 b4 3f 2c a3 e6 e9 5f 02 ed 06 3c f0 e1 ca d8&quot;),
<a name="409"/>  409: 
<a name="410"/>  410:     CHSTInfo =
<a name="411"/>  411:         hexstr2bin(&quot;00 20 12 74 6c 73 31 33 20 63 20 68 73 20 74 72
<a name="412"/>  412:           61 66 66 69 63 20 86 0c 06 ed c0 78 58 ee 8e 78 f0 e7 42 8c 58
<a name="413"/>  413:           ed d6 b4 3f 2c a3 e6 e9 5f 02 ed 06 3c f0 e1 ca d8&quot;),
<a name="414"/>  414: 
<a name="415"/>  415:     CHSTrafficSecret =
<a name="416"/>  416:         hexstr2bin(&quot; b3 ed db 12 6e 06 7f 35 a7 80 b3 ab f4 5e
<a name="417"/>  417:           2d 8f 3b 1a 95 07 38 f5 2e 96 00 74 6a 0e 27 a5 5a 21&quot;),
<a name="418"/>  418: 
<a name="419"/>  419:     CHSH =  &lt;&lt;ClientHello/binary,ServerHello/binary&gt;&gt;,
<a name="420"/>  420:     CHSTHash = crypto:hash(HKDFAlgo, CHSH),
<a name="421"/>  421:     CHSTInfo =  create_info(&lt;&lt;&quot;c hs traffic&quot;&gt;&gt;, CHSTHash,  ssl_cipher:hash_size(HKDFAlgo)),
<a name="422"/>  422: 
<a name="423"/>  423:     CHSTrafficSecret =
<a name="424"/>  424:         tls_v1:client_handshake_traffic_secret(HKDFAlgo, {handshake_secret, HandshakeSecret}, CHSH),
<a name="425"/>  425: 
<a name="426"/>  426:     %% {server}  derive secret &quot;tls13 s hs traffic&quot;:
<a name="427"/>  427:     %%
<a name="428"/>  428:     %%    PRK (32 octets):  1d c8 26 e9 36 06 aa 6f dc 0a ad c1 2f 74 1b 01
<a name="429"/>  429:     %%       04 6a a6 b9 9f 69 1e d2 21 a9 f0 ca 04 3f be ac
<a name="430"/>  430:     %%
<a name="431"/>  431:     %%    hash (32 octets):  86 0c 06 ed c0 78 58 ee 8e 78 f0 e7 42 8c 58 ed
<a name="432"/>  432:     %%       d6 b4 3f 2c a3 e6 e9 5f 02 ed 06 3c f0 e1 ca d8
<a name="433"/>  433:     %%
<a name="434"/>  434:     %%    info (54 octets):  00 20 12 74 6c 73 31 33 20 73 20 68 73 20 74 72
<a name="435"/>  435:     %%       61 66 66 69 63 20 86 0c 06 ed c0 78 58 ee 8e 78 f0 e7 42 8c 58
<a name="436"/>  436:     %%       ed d6 b4 3f 2c a3 e6 e9 5f 02 ed 06 3c f0 e1 ca d8
<a name="437"/>  437:     %%
<a name="438"/>  438:     %%    expanded (32 octets):  b6 7b 7d 69 0c c1 6c 4e 75 e5 42 13 cb 2d
<a name="439"/>  439:     %%       37 b4 e9 c9 12 bc de d9 10 5d 42 be fd 59 d3 91 ad 38
<a name="440"/>  440: 
<a name="441"/>  441:     %% PRK = HandshakeSecret
<a name="442"/>  442:     %% hash = CHSTHash
<a name="443"/>  443:     SHSTInfo =
<a name="444"/>  444:         hexstr2bin(&quot;00 20 12 74 6c 73 31 33 20 73 20 68 73 20 74 72
<a name="445"/>  445:           61 66 66 69 63 20 86 0c 06 ed c0 78 58 ee 8e 78 f0 e7 42 8c 58
<a name="446"/>  446:           ed d6 b4 3f 2c a3 e6 e9 5f 02 ed 06 3c f0 e1 ca d8&quot;),
<a name="447"/>  447: 
<a name="448"/>  448:     SHSTrafficSecret =
<a name="449"/>  449:         hexstr2bin(&quot;b6 7b 7d 69 0c c1 6c 4e 75 e5 42 13 cb 2d
<a name="450"/>  450:           37 b4 e9 c9 12 bc de d9 10 5d 42 be fd 59 d3 91 ad 38&quot;),
<a name="451"/>  451: 
<a name="452"/>  452:     SHSTInfo =  create_info(&lt;&lt;&quot;s hs traffic&quot;&gt;&gt;, CHSTHash,  ssl_cipher:hash_size(HKDFAlgo)),
<a name="453"/>  453: 
<a name="454"/>  454:     SHSTrafficSecret =
<a name="455"/>  455:         tls_v1:server_handshake_traffic_secret(HKDFAlgo, {handshake_secret, HandshakeSecret}, CHSH),
<a name="456"/>  456: 
<a name="457"/>  457: 
<a name="458"/>  458:     %% {server}  derive secret for master &quot;tls13 derived&quot;:
<a name="459"/>  459:     %%
<a name="460"/>  460:     %%    PRK (32 octets):  1d c8 26 e9 36 06 aa 6f dc 0a ad c1 2f 74 1b 01
<a name="461"/>  461:     %%       04 6a a6 b9 9f 69 1e d2 21 a9 f0 ca 04 3f be ac
<a name="462"/>  462:     %%
<a name="463"/>  463:     %%    hash (32 octets):  e3 b0 c4 42 98 fc 1c 14 9a fb f4 c8 99 6f b9 24
<a name="464"/>  464:     %%       27 ae 41 e4 64 9b 93 4c a4 95 99 1b 78 52 b8 55
<a name="465"/>  465:     %%
<a name="466"/>  466:     %%    info (49 octets):  00 20 0d 74 6c 73 31 33 20 64 65 72 69 76 65 64
<a name="467"/>  467:     %%       20 e3 b0 c4 42 98 fc 1c 14 9a fb f4 c8 99 6f b9 24 27 ae 41 e4
<a name="468"/>  468:     %%       64 9b 93 4c a4 95 99 1b 78 52 b8 55
<a name="469"/>  469:     %%
<a name="470"/>  470:     %%    expanded (32 octets):  43 de 77 e0 c7 77 13 85 9a 94 4d b9 db 25
<a name="471"/>  471:     %%       90 b5 31 90 a6 5b 3e e2 e4 f1 2d d7 a0 bb 7c e2 54 b4
<a name="472"/>  472: 
<a name="473"/>  473:     %% PRK = HandshakeSecret
<a name="474"/>  474:     %% hash = Hash
<a name="475"/>  475:     %% info = Info
<a name="476"/>  476:     MasterDeriveSecret =
<a name="477"/>  477:         hexstr2bin(&quot;43 de 77 e0 c7 77 13 85 9a 94 4d b9 db 25
<a name="478"/>  478:           90 b5 31 90 a6 5b 3e e2 e4 f1 2d d7 a0 bb 7c e2 54 b4&quot;),
<a name="479"/>  479: 
<a name="480"/>  480:     MasterDeriveSecret = tls_v1:derive_secret(HandshakeSecret, &lt;&lt;&quot;derived&quot;&gt;&gt;, &lt;&lt;&gt;&gt;, HKDFAlgo),
<a name="481"/>  481: 
<a name="482"/>  482:     %% {server}  extract secret &quot;master&quot;:
<a name="483"/>  483:     %%
<a name="484"/>  484:     %%    salt (32 octets):  43 de 77 e0 c7 77 13 85 9a 94 4d b9 db 25 90 b5
<a name="485"/>  485:     %%       31 90 a6 5b 3e e2 e4 f1 2d d7 a0 bb 7c e2 54 b4
<a name="486"/>  486:     %%
<a name="487"/>  487:     %%    IKM (32 octets):  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="488"/>  488:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="489"/>  489:     %%
<a name="490"/>  490:     %%    secret (32 octets):  18 df 06 84 3d 13 a0 8b f2 a4 49 84 4c 5f 8a
<a name="491"/>  491:     %%       47 80 01 bc 4d 4c 62 79 84 d5 a4 1d a8 d0 40 29 19
<a name="492"/>  492: 
<a name="493"/>  493:     %% salt = MasterDeriveSecret
<a name="494"/>  494:     %% IKM = IKM
<a name="495"/>  495:     MasterSecret =
<a name="496"/>  496:         hexstr2bin(&quot;18 df 06 84 3d 13 a0 8b f2 a4 49 84 4c 5f 8a
<a name="497"/>  497:           47 80 01 bc 4d 4c 62 79 84 d5 a4 1d a8 d0 40 29 19&quot;),
<a name="498"/>  498: 
<a name="499"/>  499:     {master_secret, MasterSecret} =
<a name="500"/>  500:         tls_v1:key_schedule(master_secret, HKDFAlgo, {handshake_secret, HandshakeSecret}),
<a name="501"/>  501: 
<a name="502"/>  502:     %% {server}  send handshake record:
<a name="503"/>  503:     %%
<a name="504"/>  504:     %%    payload (90 octets):  02 00 00 56 03 03 a6 af 06 a4 12 18 60 dc 5e
<a name="505"/>  505:     %%       6e 60 24 9c d3 4c 95 93 0c 8a c5 cb 14 34 da c1 55 77 2e d3 e2
<a name="506"/>  506:     %%       69 28 00 13 01 00 00 2e 00 33 00 24 00 1d 00 20 c9 82 88 76 11
<a name="507"/>  507:     %%       20 95 fe 66 76 2b db f7 c6 72 e1 56 d6 cc 25 3b 83 3d f1 dd 69
<a name="508"/>  508:     %%       b1 b0 4e 75 1f 0f 00 2b 00 02 03 04
<a name="509"/>  509:     %%
<a name="510"/>  510:     %%    complete record (95 octets):  16 03 03 00 5a 02 00 00 56 03 03 a6
<a name="511"/>  511:     %%       af 06 a4 12 18 60 dc 5e 6e 60 24 9c d3 4c 95 93 0c 8a c5 cb 14
<a name="512"/>  512:     %%       34 da c1 55 77 2e d3 e2 69 28 00 13 01 00 00 2e 00 33 00 24 00
<a name="513"/>  513:     %%       1d 00 20 c9 82 88 76 11 20 95 fe 66 76 2b db f7 c6 72 e1 56 d6
<a name="514"/>  514:     %%       cc 25 3b 83 3d f1 dd 69 b1 b0 4e 75 1f 0f 00 2b 00 02 03 04
<a name="515"/>  515: 
<a name="516"/>  516:     %% payload = ServerHello
<a name="517"/>  517:     ServerHelloRecord =
<a name="518"/>  518:         hexstr2bin(&quot;16 03 03 00 5a 02 00 00 56 03 03 a6
<a name="519"/>  519:           af 06 a4 12 18 60 dc 5e 6e 60 24 9c d3 4c 95 93 0c 8a c5 cb 14
<a name="520"/>  520:           34 da c1 55 77 2e d3 e2 69 28 00 13 01 00 00 2e 00 33 00 24 00
<a name="521"/>  521:           1d 00 20 c9 82 88 76 11 20 95 fe 66 76 2b db f7 c6 72 e1 56 d6
<a name="522"/>  522:           cc 25 3b 83 3d f1 dd 69 b1 b0 4e 75 1f 0f 00 2b 00 02 03 04&quot;),
<a name="523"/>  523: 
<a name="524"/>  524:     {SHEncrypted, _} =
<a name="525"/>  525: 	tls_record:encode_handshake(ServerHello, ?TLS_1_3, ConnStatesNull),
<a name="526"/>  526:     ServerHelloRecord = iolist_to_binary(SHEncrypted),
<a name="527"/>  527: 
<a name="528"/>  528:     %% {server}  derive write traffic keys for handshake data:
<a name="529"/>  529:     %%
<a name="530"/>  530:     %%    PRK (32 octets):  b6 7b 7d 69 0c c1 6c 4e 75 e5 42 13 cb 2d 37 b4
<a name="531"/>  531:     %%       e9 c9 12 bc de d9 10 5d 42 be fd 59 d3 91 ad 38
<a name="532"/>  532:     %%
<a name="533"/>  533:     %%    key info (13 octets):  00 10 09 74 6c 73 31 33 20 6b 65 79 00
<a name="534"/>  534:     %%
<a name="535"/>  535:     %%    key expanded (16 octets):  3f ce 51 60 09 c2 17 27 d0 f2 e4 e8 6e
<a name="536"/>  536:     %%       e4 03 bc
<a name="537"/>  537:     %%
<a name="538"/>  538:     %%    iv info (12 octets):  00 0c 08 74 6c 73 31 33 20 69 76 00
<a name="539"/>  539:     %%
<a name="540"/>  540:     %%    iv expanded (12 octets):  5d 31 3e b2 67 12 76 ee 13 00 0b 30
<a name="541"/>  541: 
<a name="542"/>  542:     %% PRK = SHSTrafficSecret
<a name="543"/>  543:     WriteKeyInfo =
<a name="544"/>  544:         hexstr2bin(&quot;00 10 09 74 6c 73 31 33 20 6b 65 79 00&quot;),
<a name="545"/>  545: 
<a name="546"/>  546:     WriteKey =
<a name="547"/>  547:         hexstr2bin(&quot;3f ce 51 60 09 c2 17 27 d0 f2 e4 e8 6e e4 03 bc&quot;),
<a name="548"/>  548: 
<a name="549"/>  549:     WriteIVInfo =
<a name="550"/>  550:         hexstr2bin(&quot;00 0c 08 74 6c 73 31 33 20 69 76 00&quot;),
<a name="551"/>  551: 
<a name="552"/>  552:     WriteIV =
<a name="553"/>  553:         hexstr2bin(&quot; 5d 31 3e b2 67 12 76 ee 13 00 0b 30&quot;),
<a name="554"/>  554: 
<a name="555"/>  555:     Cipher = aes_128_gcm, %% TODO: get from ServerHello
<a name="556"/>  556: 
<a name="557"/>  557:     WriteKeyInfo = create_info(&lt;&lt;&quot;key&quot;&gt;&gt;, &lt;&lt;&gt;&gt;,  ssl_cipher:key_material(Cipher)),
<a name="558"/>  558:     %% TODO: remove hardcoded IV size
<a name="559"/>  559:     WriteIVInfo = create_info(&lt;&lt;&quot;iv&quot;&gt;&gt;, &lt;&lt;&gt;&gt;,  12),
<a name="560"/>  560: 
<a name="561"/>  561:     KeyLength = ssl_cipher:key_material(Cipher),
<a name="562"/>  562:     {WriteKey, WriteIV} = tls_v1:calculate_traffic_keys(HKDFAlgo, KeyLength, SHSTrafficSecret),
<a name="563"/>  563: 
<a name="564"/>  564:     %% {server}  construct an EncryptedExtensions handshake message:
<a name="565"/>  565:     %%
<a name="566"/>  566:     %%    EncryptedExtensions (40 octets):  08 00 00 24 00 22 00 0a 00 14 00
<a name="567"/>  567:     %%       12 00 1d 00 17 00 18 00 19 01 00 01 01 01 02 01 03 01 04 00 1c
<a name="568"/>  568:     %%       00 02 40 01 00 00 00 00
<a name="569"/>  569:     %%
<a name="570"/>  570:     %% {server}  construct a Certificate handshake message:
<a name="571"/>  571:     %%
<a name="572"/>  572:     %%    Certificate (445 octets):  0b 00 01 b9 00 00 01 b5 00 01 b0 30 82
<a name="573"/>  573:     %%       01 ac 30 82 01 15 a0 03 02 01 02 02 01 02 30 0d 06 09 2a 86 48
<a name="574"/>  574:     %%       86 f7 0d 01 01 0b 05 00 30 0e 31 0c 30 0a 06 03 55 04 03 13 03
<a name="575"/>  575:     %%       72 73 61 30 1e 17 0d 31 36 30 37 33 30 30 31 32 33 35 39 5a 17
<a name="576"/>  576:     %%       0d 32 36 30 37 33 30 30 31 32 33 35 39 5a 30 0e 31 0c 30 0a 06
<a name="577"/>  577:     %%       03 55 04 03 13 03 72 73 61 30 81 9f 30 0d 06 09 2a 86 48 86 f7
<a name="578"/>  578:     %%       0d 01 01 01 05 00 03 81 8d 00 30 81 89 02 81 81 00 b4 bb 49 8f
<a name="579"/>  579:     %%       82 79 30 3d 98 08 36 39 9b 36 c6 98 8c 0c 68 de 55 e1 bd b8 26
<a name="580"/>  580:     %%       d3 90 1a 24 61 ea fd 2d e4 9a 91 d0 15 ab bc 9a 95 13 7a ce 6c
<a name="581"/>  581:     %%       1a f1 9e aa 6a f9 8c 7c ed 43 12 09 98 e1 87 a8 0e e0 cc b0 52
<a name="582"/>  582:     %%       4b 1b 01 8c 3e 0b 63 26 4d 44 9a 6d 38 e2 2a 5f da 43 08 46 74
<a name="583"/>  583:     %%       80 30 53 0e f0 46 1c 8c a9 d9 ef bf ae 8e a6 d1 d0 3e 2b d1 93
<a name="584"/>  584:     %%       ef f0 ab 9a 80 02 c4 74 28 a6 d3 5a 8d 88 d7 9f 7f 1e 3f 02 03
<a name="585"/>  585:     %%       01 00 01 a3 1a 30 18 30 09 06 03 55 1d 13 04 02 30 00 30 0b 06
<a name="586"/>  586:     %%       03 55 1d 0f 04 04 03 02 05 a0 30 0d 06 09 2a 86 48 86 f7 0d 01
<a name="587"/>  587:     %%       01 0b 05 00 03 81 81 00 85 aa d2 a0 e5 b9 27 6b 90 8c 65 f7 3a
<a name="588"/>  588:     %%       72 67 17 06 18 a5 4c 5f 8a 7b 33 7d 2d f7 a5 94 36 54 17 f2 ea
<a name="589"/>  589:     %%       e8 f8 a5 8c 8f 81 72 f9 31 9c f3 6b 7f d6 c5 5b 80 f2 1a 03 01
<a name="590"/>  590:     %%       51 56 72 60 96 fd 33 5e 5e 67 f2 db f1 02 70 2e 60 8c ca e6 be
<a name="591"/>  591:     %%       c1 fc 63 a4 2a 99 be 5c 3e b7 10 7c 3c 54 e9 b9 eb 2b d5 20 3b
<a name="592"/>  592:     %%       1c 3b 84 e0 a8 b2 f7 59 40 9b a3 ea c9 d9 1d 40 2d cc 0c c8 f8
<a name="593"/>  593:     %%       96 12 29 ac 91 87 b4 2b 4d e1 00 00
<a name="594"/>  594:     %%
<a name="595"/>  595:     %% {server}  construct a CertificateVerify handshake message:
<a name="596"/>  596:     %%
<a name="597"/>  597:     %%    CertificateVerify (136 octets):  0f 00 00 84 08 04 00 80 5a 74 7c
<a name="598"/>  598:     %%       5d 88 fa 9b d2 e5 5a b0 85 a6 10 15 b7 21 1f 82 4c d4 84 14 5a
<a name="599"/>  599:     %%       b3 ff 52 f1 fd a8 47 7b 0b 7a bc 90 db 78 e2 d3 3a 5c 14 1a 07
<a name="600"/>  600:     %%       86 53 fa 6b ef 78 0c 5e a2 48 ee aa a7 85 c4 f3 94 ca b6 d3 0b
<a name="601"/>  601:     %%       be 8d 48 59 ee 51 1f 60 29 57 b1 54 11 ac 02 76 71 45 9e 46 44
<a name="602"/>  602:     %%       5c 9e a5 8c 18 1e 81 8e 95 b8 c3 fb 0b f3 27 84 09 d3 be 15 2a
<a name="603"/>  603:     %%       3d a5 04 3e 06 3d da 65 cd f5 ae a2 0d 53 df ac d4 2f 74 f3
<a name="604"/>  604:     EncryptedExtensions =
<a name="605"/>  605:         hexstr2bin(&quot;08 00 00 24 00 22 00 0a 00 14 00
<a name="606"/>  606:           12 00 1d 00 17 00 18 00 19 01 00 01 01 01 02 01 03 01 04 00 1c
<a name="607"/>  607:           00 02 40 01 00 00 00 00&quot;),
<a name="608"/>  608: 
<a name="609"/>  609:     Certificate =
<a name="610"/>  610:         hexstr2bin(&quot;0b 00 01 b9 00 00 01 b5 00 01 b0 30 82
<a name="611"/>  611:           01 ac 30 82 01 15 a0 03 02 01 02 02 01 02 30 0d 06 09 2a 86 48
<a name="612"/>  612:           86 f7 0d 01 01 0b 05 00 30 0e 31 0c 30 0a 06 03 55 04 03 13 03
<a name="613"/>  613:           72 73 61 30 1e 17 0d 31 36 30 37 33 30 30 31 32 33 35 39 5a 17
<a name="614"/>  614:           0d 32 36 30 37 33 30 30 31 32 33 35 39 5a 30 0e 31 0c 30 0a 06
<a name="615"/>  615:           03 55 04 03 13 03 72 73 61 30 81 9f 30 0d 06 09 2a 86 48 86 f7
<a name="616"/>  616:           0d 01 01 01 05 00 03 81 8d 00 30 81 89 02 81 81 00 b4 bb 49 8f
<a name="617"/>  617:           82 79 30 3d 98 08 36 39 9b 36 c6 98 8c 0c 68 de 55 e1 bd b8 26
<a name="618"/>  618:           d3 90 1a 24 61 ea fd 2d e4 9a 91 d0 15 ab bc 9a 95 13 7a ce 6c
<a name="619"/>  619:           1a f1 9e aa 6a f9 8c 7c ed 43 12 09 98 e1 87 a8 0e e0 cc b0 52
<a name="620"/>  620:           4b 1b 01 8c 3e 0b 63 26 4d 44 9a 6d 38 e2 2a 5f da 43 08 46 74
<a name="621"/>  621:           80 30 53 0e f0 46 1c 8c a9 d9 ef bf ae 8e a6 d1 d0 3e 2b d1 93
<a name="622"/>  622:           ef f0 ab 9a 80 02 c4 74 28 a6 d3 5a 8d 88 d7 9f 7f 1e 3f 02 03
<a name="623"/>  623:           01 00 01 a3 1a 30 18 30 09 06 03 55 1d 13 04 02 30 00 30 0b 06
<a name="624"/>  624:           03 55 1d 0f 04 04 03 02 05 a0 30 0d 06 09 2a 86 48 86 f7 0d 01
<a name="625"/>  625:           01 0b 05 00 03 81 81 00 85 aa d2 a0 e5 b9 27 6b 90 8c 65 f7 3a
<a name="626"/>  626:           72 67 17 06 18 a5 4c 5f 8a 7b 33 7d 2d f7 a5 94 36 54 17 f2 ea
<a name="627"/>  627:           e8 f8 a5 8c 8f 81 72 f9 31 9c f3 6b 7f d6 c5 5b 80 f2 1a 03 01
<a name="628"/>  628:           51 56 72 60 96 fd 33 5e 5e 67 f2 db f1 02 70 2e 60 8c ca e6 be
<a name="629"/>  629:           c1 fc 63 a4 2a 99 be 5c 3e b7 10 7c 3c 54 e9 b9 eb 2b d5 20 3b
<a name="630"/>  630:           1c 3b 84 e0 a8 b2 f7 59 40 9b a3 ea c9 d9 1d 40 2d cc 0c c8 f8
<a name="631"/>  631:           96 12 29 ac 91 87 b4 2b 4d e1 00 00&quot;),
<a name="632"/>  632: 
<a name="633"/>  633:     CertificateVerify =
<a name="634"/>  634:         hexstr2bin(&quot;0f 00 00 84 08 04 00 80 5a 74 7c
<a name="635"/>  635:           5d 88 fa 9b d2 e5 5a b0 85 a6 10 15 b7 21 1f 82 4c d4 84 14 5a
<a name="636"/>  636:           b3 ff 52 f1 fd a8 47 7b 0b 7a bc 90 db 78 e2 d3 3a 5c 14 1a 07
<a name="637"/>  637:           86 53 fa 6b ef 78 0c 5e a2 48 ee aa a7 85 c4 f3 94 ca b6 d3 0b
<a name="638"/>  638:           be 8d 48 59 ee 51 1f 60 29 57 b1 54 11 ac 02 76 71 45 9e 46 44
<a name="639"/>  639:           5c 9e a5 8c 18 1e 81 8e 95 b8 c3 fb 0b f3 27 84 09 d3 be 15 2a
<a name="640"/>  640:           3d a5 04 3e 06 3d da 65 cd f5 ae a2 0d 53 df ac d4 2f 74 f3&quot;),
<a name="641"/>  641: 
<a name="642"/>  642:     %% {server}  calculate finished &quot;tls13 finished&quot;:
<a name="643"/>  643:     %%
<a name="644"/>  644:     %%    PRK (32 octets):  b6 7b 7d 69 0c c1 6c 4e 75 e5 42 13 cb 2d 37 b4
<a name="645"/>  645:     %%       e9 c9 12 bc de d9 10 5d 42 be fd 59 d3 91 ad 38
<a name="646"/>  646:     %%
<a name="647"/>  647:     %%    hash (0 octets):  (empty)
<a name="648"/>  648:     %%
<a name="649"/>  649:     %%    info (18 octets):  00 20 0e 74 6c 73 31 33 20 66 69 6e 69 73 68 65
<a name="650"/>  650:     %%       64 00
<a name="651"/>  651:     %%
<a name="652"/>  652:     %%    expanded (32 octets):  00 8d 3b 66 f8 16 ea 55 9f 96 b5 37 e8 85
<a name="653"/>  653:     %%       c3 1f c0 68 bf 49 2c 65 2f 01 f2 88 a1 d8 cd c1 9f c8
<a name="654"/>  654:     %%
<a name="655"/>  655:     %%    finished (32 octets):  9b 9b 14 1d 90 63 37 fb d2 cb dc e7 1d f4
<a name="656"/>  656:     %%       de da 4a b4 2c 30 95 72 cb 7f ff ee 54 54 b7 8f 07 18
<a name="657"/>  657: 
<a name="658"/>  658:     %% PRK = SHSTrafficSecret
<a name="659"/>  659:     FInfo =
<a name="660"/>  660:         hexstr2bin(&quot;00 20 0e 74 6c 73 31 33 20 66 69 6e 69 73 68 65
<a name="661"/>  661:           64 00&quot;),
<a name="662"/>  662: 
<a name="663"/>  663:     FExpanded =
<a name="664"/>  664:         hexstr2bin(&quot;00 8d 3b 66 f8 16 ea 55 9f 96 b5 37 e8 85
<a name="665"/>  665:           c3 1f c0 68 bf 49 2c 65 2f 01 f2 88 a1 d8 cd c1 9f c8&quot;),
<a name="666"/>  666: 
<a name="667"/>  667:     FinishedVerifyData =
<a name="668"/>  668:         hexstr2bin(&quot;9b 9b 14 1d 90 63 37 fb d2 cb dc e7 1d f4
<a name="669"/>  669:           de da 4a b4 2c 30 95 72 cb 7f ff ee 54 54 b7 8f 07 18&quot;),
<a name="670"/>  670: 
<a name="671"/>  671:     FInfo = create_info(&lt;&lt;&quot;finished&quot;&gt;&gt;, &lt;&lt;&gt;&gt;,  ssl_cipher:hash_size(HKDFAlgo)),
<a name="672"/>  672: 
<a name="673"/>  673:     FExpanded = tls_v1:finished_key(SHSTrafficSecret, HKDFAlgo),
<a name="674"/>  674: 
<a name="675"/>  675:     MessageHistory0 = [CertificateVerify,
<a name="676"/>  676:                        Certificate,
<a name="677"/>  677:                        EncryptedExtensions,
<a name="678"/>  678:                        ServerHello,
<a name="679"/>  679:                        ClientHello],
<a name="680"/>  680: 
<a name="681"/>  681:     FinishedVerifyData = tls_v1:finished_verify_data(FExpanded, HKDFAlgo, MessageHistory0),
<a name="682"/>  682: 
<a name="683"/>  683:     %% {server}  construct a Finished handshake message:
<a name="684"/>  684:     %%
<a name="685"/>  685:     %%    Finished (36 octets):  14 00 00 20 9b 9b 14 1d 90 63 37 fb d2 cb
<a name="686"/>  686:     %%       dc e7 1d f4 de da 4a b4 2c 30 95 72 cb 7f ff ee 54 54 b7 8f 07
<a name="687"/>  687:     %%       18
<a name="688"/>  688:     FinishedHSBin =
<a name="689"/>  689:         hexstr2bin(&quot;14 00 00 20 9b 9b 14 1d 90 63 37 fb d2 cb
<a name="690"/>  690:           dc e7 1d f4 de da 4a b4 2c 30 95 72 cb 7f ff ee 54 54 b7 8f 07
<a name="691"/>  691:           18&quot;),
<a name="692"/>  692: 
<a name="693"/>  693:     FinishedHS = #finished{verify_data = FinishedVerifyData},
<a name="694"/>  694: 
<a name="695"/>  695:     FinishedIOList = tls_handshake:encode_handshake(FinishedHS, ?TLS_1_3),
<a name="696"/>  696:     FinishedHSBin = iolist_to_binary(FinishedIOList),
<a name="697"/>  697: 
<a name="698"/>  698:     %% {server}  derive secret &quot;tls13 c ap traffic&quot;:
<a name="699"/>  699:     %%
<a name="700"/>  700:     %%    PRK (32 octets):  18 df 06 84 3d 13 a0 8b f2 a4 49 84 4c 5f 8a 47
<a name="701"/>  701:     %%       80 01 bc 4d 4c 62 79 84 d5 a4 1d a8 d0 40 29 19
<a name="702"/>  702:     %%
<a name="703"/>  703:     %%    hash (32 octets):  96 08 10 2a 0f 1c cc 6d b6 25 0b 7b 7e 41 7b 1a
<a name="704"/>  704:     %%       00 0e aa da 3d aa e4 77 7a 76 86 c9 ff 83 df 13
<a name="705"/>  705:     %%
<a name="706"/>  706:     %%    info (54 octets):  00 20 12 74 6c 73 31 33 20 63 20 61 70 20 74 72
<a name="707"/>  707:     %%       61 66 66 69 63 20 96 08 10 2a 0f 1c cc 6d b6 25 0b 7b 7e 41 7b
<a name="708"/>  708:     %%       1a 00 0e aa da 3d aa e4 77 7a 76 86 c9 ff 83 df 13
<a name="709"/>  709:     %%
<a name="710"/>  710:     %%    expanded (32 octets):  9e 40 64 6c e7 9a 7f 9d c0 5a f8 88 9b ce
<a name="711"/>  711:     %%       65 52 87 5a fa 0b 06 df 00 87 f7 92 eb b7 c1 75 04 a5
<a name="712"/>  712: 
<a name="713"/>  713:     %% PRK = MasterSecret
<a name="714"/>  714:     CAPTHash =
<a name="715"/>  715:         hexstr2bin(&quot;96 08 10 2a 0f 1c cc 6d b6 25 0b 7b 7e 41 7b 1a
<a name="716"/>  716:           00 0e aa da 3d aa e4 77 7a 76 86 c9 ff 83 df 13&quot;),
<a name="717"/>  717:     CAPTInfo =
<a name="718"/>  718:         hexstr2bin(&quot;00 20 12 74 6c 73 31 33 20 63 20 61 70 20 74 72
<a name="719"/>  719:           61 66 66 69 63 20 96 08 10 2a 0f 1c cc 6d b6 25 0b 7b 7e 41 7b
<a name="720"/>  720:           1a 00 0e aa da 3d aa e4 77 7a 76 86 c9 ff 83 df 13&quot;),
<a name="721"/>  721: 
<a name="722"/>  722:     CAPTrafficSecret =
<a name="723"/>  723:         hexstr2bin(&quot;9e 40 64 6c e7 9a 7f 9d c0 5a f8 88 9b ce
<a name="724"/>  724:           65 52 87 5a fa 0b 06 df 00 87 f7 92 eb b7 c1 75 04 a5&quot;),
<a name="725"/>  725: 
<a name="726"/>  726:     CHSF = &lt;&lt;ClientHello/binary,
<a name="727"/>  727:              ServerHello/binary,
<a name="728"/>  728:              EncryptedExtensions/binary,
<a name="729"/>  729:              Certificate/binary,
<a name="730"/>  730:              CertificateVerify/binary,
<a name="731"/>  731:              FinishedHSBin/binary&gt;&gt;,
<a name="732"/>  732: 
<a name="733"/>  733:     CAPTHash = crypto:hash(HKDFAlgo, CHSF),
<a name="734"/>  734: 
<a name="735"/>  735:     CAPTInfo =
<a name="736"/>  736:         create_info(&lt;&lt;&quot;c ap traffic&quot;&gt;&gt;, CAPTHash, ssl_cipher:hash_size(HKDFAlgo)),
<a name="737"/>  737: 
<a name="738"/>  738:     CAPTrafficSecret =
<a name="739"/>  739:         tls_v1:client_application_traffic_secret_0(HKDFAlgo, {master_secret, MasterSecret}, CHSF),
<a name="740"/>  740: 
<a name="741"/>  741:     %% {server}  derive secret &quot;tls13 s ap traffic&quot;:
<a name="742"/>  742:     %%
<a name="743"/>  743:     %%    PRK (32 octets):  18 df 06 84 3d 13 a0 8b f2 a4 49 84 4c 5f 8a 47
<a name="744"/>  744:     %%       80 01 bc 4d 4c 62 79 84 d5 a4 1d a8 d0 40 29 19
<a name="745"/>  745:     %%
<a name="746"/>  746:     %%    hash (32 octets):  96 08 10 2a 0f 1c cc 6d b6 25 0b 7b 7e 41 7b 1a
<a name="747"/>  747:     %%       00 0e aa da 3d aa e4 77 7a 76 86 c9 ff 83 df 13
<a name="748"/>  748:     %%
<a name="749"/>  749:     %%    info (54 octets):  00 20 12 74 6c 73 31 33 20 73 20 61 70 20 74 72
<a name="750"/>  750:     %%       61 66 66 69 63 20 96 08 10 2a 0f 1c cc 6d b6 25 0b 7b 7e 41 7b
<a name="751"/>  751:     %%       1a 00 0e aa da 3d aa e4 77 7a 76 86 c9 ff 83 df 13
<a name="752"/>  752:     %%
<a name="753"/>  753:     %%    expanded (32 octets):  a1 1a f9 f0 55 31 f8 56 ad 47 11 6b 45 a9
<a name="754"/>  754:     %%       50 32 82 04 b4 f4 4b fb 6b 3a 4b 4f 1f 3f cb 63 16 43
<a name="755"/>  755: 
<a name="756"/>  756:     %% PRK = MasterSecret
<a name="757"/>  757:     %% hash = CAPTHash
<a name="758"/>  758:     SAPTInfo =
<a name="759"/>  759:         hexstr2bin(&quot; 00 20 12 74 6c 73 31 33 20 73 20 61 70 20 74 72
<a name="760"/>  760:           61 66 66 69 63 20 96 08 10 2a 0f 1c cc 6d b6 25 0b 7b 7e 41 7b
<a name="761"/>  761:           1a 00 0e aa da 3d aa e4 77 7a 76 86 c9 ff 83 df 13&quot;),
<a name="762"/>  762: 
<a name="763"/>  763:     SAPTrafficSecret =
<a name="764"/>  764:         hexstr2bin(&quot;a1 1a f9 f0 55 31 f8 56 ad 47 11 6b 45 a9
<a name="765"/>  765:           50 32 82 04 b4 f4 4b fb 6b 3a 4b 4f 1f 3f cb 63 16 43&quot;),
<a name="766"/>  766: 
<a name="767"/>  767:     SAPTInfo =
<a name="768"/>  768:         create_info(&lt;&lt;&quot;s ap traffic&quot;&gt;&gt;, CAPTHash, ssl_cipher:hash_size(HKDFAlgo)),
<a name="769"/>  769: 
<a name="770"/>  770:     SAPTrafficSecret =
<a name="771"/>  771:         tls_v1:server_application_traffic_secret_0(HKDFAlgo, {master_secret, MasterSecret}, CHSF),
<a name="772"/>  772: 
<a name="773"/>  773:     %% Resumption master secret from '0-RTT'
<a name="774"/>  774:     %%
<a name="775"/>  775:     %% {server}  generate resumption secret &quot;tls13 resumption&quot;:
<a name="776"/>  776:     %%
<a name="777"/>  777:     %%    PRK (32 octets):  7d f2 35 f2 03 1d 2a 05 12 87 d0 2b 02 41 b0 bf
<a name="778"/>  778:     %%       da f8 6c c8 56 23 1f 2d 5a ba 46 c4 34 ec 19 6c
<a name="779"/>  779:     %%
<a name="780"/>  780:     _RMS = hexstr2bin(&quot;7d f2 35 f2 03 1d 2a 05 12 87 d0 2b 02 41 b0 bf
<a name="781"/>  781:                       da f8 6c c8 56 23 1f 2d 5a ba 46 c4 34 ec 19 6c&quot;),
<a name="782"/>  782: 
<a name="783"/>  783:     %% Verify calculation of resumption master secret that is used to create
<a name="784"/>  784:     %% the pre shared key in '0-RTT'.
<a name="785"/>  785:     _Temp = tls_v1:resumption_master_secret(HKDFAlgo, {master_secret, MasterSecret}, CHSF),
<a name="786"/>  786: 
<a name="787"/>  787:     %% {server}  derive secret &quot;tls13 exp master&quot;:
<a name="788"/>  788:     %%
<a name="789"/>  789:     %%    PRK (32 octets):  18 df 06 84 3d 13 a0 8b f2 a4 49 84 4c 5f 8a 47
<a name="790"/>  790:     %%       80 01 bc 4d 4c 62 79 84 d5 a4 1d a8 d0 40 29 19
<a name="791"/>  791:     %%
<a name="792"/>  792:     %%    hash (32 octets):  96 08 10 2a 0f 1c cc 6d b6 25 0b 7b 7e 41 7b 1a
<a name="793"/>  793:     %%       00 0e aa da 3d aa e4 77 7a 76 86 c9 ff 83 df 13
<a name="794"/>  794:     %%
<a name="795"/>  795:     %%    info (52 octets):  00 20 10 74 6c 73 31 33 20 65 78 70 20 6d 61 73
<a name="796"/>  796:     %%       74 65 72 20 96 08 10 2a 0f 1c cc 6d b6 25 0b 7b 7e 41 7b 1a 00
<a name="797"/>  797:     %%       0e aa da 3d aa e4 77 7a 76 86 c9 ff 83 df 13
<a name="798"/>  798:     %%
<a name="799"/>  799:     %%    expanded (32 octets):  fe 22 f8 81 17 6e da 18 eb 8f 44 52 9e 67
<a name="800"/>  800:     %%       92 c5 0c 9a 3f 89 45 2f 68 d8 ae 31 1b 43 09 d3 cf 50
<a name="801"/>  801: 
<a name="802"/>  802:     %% PRK = MasterSecret
<a name="803"/>  803:     %% hash = CAPTHash
<a name="804"/>  804:     ExporterInfo =
<a name="805"/>  805:         hexstr2bin(&quot;00 20 10 74 6c 73 31 33 20 65 78 70 20 6d 61 73
<a name="806"/>  806:           74 65 72 20 96 08 10 2a 0f 1c cc 6d b6 25 0b 7b 7e 41 7b 1a 00
<a name="807"/>  807:           0e aa da 3d aa e4 77 7a 76 86 c9 ff 83 df 13&quot;),
<a name="808"/>  808: 
<a name="809"/>  809:     ExporterMasterSecret =
<a name="810"/>  810:         hexstr2bin(&quot;fe 22 f8 81 17 6e da 18 eb 8f 44 52 9e 67
<a name="811"/>  811:           92 c5 0c 9a 3f 89 45 2f 68 d8 ae 31 1b 43 09 d3 cf 50&quot;),
<a name="812"/>  812: 
<a name="813"/>  813:     ExporterInfo =
<a name="814"/>  814:         create_info(&lt;&lt;&quot;exp master&quot;&gt;&gt;, CAPTHash, ssl_cipher:hash_size(HKDFAlgo)),
<a name="815"/>  815: 
<a name="816"/>  816:     ExporterMasterSecret =
<a name="817"/>  817:         tls_v1:exporter_master_secret(HKDFAlgo, {master_secret, MasterSecret}, CHSF),
<a name="818"/>  818: 
<a name="819"/>  819:     %% {server}  derive write traffic keys for application data:
<a name="820"/>  820:     %%
<a name="821"/>  821:     %%    PRK (32 octets):  a1 1a f9 f0 55 31 f8 56 ad 47 11 6b 45 a9 50 32
<a name="822"/>  822:     %%       82 04 b4 f4 4b fb 6b 3a 4b 4f 1f 3f cb 63 16 43
<a name="823"/>  823:     %%
<a name="824"/>  824:     %%    key info (13 octets):  00 10 09 74 6c 73 31 33 20 6b 65 79 00
<a name="825"/>  825:     %%
<a name="826"/>  826:     %%    key expanded (16 octets):  9f 02 28 3b 6c 9c 07 ef c2 6b b9 f2 ac
<a name="827"/>  827:     %%       92 e3 56
<a name="828"/>  828:     %%
<a name="829"/>  829:     %%    iv info (12 octets):  00 0c 08 74 6c 73 31 33 20 69 76 00
<a name="830"/>  830:     %%
<a name="831"/>  831:     %%    iv expanded (12 octets):  cf 78 2b 88 dd 83 54 9a ad f1 e9 84
<a name="832"/>  832: 
<a name="833"/>  833:     %% PRK = SAPTrafficsecret
<a name="834"/>  834:     %% key info = WriteKeyInfo
<a name="835"/>  835:     %% iv info = WriteIVInfo
<a name="836"/>  836:     SWKey =
<a name="837"/>  837:         hexstr2bin(&quot;9f 02 28 3b 6c 9c 07 ef c2 6b b9 f2 ac 92 e3 56&quot;),
<a name="838"/>  838: 
<a name="839"/>  839:     SWIV =
<a name="840"/>  840:         hexstr2bin(&quot;cf 78 2b 88 dd 83 54 9a ad f1 e9 84&quot;),
<a name="841"/>  841: 
<a name="842"/>  842:     {SWKey, SWIV} = tls_v1:calculate_traffic_keys(HKDFAlgo, KeyLength, SAPTrafficSecret),
<a name="843"/>  843: 
<a name="844"/>  844:     %% {server}  derive read traffic keys for handshake data:
<a name="845"/>  845:     %%
<a name="846"/>  846:     %%    PRK (32 octets):  b3 ed db 12 6e 06 7f 35 a7 80 b3 ab f4 5e 2d 8f
<a name="847"/>  847:     %%       3b 1a 95 07 38 f5 2e 96 00 74 6a 0e 27 a5 5a 21
<a name="848"/>  848:     %%
<a name="849"/>  849:     %%    key info (13 octets):  00 10 09 74 6c 73 31 33 20 6b 65 79 00
<a name="850"/>  850:     %%
<a name="851"/>  851:     %%    key expanded (16 octets):  db fa a6 93 d1 76 2c 5b 66 6a f5 d9 50
<a name="852"/>  852:     %%       25 8d 01
<a name="853"/>  853:     %%
<a name="854"/>  854:     %%    iv info (12 octets):  00 0c 08 74 6c 73 31 33 20 69 76 00
<a name="855"/>  855:     %%
<a name="856"/>  856:     %%    iv expanded (12 octets):  5b d3 c7 1b 83 6e 0b 76 bb 73 26 5f
<a name="857"/>  857: 
<a name="858"/>  858:     %% PRK = CHSTrafficsecret
<a name="859"/>  859:     %% key info = WriteKeyInfo
<a name="860"/>  860:     %% iv info = WrtieIVInfo
<a name="861"/>  861:     SRKey =
<a name="862"/>  862:         hexstr2bin(&quot;db fa a6 93 d1 76 2c 5b 66 6a f5 d9 50 25 8d 01&quot;),
<a name="863"/>  863: 
<a name="864"/>  864:     SRIV =
<a name="865"/>  865:         hexstr2bin(&quot;5b d3 c7 1b 83 6e 0b 76 bb 73 26 5f&quot;),
<a name="866"/>  866: 
<a name="867"/>  867:     {SRKey, SRIV} = tls_v1:calculate_traffic_keys(HKDFAlgo, KeyLength, CHSTrafficSecret),
<a name="868"/>  868: 
<a name="869"/>  869:     %% {client}  calculate finished &quot;tls13 finished&quot;:
<a name="870"/>  870:     %%
<a name="871"/>  871:     %%    PRK (32 octets):  b3 ed db 12 6e 06 7f 35 a7 80 b3 ab f4 5e 2d 8f
<a name="872"/>  872:     %%       3b 1a 95 07 38 f5 2e 96 00 74 6a 0e 27 a5 5a 21
<a name="873"/>  873:     %%
<a name="874"/>  874:     %%    hash (0 octets):  (empty)
<a name="875"/>  875:     %%
<a name="876"/>  876:     %%    info (18 octets):  00 20 0e 74 6c 73 31 33 20 66 69 6e 69 73 68 65
<a name="877"/>  877:     %%       64 00
<a name="878"/>  878:     %%
<a name="879"/>  879:     %%    expanded (32 octets):  b8 0a d0 10 15 fb 2f 0b d6 5f f7 d4 da 5d
<a name="880"/>  880:     %%       6b f8 3f 84 82 1d 1f 87 fd c7 d3 c7 5b 5a 7b 42 d9 c4
<a name="881"/>  881:     %%
<a name="882"/>  882:     %%    finished (32 octets):  a8 ec 43 6d 67 76 34 ae 52 5a c1 fc eb e1
<a name="883"/>  883:     %%       1a 03 9e c1 76 94 fa c6 e9 85 27 b6 42 f2 ed d5 ce 61
<a name="884"/>  884: 
<a name="885"/>  885:     %% PRK = CHSTrafficsecret
<a name="886"/>  886:     %% info = FInfo
<a name="887"/>  887:     CFExpanded =
<a name="888"/>  888:         hexstr2bin(&quot;b8 0a d0 10 15 fb 2f 0b d6 5f f7 d4 da 5d
<a name="889"/>  889:         6b f8 3f 84 82 1d 1f 87 fd c7 d3 c7 5b 5a 7b 42 d9 c4&quot;),
<a name="890"/>  890: 
<a name="891"/>  891:     CFinishedVerifyData =
<a name="892"/>  892:         hexstr2bin(&quot;a8 ec 43 6d 67 76 34 ae 52 5a c1 fc eb e1
<a name="893"/>  893:         1a 03 9e c1 76 94 fa c6 e9 85 27 b6 42 f2 ed d5 ce 61&quot;),
<a name="894"/>  894: 
<a name="895"/>  895:     MessageHistory1 = [FinishedHSBin,
<a name="896"/>  896:                        CertificateVerify,
<a name="897"/>  897:                        Certificate,
<a name="898"/>  898:                        EncryptedExtensions,
<a name="899"/>  899:                        ServerHello,
<a name="900"/>  900:                        ClientHello],
<a name="901"/>  901: 
<a name="902"/>  902:     CFExpanded = tls_v1:finished_key(CHSTrafficSecret, HKDFAlgo),
<a name="903"/>  903:     CFinishedVerifyData = tls_v1:finished_verify_data(CFExpanded, HKDFAlgo, MessageHistory1),
<a name="904"/>  904: 
<a name="905"/>  905:     %% {client}  construct a Finished handshake message:
<a name="906"/>  906:     %%
<a name="907"/>  907:     %%    Finished (36 octets):  14 00 00 20 a8 ec 43 6d 67 76 34 ae 52 5a
<a name="908"/>  908:     %%       c1 fc eb e1 1a 03 9e c1 76 94 fa c6 e9 85 27 b6 42 f2 ed d5 ce
<a name="909"/>  909:     %%       61
<a name="910"/>  910:     CFinishedBin =
<a name="911"/>  911:         hexstr2bin(&quot;14 00 00 20 a8 ec 43 6d 67 76 34 ae 52 5a
<a name="912"/>  912:           c1 fc eb e1 1a 03 9e c1 76 94 fa c6 e9 85 27 b6 42 f2 ed d5 ce
<a name="913"/>  913:           61&quot;),
<a name="914"/>  914: 
<a name="915"/>  915:     CFinished = #finished{verify_data = CFinishedVerifyData},
<a name="916"/>  916: 
<a name="917"/>  917:     CFinishedIOList = tls_handshake:encode_handshake(CFinished, ?TLS_1_3),
<a name="918"/>  918:     CFinishedBin = iolist_to_binary(CFinishedIOList),
<a name="919"/>  919: 
<a name="920"/>  920:     %% {client}  derive write traffic keys for application data:
<a name="921"/>  921:     %%
<a name="922"/>  922:     %%    PRK (32 octets):  9e 40 64 6c e7 9a 7f 9d c0 5a f8 88 9b ce 65 52
<a name="923"/>  923:     %%       87 5a fa 0b 06 df 00 87 f7 92 eb b7 c1 75 04 a5
<a name="924"/>  924:     %%
<a name="925"/>  925:     %%    key info (13 octets):  00 10 09 74 6c 73 31 33 20 6b 65 79 00
<a name="926"/>  926:     %%
<a name="927"/>  927:     %%    key expanded (16 octets):  17 42 2d da 59 6e d5 d9 ac d8 90 e3 c6
<a name="928"/>  928:     %%       3f 50 51
<a name="929"/>  929:     %%
<a name="930"/>  930:     %%    iv info (12 octets):  00 0c 08 74 6c 73 31 33 20 69 76 00
<a name="931"/>  931:     %%
<a name="932"/>  932:     %%    iv expanded (12 octets):  5b 78 92 3d ee 08 57 90 33 e5 23 d9
<a name="933"/>  933: 
<a name="934"/>  934:     %% PRK = CAPTrafficsecret
<a name="935"/>  935:     %% key info = WriteKeyInfo
<a name="936"/>  936:     %% iv info = WriteIVInfo
<a name="937"/>  937: 
<a name="938"/>  938:     CWKey =
<a name="939"/>  939:         hexstr2bin(&quot;17 42 2d da 59 6e d5 d9 ac d8 90 e3 c6 3f 50 51&quot;),
<a name="940"/>  940: 
<a name="941"/>  941:     CWIV =
<a name="942"/>  942:         hexstr2bin(&quot;5b 78 92 3d ee 08 57 90 33 e5 23 d9&quot;),
<a name="943"/>  943: 
<a name="944"/>  944:     {CWKey, CWIV} = tls_v1:calculate_traffic_keys(HKDFAlgo, KeyLength, CAPTrafficSecret),
<a name="945"/>  945: 
<a name="946"/>  946:     %% {client}  derive secret &quot;tls13 res master&quot;:
<a name="947"/>  947:     %%
<a name="948"/>  948:     %%    PRK (32 octets):  18 df 06 84 3d 13 a0 8b f2 a4 49 84 4c 5f 8a 47
<a name="949"/>  949:     %%       80 01 bc 4d 4c 62 79 84 d5 a4 1d a8 d0 40 29 19
<a name="950"/>  950:     %%
<a name="951"/>  951:     %%    hash (32 octets):  20 91 45 a9 6e e8 e2 a1 22 ff 81 00 47 cc 95 26
<a name="952"/>  952:     %%       84 65 8d 60 49 e8 64 29 42 6d b8 7c 54 ad 14 3d
<a name="953"/>  953:     %%
<a name="954"/>  954:     %%    info (52 octets):  00 20 10 74 6c 73 31 33 20 72 65 73 20 6d 61 73
<a name="955"/>  955:     %%       74 65 72 20 20 91 45 a9 6e e8 e2 a1 22 ff 81 00 47 cc 95 26 84
<a name="956"/>  956:     %%       65 8d 60 49 e8 64 29 42 6d b8 7c 54 ad 14 3d
<a name="957"/>  957:     %%
<a name="958"/>  958:     %%    expanded (32 octets):  7d f2 35 f2 03 1d 2a 05 12 87 d0 2b 02 41
<a name="959"/>  959:     %%       b0 bf da f8 6c c8 56 23 1f 2d 5a ba 46 c4 34 ec 19 6c
<a name="960"/>  960: 
<a name="961"/>  961:     %% PRK = MasterSecret
<a name="962"/>  962: 
<a name="963"/>  963:     CRMHash = hexstr2bin(&quot;20 91 45 a9 6e e8 e2 a1 22 ff 81 00 47 cc 95 26
<a name="964"/>  964:                           84 65 8d 60 49 e8 64 29 42 6d b8 7c 54 ad 14 3d&quot;),
<a name="965"/>  965: 
<a name="966"/>  966:     CRMInfo = hexstr2bin(&quot; 00 20 10 74 6c 73 31 33 20 72 65 73 20 6d 61 73
<a name="967"/>  967:             74 65 72 20 20 91 45 a9 6e e8 e2 a1 22 ff 81 00 47 cc 95 26 84
<a name="968"/>  968:             65 8d 60 49 e8 64 29 42 6d b8 7c 54 ad 14 3d&quot;),
<a name="969"/>  969: 
<a name="970"/>  970:     ResumptionMasterSecret = hexstr2bin(&quot;7d f2 35 f2 03 1d 2a 05 12 87 d0 2b 02 41
<a name="971"/>  971:                              b0 bf da f8 6c c8 56 23 1f 2d 5a ba 46 c4 34 ec 19 6c&quot;),
<a name="972"/>  972: 
<a name="973"/>  973:     CHCF = &lt;&lt;ClientHello/binary,
<a name="974"/>  974:              ServerHello/binary,
<a name="975"/>  975:              EncryptedExtensions/binary,
<a name="976"/>  976:              Certificate/binary,
<a name="977"/>  977:              CertificateVerify/binary,
<a name="978"/>  978:              FinishedHSBin/binary,
<a name="979"/>  979:              CFinishedBin/binary&gt;&gt;,
<a name="980"/>  980: 
<a name="981"/>  981:     MessageHistory3 = [ClientHello,
<a name="982"/>  982:                        ServerHello,
<a name="983"/>  983:                        EncryptedExtensions,
<a name="984"/>  984:                        Certificate,
<a name="985"/>  985:                        CertificateVerify,
<a name="986"/>  986:                        FinishedHSBin,
<a name="987"/>  987:                        CFinishedBin
<a name="988"/>  988:                        ],
<a name="989"/>  989: 
<a name="990"/>  990:     CRMHash = crypto:hash(HKDFAlgo, CHCF),
<a name="991"/>  991: 
<a name="992"/>  992:     CRMInfo =
<a name="993"/>  993:         create_info(&lt;&lt;&quot;res master&quot;&gt;&gt;, CRMHash, ssl_cipher:hash_size(HKDFAlgo)),
<a name="994"/>  994: 
<a name="995"/>  995:     ResumptionMasterSecret =
<a name="996"/>  996:         tls_v1:resumption_master_secret(HKDFAlgo, {master_secret, MasterSecret}, MessageHistory3),
<a name="1_RTT_handshake-last_expr"/><a name="997"/>  997:     ok.
<a name="998"/>  998: 
<a name="999"/>  999: <i>%%--------------------------------------------------------------------</i>
<a name="0_RTT_handshake-0"/><a name="1000"/> 1000: <b>'0_RTT_handshake'</b>() -&gt;
<a name="0_RTT_handshake-last_expr"/><a name="1001"/> 1001:      [{doc,&quot;Test TLS 1.3 0-RTT Handshake&quot;}].
<a name="1002"/> 1002: 
<a name="0_RTT_handshake-1"/><a name="1003"/> 1003: <b>'0_RTT_handshake'</b>(_Config) -&gt;
<a name="1004"/> 1004:     HKDFAlgo = sha256,
<a name="1005"/> 1005: 
<a name="1006"/> 1006:     %% {server}  generate resumption secret &quot;tls13 resumption&quot;:
<a name="1007"/> 1007:     %%
<a name="1008"/> 1008:     %%    PRK (32 octets):  7d f2 35 f2 03 1d 2a 05 12 87 d0 2b 02 41 b0 bf
<a name="1009"/> 1009:     %%       da f8 6c c8 56 23 1f 2d 5a ba 46 c4 34 ec 19 6c
<a name="1010"/> 1010:     %%
<a name="1011"/> 1011:     %%    hash (2 octets):  00 00
<a name="1012"/> 1012:     %%
<a name="1013"/> 1013:     %%    info (22 octets):  00 20 10 74 6c 73 31 33 20 72 65 73 75 6d 70 74
<a name="1014"/> 1014:     %%       69 6f 6e 02 00 00
<a name="1015"/> 1015:     %%
<a name="1016"/> 1016:     %%    expanded (32 octets):  4e cd 0e b6 ec 3b 4d 87 f5 d6 02 8f 92 2c
<a name="1017"/> 1017:     %%       a4 c5 85 1a 27 7f d4 13 11 c9 e6 2d 2c 94 92 e1 c4 f3
<a name="1018"/> 1018:     %%
<a name="1019"/> 1019:     %% {server}  construct a NewSessionTicket handshake message:
<a name="1020"/> 1020:     %%
<a name="1021"/> 1021:     %%    NewSessionTicket (205 octets):  04 00 00 c9 00 00 00 1e fa d6 aa
<a name="1022"/> 1022:     %%       c5 02 00 00 00 b2 2c 03 5d 82 93 59 ee 5f f7 af 4e c9 00 00 00
<a name="1023"/> 1023:     %%       00 26 2a 64 94 dc 48 6d 2c 8a 34 cb 33 fa 90 bf 1b 00 70 ad 3c
<a name="1024"/> 1024:     %%       49 88 83 c9 36 7c 09 a2 be 78 5a bc 55 cd 22 60 97 a3 a9 82 11
<a name="1025"/> 1025:     %%       72 83 f8 2a 03 a1 43 ef d3 ff 5d d3 6d 64 e8 61 be 7f d6 1d 28
<a name="1026"/> 1026:     %%       27 db 27 9c ce 14 50 77 d4 54 a3 66 4d 4e 6d a4 d2 9e e0 37 25
<a name="1027"/> 1027:     %%       a6 a4 da fc d0 fc 67 d2 ae a7 05 29 51 3e 3d a2 67 7f a5 90 6c
<a name="1028"/> 1028:     %%       5b 3f 7d 8f 92 f2 28 bd a4 0d da 72 14 70 f9 fb f2 97 b5 ae a6
<a name="1029"/> 1029:     %%       17 64 6f ac 5c 03 27 2e 97 07 27 c6 21 a7 91 41 ef 5f 7d e6 50
<a name="1030"/> 1030:     %%       5e 5b fb c3 88 e9 33 43 69 40 93 93 4a e4 d3 57 00 08 00 2a 00
<a name="1031"/> 1031:     %%       04 00 00 04 00
<a name="1032"/> 1032:     ResPRK =
<a name="1033"/> 1033:         hexstr2bin(&quot;7d f2 35 f2 03 1d 2a 05 12 87 d0 2b 02 41 b0 bf
<a name="1034"/> 1034:                     da f8 6c c8 56 23 1f 2d 5a ba 46 c4 34 ec 19 6c&quot;),
<a name="1035"/> 1035: 
<a name="1036"/> 1036:     _ResHash = hexstr2bin(&quot;00 00&quot;),
<a name="1037"/> 1037: 
<a name="1038"/> 1038:     _ResInfo = hexstr2bin(&quot;00 20 10 74 6c 73 31 33 20 72 65 73 75 6d 70 74
<a name="1039"/> 1039:                            69 6f 6e 02 00 00&quot;),
<a name="1040"/> 1040: 
<a name="1041"/> 1041:     ResExpanded =
<a name="1042"/> 1042:         hexstr2bin(&quot;4e cd 0e b6 ec 3b 4d 87 f5 d6 02 8f 92 2c
<a name="1043"/> 1043:         a4 c5 85 1a 27 7f d4 13 11 c9 e6 2d 2c 94 92 e1 c4 f3&quot;),
<a name="1044"/> 1044: 
<a name="1045"/> 1045:     NewSessionTicket =
<a name="1046"/> 1046:         hexstr2bin(&quot;04 00 00 c9 00 00 00 1e fa d6 aa
<a name="1047"/> 1047:           c5 02 00 00 00 b2 2c 03 5d 82 93 59 ee 5f f7 af 4e c9 00 00 00
<a name="1048"/> 1048:           00 26 2a 64 94 dc 48 6d 2c 8a 34 cb 33 fa 90 bf 1b 00 70 ad 3c
<a name="1049"/> 1049:           49 88 83 c9 36 7c 09 a2 be 78 5a bc 55 cd 22 60 97 a3 a9 82 11
<a name="1050"/> 1050:           72 83 f8 2a 03 a1 43 ef d3 ff 5d d3 6d 64 e8 61 be 7f d6 1d 28
<a name="1051"/> 1051:           27 db 27 9c ce 14 50 77 d4 54 a3 66 4d 4e 6d a4 d2 9e e0 37 25
<a name="1052"/> 1052:           a6 a4 da fc d0 fc 67 d2 ae a7 05 29 51 3e 3d a2 67 7f a5 90 6c
<a name="1053"/> 1053:           5b 3f 7d 8f 92 f2 28 bd a4 0d da 72 14 70 f9 fb f2 97 b5 ae a6
<a name="1054"/> 1054:           17 64 6f ac 5c 03 27 2e 97 07 27 c6 21 a7 91 41 ef 5f 7d e6 50
<a name="1055"/> 1055:           5e 5b fb c3 88 e9 33 43 69 40 93 93 4a e4 d3 57 00 08 00 2a 00
<a name="1056"/> 1056:           04 00 00 04 00&quot;),
<a name="1057"/> 1057:     &lt;&lt;?BYTE(NWT), ?UINT24(_), TicketBody/binary&gt;&gt; = NewSessionTicket,
<a name="1058"/> 1058:     #new_session_ticket{
<a name="1059"/> 1059:        ticket_lifetime = _LifeTime,
<a name="1060"/> 1060:        ticket_age_add = _AgeAdd,
<a name="1061"/> 1061:        ticket_nonce = Nonce,
<a name="1062"/> 1062:        ticket = Ticket,
<a name="1063"/> 1063:        extensions = _Extensions
<a name="1064"/> 1064:       } = tls_handshake:decode_handshake(?TLS_1_3, NWT, TicketBody),
<a name="1065"/> 1065: 
<a name="1066"/> 1066:     %% ResPRK = resumption master secret
<a name="1067"/> 1067:     ResExpanded = tls_v1:pre_shared_key(ResPRK, Nonce, HKDFAlgo),
<a name="1068"/> 1068: 
<a name="1069"/> 1069:     %% {client}  create an ephemeral x25519 key pair:
<a name="1070"/> 1070:     %%
<a name="1071"/> 1071:     %%    private key (32 octets):  bf f9 11 88 28 38 46 dd 6a 21 34 ef 71
<a name="1072"/> 1072:     %%       80 ca 2b 0b 14 fb 10 dc e7 07 b5 09 8c 0d dd c8 13 b2 df
<a name="1073"/> 1073:     %%
<a name="1074"/> 1074:     %%    public key (32 octets):  e4 ff b6 8a c0 5f 8d 96 c9 9d a2 66 98 34
<a name="1075"/> 1075:     %%       6c 6b e1 64 82 ba dd da fe 05 1a 66 b4 f1 8d 66 8f 0b
<a name="1076"/> 1076:     %%
<a name="1077"/> 1077:     %% {client}  extract secret &quot;early&quot;:
<a name="1078"/> 1078:     %%
<a name="1079"/> 1079:     %%    salt:  0 (all zero octets)
<a name="1080"/> 1080:     %%
<a name="1081"/> 1081:     %%    IKM (32 octets):  4e cd 0e b6 ec 3b 4d 87 f5 d6 02 8f 92 2c a4 c5
<a name="1082"/> 1082:     %%       85 1a 27 7f d4 13 11 c9 e6 2d 2c 94 92 e1 c4 f3
<a name="1083"/> 1083:     %%
<a name="1084"/> 1084:     %%    secret (32 octets):  9b 21 88 e9 b2 fc 6d 64 d7 1d c3 29 90 0e 20
<a name="1085"/> 1085:     %%       bb 41 91 50 00 f6 78 aa 83 9c bb 79 7c b7 d8 33 2c
<a name="1086"/> 1086:     %%
<a name="1087"/> 1087: 
<a name="1088"/> 1088:     PSK = hexstr2bin(&quot;4e cd 0e b6 ec 3b 4d 87 f5 d6 02 8f 92 2c a4 c5
<a name="1089"/> 1089:                       85 1a 27 7f d4 13 11 c9 e6 2d 2c 94 92 e1 c4 f3&quot;),
<a name="1090"/> 1090:     PSK = ResExpanded,
<a name="1091"/> 1091:     EarlySecret = hexstr2bin(&quot;9b 21 88 e9 b2 fc 6d 64 d7 1d c3 29 90 0e 20
<a name="1092"/> 1092:                       bb 41 91 50 00 f6 78 aa 83 9c bb 79 7c b7 d8 33 2c&quot;),
<a name="1093"/> 1093: 
<a name="1094"/> 1094:     {early_secret, EarlySecret} = tls_v1:key_schedule(early_secret, HKDFAlgo, {psk, PSK}),
<a name="1095"/> 1095: 
<a name="1096"/> 1096:     %% {client}  construct a ClientHello handshake message:
<a name="1097"/> 1097:     %%
<a name="1098"/> 1098:     %%    ClientHello (477 octets):  01 00 01 fc 03 03 1b c3 ce b6 bb e3 9c
<a name="1099"/> 1099:     %%       ff 93 83 55 b5 a5 0a db 6d b2 1b 7a 6a f6 49 d7 b4 bc 41 9d 78
<a name="1100"/> 1100:     %%       76 48 7d 95 00 00 06 13 01 13 03 13 02 01 00 01 cd 00 00 00 0b
<a name="1101"/> 1101:     %%       00 09 00 00 06 73 65 72 76 65 72 ff 01 00 01 00 00 0a 00 14 00
<a name="1102"/> 1102:     %%       12 00 1d 00 17 00 18 00 19 01 00 01 01 01 02 01 03 01 04 00 33
<a name="1103"/> 1103:     %%       00 26 00 24 00 1d 00 20 e4 ff b6 8a c0 5f 8d 96 c9 9d a2 66 98
<a name="1104"/> 1104:     %%       34 6c 6b e1 64 82 ba dd da fe 05 1a 66 b4 f1 8d 66 8f 0b 00 2a
<a name="1105"/> 1105:     %%       00 00 00 2b 00 03 02 03 04 00 0d 00 20 00 1e 04 03 05 03 06 03
<a name="1106"/> 1106:     %%       02 03 08 04 08 05 08 06 04 01 05 01 06 01 02 01 04 02 05 02 06
<a name="1107"/> 1107:     %%       02 02 02 00 2d 00 02 01 01 00 1c 00 02 40 01 00 15 00 57 00 00
<a name="1108"/> 1108:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1109"/> 1109:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1110"/> 1110:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1111"/> 1111:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1112"/> 1112:     %%       00 00 29 00 dd 00 b8 00 b2 2c 03 5d 82 93 59 ee 5f f7 af 4e c9
<a name="1113"/> 1113:     %%       00 00 00 00 26 2a 64 94 dc 48 6d 2c 8a 34 cb 33 fa 90 bf 1b 00
<a name="1114"/> 1114:     %%       70 ad 3c 49 88 83 c9 36 7c 09 a2 be 78 5a bc 55 cd 22 60 97 a3
<a name="1115"/> 1115:     %%       a9 82 11 72 83 f8 2a 03 a1 43 ef d3 ff 5d d3 6d 64 e8 61 be 7f
<a name="1116"/> 1116:     %%       d6 1d 28 27 db 27 9c ce 14 50 77 d4 54 a3 66 4d 4e 6d a4 d2 9e
<a name="1117"/> 1117:     %%       e0 37 25 a6 a4 da fc d0 fc 67 d2 ae a7 05 29 51 3e 3d a2 67 7f
<a name="1118"/> 1118:     %%       a5 90 6c 5b 3f 7d 8f 92 f2 28 bd a4 0d da 72 14 70 f9 fb f2 97
<a name="1119"/> 1119:     %%       b5 ae a6 17 64 6f ac 5c 03 27 2e 97 07 27 c6 21 a7 91 41 ef 5f
<a name="1120"/> 1120:     %%       7d e6 50 5e 5b fb c3 88 e9 33 43 69 40 93 93 4a e4 d3 57 fa d6
<a name="1121"/> 1121:     %%       aa cb
<a name="1122"/> 1122:     %%
<a name="1123"/> 1123:     ClientHello =
<a name="1124"/> 1124:         hexstr2bin(&quot;01 00 01 fc 03 03 1b c3 ce b6 bb e3 9c
<a name="1125"/> 1125:           ff 93 83 55 b5 a5 0a db 6d b2 1b 7a 6a f6 49 d7 b4 bc 41 9d 78
<a name="1126"/> 1126:           76 48 7d 95 00 00 06 13 01 13 03 13 02 01 00 01 cd 00 00 00 0b
<a name="1127"/> 1127:           00 09 00 00 06 73 65 72 76 65 72 ff 01 00 01 00 00 0a 00 14 00
<a name="1128"/> 1128:           12 00 1d 00 17 00 18 00 19 01 00 01 01 01 02 01 03 01 04 00 33
<a name="1129"/> 1129:           00 26 00 24 00 1d 00 20 e4 ff b6 8a c0 5f 8d 96 c9 9d a2 66 98
<a name="1130"/> 1130:           34 6c 6b e1 64 82 ba dd da fe 05 1a 66 b4 f1 8d 66 8f 0b 00 2a
<a name="1131"/> 1131:           00 00 00 2b 00 03 02 03 04 00 0d 00 20 00 1e 04 03 05 03 06 03
<a name="1132"/> 1132:           02 03 08 04 08 05 08 06 04 01 05 01 06 01 02 01 04 02 05 02 06
<a name="1133"/> 1133:           02 02 02 00 2d 00 02 01 01 00 1c 00 02 40 01 00 15 00 57 00 00
<a name="1134"/> 1134:           00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1135"/> 1135:           00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1136"/> 1136:           00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1137"/> 1137:           00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1138"/> 1138:           00 00 29 00 dd 00 b8 00 b2 2c 03 5d 82 93 59 ee 5f f7 af 4e c9
<a name="1139"/> 1139:           00 00 00 00 26 2a 64 94 dc 48 6d 2c 8a 34 cb 33 fa 90 bf 1b 00
<a name="1140"/> 1140:           70 ad 3c 49 88 83 c9 36 7c 09 a2 be 78 5a bc 55 cd 22 60 97 a3
<a name="1141"/> 1141:           a9 82 11 72 83 f8 2a 03 a1 43 ef d3 ff 5d d3 6d 64 e8 61 be 7f
<a name="1142"/> 1142:           d6 1d 28 27 db 27 9c ce 14 50 77 d4 54 a3 66 4d 4e 6d a4 d2 9e
<a name="1143"/> 1143:           e0 37 25 a6 a4 da fc d0 fc 67 d2 ae a7 05 29 51 3e 3d a2 67 7f
<a name="1144"/> 1144:           a5 90 6c 5b 3f 7d 8f 92 f2 28 bd a4 0d da 72 14 70 f9 fb f2 97
<a name="1145"/> 1145:           b5 ae a6 17 64 6f ac 5c 03 27 2e 97 07 27 c6 21 a7 91 41 ef 5f
<a name="1146"/> 1146:           7d e6 50 5e 5b fb c3 88 e9 33 43 69 40 93 93 4a e4 d3 57 fa d6
<a name="1147"/> 1147:           aa cb&quot;),
<a name="1148"/> 1148: 
<a name="1149"/> 1149:     %% {client}  calculate PSK binder:
<a name="1150"/> 1150:     %%
<a name="1151"/> 1151:     %%    ClientHello prefix (477 octets):  01 00 01 fc 03 03 1b c3 ce b6 bb
<a name="1152"/> 1152:     %%       e3 9c ff 93 83 55 b5 a5 0a db 6d b2 1b 7a 6a f6 49 d7 b4 bc 41
<a name="1153"/> 1153:     %%       9d 78 76 48 7d 95 00 00 06 13 01 13 03 13 02 01 00 01 cd 00 00
<a name="1154"/> 1154:     %%       00 0b 00 09 00 00 06 73 65 72 76 65 72 ff 01 00 01 00 00 0a 00
<a name="1155"/> 1155:     %%       14 00 12 00 1d 00 17 00 18 00 19 01 00 01 01 01 02 01 03 01 04
<a name="1156"/> 1156:     %%       00 33 00 26 00 24 00 1d 00 20 e4 ff b6 8a c0 5f 8d 96 c9 9d a2
<a name="1157"/> 1157:     %%       66 98 34 6c 6b e1 64 82 ba dd da fe 05 1a 66 b4 f1 8d 66 8f 0b
<a name="1158"/> 1158:     %%       00 2a 00 00 00 2b 00 03 02 03 04 00 0d 00 20 00 1e 04 03 05 03
<a name="1159"/> 1159:     %%       06 03 02 03 08 04 08 05 08 06 04 01 05 01 06 01 02 01 04 02 05
<a name="1160"/> 1160:     %%       02 06 02 02 02 00 2d 00 02 01 01 00 1c 00 02 40 01 00 15 00 57
<a name="1161"/> 1161:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1162"/> 1162:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1163"/> 1163:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1164"/> 1164:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1165"/> 1165:     %%       00 00 00 00 29 00 dd 00 b8 00 b2 2c 03 5d 82 93 59 ee 5f f7 af
<a name="1166"/> 1166:     %%       4e c9 00 00 00 00 26 2a 64 94 dc 48 6d 2c 8a 34 cb 33 fa 90 bf
<a name="1167"/> 1167:     %%       1b 00 70 ad 3c 49 88 83 c9 36 7c 09 a2 be 78 5a bc 55 cd 22 60
<a name="1168"/> 1168:     %%       97 a3 a9 82 11 72 83 f8 2a 03 a1 43 ef d3 ff 5d d3 6d 64 e8 61
<a name="1169"/> 1169:     %%       be 7f d6 1d 28 27 db 27 9c ce 14 50 77 d4 54 a3 66 4d 4e 6d a4
<a name="1170"/> 1170:     %%       d2 9e e0 37 25 a6 a4 da fc d0 fc 67 d2 ae a7 05 29 51 3e 3d a2
<a name="1171"/> 1171:     %%       67 7f a5 90 6c 5b 3f 7d 8f 92 f2 28 bd a4 0d da 72 14 70 f9 fb
<a name="1172"/> 1172:     %%       f2 97 b5 ae a6 17 64 6f ac 5c 03 27 2e 97 07 27 c6 21 a7 91 41
<a name="1173"/> 1173:     %%       ef 5f 7d e6 50 5e 5b fb c3 88 e9 33 43 69 40 93 93 4a e4 d3 57
<a name="1174"/> 1174:     %%       fa d6 aa cb
<a name="1175"/> 1175:     %%
<a name="1176"/> 1176:     %%    binder hash (32 octets):  63 22 4b 2e 45 73 f2 d3 45 4c a8 4b 9d
<a name="1177"/> 1177:     %%       00 9a 04 f6 be 9e 05 71 1a 83 96 47 3a ef a0 1e 92 4a 14
<a name="1178"/> 1178:     %%
<a name="1179"/> 1179:     %%    PRK (32 octets):  69 fe 13 1a 3b ba d5 d6 3c 64 ee bc c3 0e 39 5b
<a name="1180"/> 1180:     %%       9d 81 07 72 6a 13 d0 74 e3 89 db c8 a4 e4 72 56
<a name="1181"/> 1181:     %%
<a name="1182"/> 1182:     %%    hash (0 octets):  (empty)
<a name="1183"/> 1183:     %%
<a name="1184"/> 1184:     %%    info (18 octets):  00 20 0e 74 6c 73 31 33 20 66 69 6e 69 73 68 65
<a name="1185"/> 1185:     %%       64 00
<a name="1186"/> 1186:     %%
<a name="1187"/> 1187:     %%    expanded (32 octets):  55 88 67 3e 72 cb 59 c8 7d 22 0c af fe 94
<a name="1188"/> 1188:     %%       f2 de a9 a3 b1 60 9f 7d 50 e9 0a 48 22 7d b9 ed 7e aa
<a name="1189"/> 1189:     %%
<a name="1190"/> 1190:     %%    finished (32 octets):  3a dd 4f b2 d8 fd f8 22 a0 ca 3c f7 67 8e
<a name="1191"/> 1191:     %%       f5 e8 8d ae 99 01 41 c5 92 4d 57 bb 6f a3 1b 9e 5f 9d
<a name="1192"/> 1192:     BinderHash =
<a name="1193"/> 1193:         hexstr2bin(&quot;63 22 4b 2e 45 73 f2 d3 45 4c a8 4b 9d
<a name="1194"/> 1194:                     00 9a 04 f6 be 9e 05 71 1a 83 96 47 3a ef a0 1e 92 4a 14&quot;),
<a name="1195"/> 1195: 
<a name="1196"/> 1196:     %% Part of derive_secret/4
<a name="1197"/> 1197:     BinderHash = crypto:hash(HKDFAlgo, [ClientHello]),
<a name="1198"/> 1198: 
<a name="1199"/> 1199:     PRK = hexstr2bin(&quot;69 fe 13 1a 3b ba d5 d6 3c 64 ee bc c3 0e 39 5b
<a name="1200"/> 1200:                       9d 81 07 72 6a 13 d0 74 e3 89 db c8 a4 e4 72 56&quot;),
<a name="1201"/> 1201: 
<a name="1202"/> 1202:     PRK = tls_v1:resumption_binder_key(HKDFAlgo, {early_secret, EarlySecret}),
<a name="1203"/> 1203: 
<a name="1204"/> 1204:     Expanded =
<a name="1205"/> 1205:         hexstr2bin(&quot;55 88 67 3e 72 cb 59 c8 7d 22 0c af fe 94
<a name="1206"/> 1206:                     f2 de a9 a3 b1 60 9f 7d 50 e9 0a 48 22 7d b9 ed 7e aa&quot;),
<a name="1207"/> 1207: 
<a name="1208"/> 1208:     Expanded = tls_v1:finished_key(PRK, HKDFAlgo),
<a name="1209"/> 1209: 
<a name="1210"/> 1210:     Finished = hexstr2bin(&quot;3a dd 4f b2 d8 fd f8 22 a0 ca 3c f7 67 8e
<a name="1211"/> 1211:                f5 e8 8d ae 99 01 41 c5 92 4d 57 bb 6f a3 1b 9e 5f 9d&quot;),
<a name="1212"/> 1212: 
<a name="1213"/> 1213:     Finished = tls_v1:finished_verify_data(Expanded, HKDFAlgo, [ClientHello]),
<a name="1214"/> 1214: 
<a name="1215"/> 1215:     %% {client}  send handshake record:
<a name="1216"/> 1216:     %%
<a name="1217"/> 1217:     %%    payload (512 octets):  01 00 01 fc 03 03 1b c3 ce b6 bb e3 9c ff
<a name="1218"/> 1218:     %%       93 83 55 b5 a5 0a db 6d b2 1b 7a 6a f6 49 d7 b4 bc 41 9d 78 76
<a name="1219"/> 1219:     %%       48 7d 95 00 00 06 13 01 13 03 13 02 01 00 01 cd 00 00 00 0b 00
<a name="1220"/> 1220:     %%       09 00 00 06 73 65 72 76 65 72 ff 01 00 01 00 00 0a 00 14 00 12
<a name="1221"/> 1221:     %%       00 1d 00 17 00 18 00 19 01 00 01 01 01 02 01 03 01 04 00 33 00
<a name="1222"/> 1222:     %%       26 00 24 00 1d 00 20 e4 ff b6 8a c0 5f 8d 96 c9 9d a2 66 98 34
<a name="1223"/> 1223:     %%       6c 6b e1 64 82 ba dd da fe 05 1a 66 b4 f1 8d 66 8f 0b 00 2a 00
<a name="1224"/> 1224:     %%       00 00 2b 00 03 02 03 04 00 0d 00 20 00 1e 04 03 05 03 06 03 02
<a name="1225"/> 1225:     %%       03 08 04 08 05 08 06 04 01 05 01 06 01 02 01 04 02 05 02 06 02
<a name="1226"/> 1226:     %%       02 02 00 2d 00 02 01 01 00 1c 00 02 40 01 00 15 00 57 00 00 00
<a name="1227"/> 1227:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1228"/> 1228:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1229"/> 1229:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1230"/> 1230:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1231"/> 1231:     %%       00 29 00 dd 00 b8 00 b2 2c 03 5d 82 93 59 ee 5f f7 af 4e c9 00
<a name="1232"/> 1232:     %%       00 00 00 26 2a 64 94 dc 48 6d 2c 8a 34 cb 33 fa 90 bf 1b 00 70
<a name="1233"/> 1233:     %%       ad 3c 49 88 83 c9 36 7c 09 a2 be 78 5a bc 55 cd 22 60 97 a3 a9
<a name="1234"/> 1234:     %%       82 11 72 83 f8 2a 03 a1 43 ef d3 ff 5d d3 6d 64 e8 61 be 7f d6
<a name="1235"/> 1235:     %%       1d 28 27 db 27 9c ce 14 50 77 d4 54 a3 66 4d 4e 6d a4 d2 9e e0
<a name="1236"/> 1236:     %%       37 25 a6 a4 da fc d0 fc 67 d2 ae a7 05 29 51 3e 3d a2 67 7f a5
<a name="1237"/> 1237:     %%       90 6c 5b 3f 7d 8f 92 f2 28 bd a4 0d da 72 14 70 f9 fb f2 97 b5
<a name="1238"/> 1238:     %%       ae a6 17 64 6f ac 5c 03 27 2e 97 07 27 c6 21 a7 91 41 ef 5f 7d
<a name="1239"/> 1239:     %%       e6 50 5e 5b fb c3 88 e9 33 43 69 40 93 93 4a e4 d3 57 fa d6 aa
<a name="1240"/> 1240:     %%       cb 00 21 20 3a dd 4f b2 d8 fd f8 22 a0 ca 3c f7 67 8e f5 e8 8d
<a name="1241"/> 1241:     %%       ae 99 01 41 c5 92 4d 57 bb 6f a3 1b 9e 5f 9d
<a name="1242"/> 1242:     %%
<a name="1243"/> 1243:     %%    complete record (517 octets):  16 03 01 02 00 01 00 01 fc 03 03 1b
<a name="1244"/> 1244:     %%       c3 ce b6 bb e3 9c ff 93 83 55 b5 a5 0a db 6d b2 1b 7a 6a f6 49
<a name="1245"/> 1245:     %%       d7 b4 bc 41 9d 78 76 48 7d 95 00 00 06 13 01 13 03 13 02 01 00
<a name="1246"/> 1246:     %%       01 cd 00 00 00 0b 00 09 00 00 06 73 65 72 76 65 72 ff 01 00 01
<a name="1247"/> 1247:     %%       00 00 0a 00 14 00 12 00 1d 00 17 00 18 00 19 01 00 01 01 01 02
<a name="1248"/> 1248:     %%       01 03 01 04 00 33 00 26 00 24 00 1d 00 20 e4 ff b6 8a c0 5f 8d
<a name="1249"/> 1249:     %%       96 c9 9d a2 66 98 34 6c 6b e1 64 82 ba dd da fe 05 1a 66 b4 f1
<a name="1250"/> 1250:     %%       8d 66 8f 0b 00 2a 00 00 00 2b 00 03 02 03 04 00 0d 00 20 00 1e
<a name="1251"/> 1251:     %%       04 03 05 03 06 03 02 03 08 04 08 05 08 06 04 01 05 01 06 01 02
<a name="1252"/> 1252:     %%       01 04 02 05 02 06 02 02 02 00 2d 00 02 01 01 00 1c 00 02 40 01
<a name="1253"/> 1253:     %%       00 15 00 57 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1254"/> 1254:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1255"/> 1255:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1256"/> 1256:     %%       00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1257"/> 1257:     %%       00 00 00 00 00 00 00 00 29 00 dd 00 b8 00 b2 2c 03 5d 82 93 59
<a name="1258"/> 1258:     %%       ee 5f f7 af 4e c9 00 00 00 00 26 2a 64 94 dc 48 6d 2c 8a 34 cb
<a name="1259"/> 1259:     %%       33 fa 90 bf 1b 00 70 ad 3c 49 88 83 c9 36 7c 09 a2 be 78 5a bc
<a name="1260"/> 1260:     %%       55 cd 22 60 97 a3 a9 82 11 72 83 f8 2a 03 a1 43 ef d3 ff 5d d3
<a name="1261"/> 1261:     %%       6d 64 e8 61 be 7f d6 1d 28 27 db 27 9c ce 14 50 77 d4 54 a3 66
<a name="1262"/> 1262:     %%       4d 4e 6d a4 d2 9e e0 37 25 a6 a4 da fc d0 fc 67 d2 ae a7 05 29
<a name="1263"/> 1263:     %%       51 3e 3d a2 67 7f a5 90 6c 5b 3f 7d 8f 92 f2 28 bd a4 0d da 72
<a name="1264"/> 1264:     %%       14 70 f9 fb f2 97 b5 ae a6 17 64 6f ac 5c 03 27 2e 97 07 27 c6
<a name="1265"/> 1265:     %%       21 a7 91 41 ef 5f 7d e6 50 5e 5b fb c3 88 e9 33 43 69 40 93 93
<a name="1266"/> 1266:     %%       4a e4 d3 57 fa d6 aa cb 00 21 20 3a dd 4f b2 d8 fd f8 22 a0 ca
<a name="1267"/> 1267:     %%       3c f7 67 8e f5 e8 8d ae 99 01 41 c5 92 4d 57 bb 6f a3 1b 9e 5f
<a name="1268"/> 1268:     %%       9d
<a name="1269"/> 1269:     ClientHelloRecord =
<a name="1270"/> 1270:         hexstr2bin(&quot;01 00 01 fc 03 03 1b c3 ce b6 bb e3 9c ff
<a name="1271"/> 1271:           93 83 55 b5 a5 0a db 6d b2 1b 7a 6a f6 49 d7 b4 bc 41 9d 78 76
<a name="1272"/> 1272:           48 7d 95 00 00 06 13 01 13 03 13 02 01 00 01 cd 00 00 00 0b 00
<a name="1273"/> 1273:           09 00 00 06 73 65 72 76 65 72 ff 01 00 01 00 00 0a 00 14 00 12
<a name="1274"/> 1274:           00 1d 00 17 00 18 00 19 01 00 01 01 01 02 01 03 01 04 00 33 00
<a name="1275"/> 1275:           26 00 24 00 1d 00 20 e4 ff b6 8a c0 5f 8d 96 c9 9d a2 66 98 34
<a name="1276"/> 1276:           6c 6b e1 64 82 ba dd da fe 05 1a 66 b4 f1 8d 66 8f 0b 00 2a 00
<a name="1277"/> 1277:           00 00 2b 00 03 02 03 04 00 0d 00 20 00 1e 04 03 05 03 06 03 02
<a name="1278"/> 1278:           03 08 04 08 05 08 06 04 01 05 01 06 01 02 01 04 02 05 02 06 02
<a name="1279"/> 1279:           02 02 00 2d 00 02 01 01 00 1c 00 02 40 01 00 15 00 57 00 00 00
<a name="1280"/> 1280:           00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1281"/> 1281:           00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1282"/> 1282:           00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1283"/> 1283:           00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
<a name="1284"/> 1284:           00 29 00 dd 00 b8 00 b2 2c 03 5d 82 93 59 ee 5f f7 af 4e c9 00
<a name="1285"/> 1285:           00 00 00 26 2a 64 94 dc 48 6d 2c 8a 34 cb 33 fa 90 bf 1b 00 70
<a name="1286"/> 1286:           ad 3c 49 88 83 c9 36 7c 09 a2 be 78 5a bc 55 cd 22 60 97 a3 a9
<a name="1287"/> 1287:           82 11 72 83 f8 2a 03 a1 43 ef d3 ff 5d d3 6d 64 e8 61 be 7f d6
<a name="1288"/> 1288:           1d 28 27 db 27 9c ce 14 50 77 d4 54 a3 66 4d 4e 6d a4 d2 9e e0
<a name="1289"/> 1289:           37 25 a6 a4 da fc d0 fc 67 d2 ae a7 05 29 51 3e 3d a2 67 7f a5
<a name="1290"/> 1290:           90 6c 5b 3f 7d 8f 92 f2 28 bd a4 0d da 72 14 70 f9 fb f2 97 b5
<a name="1291"/> 1291:           ae a6 17 64 6f ac 5c 03 27 2e 97 07 27 c6 21 a7 91 41 ef 5f 7d
<a name="1292"/> 1292:           e6 50 5e 5b fb c3 88 e9 33 43 69 40 93 93 4a e4 d3 57 fa d6 aa
<a name="1293"/> 1293:           cb 00 21 20 3a dd 4f b2 d8 fd f8 22 a0 ca 3c f7 67 8e f5 e8 8d
<a name="1294"/> 1294:           ae 99 01 41 c5 92 4d 57 bb 6f a3 1b 9e 5f 9d&quot;),
<a name="1295"/> 1295: 
<a name="1296"/> 1296:     &lt;&lt;?BYTE(CH), ?UINT24(_Length), ClientHelloBody/binary&gt;&gt; = ClientHelloRecord,
<a name="1297"/> 1297:     #client_hello{extensions = #{pre_shared_key := PreSharedKey}} =
<a name="1298"/> 1298:         tls_handshake:decode_handshake(?TLS_1_3, CH, ClientHelloBody),
<a name="1299"/> 1299: 
<a name="1300"/> 1300:     #pre_shared_key_client_hello{
<a name="1301"/> 1301:        offered_psks = #offered_psks{
<a name="1302"/> 1302:                          identities = [Identity],
<a name="1303"/> 1303:                          binders = [_Binders]}} =  PreSharedKey,
<a name="1304"/> 1304: 
<a name="1305"/> 1305:     #psk_identity{
<a name="1306"/> 1306:        identity = Ticket} = Identity,
<a name="1307"/> 1307: 
<a name="0_RTT_handshake-last_expr"/><a name="1308"/> 1308:     ok.
<a name="1309"/> 1309: 
<a name="1310"/> 1310: 
<a name="1311"/> 1311: <i>%%--------------------------------------------------------------------</i>
<a name="finished_verify_data-0"/><a name="1312"/> 1312: <b>finished_verify_data</b>() -&gt;
<a name="finished_verify_data-last_expr"/><a name="1313"/> 1313:      [{doc,&quot;Test TLS 1.3 Finished message handling&quot;}].
<a name="1314"/> 1314: 
<a name="finished_verify_data-1"/><a name="1315"/> 1315: <b>finished_verify_data</b>(_Config) -&gt;
<a name="1316"/> 1316:     ClientHello =
<a name="1317"/> 1317:         hexstr2bin(&quot;01 00 00 c6 03 03 00 01  02 03 04 05 06 07 08 09
<a name="1318"/> 1318:                     0a 0b 0c 0d 0e 0f 10 11  12 13 14 15 16 17 18 19
<a name="1319"/> 1319:                     1a 1b 1c 1d 1e 1f 20 e0  e1 e2 e3 e4 e5 e6 e7 e8
<a name="1320"/> 1320:                     e9 ea eb ec ed ee ef f0  f1 f2 f3 f4 f5 f6 f7 f8
<a name="1321"/> 1321:                     f9 fa fb fc fd fe ff 00  06 13 01 13 02 13 03 01
<a name="1322"/> 1322:                     00 00 77 00 00 00 18 00  16 00 00 13 65 78 61 6d
<a name="1323"/> 1323:                     70 6c 65 2e 75 6c 66 68  65 69 6d 2e 6e 65 74 00
<a name="1324"/> 1324:                     0a 00 08 00 06 00 1d 00  17 00 18 00 0d 00 14 00
<a name="1325"/> 1325:                     12 04 03 08 04 04 01 05  03 08 05 05 01 08 06 06
<a name="1326"/> 1326:                     01 02 01 00 33 00 26 00  24 00 1d 00 20 35 80 72
<a name="1327"/> 1327:                     d6 36 58 80 d1 ae ea 32  9a df 91 21 38 38 51 ed
<a name="1328"/> 1328:                     21 a2 8e 3b 75 e9 65 d0  d2 cd 16 62 54 00 2d 00
<a name="1329"/> 1329:                     02 01 01 00 2b 00 03 02  03 04&quot;),
<a name="1330"/> 1330: 
<a name="1331"/> 1331:     ServerHello =
<a name="1332"/> 1332:         hexstr2bin(&quot;02 00 00 76 03 03 70 71  72 73 74 75 76 77 78 79
<a name="1333"/> 1333:                     7a 7b 7c 7d 7e 7f 80 81  82 83 84 85 86 87 88 89
<a name="1334"/> 1334:                     8a 8b 8c 8d 8e 8f 20 e0  e1 e2 e3 e4 e5 e6 e7 e8
<a name="1335"/> 1335:                     e9 ea eb ec ed ee ef f0  f1 f2 f3 f4 f5 f6 f7 f8
<a name="1336"/> 1336:                     f9 fa fb fc fd fe ff 13  01 00 00 2e 00 33 00 24
<a name="1337"/> 1337:                     00 1d 00 20 9f d7 ad 6d  cf f4 29 8d d3 f9 6d 5b
<a name="1338"/> 1338:                     1b 2a f9 10 a0 53 5b 14  88 d7 f8 fa bb 34 9a 98
<a name="1339"/> 1339:                     28 80 b6 15 00 2b 00 02  03 04&quot;),
<a name="1340"/> 1340: 
<a name="1341"/> 1341:     EncryptedExtensions =
<a name="1342"/> 1342:         hexstr2bin(&quot;08 00 00 02 00 00&quot;),
<a name="1343"/> 1343: 
<a name="1344"/> 1344:     Certificate =
<a name="1345"/> 1345:         hexstr2bin(&quot;0b 00 03 2e 00 00 03 2a  00 03 25 30 82 03 21 30
<a name="1346"/> 1346:                     82 02 09 a0 03 02 01 02  02 08 15 5a 92 ad c2 04
<a name="1347"/> 1347:                     8f 90 30 0d 06 09 2a 86  48 86 f7 0d 01 01 0b 05
<a name="1348"/> 1348:                     00 30 22 31 0b 30 09 06  03 55 04 06 13 02 55 53
<a name="1349"/> 1349:                     31 13 30 11 06 03 55 04  0a 13 0a 45 78 61 6d 70
<a name="1350"/> 1350:                     6c 65 20 43 41 30 1e 17  0d 31 38 31 30 30 35 30
<a name="1351"/> 1351:                     31 33 38 31 37 5a 17 0d  31 39 31 30 30 35 30 31
<a name="1352"/> 1352:                     33 38 31 37 5a 30 2b 31  0b 30 09 06 03 55 04 06
<a name="1353"/> 1353:                     13 02 55 53 31 1c 30 1a  06 03 55 04 03 13 13 65
<a name="1354"/> 1354:                     78 61 6d 70 6c 65 2e 75  6c 66 68 65 69 6d 2e 6e
<a name="1355"/> 1355:                     65 74 30 82 01 22 30 0d  06 09 2a 86 48 86 f7 0d
<a name="1356"/> 1356:                     01 01 01 05 00 03 82 01  0f 00 30 82 01 0a 02 82
<a name="1357"/> 1357:                     01 01 00 c4 80 36 06 ba  e7 47 6b 08 94 04 ec a7
<a name="1358"/> 1358:                     b6 91 04 3f f7 92 bc 19  ee fb 7d 74 d7 a8 0d 00
<a name="1359"/> 1359:                     1e 7b 4b 3a 4a e6 0f e8  c0 71 fc 73 e7 02 4c 0d
<a name="1360"/> 1360:                     bc f4 bd d1 1d 39 6b ba  70 46 4a 13 e9 4a f8 3d
<a name="1361"/> 1361:                     f3 e1 09 59 54 7b c9 55  fb 41 2d a3 76 52 11 e1
<a name="1362"/> 1362:                     f3 dc 77 6c aa 53 37 6e  ca 3a ec be c3 aa b7 3b
<a name="1363"/> 1363:                     31 d5 6c b6 52 9c 80 98  bc c9 e0 28 18 e2 0b f7
<a name="1364"/> 1364:                     f8 a0 3a fd 17 04 50 9e  ce 79 bd 9f 39 f1 ea 69
<a name="1365"/> 1365:                     ec 47 97 2e 83 0f b5 ca  95 de 95 a1 e6 04 22 d5
<a name="1366"/> 1366:                     ee be 52 79 54 a1 e7 bf  8a 86 f6 46 6d 0d 9f 16
<a name="1367"/> 1367:                     95 1a 4c f7 a0 46 92 59  5c 13 52 f2 54 9e 5a fb
<a name="1368"/> 1368:                     4e bf d7 7a 37 95 01 44  e4 c0 26 87 4c 65 3e 40
<a name="1369"/> 1369:                     7d 7d 23 07 44 01 f4 84  ff d0 8f 7a 1f a0 52 10
<a name="1370"/> 1370:                     d1 f4 f0 d5 ce 79 70 29  32 e2 ca be 70 1f df ad
<a name="1371"/> 1371:                     6b 4b b7 11 01 f4 4b ad  66 6a 11 13 0f e2 ee 82
<a name="1372"/> 1372:                     9e 4d 02 9d c9 1c dd 67  16 db b9 06 18 86 ed c1
<a name="1373"/> 1373:                     ba 94 21 02 03 01 00 01  a3 52 30 50 30 0e 06 03
<a name="1374"/> 1374:                     55 1d 0f 01 01 ff 04 04  03 02 05 a0 30 1d 06 03
<a name="1375"/> 1375:                     55 1d 25 04 16 30 14 06  08 2b 06 01 05 05 07 03
<a name="1376"/> 1376:                     02 06 08 2b 06 01 05 05  07 03 01 30 1f 06 03 55
<a name="1377"/> 1377:                     1d 23 04 18 30 16 80 14  89 4f de 5b cc 69 e2 52
<a name="1378"/> 1378:                     cf 3e a3 00 df b1 97 b8  1d e1 c1 46 30 0d 06 09
<a name="1379"/> 1379:                     2a 86 48 86 f7 0d 01 01  0b 05 00 03 82 01 01 00
<a name="1380"/> 1380:                     59 16 45 a6 9a 2e 37 79  e4 f6 dd 27 1a ba 1c 0b
<a name="1381"/> 1381:                     fd 6c d7 55 99 b5 e7 c3  6e 53 3e ff 36 59 08 43
<a name="1382"/> 1382:                     24 c9 e7 a5 04 07 9d 39  e0 d4 29 87 ff e3 eb dd
<a name="1383"/> 1383:                     09 c1 cf 1d 91 44 55 87  0b 57 1d d1 9b df 1d 24
<a name="1384"/> 1384:                     f8 bb 9a 11 fe 80 fd 59  2b a0 39 8c de 11 e2 65
<a name="1385"/> 1385:                     1e 61 8c e5 98 fa 96 e5  37 2e ef 3d 24 8a fd e1
<a name="1386"/> 1386:                     74 63 eb bf ab b8 e4 d1  ab 50 2a 54 ec 00 64 e9
<a name="1387"/> 1387:                     2f 78 19 66 0d 3f 27 cf  20 9e 66 7f ce 5a e2 e4
<a name="1388"/> 1388:                     ac 99 c7 c9 38 18 f8 b2  51 07 22 df ed 97 f3 2e
<a name="1389"/> 1389:                     3e 93 49 d4 c6 6c 9e a6  39 6d 74 44 62 a0 6b 42
<a name="1390"/> 1390:                     c6 d5 ba 68 8e ac 3a 01  7b dd fc 8e 2c fc ad 27
<a name="1391"/> 1391:                     cb 69 d3 cc dc a2 80 41  44 65 d3 ae 34 8c e0 f3
<a name="1392"/> 1392:                     4a b2 fb 9c 61 83 71 31  2b 19 10 41 64 1c 23 7f
<a name="1393"/> 1393:                     11 a5 d6 5c 84 4f 04 04  84 99 38 71 2b 95 9e d6
<a name="1394"/> 1394:                     85 bc 5c 5d d6 45 ed 19  90 94 73 40 29 26 dc b4
<a name="1395"/> 1395:                     0e 34 69 a1 59 41 e8 e2  cc a8 4b b6 08 46 36 a0
<a name="1396"/> 1396:                     00 00&quot;),
<a name="1397"/> 1397: 
<a name="1398"/> 1398:     CertificateVerify =
<a name="1399"/> 1399:         hexstr2bin(&quot;0f 00 01 04 08 04 01 00  17 fe b5 33 ca 6d 00 7d
<a name="1400"/> 1400:                     00 58 25 79 68 42 4b bc  3a a6 90 9e 9d 49 55 75
<a name="1401"/> 1401:                     76 a5 20 e0 4a 5e f0 5f  0e 86 d2 4f f4 3f 8e b8
<a name="1402"/> 1402:                     61 ee f5 95 22 8d 70 32  aa 36 0f 71 4e 66 74 13
<a name="1403"/> 1403:                     92 6e f4 f8 b5 80 3b 69  e3 55 19 e3 b2 3f 43 73
<a name="1404"/> 1404:                     df ac 67 87 06 6d cb 47  56 b5 45 60 e0 88 6e 9b
<a name="1405"/> 1405:                     96 2c 4a d2 8d ab 26 ba  d1 ab c2 59 16 b0 9a f2
<a name="1406"/> 1406:                     86 53 7f 68 4f 80 8a ef  ee 73 04 6c b7 df 0a 84
<a name="1407"/> 1407:                     fb b5 96 7a ca 13 1f 4b  1c f3 89 79 94 03 a3 0c
<a name="1408"/> 1408:                     02 d2 9c bd ad b7 25 12  db 9c ec 2e 5e 1d 00 e5
<a name="1409"/> 1409:                     0c af cf 6f 21 09 1e bc  4f 25 3c 5e ab 01 a6 79
<a name="1410"/> 1410:                     ba ea be ed b9 c9 61 8f  66 00 6b 82 44 d6 62 2a
<a name="1411"/> 1411:                     aa 56 88 7c cf c6 6a 0f  38 51 df a1 3a 78 cf f7
<a name="1412"/> 1412:                     99 1e 03 cb 2c 3a 0e d8  7d 73 67 36 2e b7 80 5b
<a name="1413"/> 1413:                     00 b2 52 4f f2 98 a4 da  48 7c ac de af 8a 23 36
<a name="1414"/> 1414:                     c5 63 1b 3e fa 93 5b b4  11 e7 53 ca 13 b0 15 fe
<a name="1415"/> 1415:                     c7 e4 a7 30 f1 36 9f 9e&quot;),
<a name="1416"/> 1416: 
<a name="1417"/> 1417:     BaseKey =
<a name="1418"/> 1418:         hexstr2bin(&quot;a2 06 72 65 e7 f0 65 2a  92 3d 5d 72 ab 04 67 c4
<a name="1419"/> 1419:                     61 32 ee b9 68 b6 a3 2d  31 1c 80 58 68 54 88 14&quot;),
<a name="1420"/> 1420: 
<a name="1421"/> 1421:     VerifyData =
<a name="1422"/> 1422:         hexstr2bin(&quot;ea 6e e1 76 dc cc 4a f1  85 9e 9e 4e 93 f7 97 ea
<a name="1423"/> 1423:                     c9 a7 8c e4 39 30 1e 35  27 5a d4 3f 3c dd bd e3&quot;),
<a name="1424"/> 1424: 
<a name="1425"/> 1425:     Messages = [CertificateVerify,
<a name="1426"/> 1426:                 Certificate,
<a name="1427"/> 1427:                 EncryptedExtensions,
<a name="1428"/> 1428:                 ServerHello,
<a name="1429"/> 1429:                 ClientHello],
<a name="1430"/> 1430: 
<a name="1431"/> 1431:     FinishedKey = tls_v1:finished_key(BaseKey, sha256),
<a name="finished_verify_data-last_expr"/><a name="1432"/> 1432: <b>    VerifyData = tls_v1:finished_verify_data</b>(FinishedKey, sha256, Messages).
<a name="1433"/> 1433: 
<a name="1434"/> 1434: <i>%%--------------------------------------------------------------------</i>
<a name="1435"/> 1435: <i>%% Internal functions ------------------------------------------------</i>
<a name="1436"/> 1436: <i>%%--------------------------------------------------------------------</i>
<a name="1437"/> 1437: 
<a name="hexstr2int-1"/><a name="1438"/> 1438: <b>hexstr2int</b>(S) -&gt;
<a name="1439"/> 1439:     B = hexstr2bin(S),
<a name="1440"/> 1440:     Bits = byte_size(B) * 8,
<a name="1441"/> 1441:     &lt;&lt;Integer:Bits/integer&gt;&gt; = B,
<a name="hexstr2int-last_expr"/><a name="1442"/> 1442:     Integer.
<a name="1443"/> 1443: 
<a name="hexstr2bin-1"/><a name="1444"/> 1444: <b>hexstr2bin</b>(S) when is_binary(S) -&gt;
<a name="1445"/> 1445:     hexstr2bin(S, &lt;&lt;&gt;&gt;);
<a name="1446"/> 1446: <b>hexstr2bin</b>(S) -&gt;
<a name="hexstr2bin-last_expr"/><a name="1447"/> 1447: <b>    hexstr2bin</b>(list_to_binary(S), &lt;&lt;&gt;&gt;).
<a name="1448"/> 1448: <i>%%</i>
<a name="hexstr2bin-2"/><a name="1449"/> 1449: <b>hexstr2bin</b>(&lt;&lt;&gt;&gt;, Acc) -&gt;
<a name="1450"/> 1450:     Acc;
<a name="1451"/> 1451: <b>hexstr2bin</b>(&lt;&lt;C,T/binary&gt;&gt;, Acc) when C =:= 32;   %% SPACE
<a name="1452"/> 1452:                                      C =:= 10;   %% LF
<a name="1453"/> 1453:                                      C =:= 13 -&gt; %% CR
<a name="1454"/> 1454:     hexstr2bin(T, Acc);
<a name="1455"/> 1455: <b>hexstr2bin</b>(&lt;&lt;X,Y,T/binary&gt;&gt;, Acc) -&gt;
<a name="1456"/> 1456:     I = hex2int(X) * 16 + hex2int(Y),
<a name="hexstr2bin-last_expr"/><a name="1457"/> 1457: <b>    hexstr2bin</b>(T, &lt;&lt;Acc/binary,I&gt;&gt;).
<a name="1458"/> 1458: 
<a name="hex2int-1"/><a name="1459"/> 1459: <b>hex2int</b>(C) when $0 =&lt; C, C =&lt; $9 -&gt;
<a name="1460"/> 1460:     C - $0;
<a name="1461"/> 1461: <b>hex2int</b>(C) when $A =&lt; C, C =&lt; $F -&gt;
<a name="1462"/> 1462:     C - $A + 10;
<a name="1463"/> 1463: <b>hex2int</b>(C) when $a =&lt; C, C =&lt; $f -&gt;
<a name="hex2int-last_expr"/><a name="1464"/> 1464:     C - $a + 10.
<a name="1465"/> 1465: 
<a name="create_info-3"/><a name="1466"/> 1466: <b>create_info</b>(Label, Context, Length) -&gt;
<a name="create_info-last_expr"/><a name="1467"/> 1467: <b>    tls_v1:create_info</b>(Label, Context, Length, &lt;&lt; &quot;tls13 &quot;&gt;&gt;).
</pre>
<script>
var hash = window.location.hash.substring(1);
var anchor = document.getElementsByName(hash);
anchor[0].style.backgroundColor="orange";
</script>
</body>
</html>
