<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/></meta>
<title>/buildroot/otp/lib/stdlib/make_test_dir/stdlib_test/id_transform_SUITE.erl</title>
</head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
<a name="1"/>    1: <i>%%</i>
<a name="2"/>    2: <i>%% %CopyrightBegin%</i>
<a name="3"/>    3: <i>%% </i>
<a name="4"/>    4: <i>%% Copyright Ericsson AB 2003-2022. All Rights Reserved.</i>
<a name="5"/>    5: <i>%% </i>
<a name="6"/>    6: <i>%% Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</i>
<a name="7"/>    7: <i>%% you may not use this file except in compliance with the License.</i>
<a name="8"/>    8: <i>%% You may obtain a copy of the License at</i>
<a name="9"/>    9: <i>%%</i>
<a name="10"/>   10: <i>%%     http://www.apache.org/licenses/LICENSE-2.0</i>
<a name="11"/>   11: <i>%%</i>
<a name="12"/>   12: <i>%% Unless required by applicable law or agreed to in writing, software</i>
<a name="13"/>   13: <i>%% distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</i>
<a name="14"/>   14: <i>%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</i>
<a name="15"/>   15: <i>%% See the License for the specific language governing permissions and</i>
<a name="16"/>   16: <i>%% limitations under the License.</i>
<a name="17"/>   17: <i>%% </i>
<a name="18"/>   18: <i>%% %CopyrightEnd%</i>
<a name="19"/>   19: <i>%%</i>
<a name="20"/>   20: <b>-module</b>(id_transform_SUITE).
<a name="21"/>   21: <b>-author</b>('pan@erix.ericsson.se').
<a name="22"/>   22: 
<a name="23"/>   23: <b>-include_lib</b>(&quot;kernel/include/file.hrl&quot;).
<a name="24"/>   24:           
<a name="25"/>   25: <b>-export</b>([all/0, suite/0,groups/0,init_per_suite/1, end_per_suite/1, 
<a name="26"/>   26: 	 init_per_group/2,end_per_group/2,
<a name="27"/>   27: 	 id_transform/1]).
<a name="28"/>   28: 
<a name="29"/>   29: <b>-export</b>([check/2,check2/1,g/0,f/1,t/1,t1/1,t2/1,t3/1,t4/1,
<a name="30"/>   30: 	 t5/1,apa/1,new_fun/0]).
<a name="31"/>   31: 
<a name="32"/>   32: <i>%% Serves as test...</i>
<a name="33"/>   33: <b>-hej</b>(hopp).
<a name="34"/>   34: <b>-include_lib</b>(&quot;common_test/include/ct.hrl&quot;).
<a name="35"/>   35: 
<a name="suite-0"/><a name="36"/>   36: <b>suite</b>() -&gt;
<a name="suite-last_expr"/><a name="37"/>   37:     [{ct_hooks,[ts_install_cth]}].
<a name="38"/>   38: 
<a name="all-0"/><a name="39"/>   39: <b>all</b>() -&gt; 
<a name="all-last_expr"/><a name="40"/>   40:     [id_transform].
<a name="41"/>   41: 
<a name="groups-0"/><a name="42"/>   42: <b>groups</b>() -&gt; 
<a name="groups-last_expr"/><a name="43"/>   43:     [].
<a name="44"/>   44: 
<a name="init_per_suite-1"/><a name="45"/>   45: <b>init_per_suite</b>(Config) -&gt;
<a name="init_per_suite-last_expr"/><a name="46"/>   46:     Config.
<a name="47"/>   47: 
<a name="end_per_suite-1"/><a name="48"/>   48: <b>end_per_suite</b>(_Config) -&gt;
<a name="end_per_suite-last_expr"/><a name="49"/>   49:     ok.
<a name="50"/>   50: 
<a name="init_per_group-2"/><a name="51"/>   51: <b>init_per_group</b>(_GroupName, Config) -&gt;
<a name="init_per_group-last_expr"/><a name="52"/>   52:     Config.
<a name="53"/>   53: 
<a name="end_per_group-2"/><a name="54"/>   54: <b>end_per_group</b>(_GroupName, Config) -&gt;
<a name="end_per_group-last_expr"/><a name="55"/>   55:     Config.
<a name="56"/>   56: 
<a name="57"/>   57: 
<a name="58"/>   58: <i>%% Test erl_id_trans.</i>
<a name="id_transform-1"/><a name="59"/>   59: <b>id_transform</b>(Config) when is_list(Config) -&gt;
<a name="60"/>   60:     File = filename:join([code:lib_dir(stdlib),&quot;examples&quot;,
<a name="61"/>   61: 			&quot;erl_id_trans.erl&quot;]),
<a name="62"/>   62:     {ok,erl_id_trans,Bin} = compile:file(File, [binary,report]),
<a name="63"/>   63:     {module,erl_id_trans} = code:load_binary(erl_id_trans, File, Bin),
<a name="id_transform-last_expr"/><a name="64"/>   64: <b>    case test_server:is_valgrind</b>() of
<a name="65"/>   65: 	false -&gt;
<a name="66"/>   66: 	    ct:timetrap({hours,1}),
<a name="67"/>   67: 	    run_in_test_suite();
<a name="68"/>   68: 	true -&gt;
<a name="69"/>   69: 	    {skip,&quot;Valgrind (too slow)&quot;}
<a name="70"/>   70:     end.
<a name="71"/>   71: 
<a name="run_in_test_suite-0"/><a name="72"/>   72: <b>run_in_test_suite</b>() -&gt;
<a name="73"/>   73:     SuperDir = filename:dirname(filename:dirname(code:which(?MODULE))),
<a name="74"/>   74:     TestDirs = filelib:wildcard(filename:join([SuperDir,&quot;*_test&quot;])),
<a name="75"/>   75:     AbsDirs = [filename:absname(X) || X &lt;- code:get_path()],
<a name="76"/>   76:     Dirs = ordsets:from_list(AbsDirs ++ TestDirs),
<a name="run_in_test_suite-last_expr"/><a name="77"/>   77: <b>    run_list</b>(Dirs).
<a name="78"/>   78: 
<a name="run_list-1"/><a name="79"/>   79: <b>run_list</b>(PathL) -&gt;
<a name="80"/>   80:     io:format(&quot;Where to search for beam files:\n~p\n&quot;, [PathL]),
<a name="81"/>   81:     io:format(&quot;Searching for beam files ...~n&quot;,[]),
<a name="82"/>   82:     Beams = collect_beams(PathL, []),
<a name="83"/>   83:     io:format(&quot;~p beam files\n&quot;, [length(Beams)]),
<a name="84"/>   84:     io:format(&quot;Applying erl_id_trans to found beam files...~n&quot;,[]),
<a name="85"/>   85:     Res = [do_trans(X) || X &lt;- Beams],
<a name="86"/>   86:     io:format(&quot;...done~n&quot;,[]),
<a name="87"/>   87:     Successes = [X || {ok,X} &lt;- Res],
<a name="88"/>   88:     SevereFailures = [{F,E} || {failed,{F,{transform,E}}} &lt;- Res],
<a name="89"/>   89:     BeamLib = [{F,E} || {failed,{F,{beam_lib,E}}} &lt;- Res],
<a name="90"/>   90:     io:format(&quot;~p files processed&quot;, [length(Res)]),
<a name="91"/>   91:     io:format(&quot;~p files successfully transformed&quot;, [length(Successes)]),
<a name="92"/>   92:     case length(SevereFailures) of
<a name="93"/>   93: 	0 -&gt; ok;
<a name="94"/>   94: 	SevLen -&gt;
<a name="95"/>   95: 	    io:format(&quot;\n~p severe failures:\n~p&quot;,
<a name="96"/>   96: 		      [SevLen,SevereFailures])
<a name="97"/>   97:     end,
<a name="98"/>   98:     case BeamLib of
<a name="99"/>   99: 	[] -&gt; ok;
<a name="100"/>  100: 	_ -&gt; io:format(&quot;\nbeam_lib failures:\n~p&quot;, [BeamLib])
<a name="101"/>  101:     end,
<a name="run_list-last_expr"/><a name="102"/>  102: <b>    case length</b>(SevereFailures) of
<a name="103"/>  103: 	0 -&gt; ok;
<a name="104"/>  104: 	Len -&gt; {failed,integer_to_list(Len)++&quot; failures&quot;}
<a name="105"/>  105:     end.
<a name="106"/>  106:     
<a name="107"/>  107: 
<a name="collect_beams-2"/><a name="108"/>  108: <b>collect_beams</b>([P0|Ps], Acc) -&gt;
<a name="109"/>  109:     Wc = filename:join(filename:absname(P0), &quot;*.beam&quot;),
<a name="110"/>  110:     collect_beams(Ps, filelib:wildcard(Wc)++Acc);
<a name="collect_beams-last_expr"/><a name="111"/>  111: <b>collect_beams</b>([], Acc) -&gt; Acc.
<a name="112"/>  112:     
<a name="do_trans-1"/><a name="113"/>  113: <b>do_trans</b>(Beam) -&gt;
<a name="do_trans-last_expr"/><a name="114"/>  114: <b>    case beam_lib:chunks</b>(Beam, [abstract_code]) of
<a name="115"/>  115: 	{ok,{_Mod,[{abstract_code,no_abstract_code}]}} -&gt;
<a name="116"/>  116: 	    {failed,{Beam,{beam_lib,no_debug_info}}};
<a name="117"/>  117: 	{ok,{_Mod,[{abstract_code,{raw_abstract_v1,Abst}}]}} -&gt;
<a name="118"/>  118: 	    do_trans_1(Beam, Abst);
<a name="119"/>  119: 	{ok,{_Mod,[{abstract_code,{Tag,_}}]}} -&gt;
<a name="120"/>  120: 	    {failed,{Beam,{beam_lib,{wrong_type_of_debug_info,Tag}}}};
<a name="121"/>  121: 	{ok,{_Mod,[{abstract_code,_}]}} -&gt;
<a name="122"/>  122: 	    {failed,{Beam,{beam_lib,unknown_type_of_debug_info}}};
<a name="123"/>  123: 	{error,beam_lib,{missing_chunk,_,_}} -&gt;
<a name="124"/>  124: 	    {failed,{Beam,{beam_lib,no_debug_info}}};	    
<a name="125"/>  125: 	Error -&gt;
<a name="126"/>  126: 	    {failed,{Beam,{beam_lib,Error}}}
<a name="127"/>  127:     end.
<a name="128"/>  128: 
<a name="do_trans_1-2"/><a name="129"/>  129: <b>do_trans_1</b>(File, Tree0) -&gt;
<a name="do_trans_1-last_expr"/><a name="130"/>  130: <b>    case catch erl_id_trans:parse_transform</b>(Tree0, []) of
<a name="131"/>  131: 	Tree0 when is_list(Tree0) -&gt;
<a name="132"/>  132: 	    {ok,File};
<a name="133"/>  133: 	Tree when is_list(Tree) -&gt;
<a name="134"/>  134: 	    {failed,{File,{transform,output_not_same_as_input}}};
<a name="135"/>  135: 	{'EXIT', Reason} -&gt;
<a name="136"/>  136: 	    {failed,{File,{transform,{crash,Reason}}}};
<a name="137"/>  137: 	Else -&gt;
<a name="138"/>  138: 	    {failed,{File,{transform,{unknown,Else}}}}
<a name="139"/>  139:     end.
<a name="140"/>  140: 
<a name="141"/>  141: <i>%% From here on there's only fake code to serve as test cases</i>
<a name="142"/>  142: <i>%% for the id_transform.</i>
<a name="143"/>  143: <i>%% They need to be exported.</i>
<a name="144"/>  144: 
<a name="check-2"/><a name="145"/>  145: <b>check</b>(X,_Y) when X -&gt;   
<a name="146"/>  146:     true;
<a name="147"/>  147: <b>check</b>(A,_) when atom(A) -&gt;
<a name="148"/>  148:     atom;
<a name="149"/>  149: <b>check</b>(A,_) when erlang:is_list(A) -&gt;
<a name="150"/>  150:     list;
<a name="151"/>  151: <b>check</b>(A,B) when erlang:'+'(A,B) -&gt;
<a name="152"/>  152:     atom;
<a name="153"/>  153: <b>check</b>(_,_) -&gt;
<a name="check-last_expr"/><a name="154"/>  154:     false.
<a name="155"/>  155: 
<a name="check2-1"/><a name="156"/>  156: <b>check2</b>(A) -&gt;
<a name="check2-last_expr"/><a name="157"/>  157:     case A of
<a name="158"/>  158: 	&quot;hej&quot; ++ &quot;hopp&quot; -&gt;
<a name="159"/>  159: 	    a;
<a name="160"/>  160: 	[$l,$e,$k] ++ &quot;hopp&quot; -&gt;
<a name="161"/>  161: 	    a;
<a name="162"/>  162: 	[1] ++ [2] -&gt;
<a name="163"/>  163: 	    b
<a name="164"/>  164:     end.
<a name="165"/>  165: 
<a name="166"/>  166: <b>-record</b>(x,{x,y}).
<a name="167"/>  167: <b>-record</b>(y,{x=1,y=0}).
<a name="168"/>  168: 
<a name="g-0"/><a name="169"/>  169: <b>g</b>() -&gt;
<a name="g-last_expr"/><a name="170"/>  170:     #y.y.
<a name="171"/>  171: 
<a name="f-1"/><a name="172"/>  172: <b>f</b>(#y.y) -&gt;
<a name="173"/>  173:     vansinne;
<a name="174"/>  174: 
<a name="175"/>  175: <b>f</b>(X) when X =:= #y.y -&gt;
<a name="176"/>  176:     {#y.y,_Y} = {X,hej};
<a name="177"/>  177: <b>f</b>(#x{_='_'}) -&gt;
<a name="178"/>  178:     hopp;
<a name="179"/>  179: <b>f</b>(#x{x=true,y=true}) -&gt;
<a name="180"/>  180:     babba;
<a name="181"/>  181: <b>f</b>(A) when A == #x{x=true,y=true} -&gt;
<a name="182"/>  182:     true;
<a name="183"/>  183: <b>f</b>(A) when A#x.x == 4 -&gt;
<a name="184"/>  184:     #x{x = 1, _ = 2};
<a name="185"/>  185: <b>f</b>(X) -&gt;
<a name="f-last_expr"/><a name="186"/>  186:     if X#x.y -&gt;
<a name="187"/>  187: 	    ok;
<a name="188"/>  188:        element(3,X) -&gt;
<a name="189"/>  189: 	    banan;
<a name="190"/>  190:        true -&gt;
<a name="191"/>  191: 	    nok
<a name="192"/>  192:     end.
<a name="193"/>  193: 
<a name="194"/>  194: <i>%% Stolen from erl_lint_SUITE.erl</i>
<a name="195"/>  195: <b>-record</b>(apa, {}).
<a name="196"/>  196: 
<a name="t-1"/><a name="197"/>  197: <b>t</b>(A) when atom(A) -&gt;
<a name="198"/>  198:     atom;
<a name="199"/>  199: <b>t</b>(A) when binary(A) -&gt;
<a name="200"/>  200:     binary;
<a name="201"/>  201: <b>t</b>(A) when float(A) -&gt;
<a name="202"/>  202:     float;
<a name="203"/>  203: <b>t</b>(A) when function(A) -&gt;
<a name="204"/>  204:     function;
<a name="205"/>  205: <b>t</b>(A) when integer(A) -&gt;
<a name="206"/>  206:     integer;
<a name="207"/>  207: <b>t</b>(A) when is_atom(A) -&gt;
<a name="208"/>  208:     is_atom;
<a name="209"/>  209: <b>t</b>(A) when is_binary(A) -&gt;
<a name="210"/>  210:     is_binary;
<a name="211"/>  211: <b>t</b>(A) when is_float(A) -&gt;
<a name="212"/>  212:     is_float;
<a name="213"/>  213: <b>t</b>(A) when is_function(A) -&gt;
<a name="214"/>  214:     is_function;
<a name="215"/>  215: <b>t</b>(A) when is_integer(A) -&gt;
<a name="216"/>  216:     is_integer;
<a name="217"/>  217: <b>t</b>(A) when is_list(A) -&gt;
<a name="218"/>  218:     is_list;
<a name="219"/>  219: <b>t</b>(A) when is_number(A) -&gt;
<a name="220"/>  220:     is_number;
<a name="221"/>  221: <b>t</b>(A) when is_pid(A) -&gt;
<a name="222"/>  222:     is_pid;
<a name="223"/>  223: <b>t</b>(A) when is_port(A) -&gt;
<a name="224"/>  224:     is_port;
<a name="225"/>  225: <b>t</b>(A) when is_record(A, apa) -&gt;
<a name="226"/>  226:     is_record;
<a name="227"/>  227: <b>t</b>(A) when is_reference(A) -&gt;
<a name="228"/>  228:     is_reference;
<a name="229"/>  229: <b>t</b>(A) when is_tuple(A) -&gt;
<a name="230"/>  230:     is_tuple;
<a name="231"/>  231: <b>t</b>(A) when list(A) -&gt;
<a name="232"/>  232:     list;
<a name="233"/>  233: <b>t</b>(A) when number(A) -&gt;
<a name="234"/>  234:     number;
<a name="235"/>  235: <b>t</b>(A) when pid(A) -&gt;
<a name="236"/>  236:     pid;
<a name="237"/>  237: <b>t</b>(A) when port(A) -&gt;
<a name="238"/>  238:     port;
<a name="239"/>  239: <b>t</b>(A) when record(A, apa) -&gt;
<a name="240"/>  240:     record;
<a name="241"/>  241: <b>t</b>(A) when reference(A) -&gt;
<a name="242"/>  242:     reference;
<a name="243"/>  243: <b>t</b>(A) when tuple(A) -&gt;
<a name="t-last_expr"/><a name="244"/>  244:     tuple.
<a name="245"/>  245: 
<a name="t1-1"/><a name="246"/>  246: <b>t1</b>(A) when atom(A), atom(A) -&gt;
<a name="247"/>  247:     atom;
<a name="248"/>  248: <b>t1</b>(A) when binary(A), binary(A) -&gt;
<a name="249"/>  249:     binary;
<a name="250"/>  250: <b>t1</b>(A) when float(A), float(A) -&gt;
<a name="251"/>  251:     float;
<a name="252"/>  252: <b>t1</b>(A) when function(A), function(A) -&gt;
<a name="253"/>  253:     function;
<a name="254"/>  254: <b>t1</b>(A) when integer(A), integer(A) -&gt;
<a name="255"/>  255:     integer;
<a name="256"/>  256: <b>t1</b>(A) when is_atom(A), is_atom(A) -&gt;
<a name="257"/>  257:     is_atom;
<a name="258"/>  258: <b>t1</b>(A) when is_binary(A), is_binary(A) -&gt;
<a name="259"/>  259:     is_binary;
<a name="260"/>  260: <b>t1</b>(A) when is_float(A), is_float(A) -&gt;
<a name="261"/>  261:     is_float;
<a name="262"/>  262: <b>t1</b>(A) when is_function(A), is_function(A) -&gt;
<a name="263"/>  263:     is_function;
<a name="264"/>  264: <b>t1</b>(A) when is_integer(A), is_integer(A) -&gt;
<a name="265"/>  265:     is_integer;
<a name="266"/>  266: <b>t1</b>(A) when is_list(A), is_list(A) -&gt;
<a name="267"/>  267:     is_list;
<a name="268"/>  268: <b>t1</b>(A) when is_number(A), is_number(A) -&gt;
<a name="269"/>  269:     is_number;
<a name="270"/>  270: <b>t1</b>(A) when is_pid(A), is_pid(A) -&gt;
<a name="271"/>  271:     is_pid;
<a name="272"/>  272: <b>t1</b>(A) when is_port(A), is_port(A) -&gt;
<a name="273"/>  273:     is_port;
<a name="274"/>  274: <b>t1</b>(A) when is_record(A, apa), is_record(A, apa) -&gt;
<a name="275"/>  275:     is_record;
<a name="276"/>  276: <b>t1</b>(A) when is_reference(A), is_reference(A) -&gt;
<a name="277"/>  277:     is_reference;
<a name="278"/>  278: <b>t1</b>(A) when is_tuple(A), is_tuple(A) -&gt;
<a name="279"/>  279:     is_tuple;
<a name="280"/>  280: <b>t1</b>(A) when list(A), list(A) -&gt;
<a name="281"/>  281:     list;
<a name="282"/>  282: <b>t1</b>(A) when number(A), number(A) -&gt;
<a name="283"/>  283:     number;
<a name="284"/>  284: <b>t1</b>(A) when pid(A), pid(A) -&gt;
<a name="285"/>  285:     pid;
<a name="286"/>  286: <b>t1</b>(A) when port(A), port(A) -&gt;
<a name="287"/>  287:     port;
<a name="288"/>  288: <b>t1</b>(A) when record(A, apa), record(A, apa) -&gt;
<a name="289"/>  289:     record;
<a name="290"/>  290: <b>t1</b>(A) when reference(A), reference(A) -&gt;
<a name="291"/>  291:     reference;
<a name="292"/>  292: <b>t1</b>(A) when tuple(A), tuple(A) -&gt;
<a name="t1-last_expr"/><a name="293"/>  293:     tuple.
<a name="294"/>  294: 
<a name="t2-1"/><a name="295"/>  295: <b>t2</b>(A) when atom(A); atom(A) -&gt;
<a name="296"/>  296:     atom;
<a name="297"/>  297: <b>t2</b>(A) when binary(A); binary(A) -&gt;
<a name="298"/>  298:     binary;
<a name="299"/>  299: <b>t2</b>(A) when float(A); float(A) -&gt;
<a name="300"/>  300:     float;
<a name="301"/>  301: <b>t2</b>(A) when function(A); function(A) -&gt;
<a name="302"/>  302:     function;
<a name="303"/>  303: <b>t2</b>(A) when integer(A); integer(A) -&gt;
<a name="304"/>  304:     integer;
<a name="305"/>  305: <b>t2</b>(A) when is_atom(A); is_atom(A) -&gt;
<a name="306"/>  306:     is_atom;
<a name="307"/>  307: <b>t2</b>(A) when is_binary(A); is_binary(A) -&gt;
<a name="308"/>  308:     is_binary;
<a name="309"/>  309: <b>t2</b>(A) when is_float(A); is_float(A) -&gt;
<a name="310"/>  310:     is_float;
<a name="311"/>  311: <b>t2</b>(A) when is_function(A); is_function(A) -&gt;
<a name="312"/>  312:     is_function;
<a name="313"/>  313: <b>t2</b>(A) when is_integer(A); is_integer(A) -&gt;
<a name="314"/>  314:     is_integer;
<a name="315"/>  315: <b>t2</b>(A) when is_list(A); is_list(A) -&gt;
<a name="316"/>  316:     is_list;
<a name="317"/>  317: <b>t2</b>(A) when is_number(A); is_number(A) -&gt;
<a name="318"/>  318:     is_number;
<a name="319"/>  319: <b>t2</b>(A) when is_pid(A); is_pid(A) -&gt;
<a name="320"/>  320:     is_pid;
<a name="321"/>  321: <b>t2</b>(A) when is_port(A); is_port(A) -&gt;
<a name="322"/>  322:     is_port;
<a name="323"/>  323: <b>t2</b>(A) when is_record(A, apa); is_record(A, apa) -&gt;
<a name="324"/>  324:     is_record;
<a name="325"/>  325: <b>t2</b>(A) when is_reference(A); is_reference(A) -&gt;
<a name="326"/>  326:     is_reference;
<a name="327"/>  327: <b>t2</b>(A) when is_tuple(A); is_tuple(A) -&gt;
<a name="328"/>  328:     is_tuple;
<a name="329"/>  329: <b>t2</b>(A) when list(A); list(A) -&gt;
<a name="330"/>  330:     list;
<a name="331"/>  331: <b>t2</b>(A) when number(A); number(A) -&gt;
<a name="332"/>  332:     number;
<a name="333"/>  333: <b>t2</b>(A) when pid(A); pid(A) -&gt;
<a name="334"/>  334:     pid;
<a name="335"/>  335: <b>t2</b>(A) when port(A); port(A) -&gt;
<a name="336"/>  336:     port;
<a name="337"/>  337: <b>t2</b>(A) when record(A, apa); record(A, apa) -&gt;
<a name="338"/>  338:     record;
<a name="339"/>  339: <b>t2</b>(A) when reference(A); reference(A) -&gt;
<a name="340"/>  340:     reference;
<a name="341"/>  341: <b>t2</b>(A) when tuple(A); tuple(A) -&gt;
<a name="t2-last_expr"/><a name="342"/>  342:     tuple.
<a name="343"/>  343: 
<a name="t3-1"/><a name="344"/>  344: <b>t3</b>(A) when is_atom(A) or is_atom(A) -&gt;
<a name="345"/>  345:     is_atom;
<a name="346"/>  346: <b>t3</b>(A) when is_binary(A) or is_binary(A) -&gt;
<a name="347"/>  347:     is_binary;
<a name="348"/>  348: <b>t3</b>(A) when is_float(A) or is_float(A) -&gt;
<a name="349"/>  349:     is_float;
<a name="350"/>  350: <b>t3</b>(A) when is_function(A) or is_function(A) -&gt;
<a name="351"/>  351:     is_function;
<a name="352"/>  352: <b>t3</b>(A) when is_integer(A) or is_integer(A) -&gt;
<a name="353"/>  353:     is_integer;
<a name="354"/>  354: <b>t3</b>(A) when is_list(A) or is_list(A) -&gt;
<a name="355"/>  355:     is_list;
<a name="356"/>  356: <b>t3</b>(A) when is_number(A) or is_number(A) -&gt;
<a name="357"/>  357:     is_number;
<a name="358"/>  358: <b>t3</b>(A) when is_pid(A) or is_pid(A) -&gt;
<a name="359"/>  359:     is_pid;
<a name="360"/>  360: <b>t3</b>(A) when is_port(A) or is_port(A) -&gt;
<a name="361"/>  361:     is_port;
<a name="362"/>  362: <b>t3</b>(A) when is_record(A, apa) or is_record(A, apa) -&gt;
<a name="363"/>  363:    is_record;
<a name="364"/>  364: <b>t3</b>(A) when is_reference(A) or is_reference(A) -&gt;
<a name="365"/>  365:    is_reference;
<a name="366"/>  366: <b>t3</b>(A) when is_tuple(A) or is_tuple(A) -&gt;
<a name="367"/>  367:    is_tuple; 
<a name="368"/>  368: <b>t3</b>(A) when record(A, apa) -&gt;
<a name="369"/>  369:    foo;
<a name="370"/>  370: <b>t3</b>(A) when erlang:is_record(A, apa) -&gt;
<a name="371"/>  371:    foo;
<a name="372"/>  372: <b>t3</b>(A) when is_record(A, apa) -&gt;
<a name="373"/>  373:    foo;
<a name="374"/>  374: <b>t3</b>(A) when record({apa}, apa) -&gt;
<a name="t3-last_expr"/><a name="375"/>  375:    {A,foo}.
<a name="376"/>  376: 
<a name="t4-1"/><a name="377"/>  377: <b>t4</b>(A) when erlang:is_record({apa}, apa) -&gt;
<a name="t4-last_expr"/><a name="378"/>  378:    {A,foo}.
<a name="379"/>  379: 
<a name="t5-1"/><a name="380"/>  380: <b>t5</b>(A) when is_record({apa}, apa) -&gt;
<a name="t5-last_expr"/><a name="381"/>  381:    {A,foo}.
<a name="382"/>  382: 
<a name="383"/>  383: <b>-record</b>(apa2,{a=a,b=foo:bar()}).
<a name="apa-1"/><a name="384"/>  384: <b>apa</b>(1) -&gt;
<a name="385"/>  385:     [X || X &lt;- [], #apa2{a = a} == {r,X,foo}];
<a name="386"/>  386: <b>apa</b>(2) -&gt;
<a name="387"/>  387:     [X || X &lt;- [], #apa2{b = b} == {r,X,foo}];
<a name="388"/>  388: <b>apa</b>(3) -&gt;
<a name="apa-last_expr"/><a name="389"/>  389:     [X || X &lt;- [], 3 == X#apa2.a].
<a name="390"/>  390: 
<a name="new_fun-0"/><a name="391"/>  391: <b>new_fun</b>() -&gt;
<a name="new_fun-last_expr"/><a name="392"/>  392: <b>    lists:map</b>(fun erlang:abs/1, [-1,3,4]).
</pre>
</body>
</html>
