<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/></meta>
<title>/buildroot/otp/lib/xmerl/make_test_dir/xmerl_test/xmerl_SUITE.erl</title>
</head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
<a name="1"/>    1: <i>%%</i>
<a name="2"/>    2: <i>%% %CopyrightBegin%</i>
<a name="3"/>    3: <i>%%</i>
<a name="4"/>    4: <i>%% Copyright Ericsson AB 2008-2023. All Rights Reserved.</i>
<a name="5"/>    5: <i>%%</i>
<a name="6"/>    6: <i>%% Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</i>
<a name="7"/>    7: <i>%% you may not use this file except in compliance with the License.</i>
<a name="8"/>    8: <i>%% You may obtain a copy of the License at</i>
<a name="9"/>    9: <i>%%</i>
<a name="10"/>   10: <i>%%     http://www.apache.org/licenses/LICENSE-2.0</i>
<a name="11"/>   11: <i>%%</i>
<a name="12"/>   12: <i>%% Unless required by applicable law or agreed to in writing, software</i>
<a name="13"/>   13: <i>%% distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</i>
<a name="14"/>   14: <i>%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</i>
<a name="15"/>   15: <i>%% See the License for the specific language governing permissions and</i>
<a name="16"/>   16: <i>%% limitations under the License.</i>
<a name="17"/>   17: <i>%%</i>
<a name="18"/>   18: <i>%% %CopyrightEnd%</i>
<a name="19"/>   19: <i>%%</i>
<a name="20"/>   20: <i>%%</i>
<a name="21"/>   21: <i>%%% Purpose : Test suite for the ASN.1 application</i>
<a name="22"/>   22: 
<a name="23"/>   23: <b>-module</b>(xmerl_SUITE).
<a name="24"/>   24: 
<a name="25"/>   25: <b>-compile</b>(export_all).
<a name="26"/>   26: 
<a name="27"/>   27: <i>%%----------------------------------------------------------------------</i>
<a name="28"/>   28: <i>%% Include files</i>
<a name="29"/>   29: <i>%%----------------------------------------------------------------------</i>
<a name="30"/>   30: <b>-include_lib</b>(&quot;common_test/include/ct.hrl&quot;).
<a name="31"/>   31: <i>%%-include(&quot;xmerl.hrl&quot;).</i>
<a name="32"/>   32: <b>-include_lib</b>(&quot;xmerl/include/xmerl.hrl&quot;).
<a name="33"/>   33: <b>-include_lib</b>(&quot;kernel/include/file.hrl&quot;).
<a name="34"/>   34: 
<a name="35"/>   35: 
<a name="36"/>   36: <i>%%======================================================================</i>
<a name="37"/>   37: <i>%% Tests</i>
<a name="38"/>   38: <i>%%======================================================================</i>
<a name="39"/>   39: 
<a name="40"/>   40: <i>%%----------------------------------------------------------------------</i>
<a name="41"/>   41: <i>%% Test groups</i>
<a name="42"/>   42: <i>%%----------------------------------------------------------------------</i>
<a name="all-0"/><a name="43"/>   43: <b>all</b>() -&gt;
<a name="all-last_expr"/><a name="44"/>   44:     [{group, cpd_tests}, xpath_text1, xpath_main,
<a name="45"/>   45:      xpath_abbreviated_syntax, xpath_functions, xpath_namespaces,
<a name="46"/>   46:      {group, misc}, {group, eventp_tests},
<a name="47"/>   47:      {group, ticket_tests}, {group, app_test},
<a name="48"/>   48:      {group, appup_test}, {group, format_test}].
<a name="49"/>   49: 
<a name="groups-0"/><a name="50"/>   50: <b>groups</b>() -&gt;
<a name="groups-last_expr"/><a name="51"/>   51:     [{cpd_tests, [],
<a name="52"/>   52:       [cpd_invalid1, cpd_invalid1_index, cpd_invalid2_index,
<a name="53"/>   53:        cpd_invalid_index3, cpd_invalid_is_layer,
<a name="54"/>   54:        cpd_expl_provided_DTD]},
<a name="55"/>   55:      {misc, [],
<a name="56"/>   56:       [latin1_alias, syntax_bug1, syntax_bug2, syntax_bug3,
<a name="57"/>   57:        pe_ref1, copyright, testXSEIF, export_simple1, export,
<a name="58"/>   58:        default_attrs_bug, xml_ns, scan_splits_string_bug,
<a name="59"/>   59:        allow_entities_test]},
<a name="60"/>   60:      {eventp_tests, [], [sax_parse_and_export]},
<a name="61"/>   61:      {ticket_tests, [],
<a name="62"/>   62:       [ticket_5998, ticket_7211, ticket_7214, ticket_7430,
<a name="63"/>   63:        ticket_6873, ticket_7496, ticket_8156, ticket_8697,
<a name="64"/>   64:        ticket_9411, ticket_9457, ticket_9664_schema, ticket_9664_dtd]},
<a name="65"/>   65:      {app_test, [], [{xmerl_app_test, all}]},
<a name="66"/>   66:      {appup_test, [], [{xmerl_appup_test, all}]},
<a name="67"/>   67:      {format_test, [], [formatter_pass,formatter_fail]}].
<a name="68"/>   68: 
<a name="suite-0"/><a name="69"/>   69: <b>suite</b>() -&gt;
<a name="suite-last_expr"/><a name="70"/>   70:     [{timetrap,{minutes,10}}].
<a name="71"/>   71: 
<a name="72"/>   72: <i>%%----------------------------------------------------------------------</i>
<a name="73"/>   73: <i>%% Initializations</i>
<a name="74"/>   74: <i>%%----------------------------------------------------------------------</i>
<a name="75"/>   75: 
<a name="init_per_suite-1"/><a name="76"/>   76: <b>init_per_suite</b>(Config) -&gt;
<a name="77"/>   77:     file:set_cwd(datadir(Config)),
<a name="78"/>   78:     ok=erl_tar:extract(&quot;cpd.tar.gz&quot;,[compressed]),
<a name="79"/>   79:     ok=erl_tar:extract(&quot;misc.tar.gz&quot;,[compressed]),
<a name="80"/>   80:     ok = change_mode([&quot;cpd&quot;, &quot;misc&quot;]),
<a name="81"/>   81:     file:set_cwd(filename:join(datadir(Config),xpath)),
<a name="82"/>   82:     {ok, xpath_lib} = compile:file(xpath_lib, []),
<a name="83"/>   83:     {ok, xpath_text} = compile:file(xpath_text, []),
<a name="84"/>   84:     {ok, xpath_abbrev} = compile:file(xpath_abbrev, []),
<a name="init_per_suite-last_expr"/><a name="85"/>   85:     Config.
<a name="86"/>   86: 
<a name="87"/>   87: 
<a name="88"/>   88: <b>-ifndef</b>(dont_rm_test_dirs).
<a name="end_per_suite-1"/><a name="89"/>   89: <b>end_per_suite</b>(Config) -&gt;
<a name="90"/>   90:     file:set_cwd(datadir(Config)),
<a name="91"/>   91:     ok = rm_files([&quot;cpd&quot;, &quot;misc&quot;]),
<a name="end_per_suite-last_expr"/><a name="92"/>   92:     ok.
<a name="93"/>   93: 
<a name="94"/>   94: -else.
<a name="95"/>   95: end_per_suite(_Config) -&gt;
<a name="96"/>   96:     ok.
<a name="97"/>   97: -endif.
<a name="98"/>   98: 
<a name="99"/>   99: 
<a name="100"/>  100: <i>%% initialization before each testcase</i>
<a name="init_per_testcase-2"/><a name="101"/>  101: <b>init_per_testcase</b>(_TestCase,Config) -&gt;
<a name="102"/>  102:     io:format(&quot;Config:~n~p&quot;,[Config]),
<a name="103"/>  103:     {ok, _} = file:read_file_info(filename:join([privdir(Config)])),
<a name="104"/>  104:     code:add_patha(privdir(Config)),
<a name="init_per_testcase-last_expr"/><a name="105"/>  105:     Config.
<a name="106"/>  106: 
<a name="107"/>  107: 
<a name="108"/>  108: <i>%% clean up after each testcase</i>
<a name="end_per_testcase-2"/><a name="109"/>  109: <b>end_per_testcase</b>(_Func,_Config) -&gt;
<a name="end_per_testcase-last_expr"/><a name="110"/>  110:     ok.
<a name="111"/>  111: 
<a name="112"/>  112: 
<a name="113"/>  113: <i>%%----------------------------------------------------------------------</i>
<a name="114"/>  114: <i>%% Test cases</i>
<a name="115"/>  115: <i>%%----------------------------------------------------------------------</i>
<a name="cpd_invalid1-1"/><a name="116"/>  116: <b>cpd_invalid1</b>(Config) -&gt;
<a name="117"/>  117:     file:set_cwd(datadir(Config)),
<a name="cpd_invalid1-last_expr"/><a name="118"/>  118: <b>    case catch xmerl_scan:file</b>(datadir_join(Config,[cpd,&quot;cpd_test.xml&quot;]),[]) of
<a name="119"/>  119:         {'EXIT',{fatal,Reason}} -&gt;
<a name="120"/>  120:             case Reason of
<a name="121"/>  121:                 {expected_markup,_Path,28,32} -&gt; ok;
<a name="122"/>  122:                 _ -&gt; {comment,&quot;parsing changed behaviour&quot;}
<a name="123"/>  123:             end
<a name="124"/>  124:     end.
<a name="125"/>  125: 
<a name="cpd_invalid1_index-1"/><a name="126"/>  126: <b>cpd_invalid1_index</b>(Config) -&gt;
<a name="127"/>  127:     file:set_cwd(datadir(Config)),
<a name="cpd_invalid1_index-last_expr"/><a name="128"/>  128: <b>    case catch xmerl_scan:file</b>(datadir_join(Config,[cpd,&quot;cpd_index.xml&quot;]),[]) of
<a name="129"/>  129:         {'EXIT',{fatal,Reason}} -&gt;
<a name="130"/>  130:             case Reason of
<a name="131"/>  131:                 {{error,{whitespace_was_expected}},_Path,1,19} -&gt; ok;
<a name="132"/>  132:                 _ -&gt; {comment,&quot;parsing changed behaviour&quot;}
<a name="133"/>  133:             end
<a name="134"/>  134:     end.
<a name="135"/>  135: 
<a name="cpd_invalid2_index-1"/><a name="136"/>  136: <b>cpd_invalid2_index</b>(Config) -&gt;
<a name="137"/>  137:     file:set_cwd(datadir(Config)),
<a name="cpd_invalid2_index-last_expr"/><a name="138"/>  138: <b>    case catch xmerl_scan:file</b>(datadir_join(Config,[cpd,&quot;cpd_index2.xml&quot;]),[]) of
<a name="139"/>  139:         {'EXIT',{fatal,Reason}} -&gt;
<a name="140"/>  140:             case Reason of
<a name="141"/>  141:                 {{invalid_target_name,_Ver},_Path,2,3} -&gt;ok;
<a name="142"/>  142:                 _ -&gt; {comment,&quot;parsing changed behaviour&quot;}
<a name="143"/>  143:             end
<a name="144"/>  144:     end.
<a name="145"/>  145: 
<a name="cpd_invalid_index3-1"/><a name="146"/>  146: <b>cpd_invalid_index3</b>(Config) -&gt;
<a name="147"/>  147:     file:set_cwd(datadir(Config)),
<a name="cpd_invalid_index3-last_expr"/><a name="148"/>  148: <b>    case catch xmerl_scan:file</b>(datadir_join(Config,[cpd,&quot;cpd_index3.xml&quot;]),[]) of
<a name="149"/>  149:         {'EXIT',{fatal,Reason}} -&gt;
<a name="150"/>  150:             case Reason of
<a name="151"/>  151:                 {expected_markup,_Path,1,2} -&gt; ok;
<a name="152"/>  152:                 _ -&gt; {comment,&quot;parsing changed behaviour&quot;}
<a name="153"/>  153:             end
<a name="154"/>  154:     end.
<a name="155"/>  155: 
<a name="cpd_invalid_is_layer-1"/><a name="156"/>  156: <b>cpd_invalid_is_layer</b>(Config) -&gt;
<a name="157"/>  157:     file:set_cwd(datadir(Config)),
<a name="cpd_invalid_is_layer-last_expr"/><a name="158"/>  158: <b>    case catch xmerl_scan:file</b>(datadir_join(Config,[cpd,&quot;is_layer2.xml&quot;]),[]) of
<a name="159"/>  159:         {'EXIT',{fatal,_Reason}} -&gt; ok
<a name="160"/>  160:     end.
<a name="161"/>  161: 
<a name="cpd_expl_provided_DTD-1"/><a name="162"/>  162: <b>cpd_expl_provided_DTD</b>(Config) -&gt;
<a name="163"/>  163:     file:set_cwd(datadir(Config)),
<a name="cpd_expl_provided_DTD-last_expr"/><a name="164"/>  164: <b>    {#xmlElement{},[]} = xmerl_scan:file</b>(datadir_join(Config,[cpd,&quot;file_wo_DTD.xml&quot;]),
<a name="165"/>  165:                                          [{validation,true},{doctype_DTD,&quot;separate_DTD.dtd&quot;}]).
<a name="166"/>  166: 
<a name="167"/>  167: <i>%%----------------------------------------------------------------------</i>
<a name="168"/>  168: 
<a name="xpath_text1-1"/><a name="169"/>  169: <b>xpath_text1</b>(Config) -&gt;
<a name="170"/>  170:     file:set_cwd(filename:join(datadir(Config),xpath)),
<a name="xpath_text1-last_expr"/><a name="171"/>  171: <b>    ok = xpath_text:one</b>().
<a name="172"/>  172: 
<a name="xpath_main-1"/><a name="173"/>  173: <b>xpath_main</b>(Config) -&gt;
<a name="174"/>  174:     file:set_cwd(filename:join(datadir(Config),xpath)),
<a name="xpath_main-last_expr"/><a name="175"/>  175: <b>    ok = xpath_lib:test</b>().
<a name="176"/>  176: 
<a name="xpath_abbreviated_syntax-1"/><a name="177"/>  177: <b>xpath_abbreviated_syntax</b>(Config) -&gt;
<a name="178"/>  178:     file:set_cwd(filename:join(datadir(Config),xpath)),
<a name="xpath_abbreviated_syntax-last_expr"/><a name="179"/>  179: <b>    ok = xpath_abbrev:test</b>().
<a name="180"/>  180: 
<a name="xpath_functions-1"/><a name="181"/>  181: <b>xpath_functions</b>(Config) -&gt;
<a name="182"/>  182:     file:set_cwd(filename:join(datadir(Config),xpath)),
<a name="xpath_functions-last_expr"/><a name="183"/>  183: <b>    ok = xpath_abbrev:functions</b>().
<a name="184"/>  184: 
<a name="xpath_namespaces-1"/><a name="185"/>  185: <b>xpath_namespaces</b>(Config) -&gt;
<a name="186"/>  186:     file:set_cwd(filename:join(datadir(Config),xpath)),
<a name="xpath_namespaces-last_expr"/><a name="187"/>  187: <b>    ok = xpath_abbrev:namespaces</b>().
<a name="188"/>  188: 
<a name="189"/>  189: <i>%%----------------------------------------------------------------------</i>
<a name="190"/>  190: 
<a name="latin1_alias-1"/><a name="191"/>  191: <b>latin1_alias</b>(Config) -&gt;
<a name="192"/>  192: <i>%    file:set_cwd(filename:join(datadir(Config),misc)),</i>
<a name="193"/>  193:     file:set_cwd(datadir(Config)),
<a name="latin1_alias-last_expr"/><a name="194"/>  194: <b>    {_Elements,[]} = xmerl_scan:file</b>(datadir_join(Config,[misc,&quot;motorcycles.xml&quot;]),
<a name="195"/>  195:                                      [{validation,true},
<a name="196"/>  196:                                       {encoding,'iso-8859-1'}]).
<a name="197"/>  197: 
<a name="syntax_bug1-1"/><a name="198"/>  198: <b>syntax_bug1</b>(Config) -&gt;
<a name="199"/>  199:     file:set_cwd(datadir(Config)),
<a name="syntax_bug1-last_expr"/><a name="200"/>  200:     {fatal,{&quot;expected one of: ?&gt;, standalone, encoding&quot;,
<a name="201"/>  201:             {file,'misc/syntax_bug1.xml'},{line,1},{col,21}}
<a name="202"/>  202:     } = case catch xmerl_scan:file('misc/syntax_bug1.xml') of
<a name="203"/>  203:             {'EXIT',Reason} -&gt;
<a name="204"/>  204:                 Reason;
<a name="205"/>  205:             Err -&gt; Err
<a name="206"/>  206:         end.
<a name="207"/>  207: 
<a name="syntax_bug2-1"/><a name="208"/>  208: <b>syntax_bug2</b>(Config) -&gt;
<a name="209"/>  209:     file:set_cwd(datadir(Config)),
<a name="syntax_bug2-last_expr"/><a name="210"/>  210:     {fatal,{&quot;expected one of: ?&gt;, whitespace_character&quot;,
<a name="211"/>  211:             {file,'misc/syntax_bug2.xml'},{line,1},{col,20}}
<a name="212"/>  212:     } = case catch xmerl_scan:file('misc/syntax_bug2.xml') of
<a name="213"/>  213:             {'EXIT',Reason} -&gt;
<a name="214"/>  214:                 Reason;
<a name="215"/>  215:             Err -&gt; Err
<a name="216"/>  216:         end.
<a name="217"/>  217: 
<a name="syntax_bug3-1"/><a name="218"/>  218: <b>syntax_bug3</b>(Config) -&gt;
<a name="219"/>  219:     file:set_cwd(datadir(Config)),
<a name="syntax_bug3-last_expr"/><a name="220"/>  220:     {fatal,{{endtag_does_not_match,{was,obj,should_have_been,int}},
<a name="221"/>  221:             {file,'misc/syntax_bug3.xml'},{line,4},{col,3}}
<a name="222"/>  222:     } = case catch xmerl_scan:file('misc/syntax_bug3.xml') of
<a name="223"/>  223:             {'EXIT',Reason} -&gt;
<a name="224"/>  224:                 Reason;
<a name="225"/>  225:             Err -&gt; Err
<a name="226"/>  226:         end.
<a name="227"/>  227: 
<a name="default_attrs_bug-1"/><a name="228"/>  228: <b>default_attrs_bug</b>(Config) -&gt;
<a name="229"/>  229:     file:set_cwd(datadir(Config)),
<a name="230"/>  230:     Doc = &quot;&lt;!DOCTYPE doc [&lt;!ATTLIST doc b CDATA \&quot;default\&quot;&gt;]&gt;\n&quot;
<a name="231"/>  231:           &quot;&lt;doc a=\&quot;explicit\&quot;/&gt;&quot;,
<a name="232"/>  232:     {#xmlElement{attributes = [#xmlAttribute{name = a, value = &quot;explicit&quot;},
<a name="233"/>  233:                                #xmlAttribute{name = b, value = &quot;default&quot;}]},
<a name="234"/>  234:      []
<a name="235"/>  235:     } = xmerl_scan:string(Doc, [{default_attrs, true}]),
<a name="236"/>  236:     Doc2 = &quot;&lt;!DOCTYPE doc [&lt;!ATTLIST doc b CDATA \&quot;default\&quot;&gt;]&gt;\n&quot;
<a name="237"/>  237:            &quot;&lt;doc b=\&quot;also explicit\&quot; a=\&quot;explicit\&quot;/&gt;&quot;,
<a name="238"/>  238:     {#xmlElement{attributes = [#xmlAttribute{name = b, value = &quot;also explicit&quot;},
<a name="239"/>  239:                                #xmlAttribute{name = a, value = &quot;explicit&quot;}]},
<a name="240"/>  240:      []
<a name="241"/>  241:     } = xmerl_scan:string(Doc2, [{default_attrs, true}]),
<a name="default_attrs_bug-last_expr"/><a name="242"/>  242:     ok.
<a name="243"/>  243: 
<a name="244"/>  244: 
<a name="xml_ns-1"/><a name="245"/>  245: <b>xml_ns</b>(_Config) -&gt;
<a name="246"/>  246:     Doc = &quot;&lt;?xml version='1.0'?&gt;\n&quot;
<a name="247"/>  247:         &quot;&lt;doc xml:attr1=\&quot;implicit xml ns\&quot;/&gt;&quot;,
<a name="248"/>  248:     {#xmlElement{namespace=#xmlNamespace{default = [], nodes = []},
<a name="249"/>  249:                  attributes = [#xmlAttribute{name = 'xml:attr1',
<a name="250"/>  250:                                              expanded_name = {'http://www.w3.org/XML/1998/namespace',attr1},
<a name="251"/>  251:                                              nsinfo = {&quot;xml&quot;,&quot;attr1&quot;},
<a name="252"/>  252:                                              namespace = #xmlNamespace{default = [], nodes = []}}]},
<a name="253"/>  253:      []
<a name="254"/>  254:     } = xmerl_scan:string(Doc, [{namespace_conformant, true}]),
<a name="255"/>  255:     Doc2 = &quot;&lt;?xml version='1.0'?&gt;\n&quot;
<a name="256"/>  256:         &quot;&lt;doc xmlns:xml=\&quot;http://www.w3.org/XML/1998/namespace\&quot; xml:attr1=\&quot;explicit xml ns\&quot;/&gt;&quot;,
<a name="257"/>  257:     {#xmlElement{namespace=#xmlNamespace{default = [], nodes = [{&quot;xml&quot;,'http://www.w3.org/XML/1998/namespace'}]},
<a name="258"/>  258:                  attributes = [#xmlAttribute{name = 'xmlns:xml',
<a name="259"/>  259:                                              expanded_name = {&quot;xmlns&quot;,&quot;xml&quot;},
<a name="260"/>  260:                                              nsinfo = {&quot;xmlns&quot;,&quot;xml&quot;},
<a name="261"/>  261:                                              namespace = #xmlNamespace{default = [],
<a name="262"/>  262:                                                                        nodes = [{&quot;xml&quot;,'http://www.w3.org/XML/1998/namespace'}]}},
<a name="263"/>  263:                                #xmlAttribute{name = 'xml:attr1',
<a name="264"/>  264:                                              expanded_name = {'http://www.w3.org/XML/1998/namespace',attr1},
<a name="265"/>  265:                                              nsinfo = {&quot;xml&quot;,&quot;attr1&quot;},
<a name="266"/>  266:                                              namespace = #xmlNamespace{default = [],
<a name="267"/>  267:                                                                        nodes = [{&quot;xml&quot;,'http://www.w3.org/XML/1998/namespace'}]}}]},
<a name="268"/>  268:      []
<a name="269"/>  269:     } = xmerl_scan:string(Doc2, [{namespace_conformant, true}]),
<a name="xml_ns-last_expr"/><a name="270"/>  270:     ok.
<a name="271"/>  271: 
<a name="scan_splits_string_bug-1"/><a name="272"/>  272: <b>scan_splits_string_bug</b>(_Config) -&gt;
<a name="scan_splits_string_bug-last_expr"/><a name="273"/>  273:     {#xmlElement{ content = [#xmlText{ value = &quot;Jimmy Zöger&quot; }] }, []}
<a name="274"/>  274:         = xmerl_scan:string(&quot;&lt;name&gt;Jimmy Z&amp;#246;ger&lt;/name&gt;&quot;).
<a name="275"/>  275: 
<a name="pe_ref1-1"/><a name="276"/>  276: <b>pe_ref1</b>(Config) -&gt;
<a name="277"/>  277:     file:set_cwd(datadir(Config)),
<a name="pe_ref1-last_expr"/><a name="278"/>  278: <b>    {#xmlElement{},[]} = xmerl_scan:file</b>(datadir_join(Config,[misc,&quot;PE_ref1.xml&quot;]),[{validation,true}]).
<a name="279"/>  279: 
<a name="copyright-1"/><a name="280"/>  280: <b>copyright</b>(Config) -&gt;
<a name="281"/>  281:     file:set_cwd(datadir(Config)),
<a name="copyright-last_expr"/><a name="282"/>  282: <b>    {#xmlElement{},[]} = xmerl_scan:file</b>(datadir_join(Config,[misc,&quot;cprght.xml&quot;]),[{validation,true}]).
<a name="283"/>  283: 
<a name="testXSEIF-1"/><a name="284"/>  284: <b>testXSEIF</b>(Config) -&gt;
<a name="285"/>  285:     file:set_cwd(datadir(Config)),
<a name="testXSEIF-last_expr"/><a name="286"/>  286: <b>    {#xmlElement{},[]} = xmerl_scan:file</b>(datadir_join(Config,[misc,&quot;ReplBoard_1_1543-CNA11313Uen.xml&quot;]),[{validation,true}]).
<a name="287"/>  287: 
<a name="export_simple1-1"/><a name="288"/>  288: <b>export_simple1</b>(_Config) -&gt;
<a name="289"/>  289:     Simple = simple(),
<a name="290"/>  290:     Res = xmerl:export_simple(Simple,xmerl_xml,[{title, &quot;Doc Title&quot;}]),
<a name="291"/>  291:     &quot;&lt;?xml version=&quot;++_ = lists:flatten(Res),
<a name="292"/>  292: 
<a name="293"/>  293:     %% Use of fun in simple content OTP-6679
<a name="294"/>  294:     Simple2 = simple2(),
<a name="295"/>  295:     Res2 = xmerl:export_simple(Simple2,xmerl_xml,[{title,&quot;Doc Title&quot;}]),
<a name="296"/>  296:     true = (Res2 =:= Res),
<a name="export_simple1-last_expr"/><a name="297"/>  297:     ok.
<a name="298"/>  298: 
<a name="export-1"/><a name="299"/>  299: <b>export</b>(Config) -&gt;
<a name="300"/>  300:     DataDir = datadir(Config),
<a name="301"/>  301:     Prolog = [&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot; ?&gt;\n&lt;!DOCTYPE motorcycles SYSTEM \&quot;motorcycles.dtd\&quot;&gt;\n&quot;],
<a name="302"/>  302:     TestFile = filename:join([DataDir,&quot;misc&quot;,&quot;motorcycles.xml&quot;]),
<a name="303"/>  303:     {E,_} = xmerl_scan:file(TestFile),
<a name="304"/>  304:     Exported = xmerl:export([E],xmerl_xml,[{prolog,Prolog}]),
<a name="305"/>  305:     B = list_to_binary(Exported++&quot;\n&quot;),
<a name="306"/>  306:     {ok, B} = file:read_file(TestFile),
<a name="export-last_expr"/><a name="307"/>  307:     ok.
<a name="308"/>  308: 
<a name="309"/>  309: <i>%%----------------------------------------------------------------------</i>
<a name="310"/>  310: 
<a name="sax_parse_and_export-1"/><a name="311"/>  311: <b>sax_parse_and_export</b>(Config) -&gt;
<a name="312"/>  312:     ok = sax_parse_export_xml_big(Config),
<a name="sax_parse_and_export-last_expr"/><a name="313"/>  313: <b>    ok = sax_parse_export_xml_small</b>(Config).
<a name="314"/>  314: 
<a name="315"/>  315: <i>%%----------------------------------------------------------------------</i>
<a name="316"/>  316: 
<a name="sax_parse_export_xml_big-1"/><a name="317"/>  317: <b>sax_parse_export_xml_big</b>(Config) -&gt;
<a name="318"/>  318:     DataDir = datadir(Config),
<a name="319"/>  319:     OutDir = privdir(Config),
<a name="320"/>  320:     io:format(&quot;DataDir: ~p~n,OutDir:~p~n&quot;,[DataDir,OutDir]),
<a name="321"/>  321:     CMOMxml = filename:join([DataDir,&quot;eventp&quot;,&quot;CMOM.xml&quot;]),
<a name="322"/>  322:     {Ex,[]} = xmerl_eventp:file_sax(CMOMxml, xmerl_xml,[],[]),
<a name="323"/>  323:     OutFile = filename:join([OutDir,&quot;cmom&quot;]),
<a name="324"/>  324:     file:delete(OutFile),
<a name="325"/>  325:     StubFile = filename:join([DataDir,&quot;eventp&quot;,&quot;CelloMOM.stub&quot;]),
<a name="326"/>  326:     {ok,Bin} = file:read_file(StubFile),
<a name="327"/>  327:     {ok,IO} = file:open(OutFile,[write,append]),
<a name="328"/>  328:     ok = file:write(IO,Bin),
<a name="329"/>  329:     ok = io:format(IO,&quot;~s~n~n&quot;,[lists:flatten(Ex)]),
<a name="330"/>  330:     ok = file:close(IO),
<a name="331"/>  331:     {ok,CmpBin1} = file:read_file(OutFile),
<a name="332"/>  332:     {ok,CmpBin1} = file:read_file(CMOMxml),
<a name="sax_parse_export_xml_big-last_expr"/><a name="333"/>  333:     ok.
<a name="334"/>  334: 
<a name="sax_parse_export_xml_small-1"/><a name="335"/>  335: <b>sax_parse_export_xml_small</b>(Config) -&gt;
<a name="336"/>  336:     DataDir = datadir(Config),
<a name="337"/>  337:     OutDir = privdir(Config),
<a name="338"/>  338:     Wurfl_xml = filename:join([DataDir,&quot;eventp&quot;,&quot;wurfl.xml&quot;]),
<a name="339"/>  339:     {Ex,[]} = xmerl_eventp:file_sax(Wurfl_xml, xmerl_xml,[],[]),
<a name="340"/>  340:     OutFile = filename:join([OutDir,&quot;wrfl&quot;]),
<a name="341"/>  341:     file:delete(OutFile),
<a name="342"/>  342:     StubFile = filename:join([DataDir,&quot;eventp&quot;,&quot;wurfl.stub&quot;]),
<a name="343"/>  343:     {ok,Bin} = file:read_file(StubFile),
<a name="344"/>  344:     {ok,IO} = file:open(OutFile,[write,append]),
<a name="345"/>  345:     ok = file:write(IO,Bin),
<a name="346"/>  346:     ok = io:format(IO,&quot;~s~n&quot;,[lists:flatten(Ex)]),
<a name="347"/>  347:     ok = file:close(IO),
<a name="348"/>  348:     {ok,CmpBin1} = file:read_file(OutFile),
<a name="349"/>  349:     {ok,CmpBin1} = file:read_file(Wurfl_xml),
<a name="sax_parse_export_xml_small-last_expr"/><a name="350"/>  350:     ok.
<a name="351"/>  351: 
<a name="simple-0"/><a name="352"/>  352: <b>simple</b>() -&gt;
<a name="simple-last_expr"/><a name="353"/>  353:     [{document,
<a name="354"/>  354:       [{title, &quot;Doc Title&quot;}, {author, &quot;Ulf Wiger&quot;}],
<a name="355"/>  355:       [{section,
<a name="356"/>  356: 	[{heading, &quot;heading1&quot;}],
<a name="357"/>  357: 	[{'P', [&quot;This is a paragraph of text.&quot;]},
<a name="358"/>  358: 	 {section,
<a name="359"/>  359: 	  [{heading, &quot;heading2&quot;}],
<a name="360"/>  360: 	  [{'P', [&quot;This is another paragraph.&quot;]},
<a name="361"/>  361: 	   {table,
<a name="362"/>  362: 	    [{border, 1}],
<a name="363"/>  363: 	    [{heading,
<a name="364"/>  364: 	      [{col, [&quot;head1&quot;]},
<a name="365"/>  365: 	       {col, [&quot;head2&quot;]}]},
<a name="366"/>  366: 	     {row,
<a name="367"/>  367: 	      [{col, [&quot;col11&quot;]},
<a name="368"/>  368: 	       {col, [&quot;col12&quot;]}]},
<a name="369"/>  369: 	     {row,
<a name="370"/>  370: 	      [{col, [&quot;col21&quot;]},
<a name="371"/>  371: 	       {col, [&quot;col22&quot;]}]}]}]}]}]}].
<a name="372"/>  372: 
<a name="373"/>  373: 
<a name="simple2-0"/><a name="374"/>  374: <b>simple2</b>() -&gt;
<a name="375"/>  375:     GenC = fun ?MODULE:generate_section/1,
<a name="376"/>  376:     GenA = fun ?MODULE:generate_attr_title/1,
<a name="simple2-last_expr"/><a name="377"/>  377:     [{document,[{GenA,2}],[{GenC,1}]}].
<a name="378"/>  378: 
<a name="generate_attr_title-1"/><a name="379"/>  379: <b>generate_attr_title</b>(0) -&gt;
<a name="380"/>  380:     done;
<a name="381"/>  381: <b>generate_attr_title</b>(1) -&gt;
<a name="382"/>  382:     {{title,&quot;Doc Title&quot;},0};
<a name="383"/>  383: <b>generate_attr_title</b>(2) -&gt;
<a name="generate_attr_title-last_expr"/><a name="384"/>  384:     {{author, &quot;Ulf Wiger&quot;},1}.
<a name="generate_section-1"/><a name="385"/>  385: <b>generate_section</b>(0) -&gt;
<a name="386"/>  386:     done;
<a name="387"/>  387: <b>generate_section</b>(N) -&gt;
<a name="388"/>  388:     GenC = fun ?MODULE:generate_section_content/1,
<a name="389"/>  389:     GenA = fun ?MODULE:generate_section_attribute/1,
<a name="generate_section-last_expr"/><a name="390"/>  390:     {{section,[{GenA,1}],[{GenC,2}]},N-1}.
<a name="391"/>  391: 
<a name="generate_section_attribute-1"/><a name="392"/>  392: <b>generate_section_attribute</b>(0) -&gt;
<a name="393"/>  393:     done;
<a name="394"/>  394: <b>generate_section_attribute</b>(N) -&gt;
<a name="generate_section_attribute-last_expr"/><a name="395"/>  395:     {{heading, &quot;heading1&quot;},N-1}.
<a name="396"/>  396: 
<a name="397"/>  397: 
<a name="generate_subsection_content-1"/><a name="398"/>  398: <b>generate_subsection_content</b>(0) -&gt;
<a name="399"/>  399:     done;
<a name="400"/>  400: <b>generate_subsection_content</b>(1) -&gt;
<a name="401"/>  401:     {{'P',[&quot;This is another paragraph.&quot;]},0};
<a name="402"/>  402: <b>generate_subsection_content</b>(N) -&gt;
<a name="generate_subsection_content-last_expr"/><a name="403"/>  403:     {{table,[{fun ?MODULE:generate_border_attribute/1,1}],
<a name="404"/>  404:       [{fun ?MODULE:generate_table_content/1,2}]},N-1}.
<a name="generate_section_content-1"/><a name="405"/>  405: <b>generate_section_content</b>(0) -&gt;
<a name="406"/>  406:     done;
<a name="407"/>  407: <b>generate_section_content</b>(1) -&gt;
<a name="408"/>  408:     {{'P',[&quot;This is a paragraph of text.&quot;]},0};
<a name="409"/>  409: <b>generate_section_content</b>(N) -&gt;
<a name="generate_section_content-last_expr"/><a name="410"/>  410:     {{section,[{heading,&quot;heading2&quot;}],
<a name="411"/>  411:       [{fun ?MODULE:generate_subsection_content/1,2}]},N-1}.
<a name="generate_border_attribute-1"/><a name="412"/>  412: <b>generate_border_attribute</b>(0) -&gt;
<a name="413"/>  413:     done;
<a name="414"/>  414: <b>generate_border_attribute</b>(N) -&gt;
<a name="generate_border_attribute-last_expr"/><a name="415"/>  415:     {{border,N},N-1}.
<a name="generate_table_content-1"/><a name="416"/>  416: <b>generate_table_content</b>(0) -&gt;
<a name="417"/>  417:     done;
<a name="418"/>  418: <b>generate_table_content</b>(1) -&gt;
<a name="419"/>  419:     {{fun ?MODULE:generate_heading/1,1},0};
<a name="420"/>  420: <b>generate_table_content</b>(N) -&gt;
<a name="generate_table_content-last_expr"/><a name="421"/>  421:     {{fun ?MODULE:generate_row/1, {2,2}},N-1}.
<a name="generate_row-1"/><a name="422"/>  422: <b>generate_row</b>({0,_}) -&gt;
<a name="423"/>  423:     done;
<a name="424"/>  424: <b>generate_row</b>(N) -&gt;
<a name="425"/>  425:     UpdateS = fun({2,_}) -&gt; {1,2};(_) -&gt; {0,0} end,
<a name="generate_row-last_expr"/><a name="426"/>  426: <b>    {{row,[{fun ?MODULE:generate_row_col/1, N}]},UpdateS</b>(N)}.
<a name="generate_row_col-1"/><a name="427"/>  427: <b>generate_row_col</b>({_,0}) -&gt;
<a name="428"/>  428:     done;
<a name="429"/>  429: <b>generate_row_col</b>(N={C,R}) -&gt;
<a name="430"/>  430:     UpdateS = fun({X,Y}) -&gt; {X,Y-1} end,
<a name="generate_row_col-last_expr"/><a name="431"/>  431: <b>    {{col,[lists:concat</b>([&quot;col&quot;,C,R])]},UpdateS(N)}.
<a name="generate_heading-1"/><a name="432"/>  432: <b>generate_heading</b>(0) -&gt;
<a name="433"/>  433:     done;
<a name="434"/>  434: <b>generate_heading</b>(N) -&gt;
<a name="generate_heading-last_expr"/><a name="435"/>  435:     {{heading,[{fun ?MODULE:generate_heading_col/1,2}]},N-1}.
<a name="generate_heading_col-1"/><a name="436"/>  436: <b>generate_heading_col</b>(0) -&gt;
<a name="437"/>  437:     done;
<a name="438"/>  438: <b>generate_heading_col</b>(N) -&gt;
<a name="generate_heading_col-last_expr"/><a name="439"/>  439: <b>    {{col,[lists:concat</b>([&quot;head&quot;,N])]},N-1}.
<a name="440"/>  440: 
<a name="441"/>  441: <i>%%----------------------------------------------------------------------</i>
<a name="442"/>  442: <i>%% Ticket Tests</i>
<a name="443"/>  443: <i>%%----------------------------------------------------------------------</i>
<a name="444"/>  444: 
<a name="445"/>  445: <i>%%</i>
<a name="446"/>  446: <i>%% ticket_5998</i>
<a name="447"/>  447: <i>%%</i>
<a name="448"/>  448: <i>%% A Kleene Closure child in a sequence consumed all following</i>
<a name="449"/>  449: <i>%% child's. This problem has been fixed.</i>
<a name="450"/>  450: <i>%%</i>
<a name="ticket_5998-1"/><a name="451"/>  451: <b>ticket_5998</b>(Config) -&gt;
<a name="452"/>  452:     DataDir = datadir(Config),
<a name="453"/>  453:     %% First fix is tested by case syntax_bug2.
<a name="454"/>  454: 
<a name="455"/>  455:     ok =
<a name="456"/>  456:         case catch xmerl_scan:file(filename:join([DataDir,misc,&quot;ticket_5998_2.xml&quot;])) of
<a name="457"/>  457:             {'EXIT',{fatal,Reason1}} -&gt;
<a name="458"/>  458:                 case Reason1 of
<a name="459"/>  459:                     {{endtag_does_not_match,
<a name="460"/>  460:                       {was,obj,should_have_been,int}},
<a name="461"/>  461:                      _,_,_} -&gt; ok;
<a name="462"/>  462:                     _ -&gt; {comment,&quot;parsing changed behaviour&quot;}
<a name="463"/>  463:                 end
<a name="464"/>  464:         end,
<a name="465"/>  465: 
<a name="ticket_5998-last_expr"/><a name="466"/>  466:     ok =
<a name="467"/>  467:         case catch xmerl_scan:file(filename:join([DataDir,misc,&quot;ticket_5998_3.xml&quot;])) of
<a name="468"/>  468:             {'EXIT',{fatal,Reason2}} -&gt;
<a name="469"/>  469:                 case Reason2 of
<a name="470"/>  470:                     {&quot;expected one of: ?&gt;, standalone, encoding&quot;,
<a name="471"/>  471:                      _,_,_} -&gt; ok;
<a name="472"/>  472:                     _ -&gt; {comment,&quot;parsing changed behaviour&quot;}
<a name="473"/>  473:                 end
<a name="474"/>  474:         end.
<a name="475"/>  475: 
<a name="476"/>  476: 
<a name="477"/>  477: <i>%%</i>
<a name="478"/>  478: <i>%% ticket_7211</i>
<a name="479"/>  479: <i>%%</i>
<a name="480"/>  480: <i>%% A Kleene Closure child in a sequence consumed all following</i>
<a name="481"/>  481: <i>%% child's. This problem has been fixed.</i>
<a name="482"/>  482: <i>%%</i>
<a name="ticket_7211-1"/><a name="483"/>  483: <b>ticket_7211</b>(Config) -&gt;
<a name="484"/>  484:     DataDir = datadir(Config),
<a name="485"/>  485:     {E,[]} = xmerl_scan:file(filename:join([DataDir,misc,&quot;notes2.xml&quot;]),
<a name="486"/>  486:                              [{fetch_path,[filename:join([DataDir,misc,erlang_docs_dtd])]},
<a name="487"/>  487:                               {validation,dtd}]),
<a name="488"/>  488: 
<a name="489"/>  489:     ok = case E of
<a name="490"/>  490:              Rec when is_record(Rec,xmlElement) -&gt;
<a name="491"/>  491:                  ok;
<a name="492"/>  492:              _ -&gt;
<a name="493"/>  493:                  E
<a name="494"/>  494:          end,
<a name="495"/>  495: 
<a name="496"/>  496:     {E2,[]} = xmerl_scan:file(filename:join([DataDir,misc,&quot;XS.xml&quot;]),
<a name="497"/>  497:                               [{fetch_path,[filename:join([DataDir,misc,erlang_docs_dtd])]},
<a name="498"/>  498:                                {validation,dtd}]),
<a name="499"/>  499: 
<a name="ticket_7211-last_expr"/><a name="500"/>  500:     ok = case E2 of
<a name="501"/>  501:              Rec2 when is_record(Rec2,xmlElement) -&gt;
<a name="502"/>  502:                  ok;
<a name="503"/>  503:              _ -&gt;
<a name="504"/>  504:                  E2
<a name="505"/>  505:          end.
<a name="506"/>  506: 
<a name="507"/>  507: <i>%%</i>
<a name="508"/>  508: <i>%% ticket_7214</i>
<a name="509"/>  509: <i>%%</i>
<a name="510"/>  510: <i>%% Now validating xhtml1-transitional.dtd.</i>
<a name="511"/>  511: <i>%% A certain contentspec with a succeeding choice, that didn't match</i>
<a name="512"/>  512: <i>%% all content, followed by other child elements caused a</i>
<a name="513"/>  513: <i>%% failure. This is now corrected.</i>
<a name="514"/>  514: <i>%%</i>
<a name="ticket_7214-1"/><a name="515"/>  515: <b>ticket_7214</b>(Config) -&gt;
<a name="516"/>  516:     DataDir = datadir(Config),
<a name="517"/>  517: 
<a name="518"/>  518:     {E,[]} = xmerl_scan:file(filename:join([DataDir,misc,'block_tags.html']),
<a name="519"/>  519:                              [{validation,dtd},
<a name="520"/>  520:                               {fetch_path,[filename:join([DataDir,misc,erlang_docs_dtd])]}]),
<a name="521"/>  521: 
<a name="ticket_7214-last_expr"/><a name="522"/>  522:     ok = case E of
<a name="523"/>  523:              Rec when is_record(Rec,xmlElement) -&gt;
<a name="524"/>  524:                  ok;
<a name="525"/>  525:              _ -&gt;
<a name="526"/>  526:                  E
<a name="527"/>  527:          end.
<a name="528"/>  528: 
<a name="529"/>  529: <i>%%</i>
<a name="530"/>  530: <i>%% ticket_7430</i>
<a name="531"/>  531: <i>%%</i>
<a name="532"/>  532: <i>%% Problem with contents of numeric character references followed by</i>
<a name="533"/>  533: <i>%% UTF-8 characters..</i>
<a name="534"/>  534: <i>%%</i>
<a name="ticket_7430-1"/><a name="535"/>  535: <b>ticket_7430</b>(_Config) -&gt;
<a name="536"/>  536:     %%DataDir = datadir(Config),
<a name="537"/>  537: 
<a name="538"/>  538:     {E,[]} = xmerl_scan:string(&quot;&lt;a&gt;\303\251&amp;#xD;\303\251&lt;/a&gt;&quot;,[{encoding,'utf-8'}]),
<a name="539"/>  539: 
<a name="ticket_7430-last_expr"/><a name="540"/>  540:     ok = case E of
<a name="541"/>  541:              {xmlElement,a,a,[],
<a name="542"/>  542:               {xmlNamespace,[],[]},
<a name="543"/>  543:               [],1,[],
<a name="544"/>  544:               [{xmlText,[{a,1}],1,[],&quot;é\né&quot;,text}],
<a name="545"/>  545:               [],_,undeclared} -&gt;
<a name="546"/>  546:                  ok;
<a name="547"/>  547:              _ -&gt;
<a name="548"/>  548:                  E
<a name="549"/>  549:          end.
<a name="550"/>  550: 
<a name="ticket_6873-1"/><a name="551"/>  551: <b>ticket_6873</b>(Config) -&gt;
<a name="552"/>  552:     file:set_cwd(filename:join(datadir(Config),xpath)),
<a name="553"/>  553:     ok = xpath_abbrev:ticket_6873(),
<a name="ticket_6873-last_expr"/><a name="554"/>  554: <b>    ok = xpath_lib:ticket_6873</b>().
<a name="555"/>  555: 
<a name="ticket_7496-1"/><a name="556"/>  556: <b>ticket_7496</b>(Config) -&gt;
<a name="557"/>  557:     file:set_cwd(filename:join(datadir(Config),xpath)),
<a name="ticket_7496-last_expr"/><a name="558"/>  558: <b>    ok = xpath_abbrev:ticket_7496</b>().
<a name="559"/>  559: 
<a name="ticket_8156-1"/><a name="560"/>  560: <b>ticket_8156</b>(_Config) -&gt;
<a name="561"/>  561:     {ftp,{[],[]},&quot;testmachine1&quot;,21,&quot;/w.erl&quot;} = xmerl_uri:parse(&quot;ftp://testmachine1/w.erl&quot;),
<a name="562"/>  562:     {ftp,{&quot;user&quot;,[]},&quot;testmachine1&quot;,21,&quot;/w.erl&quot;} = xmerl_uri:parse(&quot;ftp://user@testmachine1/w.erl&quot;),
<a name="563"/>  563:     {ftp,{&quot;user&quot;,&quot;hello&quot;},&quot;testmachine1&quot;,21,&quot;/w.erl&quot;} = xmerl_uri:parse(&quot;ftp://user:hello@testmachine1/w.erl&quot;),
<a name="564"/>  564:     {ftp,{[],[]},&quot;testmachine1&quot;,3000,&quot;/w.erl&quot;} = xmerl_uri:parse(&quot;ftp://testmachine1:3000/w.erl&quot;),
<a name="565"/>  565:     {ftp,{&quot;user&quot;,&quot;hello&quot;},&quot;testmachine1&quot;,3000,&quot;/w.erl&quot;} = xmerl_uri:parse(&quot;ftp://user:hello@testmachine1:3000/w.erl&quot;),
<a name="ticket_8156-last_expr"/><a name="566"/>  566:     ok.
<a name="567"/>  567: 
<a name="568"/>  568: <i>%% Test that xmerl_scan can decode unicode entities properly</i>
<a name="ticket_8697-1"/><a name="569"/>  569: <b>ticket_8697</b>(_Config) -&gt;
<a name="570"/>  570:     {UTF8Output, []} = xmerl_scan:string(&quot;&lt;?xml version=\&quot;1\&quot; ?&gt;\n&lt;text&gt;&quot; ++ [229, 145, 156] ++ &quot;&lt;/text&gt;&quot;),
<a name="571"/>  571:     #xmlElement{content = [#xmlText{value = UTF8Text}]} = UTF8Output,
<a name="572"/>  572:     [16#545C] = UTF8Text,
<a name="573"/>  573:     {DecEntityOutput, []} = xmerl_scan:string(&quot;&lt;?xml version=\&quot;1\&quot; ?&gt;\n&lt;text&gt;&amp;#21596;&lt;/text&gt;&quot;),
<a name="574"/>  574:     #xmlElement{content = [#xmlText{value = DecEntityText}]} = DecEntityOutput,
<a name="575"/>  575:     [21596] = DecEntityText,
<a name="576"/>  576:     {HexEntityOutput, []} = xmerl_scan:string(&quot;&lt;?xml version=\&quot;1\&quot; ?&gt;\n&lt;text&gt;&amp;#x545C;&lt;/text&gt;&quot;),
<a name="577"/>  577:     #xmlElement{content = [#xmlText{value = HexEntityText}]} = HexEntityOutput,
<a name="578"/>  578:     [16#545C] = HexEntityText,
<a name="ticket_8697-last_expr"/><a name="579"/>  579:     ok.
<a name="580"/>  580: 
<a name="581"/>  581: <i>%% Test that xmerl_scan handles attribute that contains for example &amp;quot</i>
<a name="ticket_9411-1"/><a name="582"/>  582: <b>ticket_9411</b>(Config) -&gt;
<a name="583"/>  583:     DataDir = datadir(Config),
<a name="584"/>  584: 
<a name="585"/>  585:     {ok, Schema} = xmerl_xsd:process_schema(filename:join([DataDir,&quot;misc/ticket_9411.xsd&quot;])),
<a name="586"/>  586:     {ok, Bin} = file:read_file(filename:join([DataDir,&quot;misc/ticket_9411.xml&quot;])),
<a name="587"/>  587:     Xml = erlang:binary_to_list(Bin),
<a name="588"/>  588:     {E, _} = xmerl_scan:string(Xml),
<a name="ticket_9411-last_expr"/><a name="589"/>  589: <b>    {E, _} = xmerl_xsd:validate</b>(E, Schema).
<a name="590"/>  590: 
<a name="591"/>  591: <i>%% Test that xmerl_scan handles continuation correct when current input runs out at the end of an attribute value</i>
<a name="ticket_9457-1"/><a name="592"/>  592: <b>ticket_9457</b>(_Config) -&gt;
<a name="593"/>  593:     Opts = [{continuation_fun, fun ticket_9457_cont/3, start}, {space, normalize}],
<a name="ticket_9457-last_expr"/><a name="594"/>  594: <b>    {_E, _} = xmerl_scan:string</b>([], Opts).
<a name="595"/>  595: 
<a name="ticket_9457_cont-3"/><a name="596"/>  596: <b>ticket_9457_cont</b>(Continue, Exception, GlobalState) -&gt;
<a name="ticket_9457_cont-last_expr"/><a name="597"/>  597: <b>    case xmerl_scan:cont_state</b>(GlobalState) of
<a name="598"/>  598: 	start -&gt;
<a name="599"/>  599: 	    G1 = xmerl_scan:cont_state(next, GlobalState),
<a name="600"/>  600: 	    Bytes = &quot;&lt;?xml version=\&quot;1.0\&quot; ?&gt;\r\n&lt;item a=\&quot;b\&quot;&quot;,
<a name="601"/>  601: 	    Continue(Bytes, G1);
<a name="602"/>  602: 	next -&gt;
<a name="603"/>  603: 	    G1 = xmerl_scan:cont_state(last, GlobalState),
<a name="604"/>  604: 	    Bytes = &quot;&gt;blah&lt;/item&gt;\r\n&quot;,
<a name="605"/>  605: 	    Continue(Bytes, G1);
<a name="606"/>  606: 	_ -&gt;
<a name="607"/>  607: 	    Exception(GlobalState)
<a name="608"/>  608:     end.
<a name="609"/>  609: 
<a name="610"/>  610: 
<a name="611"/>  611: <i>%% Test that comments are handled correct with</i>
<a name="ticket_9664_schema-1"/><a name="612"/>  612: <b>ticket_9664_schema</b>(Config) -&gt;
<a name="613"/>  613:     {E, _} = xmerl_scan:file(datadir_join(Config,[misc,&quot;ticket_9664_schema.xml&quot;]),[]),
<a name="614"/>  614:     {ok, S} = xmerl_xsd:process_schema(datadir_join(Config,[misc,&quot;motorcycles.xsd&quot;])),
<a name="615"/>  615:     {E1, _} = xmerl_xsd:validate(E, S),
<a name="616"/>  616: 
<a name="617"/>  617:     {E1,_} = xmerl_xsd:process_validate(datadir_join(Config,[misc,&quot;motorcycles.xsd&quot;]),E,[]),
<a name="618"/>  618: 
<a name="619"/>  619:     {E1,_} = xmerl_scan:file(datadir_join(Config,[misc,&quot;ticket_9664_schema.xml&quot;]),
<a name="620"/>  620:                              [{schemaLocation, [{&quot;mc&quot;, &quot;motorcycles.xsd&quot;}]},
<a name="621"/>  621:                               {validation, schema}]),
<a name="ticket_9664_schema-last_expr"/><a name="622"/>  622:     ok.
<a name="623"/>  623: 
<a name="624"/>  624: <i>%% Test that comments are handled correct with</i>
<a name="ticket_9664_dtd-1"/><a name="625"/>  625: <b>ticket_9664_dtd</b>(Config) -&gt;
<a name="626"/>  626:     {E, _} = xmerl_scan:file(datadir_join(Config,[misc,&quot;ticket_9664_dtd.xml&quot;]),[]),
<a name="627"/>  627:     {E, _} = xmerl_scan:file(datadir_join(Config,[misc,&quot;ticket_9664_dtd.xml&quot;]),[{validation, true}]),
<a name="ticket_9664_dtd-last_expr"/><a name="628"/>  628:     ok.
<a name="629"/>  629: 
<a name="630"/>  630: 
<a name="allow_entities_test-1"/><a name="631"/>  631: <b>allow_entities_test</b>(Config) -&gt;
<a name="632"/>  632:     DataDir = proplists:get_value(data_dir, Config),
<a name="633"/>  633:     File = filename:join(DataDir, &quot;lol_1_test.xml&quot;), %% Depth 9
<a name="634"/>  634:     %% Disallow entities
<a name="635"/>  635:     {'EXIT',{fatal, {{error,entities_not_allowed}, _, _, _}}} =
<a name="636"/>  636:         (catch xmerl_scan:file(File, [{allow_entities, false}])),
<a name="allow_entities_test-last_expr"/><a name="637"/>  637:     ok.
<a name="638"/>  638: 
<a name="639"/>  639: 
<a name="640"/>  640: <i>%%======================================================================</i>
<a name="641"/>  641: <i>%% Support Functions</i>
<a name="642"/>  642: <i>%%======================================================================</i>
<a name="643"/>  643: 
<a name="644"/>  644: <i>%% Dir is a directory</i>
<a name="rm_f_-1"/><a name="645"/>  645: <b>rm_f_</b>(Dir) -&gt;
<a name="646"/>  646:     {ok,CWD} = file:get_cwd(),
<a name="647"/>  647:     {ok,FileList} = file:list_dir(Dir),
<a name="648"/>  648:     file:set_cwd(filename:join([CWD,Dir])),
<a name="649"/>  649:     rm_files(FileList),
<a name="650"/>  650:     file:set_cwd(CWD),
<a name="rm_f_-last_expr"/><a name="651"/>  651: <b>    ? line ok = file:del_dir</b>(Dir).
<a name="652"/>  652: 
<a name="rm_files-1"/><a name="653"/>  653: <b>rm_files</b>([])-&gt;
<a name="654"/>  654:     ok;
<a name="655"/>  655: <b>rm_files</b>([F|Fs]) -&gt;
<a name="656"/>  656:     case filelib:is_dir(F) of
<a name="657"/>  657: 	true -&gt;
<a name="658"/>  658: 	    rm_f_(F);
<a name="659"/>  659: 	_ -&gt;
<a name="660"/>  660: 	    ok = file:delete(F)
<a name="661"/>  661:     end,
<a name="rm_files-last_expr"/><a name="662"/>  662: <b>    rm_files</b>(Fs).
<a name="663"/>  663: 
<a name="change_mode-1"/><a name="664"/>  664: <b>change_mode</b>(Files) -&gt;
<a name="change_mode-last_expr"/><a name="665"/>  665: <b>    change_mode3</b>(Files).
<a name="change_mode2-1"/><a name="666"/>  666: <b>change_mode2</b>(Dir)-&gt;
<a name="667"/>  667:     {ok,CWD} = file:get_cwd(),
<a name="668"/>  668:     {ok,FileList} = file:list_dir(Dir),
<a name="669"/>  669:     file:set_cwd(filename:join([CWD,Dir])),
<a name="670"/>  670:     change_mode3(FileList),
<a name="change_mode2-last_expr"/><a name="671"/>  671: <b>    file:set_cwd</b>(CWD).
<a name="change_mode3-1"/><a name="672"/>  672: <b>change_mode3</b>([]) -&gt;
<a name="673"/>  673:     ok;
<a name="674"/>  674: <b>change_mode3</b>([F|Fs]) -&gt;
<a name="675"/>  675:     case filelib:is_dir(F) of
<a name="676"/>  676:         true -&gt;
<a name="677"/>  677:             chmod(F),
<a name="678"/>  678:             change_mode2(F);
<a name="679"/>  679:         _ -&gt;
<a name="680"/>  680:             chmod(F)
<a name="681"/>  681:     end,
<a name="change_mode3-last_expr"/><a name="682"/>  682: <b>    change_mode3</b>(Fs).
<a name="683"/>  683: 
<a name="chmod-1"/><a name="684"/>  684: <b>chmod</b>(F) -&gt;
<a name="chmod-last_expr"/><a name="685"/>  685: <b>    case file:read_file_info</b>(F) of
<a name="686"/>  686: 	{ok,FileInfo} -&gt;
<a name="687"/>  687: 	    Mode= FileInfo#file_info.mode,
<a name="688"/>  688: 	    file:write_file_info(F,FileInfo#file_info{mode=8#00777 bor Mode});
<a name="689"/>  689: 	_ -&gt;
<a name="690"/>  690: 	    ok
<a name="691"/>  691:     end.
<a name="692"/>  692: 
<a name="privdir-1"/><a name="693"/>  693: <b>privdir</b>(Config) -&gt;
<a name="privdir-last_expr"/><a name="694"/>  694: <b>    proplists:get_value</b>(priv_dir, Config).
<a name="datadir-1"/><a name="695"/>  695: <b>datadir</b>(Config) -&gt;
<a name="datadir-last_expr"/><a name="696"/>  696: <b>    proplists:get_value</b>(data_dir, Config).
<a name="697"/>  697: 
<a name="datadir_join-2"/><a name="698"/>  698: <b>datadir_join</b>(Config,Files) -&gt;
<a name="datadir_join-last_expr"/><a name="699"/>  699: <b>    filename:join</b>([datadir(Config)|Files]).
<a name="700"/>  700: 
<a name="701"/>  701: <i>%%======================================================================</i>
<a name="702"/>  702: <i>%% New formatter tests input/output</i>
<a name="703"/>  703: <i>%%======================================================================</i>
<a name="704"/>  704: 
<a name="html-0"/><a name="705"/>  705: <b>html</b>() -&gt;
<a name="html-last_expr"/><a name="706"/>  706:     &quot;&lt;!DOCTYPE html PUBLIC \&quot;-//W3C//DTD XHTML 1.0 Strict//EN\&quot; \&quot;DTD/xhtml1-strict.dtd\&quot;&gt;&lt;html&gt;&quot;
<a name="707"/>  707:     &quot;&lt;head&gt;&lt;title&gt;Doc Title&lt;/title&gt;&lt;author&gt;Ulf Wiger&lt;/author&gt;&lt;/head&gt;&quot;
<a name="708"/>  708:     &quot;&lt;h1&gt;heading1&lt;/h1&gt;&quot;
<a name="709"/>  709:     &quot;&lt;p&gt;This is a paragraph of text.&lt;/p&gt;&quot;
<a name="710"/>  710:     &quot;&lt;h2&gt;heading2&lt;/h2&gt;&quot;
<a name="711"/>  711:     &quot;&lt;p&gt;This is another paragraph.&lt;/p&gt;&quot;
<a name="712"/>  712:     &quot;&lt;table&gt;&quot;
<a name="713"/>  713:     &quot;&lt;thead&gt;&lt;tr&gt;&lt;td&gt;head1&lt;/td&gt;&lt;td&gt;head2&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&quot;
<a name="714"/>  714:     &quot;&lt;tr&gt;&lt;td&gt;col11&lt;/td&gt;&lt;td&gt;col122&lt;/td&gt;&lt;/tr&gt;&quot;
<a name="715"/>  715:     &quot;&lt;tr&gt;&lt;td&gt;col21&lt;/td&gt;&lt;td&gt;col122&lt;/td&gt;&lt;/tr&gt;&quot;
<a name="716"/>  716:     &quot;&lt;/table&gt;&quot;
<a name="717"/>  717:     &quot;&lt;/html&gt;&quot;.
<a name="718"/>  718: 
<a name="html_indented-0"/><a name="719"/>  719: <b>html_indented</b>() -&gt;
<a name="html_indented-last_expr"/><a name="720"/>  720:     &quot;&lt;?xml version=\&quot;1.0\&quot;?&gt;&quot;
<a name="721"/>  721:     &quot;\n&lt;html&gt;&quot;
<a name="722"/>  722:     &quot;\n  &lt;head&gt;&quot;
<a name="723"/>  723:     &quot;\n    &lt;title&gt;Doc Title&lt;/title&gt;&quot;
<a name="724"/>  724:     &quot;\n    &lt;author&gt;Ulf Wiger&lt;/author&gt;&quot;
<a name="725"/>  725:     &quot;\n  &lt;/head&gt;&quot;
<a name="726"/>  726:     &quot;\n  &lt;h1&gt;heading1&lt;/h1&gt;&quot;
<a name="727"/>  727:     &quot;\n  &lt;p&gt;This is a paragraph of text.&lt;/p&gt;&quot;
<a name="728"/>  728:     &quot;\n  &lt;h2&gt;heading2&lt;/h2&gt;&quot;
<a name="729"/>  729:     &quot;\n  &lt;p&gt;This is another paragraph.&lt;/p&gt;&quot;
<a name="730"/>  730:     &quot;\n  &lt;table&gt;&quot;
<a name="731"/>  731:     &quot;\n    &lt;thead&gt;&quot;
<a name="732"/>  732:     &quot;\n      &lt;tr&gt;&quot;
<a name="733"/>  733:     &quot;\n        &lt;td&gt;head1&lt;/td&gt;&quot;
<a name="734"/>  734:     &quot;\n        &lt;td&gt;head2&lt;/td&gt;&quot;
<a name="735"/>  735:     &quot;\n      &lt;/tr&gt;&quot;
<a name="736"/>  736:     &quot;\n    &lt;/thead&gt;&quot;
<a name="737"/>  737:     &quot;\n    &lt;tr&gt;&quot;
<a name="738"/>  738:     &quot;\n      &lt;td&gt;col11&lt;/td&gt;&quot;
<a name="739"/>  739:     &quot;\n      &lt;td&gt;col122&lt;/td&gt;&quot;
<a name="740"/>  740:     &quot;\n    &lt;/tr&gt;&quot;
<a name="741"/>  741:     &quot;\n    &lt;tr&gt;&quot;
<a name="742"/>  742:     &quot;\n      &lt;td&gt;col21&lt;/td&gt;&quot;
<a name="743"/>  743:     &quot;\n      &lt;td&gt;col122&lt;/td&gt;&quot;
<a name="744"/>  744:     &quot;\n    &lt;/tr&gt;&quot;
<a name="745"/>  745:     &quot;\n  &lt;/table&gt;&quot;
<a name="746"/>  746:     &quot;\n&lt;/html&gt;&quot;.
<a name="747"/>  747: 
<a name="xml_namespace-0"/><a name="748"/>  748: <b>xml_namespace</b>() -&gt;
<a name="xml_namespace-last_expr"/><a name="749"/>  749:     &quot;&lt;?xml version=\&quot;1.0\&quot;?&gt;&quot;
<a name="750"/>  750:     &quot;&lt;!-- initially, the default namespace is \&quot;books\&quot; --&gt;&quot;
<a name="751"/>  751:     &quot;&lt;book xmlns='urn:loc.gov:books' xmlns:isbn='urn:ISBN:0-395-36341-6'&gt;&quot;
<a name="752"/>  752:     &quot;&lt;title&gt;Cheaper by the Dozen&lt;/title&gt;&quot;
<a name="753"/>  753:     &quot;&lt;isbn:number&gt;1568491379&lt;/isbn:number&gt;&quot;
<a name="754"/>  754:     &quot;&lt;notes&gt;&quot;
<a name="755"/>  755:     &quot;&lt;!-- make HTML the default namespace for some comments --&gt;&quot;
<a name="756"/>  756:     &quot;&lt;p xmlns='urn:w3-org-ns:HTML'&gt;&quot;
<a name="757"/>  757:     &quot;This is a &lt;i&gt;funny&lt;/i&gt; book!&quot;
<a name="758"/>  758:     &quot;&lt;/p&gt;&quot;
<a name="759"/>  759:     &quot;&lt;/notes&gt;&quot;
<a name="760"/>  760:     &quot;&lt;/book&gt;&quot;.
<a name="761"/>  761: 
<a name="xml_namespace_indented-0"/><a name="762"/>  762: <b>xml_namespace_indented</b>() -&gt;
<a name="xml_namespace_indented-last_expr"/><a name="763"/>  763:   &quot;&lt;?xml version=\&quot;1.0\&quot;?&gt;&quot;
<a name="764"/>  764:   &quot;\n&lt;book xmlns=\&quot;urn:loc.gov:books\&quot; xmlns:isbn=\&quot;urn:ISBN:0-395-36341-6\&quot;&gt;&quot;
<a name="765"/>  765:   &quot;\n  &lt;title&gt;Cheaper by the Dozen&lt;/title&gt;&quot;
<a name="766"/>  766:   &quot;\n  &lt;isbn:number&gt;1568491379&lt;/isbn:number&gt;&quot;
<a name="767"/>  767:   &quot;\n  &lt;notes&gt;&quot;
<a name="768"/>  768:   &quot;\n    &lt;p xmlns=\&quot;urn:w3-org-ns:HTML\&quot;&gt;This is a &lt;i&gt;funny&lt;/i&gt; book!&lt;/p&gt;&quot;
<a name="769"/>  769:   &quot;\n  &lt;/notes&gt;&quot;
<a name="770"/>  770:   &quot;\n&lt;/book&gt;&quot;.
<a name="771"/>  771: 
<a name="output_element_to_str-1"/><a name="772"/>  772: <b>output_element_to_str</b>(E) -&gt;
<a name="773"/>  773:     Output = xmerl:export([E], xmerl_xml_indent),
<a name="774"/>  774:     [Str] = io_lib:format(&quot;~s&quot;, [lists:flatten(Output)]),
<a name="output_element_to_str-last_expr"/><a name="775"/>  775:     Str.
<a name="776"/>  776: 
<a name="777"/>  777: <i>%%======================================================================</i>
<a name="778"/>  778: <i>%% New formatter tests</i>
<a name="779"/>  779: <i>%%======================================================================</i>
<a name="formatter_pass-1"/><a name="780"/>  780: <b>formatter_pass</b>(_Config) -&gt;
<a name="781"/>  781: 
<a name="782"/>  782:     FetchFun = fun(_DTDSpec, S) -&gt; {ok, not_fetched, S} end,
<a name="783"/>  783:     %% Generate based on namespace-example
<a name="784"/>  784:     {Ns, _} = xmerl_scan:string(xml_namespace(), [{fetch_fun, FetchFun}]),
<a name="785"/>  785:     GNs = output_element_to_str(Ns),
<a name="786"/>  786:     INs = xml_namespace_indented(),
<a name="787"/>  787:     INs = GNs,
<a name="788"/>  788: 
<a name="789"/>  789:     %% Generate based on html-example
<a name="790"/>  790:     {Html, _} = xmerl_scan:string(html(), [{fetch_fun, FetchFun}]),
<a name="791"/>  791:     GHtml = output_element_to_str(Html),
<a name="792"/>  792:     IHtml = html_indented(),
<a name="793"/>  793:     GHtml = IHtml,
<a name="formatter_pass-last_expr"/><a name="794"/>  794:     ok.
<a name="795"/>  795: 
<a name="formatter_fail-1"/><a name="796"/>  796: <b>formatter_fail</b>(_Config) -&gt;
<a name="formatter_fail-last_expr"/><a name="797"/>  797:     ok.
</pre>
<script>
var hash = window.location.hash.substring(1);
var anchor = document.getElementsByName(hash);
anchor[0].style.backgroundColor="orange";
</script>
</body>
</html>
