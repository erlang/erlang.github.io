<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/></meta>
<title>/buildroot/otp/lib/parsetools/make_test_dir/parsetools_test/yecc_SUITE.erl</title>
</head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
<a name="1"/>    1: <i>%%</i>
<a name="2"/>    2: <i>%% %CopyrightBegin%</i>
<a name="3"/>    3: <i>%%</i>
<a name="4"/>    4: <i>%% Copyright Ericsson AB 2005-2024. All Rights Reserved.</i>
<a name="5"/>    5: <i>%%</i>
<a name="6"/>    6: <i>%% Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</i>
<a name="7"/>    7: <i>%% you may not use this file except in compliance with the License.</i>
<a name="8"/>    8: <i>%% You may obtain a copy of the License at</i>
<a name="9"/>    9: <i>%%</i>
<a name="10"/>   10: <i>%%     http://www.apache.org/licenses/LICENSE-2.0</i>
<a name="11"/>   11: <i>%%</i>
<a name="12"/>   12: <i>%% Unless required by applicable law or agreed to in writing, software</i>
<a name="13"/>   13: <i>%% distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</i>
<a name="14"/>   14: <i>%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</i>
<a name="15"/>   15: <i>%% See the License for the specific language governing permissions and</i>
<a name="16"/>   16: <i>%% limitations under the License.</i>
<a name="17"/>   17: <i>%%</i>
<a name="18"/>   18: <i>%% %CopyrightEnd%</i>
<a name="19"/>   19: <i>%%</i>
<a name="20"/>   20: <b>-module</b>(yecc_SUITE).
<a name="21"/>   21: 
<a name="22"/>   22: <i>%-define(debug, true).</i>
<a name="23"/>   23: 
<a name="24"/>   24: <b>-include_lib</b>(&quot;stdlib/include/erl_compile.hrl&quot;).
<a name="25"/>   25: <b>-include_lib</b>(&quot;stdlib/include/assert.hrl&quot;).
<a name="26"/>   26: 
<a name="27"/>   27: <b>-ifdef</b>(debug).
<a name="28"/>   28: <b>-define</b>(config(X,Y), foo).
<a name="29"/>   29: <b>-define</b>(datadir, &quot;yecc_SUITE_data&quot;).
<a name="30"/>   30: <b>-define</b>(privdir, &quot;yecc_SUITE_priv&quot;).
<a name="31"/>   31: -else.
<a name="32"/>   32: <b>-include_lib</b>(&quot;common_test/include/ct.hrl&quot;).
<a name="33"/>   33: <b>-define</b>(datadir, ?config(data_dir, Config)).
<a name="34"/>   34: <b>-define</b>(privdir, ?config(priv_dir, Config)).
<a name="35"/>   35: -endif.
<a name="36"/>   36: 
<a name="37"/>   37: <b>-export</b>([all/0, suite/0,groups/0,init_per_suite/1, end_per_suite/1, 
<a name="38"/>   38: 	 init_per_group/2,end_per_group/2, 
<a name="39"/>   39: 	 init_per_testcase/2, end_per_testcase/2]).
<a name="40"/>   40: 
<a name="41"/>   41: <b>-export</b>([app_test/1,
<a name="42"/>   42: 	 
<a name="43"/>   43: 	 file/1, syntax/1, compile/1, rules/1, expect/1,
<a name="44"/>   44: 	 conflicts/1, deterministic/1,
<a name="45"/>   45: 	 
<a name="46"/>   46: 	 empty/1, prec/1, yeccpre/1, lalr/1, old_yecc/1, 
<a name="47"/>   47: 	 other_examples/1,
<a name="48"/>   48: 	 
<a name="49"/>   49: 	 otp_5369/1, otp_6362/1, otp_7945/1, otp_8483/1, otp_8486/1,
<a name="50"/>   50: 	 
<a name="51"/>   51: 	 otp_7292/1, otp_7969/1, otp_8919/1, otp_10302/1, otp_11269/1,
<a name="52"/>   52:          otp_11286/1, otp_14285/1, otp_17023/1, otp_17535/1]).
<a name="53"/>   53: 
<a name="54"/>   54: <i>% Default timetrap timeout (set in init_per_testcase).</i>
<a name="55"/>   55: <b>-define</b>(default_timeout, test_server:minutes(1)).
<a name="56"/>   56: 
<a name="init_per_testcase-2"/><a name="57"/>   57: <b>init_per_testcase</b>(_Case, Config) -&gt;
<a name="58"/>   58:     Dog = test_server:timetrap(?default_timeout),
<a name="init_per_testcase-last_expr"/><a name="59"/>   59:     [{watchdog, Dog} | Config].
<a name="60"/>   60: 
<a name="end_per_testcase-2"/><a name="61"/>   61: <b>end_per_testcase</b>(_Case, Config) -&gt;
<a name="62"/>   62:     Dog = ?config(watchdog, Config),
<a name="63"/>   63:     test_server:timetrap_cancel(Dog),
<a name="end_per_testcase-last_expr"/><a name="64"/>   64:     ok.
<a name="65"/>   65: 
<a name="suite-0"/><a name="suite-last_expr"/><a name="66"/>   66: <b>suite</b>() -&gt; [{ct_hooks,[ts_install_cth]}].
<a name="67"/>   67: 
<a name="all-0"/><a name="68"/>   68: <b>all</b>() -&gt; 
<a name="all-last_expr"/><a name="69"/>   69:     [app_test, {group, checks}, {group, examples},
<a name="70"/>   70:      {group, bugs}, {group, improvements}].
<a name="71"/>   71: 
<a name="groups-0"/><a name="72"/>   72: <b>groups</b>() -&gt; 
<a name="groups-last_expr"/><a name="73"/>   73:     [{checks, [],
<a name="74"/>   74:       [file, syntax, compile, rules, expect, conflicts, deterministic]},
<a name="75"/>   75:      {examples, [],
<a name="76"/>   76:       [empty, prec, yeccpre, lalr, old_yecc, other_examples]},
<a name="77"/>   77:      {bugs, [],
<a name="78"/>   78:       [otp_5369, otp_6362, otp_7945, otp_8483, otp_8486, otp_17535]},
<a name="79"/>   79:      {improvements, [], [otp_7292, otp_7969, otp_8919, otp_10302,
<a name="80"/>   80:                          otp_11269, otp_11286, otp_14285, otp_17023]}].
<a name="81"/>   81: 
<a name="init_per_suite-1"/><a name="82"/>   82: <b>init_per_suite</b>(Config) -&gt;
<a name="init_per_suite-last_expr"/><a name="83"/>   83:     Config.
<a name="84"/>   84: 
<a name="end_per_suite-1"/><a name="85"/>   85: <b>end_per_suite</b>(_Config) -&gt;
<a name="end_per_suite-last_expr"/><a name="86"/>   86:     ok.
<a name="87"/>   87: 
<a name="init_per_group-2"/><a name="88"/>   88: <b>init_per_group</b>(_GroupName, Config) -&gt;
<a name="init_per_group-last_expr"/><a name="89"/>   89:     Config.
<a name="90"/>   90: 
<a name="end_per_group-2"/><a name="91"/>   91: <b>end_per_group</b>(_GroupName, Config) -&gt;
<a name="end_per_group-last_expr"/><a name="92"/>   92:     Config.
<a name="93"/>   93: 
<a name="94"/>   94: 
<a name="app_test-1"/><a name="95"/>   95: <b>app_test</b>(doc) -&gt;
<a name="96"/>   96:     [&quot;Tests the applications consistency.&quot;];
<a name="97"/>   97: <b>app_test</b>(suite) -&gt;
<a name="98"/>   98:     [];
<a name="99"/>   99: <b>app_test</b>(Config) when is_list(Config) -&gt;
<a name="100"/>  100:     ok=test_server:app_test(parsetools),
<a name="app_test-last_expr"/><a name="101"/>  101:     ok.
<a name="102"/>  102: 
<a name="103"/>  103: 
<a name="file-1"/><a name="104"/>  104: <b>file</b>(doc) -&gt;
<a name="105"/>  105:     &quot;Bad files and options.&quot;;
<a name="106"/>  106: <b>file</b>(suite) -&gt; [];
<a name="107"/>  107: <b>file</b>(Config) when is_list(Config) -&gt;
<a name="108"/>  108:     Dir = ?privdir,
<a name="109"/>  109:     Ret = [return, {report, false}],
<a name="110"/>  110:     {error,[{_,[{none,yecc,{file_error,_}}]}],[]} = 
<a name="111"/>  111:         yecc:file(&quot;not_a_file&quot;, Ret),
<a name="112"/>  112:     {error,[{_,[{none,yecc,{file_error,_}}]}],[]} = 
<a name="113"/>  113:         yecc:file(&quot;not_a_file&quot;, [{return,true}]),
<a name="114"/>  114:     {error,[{_,[{none,yecc,{file_error,_}}]}],[]} = 
<a name="115"/>  115:         yecc:file(&quot;not_a_file&quot;, [{report,false},return_errors]),
<a name="116"/>  116:     error = yecc:file(&quot;not_a_file&quot;),
<a name="117"/>  117:     error = yecc:file(&quot;not_a_file&quot;, [{return,false},report]),
<a name="118"/>  118:     error = yecc:file(&quot;not_a_file&quot;, [return_warnings,{report,false}]),
<a name="119"/>  119:     Filename = filename:join(Dir, &quot;file.yrl&quot;),
<a name="120"/>  120:     file:delete(Filename),
<a name="121"/>  121: 
<a name="122"/>  122:     {'EXIT', {badarg, _}} = (catch yecc:file({foo})),
<a name="123"/>  123:     {'EXIT', {badarg, _}} = 
<a name="124"/>  124:         (catch yecc:file(Filename, {parserfile,{foo}})),
<a name="125"/>  125:     {'EXIT', {badarg, _}} = 
<a name="126"/>  126:         (catch yecc:file(Filename, {includefile,{foo}})),
<a name="127"/>  127: 
<a name="128"/>  128:     {'EXIT', {badarg, _}} = (catch yecc:file(Filename, no_option)),
<a name="129"/>  129:     {'EXIT', {badarg, _}} = 
<a name="130"/>  130:         (catch yecc:file(Filename, [return | report])),
<a name="131"/>  131:     {'EXIT', {badarg, _}} = 
<a name="132"/>  132:         (catch yecc:file(Filename, {return,foo})),
<a name="133"/>  133:     {'EXIT', {badarg, _}} = 
<a name="134"/>  134:         (catch yecc:file(Filename, includefile)),
<a name="135"/>  135: 
<a name="136"/>  136:     Mini = &lt;&lt;&quot;Nonterminals nt. 
<a name="137"/>  137:               Terminals t.
<a name="138"/>  138:               Rootsymbol nt.
<a name="139"/>  139:               nt -&gt; t.&quot;&gt;&gt;,
<a name="140"/>  140:     ok = file:write_file(Filename, Mini),
<a name="141"/>  141:     {error,[{_,[{none,yecc,{file_error,_}}]}],[]} = 
<a name="142"/>  142:         yecc:file(Filename, [{parserfile,&quot;//&quot;} | Ret]),
<a name="143"/>  143: 
<a name="144"/>  144:     {error,[{_,[{none,yecc,{file_error,_}}]}],[]} = 
<a name="145"/>  145:         yecc:file(Filename, [{includefile,&quot;//&quot;} | Ret]),
<a name="146"/>  146:     {error,[{_,[{none,yecc,{file_error,_}}]}],[]} = 
<a name="147"/>  147:         yecc:file(Filename, [{includefile,&quot;/ /&quot;} | Ret]),
<a name="148"/>  148: 
<a name="149"/>  149:     YeccPre = filename:join(Dir, &quot;yeccpre.hrl&quot;),
<a name="150"/>  150:     ok = file:write_file(YeccPre, &lt;&lt;&quot;syntax error. &quot;&gt;&gt;),
<a name="151"/>  151:     PreErrors1 = run_test(Config, Mini, YeccPre),
<a name="152"/>  152:     {errors,[_],[]} = extract(YeccPre, PreErrors1),
<a name="153"/>  153:     ok = file:write_file(YeccPre, my_yeccpre()),
<a name="154"/>  154:     {'EXIT', {undef,_}} = (catch run_test(Config, Mini, YeccPre)),
<a name="155"/>  155: 
<a name="156"/>  156:     MiniCode = &lt;&lt;&quot;
<a name="157"/>  157:               Nonterminals nt. 
<a name="158"/>  158:               Terminals t.
<a name="159"/>  159:               Rootsymbol nt.
<a name="160"/>  160:               nt -&gt; t.
<a name="161"/>  161:               Erlang code.
<a name="162"/>  162:              &quot;&gt;&gt;,
<a name="163"/>  163:     {'EXIT', {undef,_}} = (catch run_test(Config, MiniCode, YeccPre)),
<a name="164"/>  164: 
<a name="165"/>  165:     file:delete(YeccPre),
<a name="166"/>  166:     file:delete(Filename),
<a name="167"/>  167: 
<a name="file-last_expr"/><a name="168"/>  168:     ok.
<a name="169"/>  169: 
<a name="syntax-1"/><a name="170"/>  170: <b>syntax</b>(doc) -&gt;
<a name="171"/>  171:     &quot;Syntax checks.&quot;;
<a name="172"/>  172: <b>syntax</b>(suite) -&gt; [];
<a name="173"/>  173: <b>syntax</b>(Config) when is_list(Config) -&gt;
<a name="174"/>  174:     Dir = ?privdir,
<a name="175"/>  175:     %% Report errors. Very simple test of format_error/1.
<a name="176"/>  176:     Ret = [return, {report, true}],
<a name="177"/>  177:     Filename = filename:join(Dir, &quot;file.yrl&quot;),
<a name="178"/>  178:     Parserfile = filename:join(Dir, &quot;file.erl&quot;),
<a name="179"/>  179:     Parserfile1 = filename:join(Dir, &quot;a file&quot;),
<a name="180"/>  180: 
<a name="181"/>  181:     ok = file:write_file(Filename, &lt;&lt;&quot;&quot;&gt;&gt;),
<a name="182"/>  182:     {error,[{_,[{none,yecc,no_grammar_rules},
<a name="183"/>  183:                       {none,yecc,nonterminals_missing},
<a name="184"/>  184:                       {none,yecc,rootsymbol_missing},
<a name="185"/>  185:                       {none,yecc,terminals_missing}]}],[]} = 
<a name="186"/>  186:         yecc:file(Filename, Ret),
<a name="187"/>  187: 
<a name="188"/>  188:     ok = file:write_file(Filename, &lt;&lt;&quot;Nonterminals&quot;&gt;&gt;),
<a name="189"/>  189:     {error,[{_,[{_,yecc,{error,yeccparser,_}}]}],[]} = 
<a name="190"/>  190:         yecc:file(Filename, Ret),
<a name="191"/>  191: 
<a name="192"/>  192:     ok = file:write_file(Filename, &lt;&lt;&quot;Nonterminals nt.&quot;&gt;&gt;),
<a name="193"/>  193:     {error,[{_,[{none,yecc,no_grammar_rules},
<a name="194"/>  194:                       {none,yecc,rootsymbol_missing},
<a name="195"/>  195:                       {none,yecc,terminals_missing}]}],[]} = 
<a name="196"/>  196:         yecc:file(Filename, Ret),
<a name="197"/>  197: 
<a name="198"/>  198:     ok = file:write_file(Filename, &lt;&lt;&quot;Nonterminals nt. Terminals t.&quot;&gt;&gt;),
<a name="199"/>  199:     {error,[{_,[{none,yecc,no_grammar_rules},
<a name="200"/>  200:                       {none,yecc,rootsymbol_missing}]}],[]} = 
<a name="201"/>  201:         yecc:file(Filename, Ret),
<a name="202"/>  202: 
<a name="203"/>  203:     %% Nonterminals and terminals not disjoint.
<a name="204"/>  204:     ok = file:write_file(Filename, 
<a name="205"/>  205:          &lt;&lt;&quot;Nonterminals nt 't t'. Terminals t 't t'. Rootsymbol nt.&quot;&gt;&gt;),
<a name="206"/>  206:     {error,[{_,[{none,yecc,no_grammar_rules},
<a name="207"/>  207:                 {{1,17},yecc,{symbol_terminal_and_nonterminal,'t t'}}]}],
<a name="208"/>  208:            []} = yecc:file(Filename, Ret),
<a name="209"/>  209: 
<a name="210"/>  210:     %% Rootsymbol is not a nonterminal.
<a name="211"/>  211:     ok = file:write_file(Filename, 
<a name="212"/>  212:          &lt;&lt;&quot;Nonterminals nt. Terminals t. 
<a name="213"/>  213:             Rootsymbol t. nt -&gt; t.&quot;&gt;&gt;),
<a name="214"/>  214:     {error,[{_,[{{2,24},yecc,{bad_rootsymbol,t}}]}],[]} =
<a name="215"/>  215:         yecc:file(Filename, Ret),
<a name="216"/>  216: 
<a name="217"/>  217:     %% Rootsymbol is not a nonterminal.
<a name="218"/>  218:     ok = file:write_file(Filename, 
<a name="219"/>  219:          &lt;&lt;&quot;Nonterminals nt. Terminals t. 
<a name="220"/>  220:             Rootsymbol t. nt -&gt; t.&quot;&gt;&gt;),
<a name="221"/>  221:     {error,[{_,[{{2,24},yecc,{bad_rootsymbol,t}}]}],[]} =
<a name="222"/>  222:         yecc:file(Filename, Ret),
<a name="223"/>  223: 
<a name="224"/>  224:     %% Endsymbol is a nonterminal.
<a name="225"/>  225:     ok = file:write_file(Filename, 
<a name="226"/>  226:          &lt;&lt;&quot;Nonterminals nt. Terminals t. Rootsymbol nt. 
<a name="227"/>  227:             Endsymbol nt.
<a name="228"/>  228:             nt -&gt; t.&quot;&gt;&gt;),
<a name="229"/>  229:     {error,[{_,[{{2,23},yecc,{endsymbol_is_nonterminal,nt}}]}],[]} =
<a name="230"/>  230:         yecc:file(Filename, Ret),
<a name="231"/>  231: 
<a name="232"/>  232:     %% Endsymbol is a terminal.
<a name="233"/>  233:     ok = file:write_file(Filename, 
<a name="234"/>  234:          &lt;&lt;&quot;Nonterminals nt. Terminals t. Rootsymbol nt. 
<a name="235"/>  235:             Endsymbol t.
<a name="236"/>  236:             nt -&gt; t.&quot;&gt;&gt;),
<a name="237"/>  237:     {error,[{_,[{{2,23},yecc,{endsymbol_is_terminal,t}}]}],[]} =
<a name="238"/>  238:         yecc:file(Filename, Ret),
<a name="239"/>  239: 
<a name="240"/>  240:     %% No grammar rules.
<a name="241"/>  241:     ok = file:write_file(Filename, 
<a name="242"/>  242:          &lt;&lt;&quot;Nonterminals nt. Terminals t. Rootsymbol nt. Endsymbol e.&quot;&gt;&gt;),
<a name="243"/>  243:     {error,[{_,[{none,yecc,no_grammar_rules}]}],[]} = 
<a name="244"/>  244:         yecc:file(Filename, Ret),
<a name="245"/>  245: 
<a name="246"/>  246:     %% Bad declaration.
<a name="247"/>  247:     ok = file:write_file(Filename, 
<a name="248"/>  248:          &lt;&lt;&quot;Nonterminals nt. Terminals t. Rootsymbol nt. Endsymbol e.
<a name="249"/>  249:             nt -&gt; t. e e.&quot;&gt;&gt;),
<a name="250"/>  250:     {ok,_,[{_,[{{2,22},yecc,bad_declaration}]}]} =
<a name="251"/>  251:         yecc:file(Filename, Ret),
<a name="252"/>  252: 
<a name="253"/>  253:     %% Bad declaration with warnings_as_errors.
<a name="254"/>  254:     ok = file:delete(Parserfile),
<a name="255"/>  255:     error = yecc:file(Filename, [warnings_as_errors]),
<a name="256"/>  256:     false = filelib:is_regular(Parserfile),
<a name="257"/>  257:     error = yecc:file(Filename, [return_warnings,warnings_as_errors]),
<a name="258"/>  258:     false = filelib:is_regular(Parserfile),
<a name="259"/>  259:     {error,_,[{_,[{{2,22},yecc,bad_declaration}]}]} =
<a name="260"/>  260:         yecc:file(Filename, [return_errors,warnings_as_errors]),
<a name="261"/>  261:     false = filelib:is_regular(Parserfile),
<a name="262"/>  262:     {ok,_,[{_,[{{2,22},yecc,bad_declaration}]}]} =
<a name="263"/>  263:         yecc:file(Filename, [return_warnings]),
<a name="264"/>  264:     true = filelib:is_regular(Parserfile),
<a name="265"/>  265: 
<a name="266"/>  266:     %% Bad declaration.
<a name="267"/>  267:     ok = file:write_file(Filename, 
<a name="268"/>  268:          &lt;&lt;&quot;Nonterminals nt. Terminals t. 
<a name="269"/>  269:             Rootsymbol nt nt. Rootsymbol nt. Endsymbol e.
<a name="270"/>  270:             nt -&gt; t.&quot;&gt;&gt;),
<a name="271"/>  271:     {ok,_,[{_,[{{2,13},yecc,bad_declaration}]}]} =
<a name="272"/>  272:         yecc:file(Filename, Ret),
<a name="273"/>  273:     {ok,_,[{_,[{2,yecc,bad_declaration}]}]} =
<a name="274"/>  274:         yecc:file(Filename, [{error_location, line} | Ret]),
<a name="275"/>  275: 
<a name="276"/>  276:     %% Syntax error found by yeccparser.
<a name="277"/>  277:     ok = file:write_file(Filename, 
<a name="278"/>  278:          &lt;&lt;&quot;Nonterminals nt. Terminals t. Rootsymbol nt. Endsymbol e.
<a name="279"/>  279:             a - a.&quot;&gt;&gt;),
<a name="280"/>  280:     {error,[{_,[{{2,15},yecc,{error,_,_}}]}],[]} =
<a name="281"/>  281:         yecc:file(Filename, Ret),
<a name="282"/>  282:     {error,[{_,[{2,yecc,{error,_,_}}]}],[]} =
<a name="283"/>  283:         yecc:file(Filename, [{error_location, line} | Ret]),
<a name="284"/>  284: 
<a name="285"/>  285:     %% Syntax error: unknown nonterminal.
<a name="286"/>  286:     ok = file:write_file(Filename, 
<a name="287"/>  287:          &lt;&lt;&quot;Nonterminals nt. Terminals t. Rootsymbol nt. Endsymbol e.
<a name="288"/>  288:             'unknown ' -&gt; t.&quot;&gt;&gt;),
<a name="289"/>  289:     {error,[{_,[{{2,13},yecc,{undefined_nonterminal,'unknown '}}]}],[]} =
<a name="290"/>  290:         yecc:file(Filename, Ret),
<a name="291"/>  291: 
<a name="292"/>  292:     %% Undefined rhs symbols. Note quotes in output.
<a name="293"/>  293:     ok = file:write_file(Filename, 
<a name="294"/>  294:          &lt;&lt;&quot;Nonterminals Nonterminals nt. 
<a name="295"/>  295:             Terminals t Terminals. 
<a name="296"/>  296:             Rootsymbol nt. 
<a name="297"/>  297:             Endsymbol e.
<a name="298"/>  298:             nt -&gt; Nonterminals.
<a name="299"/>  299:             Nonterminals -&gt; Terminals receive foo 45 
<a name="300"/>  300:                             '17' 'a b'.&quot;&gt;&gt;),
<a name="301"/>  301:     {error,[{_,[{{6,39},yecc,{undefined_symbol,'receive'}},
<a name="302"/>  302:                 {{6,47},yecc,{undefined_symbol,foo}},
<a name="303"/>  303:                 {{6,51},yecc,{undefined_symbol,45}},
<a name="304"/>  304:                 {{7,29},yecc,{undefined_symbol,'17'}},
<a name="305"/>  305:                 {{7,34},yecc,{undefined_symbol,'a b'}}]}],[]} =
<a name="306"/>  306:         yecc:file(Filename, Ret),
<a name="307"/>  307: 
<a name="308"/>  308:     %% '$empty' used early, before Terminals. OK.
<a name="309"/>  309:     ok = file:write_file(Filename, 
<a name="310"/>  310:          &lt;&lt;&quot;Nonterminals nt. 
<a name="311"/>  311:             nt -&gt; '$empty'.
<a name="312"/>  312:             Terminals t. 
<a name="313"/>  313:             Rootsymbol nt. 
<a name="314"/>  314:             Endsymbol e.&quot;&gt;&gt;),
<a name="315"/>  315:     {ok,_,[{_,[{{3,23},yecc,{unused_terminal,t}}]}]} =
<a name="316"/>  316:         yecc:file(Filename, Ret),
<a name="317"/>  317: 
<a name="318"/>  318:     %% Illegal use of '$empty'.
<a name="319"/>  319:     ok = file:write_file(Filename, 
<a name="320"/>  320:          &lt;&lt;&quot;Nonterminals nt nt2. 
<a name="321"/>  321:             Terminals t. 
<a name="322"/>  322:             Rootsymbol nt. 
<a name="323"/>  323:             Endsymbol e.
<a name="324"/>  324:             nt -&gt; t.
<a name="325"/>  325:             nt2 -&gt; t '$empty'.&quot;&gt;&gt;),
<a name="326"/>  326:     {error,[{_,[{{6,22},yecc,illegal_empty}]}],[]} =
<a name="327"/>  327:         yecc:file(Filename, Ret),
<a name="328"/>  328: 
<a name="329"/>  329:     ParserFile3 = [{parserfile, Parserfile1}],
<a name="330"/>  330: 
<a name="331"/>  331:     %% Bad Erlang expression in action. Changed in OTP-7224.
<a name="332"/>  332:     ok = file:write_file(Filename,
<a name="333"/>  333:          &lt;&lt;&quot;Nonterminals nt. 
<a name="334"/>  334:             Terminals t. 
<a name="335"/>  335:             Rootsymbol nt. 
<a name="336"/>  336:             Endsymbol e.
<a name="337"/>  337:             nt -&gt; t : a bad code.&quot;&gt;&gt;),
<a name="338"/>  338:     {ok, _, []} = yecc:file(Filename, ParserFile3 ++ Ret),
<a name="339"/>  339: 
<a name="340"/>  340:     SzYeccPre = yeccpre_size(),
<a name="341"/>  341:     %% Note: checking the line numbers. Changes when yeccpre.hrl changes.
<a name="342"/>  342:     fun() -&gt;
<a name="343"/>  343:             {error,[{_,[{{5,25},_,[&quot;syntax error before: &quot;,&quot;bad&quot;]}]},
<a name="344"/>  344:                     {_,[{{L1,_},_,{undefined_function,{yeccpars2_2_,1}}},
<a name="345"/>  345:                         {{L2,_},_,{bad_inline,{yeccpars2_2_,1}}},
<a name="346"/>  346:                         {{_,_},_,{undefined_function,{yeccpars2_2_,1}}},
<a name="347"/>  347:                         {{_,_},_,{bad_nowarn_unused_function,{yeccpars2_2_,1}}}]}],
<a name="348"/>  348:              []} = compile:file(Parserfile1, [basic_validation,return]),
<a name="349"/>  349:             ?assertEqual(L1, 38 + SzYeccPre),
<a name="350"/>  350:             ?assertEqual(L2, 47 + SzYeccPre)
<a name="351"/>  351:     end(),
<a name="352"/>  352: 
<a name="353"/>  353:     %% Bad macro in action. OTP-7224.
<a name="354"/>  354:     ok = file:write_file(Filename,
<a name="355"/>  355:          &lt;&lt;&quot;Nonterminals nt. 
<a name="356"/>  356:             Terminals t. 
<a name="357"/>  357:             Rootsymbol nt. 
<a name="358"/>  358:             Endsymbol e.
<a name="359"/>  359:             nt -&gt; t : ?F(3).&quot;&gt;&gt;),
<a name="360"/>  360:     {ok, _, []} = yecc:file(Filename, ParserFile3 ++ Ret),
<a name="361"/>  361:     %% Note: checking the line numbers. Changes when yeccpre.hrl changes.
<a name="362"/>  362:     fun() -&gt;
<a name="363"/>  363:             {error,[{_,[{{5,24},_,{undefined,'F',1}}]},
<a name="364"/>  364:                     {_,[{{L1,_},_,{undefined_function,{yeccpars2_2_,1}}},
<a name="365"/>  365:                         {{L2,_},_,{bad_inline,{yeccpars2_2_,1}}},
<a name="366"/>  366:                         {{_,_},_,{undefined_function,{yeccpars2_2_,1}}},
<a name="367"/>  367:                         {{_,_},_,{bad_nowarn_unused_function,{yeccpars2_2_,1}}}]}],
<a name="368"/>  368:              []} = compile:file(Parserfile1, [basic_validation,return]),
<a name="369"/>  369:             ?assertEqual(L1, 38 + SzYeccPre),
<a name="370"/>  370:             ?assertEqual(L2, 47 + SzYeccPre)
<a name="371"/>  371:     end(),
<a name="372"/>  372: 
<a name="373"/>  373:     %% Check line numbers. OTP-7224.
<a name="374"/>  374:     ok = file:write_file(Filename,
<a name="375"/>  375:          &lt;&lt;&quot;Terminals t. 
<a name="376"/>  376:             Nonterminals nt. 
<a name="377"/>  377:             Rootsymbol nt. 
<a name="378"/>  378:             Endsymbol e.
<a name="379"/>  379:             nt -&gt; t : ?F(3).
<a name="380"/>  380:             Erlang code.
<a name="381"/>  381:             -define(F(X), X).
<a name="382"/>  382:             t() -&gt;
<a name="383"/>  383:                bad().&quot;&gt;&gt;),
<a name="384"/>  384:     {ok, _, []} = yecc:file(Filename, ParserFile3 ++ Ret),
<a name="385"/>  385:     {error,[{_,[{{9,16},_,{undefined_function,{bad,0}}}]}],
<a name="386"/>  386:            [{_,[{{8,13},_,{unused_function,{t,0}}}]}]}
<a name="387"/>  387:         = compile:file(Parserfile1, [basic_validation, return]),
<a name="388"/>  388: 
<a name="389"/>  389:     %% Terminals defined before nonterminals. (One of many checks...)
<a name="390"/>  390:     %% Used to give an error message, but now allowed.
<a name="391"/>  391:     ok = file:write_file(Filename,
<a name="392"/>  392:          &lt;&lt;&quot;Terminals t. 
<a name="393"/>  393:             Nonterminals nt. 
<a name="394"/>  394:             Rootsymbol nt. 
<a name="395"/>  395:             Endsymbol e.
<a name="396"/>  396:             nt -&gt; t.
<a name="397"/>  397:             Erlang code.&quot;&gt;&gt;),
<a name="398"/>  398:     {ok, _, []} = yecc:file(Filename, Ret),
<a name="399"/>  399: 
<a name="400"/>  400:     %% Precedence with swapped arguments. Bad declaration.
<a name="401"/>  401:     ok = file:write_file(Filename, 
<a name="402"/>  402:          &lt;&lt;&quot;Nonterminals nt. 
<a name="403"/>  403:             Terminals t. 
<a name="404"/>  404:             Rootsymbol nt. 
<a name="405"/>  405:             Endsymbol e.
<a name="406"/>  406:             nt -&gt; t.
<a name="407"/>  407:             Right t. 
<a name="408"/>  408:             Left nt 100.&quot;&gt;&gt;),
<a name="409"/>  409:     {ok,_,[{_,[{{6,13},yecc,bad_declaration},
<a name="410"/>  410:                {{7,13},yecc,bad_declaration}]}]} =
<a name="411"/>  411:         yecc:file(Filename, Ret),
<a name="412"/>  412: 
<a name="413"/>  413:     %% Precedence with unknown operator.
<a name="414"/>  414:     ok = file:write_file(Filename, 
<a name="415"/>  415:          &lt;&lt;&quot;Nonterminals nt. 
<a name="416"/>  416:             Terminals t. 
<a name="417"/>  417:             Rootsymbol nt. 
<a name="418"/>  418:             Endsymbol e.
<a name="419"/>  419:             nt -&gt; t.
<a name="420"/>  420:             Unary 100 '-'.&quot;&gt;&gt;),
<a name="421"/>  421:     {error,[{_,[{{6,23},yecc,{precedence_op_is_unknown,'-'}}]}],[]} =
<a name="422"/>  422:         yecc:file(Filename, Ret),
<a name="423"/>  423: 
<a name="424"/>  424:     %% Precedence with endsymbol operator.
<a name="425"/>  425:     ok = file:write_file(Filename, 
<a name="426"/>  426:          &lt;&lt;&quot;Nonterminals nt. 
<a name="427"/>  427:             Terminals t. 
<a name="428"/>  428:             Rootsymbol nt. 
<a name="429"/>  429:             Endsymbol e.
<a name="430"/>  430:             nt -&gt; t.
<a name="431"/>  431:             Unary 100 e.&quot;&gt;&gt;),
<a name="432"/>  432:     {error,[{_,[{{6,23},yecc,{precedence_op_is_endsymbol,e}}]}],[]} =
<a name="433"/>  433:         yecc:file(Filename, Ret),
<a name="434"/>  434: 
<a name="435"/>  435:     %% Duplicated precedence.
<a name="436"/>  436:     ok = file:write_file(Filename, &lt;&lt;&quot;
<a name="437"/>  437:             Nonterminals nt. 
<a name="438"/>  438:             Terminals t '+'. 
<a name="439"/>  439:             Rootsymbol nt. 
<a name="440"/>  440:             nt -&gt; t '+' nt.
<a name="441"/>  441:             Left 100 '+'.
<a name="442"/>  442:             Right 200 t.
<a name="443"/>  443:             Left 200 '+'.
<a name="444"/>  444:             Left 200 '+'.
<a name="445"/>  445:             Right 200 t.&quot;&gt;&gt;),
<a name="446"/>  446:     {error,[{_,[{{8,22},yecc,{duplicate_precedence,'+'}},
<a name="447"/>  447:                 {{9,22},yecc,{duplicate_precedence,'+'}},
<a name="448"/>  448:                 {{10,23},yecc,{duplicate_precedence,t}}]}],
<a name="449"/>  449:            []} = yecc:file(Filename, Ret),
<a name="450"/>  450: 
<a name="451"/>  451:     %% Duplicated nonterminal.
<a name="452"/>  452:     ok = file:write_file(Filename, 
<a name="453"/>  453:          &lt;&lt;&quot;Nonterminals 'n t' 'n t'. Terminals t. 
<a name="454"/>  454:             Rootsymbol 'n t'. 'n t' -&gt; t.&quot;&gt;&gt;),
<a name="455"/>  455:     {ok, _, [{_,[{{1,14},yecc,{duplicate_nonterminal,'n t'}}]}]} =
<a name="456"/>  456:         yecc:file(Filename, Ret),
<a name="457"/>  457:     {ok, _, [{_,[{{1,14},yecc,{duplicate_nonterminal,'n t'}}]}]} =
<a name="458"/>  458:         yecc:file(Filename, [return_warnings, {report, false}]),
<a name="459"/>  459:     {ok, _} = yecc:file(Filename),
<a name="460"/>  460:     {ok, _} = 
<a name="461"/>  461:         yecc:file(Filename, [{report,false}, {return_warnings,false}]),
<a name="462"/>  462: 
<a name="463"/>  463:     %% Duplicated terminal.
<a name="464"/>  464:     ok = file:write_file(Filename, 
<a name="465"/>  465:          &lt;&lt;&quot;Nonterminals nt. Terminals 't t' 't t'. 
<a name="466"/>  466:             Rootsymbol nt. nt -&gt; 't t'.&quot;&gt;&gt;),
<a name="467"/>  467:     {ok, _, [{_,[{{1,28},yecc,{duplicate_terminal,'t t'}}]}]} =
<a name="468"/>  468:        yecc:file(Filename, Ret),
<a name="469"/>  469: 
<a name="470"/>  470:     %% Two Nonterminals declarations.
<a name="471"/>  471:     ok = file:write_file(Filename, 
<a name="472"/>  472:          &lt;&lt;&quot;Nonterminals nt. Terminals t. 
<a name="473"/>  473:             Nonterminals nt2.
<a name="474"/>  474:             Rootsymbol nt2. nt -&gt; t. nt2 -&gt; nt.&quot;&gt;&gt;),
<a name="475"/>  475:     {error,[{_,[{{2,13},yecc,{duplicate_declaration,'Nonterminals'}}]}],
<a name="476"/>  476:            []} = yecc:file(Filename, Ret),
<a name="477"/>  477: 
<a name="478"/>  478:     %% Three Terminals declarations.
<a name="479"/>  479:     ok = file:write_file(Filename, 
<a name="480"/>  480:          &lt;&lt;&quot;Nonterminals nt. Terminals t. 
<a name="481"/>  481:             Terminals t1.
<a name="482"/>  482:             Terminals t1.
<a name="483"/>  483:             Rootsymbol nt. nt -&gt; t t1.&quot;&gt;&gt;),
<a name="484"/>  484:     {error,[{_,[{{2,13},yecc,{duplicate_declaration,'Terminals'}},
<a name="485"/>  485:                 {{3,13},yecc,{duplicate_declaration,'Terminals'}}]}],
<a name="486"/>  486:            []} = yecc:file(Filename, Ret),
<a name="487"/>  487: 
<a name="488"/>  488:     %% Two root symbols.
<a name="489"/>  489:     ok = file:write_file(Filename, 
<a name="490"/>  490:          &lt;&lt;&quot;Nonterminals nt. Terminals t. Rootsymbol t. 
<a name="491"/>  491:             Rootsymbol nt. nt -&gt; t.&quot;&gt;&gt;),
<a name="492"/>  492:     {error,[{_,[{{2,13},yecc,{duplicate_declaration,'Rootsymbol'}}]}],[]} =
<a name="493"/>  493:         yecc:file(Filename, Ret),
<a name="494"/>  494: 
<a name="495"/>  495:     %% Two end symbols.
<a name="496"/>  496:     ok = file:write_file(Filename, 
<a name="497"/>  497:          &lt;&lt;&quot;Nonterminals nt. Terminals t. Rootsymbol t. 
<a name="498"/>  498:             Endsymbol e. 
<a name="499"/>  499:             Endsymbol e. nt -&gt; t.&quot;&gt;&gt;),
<a name="500"/>  500:     {error,[{_,[{{3,13},yecc,{duplicate_declaration,'Endsymbol'}}]}],[]} =
<a name="501"/>  501:         yecc:file(Filename, Ret),
<a name="502"/>  502: 
<a name="503"/>  503:     %% Two end symbols.
<a name="504"/>  504:     ok = file:write_file(Filename, 
<a name="505"/>  505:          &lt;&lt;&quot;Nonterminals nt. Terminals t. Rootsymbol t. 
<a name="506"/>  506:             Expect 1.
<a name="507"/>  507:             Expect 0.
<a name="508"/>  508:             Endsymbol e. nt -&gt; t.&quot;&gt;&gt;),
<a name="509"/>  509:     {error,[{_,[{{3,13},yecc,{duplicate_declaration,'Expect'}}]}],[]} =
<a name="510"/>  510:         yecc:file(Filename, Ret),
<a name="511"/>  511: 
<a name="512"/>  512:     %% Some words should not be used.
<a name="513"/>  513:     ok = file:write_file(Filename, &lt;&lt;&quot;
<a name="514"/>  514:             Terminals '$empty' '$end'.
<a name="515"/>  515:             Nonterminals '$undefined'.
<a name="516"/>  516:             Rootsymbol '$undefined'.
<a name="517"/>  517:             Endsymbol '$end'.
<a name="518"/>  518:             '$undefined' -&gt; '$empty'.
<a name="519"/>  519:           &quot;&gt;&gt;),
<a name="520"/>  520:     {error,[{_,[{{2,23},yecc,{reserved,'$empty'}},
<a name="521"/>  521:                 {{2,32},yecc,{reserved,'$end'}},
<a name="522"/>  522:                 {{3,26},yecc,{reserved,'$undefined'}},
<a name="523"/>  523:                 {{5,23},yecc,{endsymbol_is_terminal,'$end'}}]}],[]} =
<a name="524"/>  524:         yecc:file(Filename, Ret),
<a name="525"/>  525: 
<a name="526"/>  526:     %% Undefined pseudo variable.
<a name="527"/>  527:     ok = file:write_file(Filename,&lt;&lt;&quot;
<a name="528"/>  528:               Nonterminals nt. 
<a name="529"/>  529:               Terminals t.
<a name="530"/>  530:               Rootsymbol nt.
<a name="531"/>  531:               nt -&gt; t : '$2'.
<a name="532"/>  532:           &quot;&gt;&gt;),
<a name="533"/>  533:     {error,[{_,[{{5,25},yecc,{undefined_pseudo_variable,'$2'}}]}],[]} =
<a name="534"/>  534:         yecc:file(Filename, Ret),
<a name="535"/>  535:     
<a name="536"/>  536:     %% Space in module name.
<a name="537"/>  537:     ok = file:write_file(Filename, &lt;&lt;&quot;
<a name="538"/>  538:         Nonterminals list.
<a name="539"/>  539:         Terminals element.
<a name="540"/>  540:         Rootsymbol list.
<a name="541"/>  541: 
<a name="542"/>  542:         list -&gt; element : {single, '$1'}.
<a name="543"/>  543:         list -&gt; list element : {pair, '$1', '$2'}.
<a name="544"/>  544: 
<a name="545"/>  545:         Erlang code.
<a name="546"/>  546: 
<a name="547"/>  547:         -export([t/0]).
<a name="548"/>  548: 
<a name="549"/>  549:         t() -&gt;
<a name="550"/>  550:             L = [{element, 1}, {element, 2}, {element, 3}],
<a name="551"/>  551:             {ok,_} = parse(L),
<a name="552"/>  552:             ok.
<a name="553"/>  553:        &quot;&gt;&gt;),
<a name="554"/>  554: 
<a name="555"/>  555:     Parserfile2 = filename:join(Dir, &quot;a \&quot;file\&quot;&quot;),
<a name="556"/>  556:     %% The parser (yeccgramm.yrl) allows many symbol names...
<a name="557"/>  557:     ok = file:write_file(Filename, &lt;&lt;&quot;
<a name="558"/>  558:         Nonterminals Nonterminals Rootsymbol ':' '-&gt;'. 
<a name="559"/>  559:         Terminals Terminals. 
<a name="560"/>  560:         Rootsymbol Rootsymbol. 
<a name="561"/>  561:         Endsymbol e.
<a name="562"/>  562:         Rootsymbol -&gt; Nonterminals ':' '-&gt;'.
<a name="563"/>  563:         Nonterminals -&gt; Terminals.
<a name="564"/>  564:         ':' -&gt; '-&gt;'.
<a name="565"/>  565:         '-&gt;' -&gt; Terminals.
<a name="566"/>  566:        &quot;&gt;&gt;),
<a name="567"/>  567:     {ok, _} = yecc:file(Filename, [{parserfile, Parserfile1}]),
<a name="568"/>  568:     {ok, _} = yecc:file(Filename, [{parserfile, Parserfile1},time]),
<a name="569"/>  569:     {ok,[]} = compile:file(Parserfile1, [basic_validation]),
<a name="570"/>  570: 
<a name="571"/>  571:     Quotes = &lt;&lt;&quot;
<a name="572"/>  572:             Nonterminals 
<a name="573"/>  573:             tail try 17 42 Unused ' unused ' '42' 'fnutt\\'' receive.
<a name="574"/>  574: 
<a name="575"/>  575:             Terminals 
<a name="576"/>  576:             ']' '|' ',' '\&quot;hi\&quot;' 'there\\'' 'you\\'' ACCEPT.
<a name="577"/>  577: 
<a name="578"/>  578:             Rootsymbol 17.
<a name="579"/>  579: 
<a name="580"/>  580:             Endsymbol '$end'.
<a name="581"/>  581: 
<a name="582"/>  582:             17 -&gt; try : '$1':more([\&quot;hi \\\&quot; there\&quot;, '.', 3.14, % $3 , % '$1' is a module
<a name="583"/>  583:                                     -104, ' ', ' a', '-&gt;', $a, $\t]), '$1'.
<a name="584"/>  584: 
<a name="585"/>  585:             try -&gt; tail 'you\\'' 'fnutt\\''.
<a name="586"/>  586: 
<a name="587"/>  587:             'fnutt\\'' -&gt; 'you\\'' ACCEPT.
<a name="588"/>  588: 
<a name="589"/>  589:             '42' -&gt; tail.
<a name="590"/>  590: 
<a name="591"/>  591:             tail -&gt; ']' : 
<a name="592"/>  592:                            (fun(Strange) -&gt; foo end)(apa).
<a name="593"/>  593:             tail -&gt; '|' try ']' : 
<a name="594"/>  594:                            (fun(Strange) -&gt; foo;
<a name="595"/>  595:                                (_) -&gt; 'when' % warning
<a name="596"/>  596:                             end)('ap a', foo),
<a name="597"/>  597:                            %% This line intentionally left blank.
<a name="598"/>  598:                            R = #rec{},
<a name="599"/>  599:                            A = R#rec.a,
<a name="600"/>  600:                            &lt;&lt;\&quot;hi\&quot;&gt;&gt; = &lt;&lt;\&quot;hi\&quot;&gt;&gt;,
<a name="601"/>  601:                            there.
<a name="602"/>  602:             tail -&gt; ',' try tail : {cons,line('$2'),'$2','$3'}.
<a name="603"/>  603: 
<a name="604"/>  604: 
<a name="605"/>  605:             Erlang code.
<a name="606"/>  606: 
<a name="607"/>  607:             -export([t/0]).
<a name="608"/>  608: 
<a name="609"/>  609:             -record(rec, {a}).
<a name="610"/>  610: 
<a name="611"/>  611:             just(Some, Code) -&gt;
<a name="612"/>  612:                 true.
<a name="613"/>  613: 
<a name="614"/>  614:             more(Code) -&gt;
<a name="615"/>  615:                 io:format(\&quot;~p~n\&quot;, [Code]), true.
<a name="616"/>  616: 
<a name="617"/>  617:             line(_) -&gt;
<a name="618"/>  618:                 17.
<a name="619"/>  619: 
<a name="620"/>  620:             t() -&gt;
<a name="621"/>  621:                 ok. % compiled successfully...
<a name="622"/>  622: 
<a name="623"/>  623:              &quot;&gt;&gt;,
<a name="624"/>  624: 
<a name="625"/>  625:     ok = file:write_file(Filename, Quotes),
<a name="626"/>  626:     {ok,_,[{_,
<a name="627"/>  627:             [{{3,25},yecc,{unused_nonterminal,42}},
<a name="628"/>  628:              {{3,28},yecc,{unused_nonterminal,'Unused'}},
<a name="629"/>  629:              {{3,35},yecc,{unused_nonterminal,' unused '}},
<a name="630"/>  630:              {{3,46},yecc,{unused_nonterminal,'42'}},
<a name="631"/>  631:              {{3,61},yecc,{unused_nonterminal,'receive'}},
<a name="632"/>  632:              {{6,25},yecc,{unused_terminal,'&quot;hi&quot;'}},
<a name="633"/>  633:              {{6,32},yecc,{unused_terminal,'there\''}}]}]} =
<a name="634"/>  634:         yecc:file(Filename, Ret),
<a name="635"/>  635: 
<a name="636"/>  636:     Ts = [{quotes, Quotes, default, ok}],
<a name="637"/>  637:     run(Config, Ts),
<a name="638"/>  638: 
<a name="639"/>  639:     %% Non-terminal has no rules, but is unused.
<a name="640"/>  640:     ok = file:write_file(Filename,&lt;&lt;&quot;
<a name="641"/>  641:               Nonterminals nt bad. 
<a name="642"/>  642:               Terminals t. 
<a name="643"/>  643:               Rootsymbol nt. 
<a name="644"/>  644: 
<a name="645"/>  645:               nt -&gt; t : something.
<a name="646"/>  646:           &quot;&gt;&gt;),
<a name="647"/>  647:     {ok,_,[{_,[{{2,31},yecc,{unused_nonterminal,bad}}]}]} =
<a name="648"/>  648:         yecc:file(Filename, Ret),
<a name="649"/>  649: 
<a name="650"/>  650:     %% Non-terminal has no rules and is used.
<a name="651"/>  651:     ok = file:write_file(Filename,&lt;&lt;&quot;
<a name="652"/>  652:               Nonterminals nt bad. 
<a name="653"/>  653:               Terminals t. 
<a name="654"/>  654:               Rootsymbol nt. 
<a name="655"/>  655: 
<a name="656"/>  656:               nt -&gt; t bad : something.
<a name="657"/>  657:           &quot;&gt;&gt;),
<a name="658"/>  658:     {error,[{_,[{{2,31},yecc,{missing_syntax_rule,bad}}]}],[]} =
<a name="659"/>  659:         yecc:file(Filename, Ret),
<a name="660"/>  660: 
<a name="661"/>  661:     %% Warning in Erlang code. With and without file attributes.
<a name="662"/>  662:     ok = file:write_file(Filename,&lt;&lt;&quot;
<a name="663"/>  663:               Nonterminals nt. 
<a name="664"/>  664:               Terminals t. 
<a name="665"/>  665:               Rootsymbol nt. 
<a name="666"/>  666: 
<a name="667"/>  667:               nt -&gt; t : t(17).
<a name="668"/>  668: 
<a name="669"/>  669:               Erlang code.
<a name="670"/>  670: 
<a name="671"/>  671:               t(A) -&gt;
<a name="672"/>  672:                   b.
<a name="673"/>  673:           &quot;&gt;&gt;),
<a name="674"/>  674:     {ok, _, []} = 
<a name="675"/>  675:         yecc:file(Filename, [file_attributes | Ret]),
<a name="676"/>  676:     Opts = [basic_validation, return],
<a name="677"/>  677:     Erlfile = filename:join(Dir, &quot;file.erl&quot;),
<a name="678"/>  678:     {ok,[],[{_,[{{10,17},_,_}]}]} = compile:file(Erlfile, Opts),
<a name="679"/>  679:     {ok, _, []} = 
<a name="680"/>  680:         yecc:file(Filename, [{file_attributes,false} | Ret]),
<a name="681"/>  681:     {ok,[],[{_,[{{4,17},_,_}]}]} = compile:file(Erlfile, Opts),
<a name="682"/>  682: 
<a name="683"/>  683:     file:delete(Parserfile1 ++ &quot;.erl&quot;),
<a name="684"/>  684:     file:delete(Parserfile2 ++ &quot;.erl&quot;),
<a name="685"/>  685:     file:delete(Filename),
<a name="686"/>  686: 
<a name="syntax-last_expr"/><a name="687"/>  687:     ok.
<a name="688"/>  688: 
<a name="compile-1"/><a name="689"/>  689: <b>compile</b>(doc) -&gt;
<a name="690"/>  690:     &quot;Check of compile/3.&quot;;
<a name="691"/>  691: <b>compile</b>(suite) -&gt; [];
<a name="692"/>  692: <b>compile</b>(Config) when is_list(Config) -&gt;
<a name="693"/>  693:     Dir = ?privdir,
<a name="694"/>  694:     Filename = filename:join(Dir, &quot;file.yrl&quot;),
<a name="695"/>  695:     Parserfile = filename:join(Dir, &quot;file.erl&quot;),
<a name="696"/>  696:     ok = file:write_file(Filename, 
<a name="697"/>  697:                                &lt;&lt;&quot;Nonterminals nt. 
<a name="698"/>  698:                                   Terminals t.
<a name="699"/>  699:                                   Rootsymbol nt.
<a name="700"/>  700:                                   nt -&gt; t.&quot;&gt;&gt;),
<a name="701"/>  701:     error = yecc:compile(Filename, &quot;//&quot;, #options{}),
<a name="702"/>  702:     ok = yecc:compile(Filename, Parserfile, #options{}),
<a name="703"/>  703:     file:delete(Parserfile),
<a name="704"/>  704:     file:delete(Filename),
<a name="compile-last_expr"/><a name="705"/>  705:     ok.
<a name="706"/>  706: 
<a name="rules-1"/><a name="707"/>  707: <b>rules</b>(doc) -&gt;
<a name="708"/>  708:     &quot;Check of rules.&quot;;
<a name="709"/>  709: <b>rules</b>(suite) -&gt; [];
<a name="710"/>  710: <b>rules</b>(Config) when is_list(Config) -&gt;
<a name="711"/>  711:     Dir = ?privdir,
<a name="712"/>  712:     Ret = [return, {report, false}],
<a name="713"/>  713:     Filename = filename:join(Dir, &quot;file.yrl&quot;),
<a name="714"/>  714: 
<a name="715"/>  715:     ok = file:write_file(Filename,
<a name="716"/>  716:       &lt;&lt;&quot;Nonterminals nt. Terminals t. Rootsymbol nt. 
<a name="717"/>  717:          nt -&gt; t. nt -&gt; t.&quot;&gt;&gt;),
<a name="718"/>  718:     {error,[{_,[{none,yecc,{conflict,_}}]}],
<a name="719"/>  719:            [{_,[{none,yecc,{conflicts,0,1}}]}]} = 
<a name="720"/>  720:         yecc:file(Filename, [return, report]),
<a name="721"/>  721: 
<a name="722"/>  722:     ok = file:write_file(Filename, &lt;&lt;&quot;
<a name="723"/>  723:                 Nonterminals A B E.
<a name="724"/>  724:                 Terminals c d f x y.
<a name="725"/>  725:                 Rootsymbol A.
<a name="726"/>  726: 
<a name="727"/>  727:                 A -&gt; B c d.
<a name="728"/>  728:                 A -&gt; E c f.
<a name="729"/>  729:                 B -&gt; x y.
<a name="730"/>  730:                 E -&gt; x y.
<a name="731"/>  731:                 &quot;&gt;&gt;),
<a name="732"/>  732:     {error,[{_,[{none,yecc,{conflict,_}}]}],
<a name="733"/>  733:            [{_,[{none,yecc,{conflicts,0,1}}]}]} = 
<a name="734"/>  734:         yecc:file(Filename, Ret),
<a name="735"/>  735: 
<a name="736"/>  736:     ok = file:write_file(Filename,&lt;&lt;&quot;
<a name="737"/>  737:               Terminals t.
<a name="738"/>  738:               Nonterminals nt.
<a name="739"/>  739:               Rootsymbol nt.
<a name="740"/>  740:               nt -&gt; '$empty' : '$1'.
<a name="741"/>  741:               nt -&gt; t.
<a name="742"/>  742:           &quot;&gt;&gt;),
<a name="743"/>  743:     {error,[{_,[{{5,32},yecc,{undefined_pseudo_variable,'$1'}}]}],[]} =
<a name="744"/>  744:         yecc:file(Filename, Ret),
<a name="745"/>  745:     
<a name="746"/>  746:     ok = file:write_file(Filename,&lt;&lt;&quot;
<a name="747"/>  747:               Terminals t.
<a name="748"/>  748:               Nonterminals nt.
<a name="749"/>  749:               Rootsymbol nt.
<a name="750"/>  750:               nt -&gt; '$empty' : '$0'.
<a name="751"/>  751:               nt -&gt; t.
<a name="752"/>  752:           &quot;&gt;&gt;),
<a name="753"/>  753:     {error,[{_,[{{5,32},yecc,{undefined_pseudo_variable,'$0'}}]}],[]} =
<a name="754"/>  754:         yecc:file(Filename, Ret),
<a name="755"/>  755: 
<a name="756"/>  756:     file:delete(Filename),
<a name="757"/>  757:     
<a name="758"/>  758:     %% No precedences.
<a name="759"/>  759:     Ts = [{rules_1,&lt;&lt;&quot;
<a name="760"/>  760:               Nonterminals exp.
<a name="761"/>  761:               Terminals number '*' '+' '(' ')'.
<a name="762"/>  762:               Rootsymbol exp.
<a name="763"/>  763: 
<a name="764"/>  764:               exp -&gt; exp '+' exp : {plus,'$1','$3'}.
<a name="765"/>  765:               exp -&gt; exp '*' exp : {times,'$1','$3'}.
<a name="766"/>  766:               exp -&gt; number : element(2, '$1').
<a name="767"/>  767:               exp -&gt; '(' exp ')' : '$2'.
<a name="768"/>  768: 
<a name="769"/>  769:               Erlang code.
<a name="770"/>  770: 
<a name="771"/>  771:               -export([t/0]).
<a name="772"/>  772: 
<a name="773"/>  773:               t() -&gt;
<a name="774"/>  774:                   {ok, {times, 1, {plus, 3, 5}}} = 
<a name="775"/>  775:                     parse([{number,1}, {'*',2}, {number,3}, 
<a name="776"/>  776:                                        {'+',4}, {number,5}]),
<a name="777"/>  777:                   ok.
<a name="778"/>  778:           &quot;&gt;&gt;,
<a name="779"/>  779:          default,
<a name="780"/>  780:          ok}],
<a name="781"/>  781:     run(Config, Ts),
<a name="rules-last_expr"/><a name="782"/>  782:     ok.
<a name="783"/>  783: 
<a name="784"/>  784: 
<a name="expect-1"/><a name="785"/>  785: <b>expect</b>(doc) -&gt;
<a name="786"/>  786:     &quot;Check of expect.&quot;;
<a name="787"/>  787: <b>expect</b>(suite) -&gt; [];
<a name="788"/>  788: <b>expect</b>(Config) when is_list(Config) -&gt;
<a name="789"/>  789:     Dir = ?privdir,
<a name="790"/>  790:     Ret = [return, {report, true}],
<a name="791"/>  791:     Filename = filename:join(Dir, &quot;file.yrl&quot;),
<a name="792"/>  792: 
<a name="793"/>  793:     ok = file:write_file(Filename, &lt;&lt;&quot;
<a name="794"/>  794:                 Nonterminals e. 
<a name="795"/>  795:                 Terminals i t else. 
<a name="796"/>  796:                 Rootsymbol e. 
<a name="797"/>  797:                 Expect a.
<a name="798"/>  798: 
<a name="799"/>  799:                 e -&gt; i e t e.
<a name="800"/>  800:                 e -&gt; i e t e else e.
<a name="801"/>  801:                 &quot;&gt;&gt;),
<a name="802"/>  802:     {error,[{_,[{{5,24},yecc,{bad_expect,a}}]}],[]} =
<a name="803"/>  803:         yecc:file(Filename, Ret),
<a name="804"/>  804: 
<a name="805"/>  805:     ok = file:write_file(Filename, &lt;&lt;&quot;
<a name="806"/>  806:                 Nonterminals e. 
<a name="807"/>  807:                 Terminals i t else. 
<a name="808"/>  808:                 Rootsymbol e. 
<a name="809"/>  809:                 Expect 1.
<a name="810"/>  810: 
<a name="811"/>  811:                 e -&gt; i e t e.
<a name="812"/>  812:                 e -&gt; i e t e else e.
<a name="813"/>  813:                 &quot;&gt;&gt;),
<a name="814"/>  814:     {ok, _, []} = yecc:file(Filename, Ret),
<a name="815"/>  815: 
<a name="816"/>  816:     ok = file:write_file(Filename, &lt;&lt;&quot;
<a name="817"/>  817:                 Nonterminals e. 
<a name="818"/>  818:                 Terminals i t else. 
<a name="819"/>  819:                 Rootsymbol e. 
<a name="820"/>  820:                 Expect 2.
<a name="821"/>  821: 
<a name="822"/>  822:                 e -&gt; i e t e.
<a name="823"/>  823:                 e -&gt; i e t e else e.
<a name="824"/>  824:                 &quot;&gt;&gt;),
<a name="825"/>  825:     {ok, _, [{_,[{none,yecc,{conflicts,1,0}}]}]} = 
<a name="826"/>  826:         yecc:file(Filename, Ret),
<a name="827"/>  827: 
<a name="828"/>  828:     ok = file:write_file(Filename, &lt;&lt;&quot;
<a name="829"/>  829:                 Nonterminals e. 
<a name="830"/>  830:                 Terminals i t else. 
<a name="831"/>  831:                 Rootsymbol e. 
<a name="832"/>  832:                 Expect -2.
<a name="833"/>  833: 
<a name="834"/>  834:                 e -&gt; i e t e.
<a name="835"/>  835:                 e -&gt; i e t e else e.
<a name="836"/>  836:                 &quot;&gt;&gt;),
<a name="837"/>  837:     {error,[{_,[{{5,24},yecc,{error,_yeccparser,_}}]}],[]} =
<a name="838"/>  838:         yecc:file(Filename, Ret),
<a name="839"/>  839: 
<a name="840"/>  840:     %% States N. An undocumented declaration used for testing.
<a name="841"/>  841:     ok = file:write_file(Filename, &lt;&lt;&quot;
<a name="842"/>  842:                 Nonterminals nt. 
<a name="843"/>  843:                 Terminals t.
<a name="844"/>  844:                 Rootsymbol nt.
<a name="845"/>  845:                 States 100.
<a name="846"/>  846:                 nt -&gt; t.&quot;&gt;&gt;),
<a name="847"/>  847:     {ok,_,[{_, [{none,yecc,{n_states,100,3}}]}]} = 
<a name="848"/>  848:         yecc:file(Filename, Ret),
<a name="849"/>  849:     
<a name="850"/>  850:     ok = file:write_file(Filename, &lt;&lt;&quot;
<a name="851"/>  851:                 Nonterminals nt. 
<a name="852"/>  852:                 Terminals t.
<a name="853"/>  853:                 Rootsymbol nt.
<a name="854"/>  854:                 States bad.
<a name="855"/>  855:                 nt -&gt; t.&quot;&gt;&gt;),
<a name="856"/>  856:     {error,[{_,[{{5,24},yecc,{bad_states,bad}}]}],[]} =
<a name="857"/>  857:         yecc:file(Filename, Ret),
<a name="858"/>  858:     
<a name="859"/>  859:     file:delete(Filename),
<a name="expect-last_expr"/><a name="860"/>  860:     ok.
<a name="861"/>  861: 
<a name="conflicts-1"/><a name="862"/>  862: <b>conflicts</b>(doc) -&gt;
<a name="863"/>  863:     &quot;Shift/reduce and reduce/reduce conflicts.&quot;;
<a name="864"/>  864: <b>conflicts</b>(suite) -&gt; [];
<a name="865"/>  865: <b>conflicts</b>(Config) when is_list(Config) -&gt;
<a name="866"/>  866:     Dir = ?privdir,
<a name="867"/>  867:     Ret = [return, {report, true}],
<a name="868"/>  868:     Filename = filename:join(Dir, &quot;file.yrl&quot;),
<a name="869"/>  869: 
<a name="870"/>  870:     ok = file:write_file(Filename, &lt;&lt;&quot;
<a name="871"/>  871:             Nonterminals S List Tuple Elements Element.
<a name="872"/>  872:             Terminals '{' '}' '[' ']' ',' nil e.
<a name="873"/>  873:             Rootsymbol S. 
<a name="874"/>  874: 
<a name="875"/>  875:             S -&gt; '$empty' : empty.
<a name="876"/>  876:             S -&gt; List : '$1'.
<a name="877"/>  877: 
<a name="878"/>  878:             List -&gt; '$empty' : [].
<a name="879"/>  879:             List -&gt; nil : [].
<a name="880"/>  880:             List -&gt; '[' Tuple ']' : {list, '$2'}.
<a name="881"/>  881: 
<a name="882"/>  882:             Tuple -&gt; '$empty' : {}.
<a name="883"/>  883:             Tuple -&gt; '{' '}' : {}.
<a name="884"/>  884:             Tuple -&gt; '{' Elements '}' : {tuple, '$2'}.
<a name="885"/>  885: 
<a name="886"/>  886:             Elements -&gt; '$empty' : none.
<a name="887"/>  887:             Elements -&gt; Elements ',' Element : {elements, '$3', '$1'}.
<a name="888"/>  888:             Elements -&gt; Element : '$1'.
<a name="889"/>  889: 
<a name="890"/>  890:             Element -&gt; List : '$1'.
<a name="891"/>  891:             Element -&gt; Tuple : '$1'.
<a name="892"/>  892:             Element -&gt; e : '$1'.
<a name="893"/>  893:            &quot;&gt;&gt;),
<a name="894"/>  894:     {error,[{_,_}],[{_,[{none,yecc,{conflicts,1,5}}]}]} = 
<a name="895"/>  895:         yecc:file(Filename, Ret),
<a name="896"/>  896: 
<a name="897"/>  897:     %% Can easily be resolved (but don't do it!).
<a name="898"/>  898:     ok = file:write_file(Filename, &lt;&lt;&quot;
<a name="899"/>  899:             Nonterminals S List Tuple Elements Element.
<a name="900"/>  900:             Terminals '{' '}' '[' ']' ',' nil e.
<a name="901"/>  901:             Rootsymbol S. 
<a name="902"/>  902: 
<a name="903"/>  903:             Right 100 List.
<a name="904"/>  904: 
<a name="905"/>  905:             S -&gt; '$empty' : empty.
<a name="906"/>  906:             S -&gt; List : '$1'.
<a name="907"/>  907: 
<a name="908"/>  908:             List -&gt; '$empty' : [].
<a name="909"/>  909:             List -&gt; nil : [].
<a name="910"/>  910:             List -&gt; '[' Tuple ']' : {list, '$2'}.
<a name="911"/>  911: 
<a name="912"/>  912:             Tuple -&gt; '$empty' : {}.
<a name="913"/>  913:             Tuple -&gt; '{' '}' : {}.
<a name="914"/>  914:             Tuple -&gt; '{' Elements '}' : {tuple, '$2'}.
<a name="915"/>  915: 
<a name="916"/>  916:             Elements -&gt; '$empty' : none.
<a name="917"/>  917:             Elements -&gt; Elements ',' Element : {elements, '$3', '$1'}.
<a name="918"/>  918:             Elements -&gt; Element : '$1'.
<a name="919"/>  919: 
<a name="920"/>  920:             Element -&gt; List : '$1'.
<a name="921"/>  921:             Element -&gt; Tuple : '$1'.
<a name="922"/>  922:             Element -&gt; e : '$1'.
<a name="923"/>  923:            &quot;&gt;&gt;),
<a name="924"/>  924:     {ok, _, []} = 
<a name="925"/>  925:         yecc:file(Filename, Ret),
<a name="926"/>  926: 
<a name="927"/>  927:     file:delete(Filename),
<a name="conflicts-last_expr"/><a name="928"/>  928:     ok.
<a name="929"/>  929: 
<a name="deterministic-1"/><a name="930"/>  930: <b>deterministic</b>(doc) -&gt;
<a name="931"/>  931:     &quot;Check yecc respects the +deterministic flag.&quot;;
<a name="932"/>  932: <b>deterministic</b>(suite) -&gt; [];
<a name="933"/>  933: <b>deterministic</b>(Config) when is_list(Config) -&gt;
<a name="934"/>  934:     Dir = ?privdir,
<a name="935"/>  935:     Filename = filename:join(Dir, &quot;file.yrl&quot;),
<a name="936"/>  936:     Parserfile = filename:join(Dir, &quot;file.erl&quot;),
<a name="937"/>  937:     ok = file:write_file(Filename,
<a name="938"/>  938:                                &lt;&lt;&quot;Nonterminals nt.
<a name="939"/>  939:                                   Terminals t.
<a name="940"/>  940:                                   Rootsymbol nt.
<a name="941"/>  941:                                   nt -&gt; t.&quot;&gt;&gt;),
<a name="942"/>  942: 
<a name="943"/>  943:     %% Generated yecc parsers need to include the yeccpre.hrl
<a name="944"/>  944:     %% header file, so we'll get a -file attribute corresponding
<a name="945"/>  945:     %% to that include. In deterministic mode, that include should
<a name="946"/>  946:     %% only use the basename, &quot;yeccpre.hrl&quot;, but otherwise, it should
<a name="947"/>  947:     %% contain the full path.
<a name="948"/>  948: 
<a name="949"/>  949:     %% Matches when OTP is not installed (e.g. /lib/parsetools/include/yeccpre.hrl)
<a name="950"/>  950:     %% and when it is (e.g. /lib/parsetools-2.3.2/include/yeccpre.hrl)
<a name="951"/>  951:     AbsolutePathSuffix = &quot;/lib/parsetools.*/include/yeccpre\.hrl&quot;,
<a name="952"/>  952: 
<a name="953"/>  953:     ok = yecc:compile(Filename, Parserfile, #options{specific=[deterministic]}),
<a name="954"/>  954:     {ok, FormsDet} = epp:parse_file(Parserfile,[]),
<a name="955"/>  955:     ?assertMatch(false, search_for_file_attr(AbsolutePathSuffix, FormsDet)),
<a name="956"/>  956:     ?assertMatch({value, _}, search_for_file_attr(&quot;yeccpre\.hrl&quot;, FormsDet)),
<a name="957"/>  957:     file:delete(Parserfile),
<a name="958"/>  958: 
<a name="959"/>  959:     ok = yecc:compile(Filename, Parserfile, #options{}),
<a name="960"/>  960:     {ok, Forms} = epp:parse_file(Parserfile,[]),
<a name="961"/>  961:     ?assertMatch({value, _}, search_for_file_attr(AbsolutePathSuffix, Forms)),
<a name="962"/>  962:     file:delete(Parserfile),
<a name="963"/>  963: 
<a name="964"/>  964:     file:delete(Filename),
<a name="deterministic-last_expr"/><a name="965"/>  965:     ok.
<a name="966"/>  966: 
<a name="empty-1"/><a name="967"/>  967: <b>empty</b>(doc) -&gt;
<a name="968"/>  968:     &quot;'$empty'.&quot;;
<a name="969"/>  969: <b>empty</b>(suite) -&gt; [];
<a name="970"/>  970: <b>empty</b>(Config) when is_list(Config) -&gt;
<a name="971"/>  971:     Ts = [{empty_1, &lt;&lt;&quot;
<a name="972"/>  972:             Nonterminals nt. 
<a name="973"/>  973:             Terminals t. 
<a name="974"/>  974:             Rootsymbol nt. 
<a name="975"/>  975:             Endsymbol e.
<a name="976"/>  976:             nt -&gt; '$empty': nothing.
<a name="977"/>  977:             nt -&gt; t : something.
<a name="978"/>  978: 
<a name="979"/>  979:             Erlang code.
<a name="980"/>  980: 
<a name="981"/>  981:             -export([t/0]).
<a name="982"/>  982: 
<a name="983"/>  983:             t() -&gt;
<a name="984"/>  984:                 {ok, nothing} = parse([{e,2}]),
<a name="985"/>  985:                 {ok, something} = parse([{t,1},{e,2}]),
<a name="986"/>  986:                 ok.&quot;&gt;&gt;,
<a name="987"/>  987:            default,
<a name="988"/>  988:            ok},
<a name="989"/>  989:           {empty_2, &lt;&lt;&quot;
<a name="990"/>  990:             %% There used to be a bug when it came to the left
<a name="991"/>  991:             %% corners. In this example rule 2 is a prefix of rule 1
<a name="992"/>  992:             %% such that the rule 2 generates $empty but rule 1 does
<a name="993"/>  993:             %% not. The old buggy code seemingly worked well too.
<a name="994"/>  994:             Nonterminals top A B C D.
<a name="995"/>  995:             Terminals t.
<a name="996"/>  996:             Rootsymbol top.
<a name="997"/>  997: 
<a name="998"/>  998:             top -&gt; A B C D : {'$1','$2','$3','$4'}.
<a name="999"/>  999:             top -&gt; A B C : {'$1','$2','$3'}.
<a name="1000"/> 1000: 
<a name="1001"/> 1001:             A -&gt; '$empty' : e.
<a name="1002"/> 1002:             B -&gt; '$empty' : e.
<a name="1003"/> 1003:             C -&gt; '$empty' : e.
<a name="1004"/> 1004: 
<a name="1005"/> 1005:             D -&gt; t : t.
<a name="1006"/> 1006: 
<a name="1007"/> 1007:             Erlang code.
<a name="1008"/> 1008: 
<a name="1009"/> 1009:             -export([t/0]).
<a name="1010"/> 1010: 
<a name="1011"/> 1011:             t() -&gt;
<a name="1012"/> 1012:                 {ok,{e,e,e,t}} = parse([{t, 1}]),
<a name="1013"/> 1013:                 {ok,{e,e,e}} = parse([]),
<a name="1014"/> 1014:                 ok.
<a name="1015"/> 1015:            &quot;&gt;&gt;,
<a name="1016"/> 1016:            default,
<a name="1017"/> 1017:            ok}],
<a name="1018"/> 1018:     run(Config, Ts),
<a name="empty-last_expr"/><a name="1019"/> 1019:     ok.
<a name="1020"/> 1020: 
<a name="prec-1"/><a name="1021"/> 1021: <b>prec</b>(doc) -&gt;
<a name="1022"/> 1022:     &quot;Precedence.&quot;;
<a name="1023"/> 1023: <b>prec</b>(suite) -&gt; [];
<a name="1024"/> 1024: <b>prec</b>(Config) when is_list(Config) -&gt;
<a name="1025"/> 1025:     Dir = ?privdir,
<a name="1026"/> 1026:     Ret = [return, {report, false}],
<a name="1027"/> 1027:     Filename = filename:join(Dir, &quot;file.yrl&quot;),
<a name="1028"/> 1028: 
<a name="1029"/> 1029:     %% Don't know what 'Unary' actually means, but this is how it has
<a name="1030"/> 1030:     %% always worked...
<a name="1031"/> 1031:     ok = file:write_file(Filename, &lt;&lt;&quot;
<a name="1032"/> 1032:                 Nonterminals E.
<a name="1033"/> 1033:                 Terminals '*' '+' '=' integer.
<a name="1034"/> 1034:                 Rootsymbol E.
<a name="1035"/> 1035: 
<a name="1036"/> 1036:                 E -&gt; E '=' E : {op, '=', '$1', '$3'}.
<a name="1037"/> 1037:                 E -&gt; E '*' E : {op, '*', '$1', '$3'}.
<a name="1038"/> 1038:                 E -&gt; E '+' E  : {op, '+', '$1', '$3'}.
<a name="1039"/> 1039:                 E -&gt; integer : '$1'.
<a name="1040"/> 1040: 
<a name="1041"/> 1041:                 Unary 100 '='.
<a name="1042"/> 1042:                 Left 200 '+'.
<a name="1043"/> 1043:                 Left 400 '*'.
<a name="1044"/> 1044:               &quot;&gt;&gt;),
<a name="1045"/> 1045:     {error,[{_,[{none,yecc,{conflict,_}}]}],
<a name="1046"/> 1046:            [{_,[{none,yecc,{conflicts,1,0}}]}]} = 
<a name="1047"/> 1047:         yecc:file(Filename, Ret),
<a name="1048"/> 1048: 
<a name="1049"/> 1049:     Ts = [{prec_1, &lt;&lt;&quot;
<a name="1050"/> 1050:         Nonterminals E Expr Uminus.
<a name="1051"/> 1051:         Terminals '=' '+' '*' '-' '(' ')' integer var dot.
<a name="1052"/> 1052:         Rootsymbol Expr.
<a name="1053"/> 1053: 
<a name="1054"/> 1054:         Expr -&gt; E dot : '$1'.
<a name="1055"/> 1055:         E -&gt; var '=' E : {match, line_of('$1'), '$1', '$3'}.
<a name="1056"/> 1056:         E -&gt; E '+' E : {op, line_of('$1'), '+', '$1', '$3'}.
<a name="1057"/> 1057:         E -&gt; E '-' E : {op, line_of('$1'), '-', '$1', '$3'}.
<a name="1058"/> 1058:         E -&gt; E '*' E : {op, line_of('$1'), '*', '$1', '$3'}.
<a name="1059"/> 1059:         E -&gt; Uminus : '$1'.
<a name="1060"/> 1060:         E -&gt; '(' E ')' : '$2'.
<a name="1061"/> 1061:         E -&gt; integer : '$1'.
<a name="1062"/> 1062: 
<a name="1063"/> 1063:         Uminus -&gt; '-' E :   {op, line_of('$1'), '-', '$2'}.
<a name="1064"/> 1064: 
<a name="1065"/> 1065:         Right 200 '='.
<a name="1066"/> 1066:         Left 300 '+'.
<a name="1067"/> 1067:         Left 300 '-'.
<a name="1068"/> 1068:         Left 400 '*'.
<a name="1069"/> 1069:         Unary 500 Uminus.
<a name="1070"/> 1070: 
<a name="1071"/> 1071:         Erlang code.
<a name="1072"/> 1072: 
<a name="1073"/> 1073:         -export([t/0, t/1]).
<a name="1074"/> 1074: 
<a name="1075"/> 1075:         line_of(Token) -&gt;
<a name="1076"/> 1076:             element(2, Token).
<a name="1077"/> 1077: 
<a name="1078"/> 1078:         t() -&gt;
<a name="1079"/> 1079:             {ok, -56} = t(\&quot;A = (4 + 3) * - 8. \&quot;),
<a name="1080"/> 1080:             {ok, 28} = t(\&quot;A = 4 + B=3 * 8. \&quot;),
<a name="1081"/> 1081:             {ok, 28} = t(\&quot;4 - 3 * - 8. \&quot;),
<a name="1082"/> 1082:             {ok, -20} = t(\&quot;4 - 3 * 8. \&quot;),
<a name="1083"/> 1083:             {ok, 2} = t(\&quot;1 - - 1.\&quot;),
<a name="1084"/> 1084:             ok.
<a name="1085"/> 1085: 
<a name="1086"/> 1086:         t(S) -&gt;
<a name="1087"/> 1087:             case erl_scan:string(S) of
<a name="1088"/> 1088:                 {ok, Tokens, _Line} -&gt;
<a name="1089"/> 1089:                     case parse(Tokens) of
<a name="1090"/> 1090:                         {ok, Expr} -&gt;
<a name="1091"/> 1091:                             case catch erl_eval:expr(Expr, []) of
<a name="1092"/> 1092:                                 {value, Value, _Bs} -&gt;
<a name="1093"/> 1093:                                     {ok, Value};
<a name="1094"/> 1094:                                 {'EXIT', Reason} -&gt;
<a name="1095"/> 1095:                                     {error, Reason}
<a name="1096"/> 1096:                             end;
<a name="1097"/> 1097:                         Error -&gt;
<a name="1098"/> 1098:                             Error
<a name="1099"/> 1099:                     end;
<a name="1100"/> 1100:                 Error -&gt;
<a name="1101"/> 1101:                     Error
<a name="1102"/> 1102:             end.
<a name="1103"/> 1103:         &quot;&gt;&gt;,
<a name="1104"/> 1104:         default,
<a name="1105"/> 1105:         ok},
<a name="1106"/> 1106: 
<a name="1107"/> 1107:           {prec_2, &lt;&lt;&quot;
<a name="1108"/> 1108:         Nonterminals E uminus.
<a name="1109"/> 1109:         Terminals '*' '-' integer.
<a name="1110"/> 1110:         Rootsymbol E.
<a name="1111"/> 1111: 
<a name="1112"/> 1112:         E -&gt; E '-' E : {op, '-', '$1', '$3'}.
<a name="1113"/> 1113:         E -&gt; E '*' E : {op, '*', '$1', '$3'}.
<a name="1114"/> 1114:         E -&gt; uminus: '$1'.
<a name="1115"/> 1115:         E -&gt; integer : '$1'.
<a name="1116"/> 1116: 
<a name="1117"/> 1117:         uminus -&gt; '-' E :  {op, '-', '$2'}.
<a name="1118"/> 1118: 
<a name="1119"/> 1119:         Left 200 '-'.
<a name="1120"/> 1120:         Left 400 '*'.
<a name="1121"/> 1121:         Unary 500 uminus.
<a name="1122"/> 1122: 
<a name="1123"/> 1123:         Erlang code.
<a name="1124"/> 1124: 
<a name="1125"/> 1125:         -export([t/0]).
<a name="1126"/> 1126: 
<a name="1127"/> 1127:         t() -&gt;
<a name="1128"/> 1128:             %% This used to be parsed -(4 * 3), but that has been corrected:
<a name="1129"/> 1129:             {ok,{op,'*',{op,'-',{integer,1,4}},{integer,3,12}}} = 
<a name="1130"/> 1130:                 parse([{'-',0},{integer,1,4},{'*',2},{integer,3,12}]),
<a name="1131"/> 1131: 
<a name="1132"/> 1132:             {ok,{op,'-',{op,'-',{integer,1,4}},{integer,3,12}}} = 
<a name="1133"/> 1133:                 parse([{'-',0},{integer,1,4},{'-',2},{integer,3,12}]),
<a name="1134"/> 1134:             {ok,{op,'*',{op,'-',{op,'-',{integer,2,4}}},{integer,4,12}}} = 
<a name="1135"/> 1135:                 parse([{'-',0},{'-',1},{integer,2,4},{'*',3},{integer,4,12}]),
<a name="1136"/> 1136:             {ok,{op,'-',{integer,1,4},{op,'-',{integer,4,12}}}} = 
<a name="1137"/> 1137:                 parse([{integer,1,4},{'-',2},{'-',3},{integer,4,12}]),
<a name="1138"/> 1138:             ok.
<a name="1139"/> 1139:         &quot;&gt;&gt;,
<a name="1140"/> 1140:         default,
<a name="1141"/> 1141:         ok},
<a name="1142"/> 1142:           {prec_3, &lt;&lt;&quot;
<a name="1143"/> 1143:             Nonterminals nt. 
<a name="1144"/> 1144:             Terminals '(' ')' t op. 
<a name="1145"/> 1145:             Rootsymbol nt. 
<a name="1146"/> 1146: 
<a name="1147"/> 1147:             Nonassoc 100 op.
<a name="1148"/> 1148: 
<a name="1149"/> 1149:             nt -&gt; nt op nt : {'$2', '$1', '$3'}.
<a name="1150"/> 1150:             nt -&gt; '(' nt ')' : '$2'.
<a name="1151"/> 1151:             nt -&gt; t : '$1'.
<a name="1152"/> 1152: 
<a name="1153"/> 1153:             Erlang code.
<a name="1154"/> 1154: 
<a name="1155"/> 1155:             -export([t/0]).
<a name="1156"/> 1156: 
<a name="1157"/> 1157:             t() -&gt;
<a name="1158"/> 1158:                 {error,{4,yecc_test,[\&quot;syntax error before: \&quot;,\&quot;op\&quot;]}} = 
<a name="1159"/> 1159:                     parse([{t,1},{op,2},{t,3},{op,4},{t,5}]),
<a name="1160"/> 1160:                 {ok,{{op,2},{t,1},{{op,5},{t,4},{t,6}}}} = 
<a name="1161"/> 1161:                     parse([{t,1},{op,2},{'(',3},{t,4},{op,5},{t,6},{')',7}]),
<a name="1162"/> 1162:                 ok.
<a name="1163"/> 1163:         &quot;&gt;&gt;,
<a name="1164"/> 1164:         default,
<a name="1165"/> 1165:         ok},
<a name="1166"/> 1166: 
<a name="1167"/> 1167:           {prec_4, &lt;&lt;&quot;
<a name="1168"/> 1168:             Nonterminals E.
<a name="1169"/> 1169:             Terminals '-' '+' '=' id.
<a name="1170"/> 1170:             Rootsymbol E.
<a name="1171"/> 1171: 
<a name="1172"/> 1172:             E -&gt; E '=' E : {op, '=', '$1', '$3'}.
<a name="1173"/> 1173:             E -&gt; E '+' E  : {op, '+', '$1', '$3'}.
<a name="1174"/> 1174:             E -&gt; '-' E : {op, '-', '$2'}.
<a name="1175"/> 1175:             E -&gt; id : '$1'.
<a name="1176"/> 1176: 
<a name="1177"/> 1177:             Nonassoc 100 '='.
<a name="1178"/> 1178:             Right 200 '+' '-'.
<a name="1179"/> 1179: 
<a name="1180"/> 1180:             Erlang code.
<a name="1181"/> 1181: 
<a name="1182"/> 1182:             -export([t/0]).
<a name="1183"/> 1183: 
<a name="1184"/> 1184:             t() -&gt;
<a name="1185"/> 1185:                 {ok,{op,'=',{id,1},{op,'-',{op,'+',{id,4},{id,6}}}}} = 
<a name="1186"/> 1186:                     parse([{id,1},{'=',2},{'-',3},{id,4},{'+',5},{id,6}]),
<a name="1187"/> 1187:                 ok.
<a name="1188"/> 1188: 
<a name="1189"/> 1189:         &quot;&gt;&gt;,
<a name="1190"/> 1190:         default,
<a name="1191"/> 1191:         ok}],
<a name="1192"/> 1192: 
<a name="1193"/> 1193:     run(Config, Ts),
<a name="prec-last_expr"/><a name="1194"/> 1194:     ok.
<a name="1195"/> 1195: 
<a name="yeccpre-1"/><a name="1196"/> 1196: <b>yeccpre</b>(doc) -&gt;
<a name="1197"/> 1197:     &quot;Errors etc. in actions, handled by yeccpre. parse_and_scan.&quot;;
<a name="1198"/> 1198: <b>yeccpre</b>(suite) -&gt; [];
<a name="1199"/> 1199: <b>yeccpre</b>(Config) when is_list(Config) -&gt;
<a name="1200"/> 1200:     Ts = [{error_1, &lt;&lt;&quot;
<a name="1201"/> 1201:             Nonterminals list.
<a name="1202"/> 1202:             Terminals element e.
<a name="1203"/> 1203:             Rootsymbol list.
<a name="1204"/> 1204: 
<a name="1205"/> 1205:             list -&gt; element : {single, '$1'}.
<a name="1206"/> 1206:             list -&gt; list element : throw(error).
<a name="1207"/> 1207:             list -&gt; e : return_error(element(2, '$1'), bad_element).
<a name="1208"/> 1208: 
<a name="1209"/> 1209:             Erlang code.
<a name="1210"/> 1210: 
<a name="1211"/> 1211:             -export([t/0]).
<a name="1212"/> 1212: 
<a name="1213"/> 1213:             t() -&gt;
<a name="1214"/> 1214:                error = (catch parse([{element,1},{element,2}])),
<a name="1215"/> 1215:                {error, {2, _, Mess}} = parse([{element,1},{e,2}]),
<a name="1216"/> 1216:                ok.
<a name="1217"/> 1217:            &quot;&gt;&gt;,
<a name="1218"/> 1218:            default,
<a name="1219"/> 1219:            ok},
<a name="1220"/> 1220: 
<a name="1221"/> 1221:           {error_2, &lt;&lt;&quot;
<a name="1222"/> 1222:             Nonterminals list.
<a name="1223"/> 1223:             Terminals element.
<a name="1224"/> 1224:             Rootsymbol list.
<a name="1225"/> 1225: 
<a name="1226"/> 1226:             list -&gt; element.
<a name="1227"/> 1227: 
<a name="1228"/> 1228:             Erlang code.
<a name="1229"/> 1229: 
<a name="1230"/> 1230:             -export([t/0, scan/1]).
<a name="1231"/> 1231: 
<a name="1232"/> 1232:             scan(How) -&gt;
<a name="1233"/> 1233:                 case How of
<a name="1234"/> 1234:                     thrown -&gt; throw(thrown);
<a name="1235"/> 1235:                     error -&gt; erlang:error(error);
<a name="1236"/> 1236:                     exit -&gt; exit(exit)
<a name="1237"/> 1237:                 end.
<a name="1238"/> 1238: 
<a name="1239"/> 1239:             t() -&gt;
<a name="1240"/> 1240:                 try parse_and_scan({yecc_test, scan, [thrown]})
<a name="1241"/> 1241:                 catch throw: thrown -&gt;
<a name="1242"/> 1242:                         ok
<a name="1243"/> 1243:                 end,
<a name="1244"/> 1244:                 try parse_and_scan({yecc_test, scan, [error]})
<a name="1245"/> 1245:                 catch error: error -&gt;
<a name="1246"/> 1246:                         ok
<a name="1247"/> 1247:                 end,
<a name="1248"/> 1248:                 try parse_and_scan({fun yecc_test:scan/1, [exit]})
<a name="1249"/> 1249:                 catch exit: exit -&gt;
<a name="1250"/> 1250:                         ok
<a name="1251"/> 1251:                 end,
<a name="1252"/> 1252:                 try parse_and_scan({fun scan/1, [thrown]})
<a name="1253"/> 1253:                 catch throw: thrown -&gt;
<a name="1254"/> 1254:                         ok
<a name="1255"/> 1255:                 end,
<a name="1256"/> 1256:                 ok.
<a name="1257"/> 1257:            &quot;&gt;&gt;,
<a name="1258"/> 1258:            default,
<a name="1259"/> 1259:            ok},
<a name="1260"/> 1260: 
<a name="1261"/> 1261:           {error_3, &lt;&lt;&quot;
<a name="1262"/> 1262:             Nonterminals statement.
<a name="1263"/> 1263:             Terminals keyword string.
<a name="1264"/> 1264:             Rootsymbol statement.
<a name="1265"/> 1265: 
<a name="1266"/> 1266:             statement -&gt; keyword string.
<a name="1267"/> 1267: 
<a name="1268"/> 1268:             Erlang code.
<a name="1269"/> 1269: 
<a name="1270"/> 1270:             -export([t/0]).
<a name="1271"/> 1271: 
<a name="1272"/> 1272:             t() -&gt;
<a name="1273"/> 1273:                 %% Never crash in yecctoken_to_string/1 or its helpers,
<a name="1274"/> 1274:                 %% even if when tokens are not in the format that erl_scan
<a name="1275"/> 1275:                 %% produces.
<a name="1276"/> 1276:                 {error, _} = parse([{string, 1, &lt;&lt;\&quot;foo\&quot;&gt;&gt;}]),
<a name="1277"/> 1277:                 ok.
<a name="1278"/> 1278:            &quot;&gt;&gt;,
<a name="1279"/> 1279:            default,
<a name="1280"/> 1280:            ok}],
<a name="1281"/> 1281: 
<a name="1282"/> 1282:     run(Config, Ts),
<a name="yeccpre-last_expr"/><a name="1283"/> 1283:     ok.
<a name="1284"/> 1284: 
<a name="lalr-1"/><a name="1285"/> 1285: <b>lalr</b>(doc) -&gt;
<a name="1286"/> 1286:     &quot;Examples of grammars that are LALR(1) but not SLR(1).&quot;;
<a name="1287"/> 1287: <b>lalr</b>(suite) -&gt; [];
<a name="1288"/> 1288: <b>lalr</b>(Config) when is_list(Config) -&gt;
<a name="1289"/> 1289:     Ts = [{lalr_1, &lt;&lt;&quot;
<a name="1290"/> 1290:             %% http://inst.cs.berkeley.edu/~cs164/lectures/slide14a.pdf
<a name="1291"/> 1291:             %% http://pages.cpsc.ucalgary.ca/~robin/class/411/LR.1.html
<a name="1292"/> 1292:             %% b d . c. Shift or reduce?
<a name="1293"/> 1293:             Nonterminals S A. 
<a name="1294"/> 1294:             Terminals a b c d.
<a name="1295"/> 1295:             Rootsymbol S.
<a name="1296"/> 1296:             S -&gt; A a : {r1,'$1','$2'}.
<a name="1297"/> 1297:             S -&gt; b A c : {r2,'$1','$2','$3'}.
<a name="1298"/> 1298:             S -&gt; d c : {r3,'$1','$2'}.
<a name="1299"/> 1299:             S -&gt; b d a : {r4,'$1','$2','$3'}.
<a name="1300"/> 1300: 
<a name="1301"/> 1301:             A -&gt; d : {r5,'$1'}.
<a name="1302"/> 1302: 
<a name="1303"/> 1303:             Erlang code.
<a name="1304"/> 1304: 
<a name="1305"/> 1305:             -export([t/0]).
<a name="1306"/> 1306: 
<a name="1307"/> 1307:             t() -&gt;
<a name="1308"/> 1308:                %% Reduce!
<a name="1309"/> 1309:                {ok,{r2,{b,1},{r5,{d,2}},{c,3}}} = parse([{b,1},{d,2},{c,3}]),
<a name="1310"/> 1310:                ok.
<a name="1311"/> 1311:            &quot;&gt;&gt;,
<a name="1312"/> 1312:            default,
<a name="1313"/> 1313:            ok},
<a name="1314"/> 1314:          {lalr_2, &lt;&lt;&quot;
<a name="1315"/> 1315:             %% http://www.cs.pitt.edu/~mock/cs2210/lectures/lecture5.pdf
<a name="1316"/> 1316:             Nonterminals S L R. 
<a name="1317"/> 1317:             Terminals '*' id '='.
<a name="1318"/> 1318:             Rootsymbol S.
<a name="1319"/> 1319:             S -&gt; L '=' R : {r1,'$1','$3'}.
<a name="1320"/> 1320:             S -&gt; R : {r2,'$1'}.
<a name="1321"/> 1321: 
<a name="1322"/> 1322:             L -&gt; '*' R : {r3,'$2'}.
<a name="1323"/> 1323:             L -&gt; id : {r4,'$1'}.
<a name="1324"/> 1324: 
<a name="1325"/> 1325:             R -&gt; L : {r5,'$1'}.
<a name="1326"/> 1326: 
<a name="1327"/> 1327:             Erlang code.
<a name="1328"/> 1328: 
<a name="1329"/> 1329:             -export([t/0]).
<a name="1330"/> 1330: 
<a name="1331"/> 1331:             t() -&gt;
<a name="1332"/> 1332:                {ok,{r1,{r3,{r5,{r4,{id,1}}}},{r5,{r4,{id,3}}}}} = 
<a name="1333"/> 1333:                    parse([{'*',0},{id,1},{'=',2},{id,3}]),
<a name="1334"/> 1334:                ok.
<a name="1335"/> 1335:            &quot;&gt;&gt;,
<a name="1336"/> 1336:            default,
<a name="1337"/> 1337:            ok}],
<a name="1338"/> 1338:     run(Config, Ts),
<a name="lalr-last_expr"/><a name="1339"/> 1339:     ok.
<a name="1340"/> 1340: 
<a name="old_yecc-1"/><a name="1341"/> 1341: <b>old_yecc</b>(doc) -&gt;
<a name="1342"/> 1342:     &quot;The old interface yecc:yecc/2,3,4.&quot;;
<a name="1343"/> 1343: <b>old_yecc</b>(suite) -&gt; [];
<a name="1344"/> 1344: <b>old_yecc</b>(Config) when is_list(Config) -&gt;
<a name="1345"/> 1345:     Dir = ?privdir,
<a name="1346"/> 1346:     Filename = filename:join(Dir, &quot;file.yrl&quot;),
<a name="1347"/> 1347:     Parserfile = filename:join(Dir, &quot;file.erl&quot;),
<a name="1348"/> 1348:     Mini = &lt;&lt;&quot;Nonterminals nt. 
<a name="1349"/> 1349:               Terminals t.
<a name="1350"/> 1350:               Rootsymbol nt.
<a name="1351"/> 1351:               nt -&gt; t.&quot;&gt;&gt;,
<a name="1352"/> 1352:     ok = file:write_file(Filename, Mini),
<a name="1353"/> 1353:     {_, _} = yecc:yecc(Filename, Parserfile),
<a name="1354"/> 1354:     {_, _} = yecc:yecc(Filename, Parserfile, true),
<a name="1355"/> 1355:     {_, _} = yecc:yecc(Filename, Parserfile, true),
<a name="1356"/> 1356:     TE = process_flag(trap_exit, true),
<a name="1357"/> 1357:     {'EXIT', error} = 
<a name="1358"/> 1358:         (catch yecc:yecc(Filename, Parserfile, false, Parserfile)),
<a name="1359"/> 1359:     _ = process_flag(trap_exit, TE),
<a name="old_yecc-last_expr"/><a name="1360"/> 1360:     ok.
<a name="1361"/> 1361: 
<a name="other_examples-1"/><a name="1362"/> 1362: <b>other_examples</b>(doc) -&gt;
<a name="1363"/> 1363:     &quot;Misc examples.&quot;;
<a name="1364"/> 1364: <b>other_examples</b>(suite) -&gt; [];
<a name="1365"/> 1365: <b>other_examples</b>(Config) when is_list(Config) -&gt;
<a name="1366"/> 1366:     Ts = [{empty, &lt;&lt;&quot;
<a name="1367"/> 1367:             %% G1 from the 1974 article.
<a name="1368"/> 1368: 
<a name="1369"/> 1369:             Nonterminals LIST ELEMENT.
<a name="1370"/> 1370:             Terminals ',' a b.
<a name="1371"/> 1371:             Rootsymbol LIST.
<a name="1372"/> 1372: 
<a name="1373"/> 1373:             LIST -&gt; LIST ',' ELEMENT : {'$1', '$3'}.
<a name="1374"/> 1374:             LIST -&gt; ELEMENT : '$1'.
<a name="1375"/> 1375: 
<a name="1376"/> 1376:             ELEMENT -&gt; a : '$1'.
<a name="1377"/> 1377:             ELEMENT -&gt; b : '$1'.
<a name="1378"/> 1378: 
<a name="1379"/> 1379:             Erlang code.
<a name="1380"/> 1380: 
<a name="1381"/> 1381:             -export([t/0]).
<a name="1382"/> 1382: 
<a name="1383"/> 1383:             t() -&gt;
<a name="1384"/> 1384:                 L = [{a, 1}, {',', 2}, {b, 3}],
<a name="1385"/> 1385:                 {ok,{{a,1},{b,3}}} = parse(L),
<a name="1386"/> 1386:                 ok.
<a name="1387"/> 1387:             &quot;&gt;&gt;,
<a name="1388"/> 1388:            default,
<a name="1389"/> 1389:            ok}],
<a name="1390"/> 1390:     run(Config, Ts),
<a name="other_examples-last_expr"/><a name="1391"/> 1391:     ok.
<a name="1392"/> 1392: 
<a name="1393"/> 1393: 
<a name="otp_5369-1"/><a name="1394"/> 1394: <b>otp_5369</b>(doc) -&gt;
<a name="1395"/> 1395:     &quot;OTP-5369. A bug in parse_and_scan reported on erlang questions.&quot;;
<a name="1396"/> 1396: <b>otp_5369</b>(suite) -&gt; [];
<a name="1397"/> 1397: <b>otp_5369</b>(Config) when is_list(Config) -&gt;
<a name="1398"/> 1398:     Ts = [{otp_5369,&lt;&lt;&quot;
<a name="1399"/> 1399:         Nonterminals list.
<a name="1400"/> 1400:         Terminals element.
<a name="1401"/> 1401:         Rootsymbol list.
<a name="1402"/> 1402: 
<a name="1403"/> 1403:         list -&gt; element : {single, '$1'}.
<a name="1404"/> 1404:         list -&gt; list element : {pair, '$1', '$2'}.
<a name="1405"/> 1405: 
<a name="1406"/> 1406:         Erlang code.
<a name="1407"/> 1407: 
<a name="1408"/> 1408:         -export([t/0, scan/1]).
<a name="1409"/> 1409: 
<a name="1410"/> 1410:         scan(Lexer) -&gt;
<a name="1411"/> 1411:             Lexer ! {scan, self()},
<a name="1412"/> 1412:             receive
<a name="1413"/> 1413:                 {ok, Lexer, [Token], Position} -&gt;
<a name="1414"/> 1414:                     {ok, [Token], Position};
<a name="1415"/> 1415:                 {eof, Lexer, Position} -&gt;
<a name="1416"/> 1416:                     {eof, Position}
<a name="1417"/> 1417:             end.
<a name="1418"/> 1418: 
<a name="1419"/> 1419:         make_scanner(L) -&gt;
<a name="1420"/> 1420:             spawn_link(fun() -&gt;
<a name="1421"/> 1421:                                loop(L)
<a name="1422"/> 1422:                        end).
<a name="1423"/> 1423: 
<a name="1424"/> 1424:         loop([]) -&gt;
<a name="1425"/> 1425:             receive
<a name="1426"/> 1426:                 {scan, Pid} -&gt;
<a name="1427"/> 1427:                     Pid ! {eof, self(), 1000}
<a name="1428"/> 1428:             end;
<a name="1429"/> 1429:         loop([Token = {_, P}|T]) -&gt;
<a name="1430"/> 1430:             receive
<a name="1431"/> 1431:                 {scan, Pid} -&gt;
<a name="1432"/> 1432:                     Pid ! {ok, self(), [Token], P},
<a name="1433"/> 1433:                     loop(T)
<a name="1434"/> 1434:             end.
<a name="1435"/> 1435: 
<a name="1436"/> 1436:         t(L) -&gt;
<a name="1437"/> 1437:             case parse_and_scan({yecc_test, scan, [make_scanner(L)]}) of
<a name="1438"/> 1438:                 {ok, _Result} -&gt;
<a name="1439"/> 1439:                     ok;
<a name="1440"/> 1440:                 {error, {_LineNumber, Module, Message}} -&gt;
<a name="1441"/> 1441:                     _M = apply(Module, format_error, [Message]),
<a name="1442"/> 1442:                     not_ok
<a name="1443"/> 1443:             end.
<a name="1444"/> 1444: 
<a name="1445"/> 1445:         t() -&gt;
<a name="1446"/> 1446:             not_ok = t([]), %% This test has been added afterwards.
<a name="1447"/> 1447:                             %% OTP-5369 did not fix this bug!
<a name="1448"/> 1448:             L = [{element, 1},
<a name="1449"/> 1449:                  {element, 2},
<a name="1450"/> 1450:                  {element, 3}],
<a name="1451"/> 1451:             t(L).
<a name="1452"/> 1452:       &quot;&gt;&gt;,
<a name="1453"/> 1453:       default,
<a name="1454"/> 1454:       ok}],
<a name="1455"/> 1455:     run(Config, Ts),
<a name="otp_5369-last_expr"/><a name="1456"/> 1456:     ok.
<a name="1457"/> 1457: 
<a name="otp_6362-1"/><a name="1458"/> 1458: <b>otp_6362</b>(doc) -&gt;
<a name="1459"/> 1459:     &quot;OTP-6362. A precedence declaration bug reported on erlang questions.&quot;;
<a name="1460"/> 1460: <b>otp_6362</b>(suite) -&gt; [];
<a name="1461"/> 1461: <b>otp_6362</b>(Config) when is_list(Config) -&gt;
<a name="1462"/> 1462:     Ts = [{otp_6362_1,&lt;&lt;&quot;
<a name="1463"/> 1463:         Nonterminals cmp compare expr.
<a name="1464"/> 1464:         Terminals 'string' '&gt;' '='.
<a name="1465"/> 1465:         Rootsymbol compare.
<a name="1466"/> 1466:         Nonassoc 250 cmp.
<a name="1467"/> 1467:         compare -&gt; expr cmp expr     : {cmp, '$2', '$1', '$3'}.
<a name="1468"/> 1468:         compare -&gt; expr              : {cmp, '==', '$1', {string, \&quot;TRUE\&quot;}}.
<a name="1469"/> 1469:         cmp -&gt; '&gt;' '='               : '&gt;='.
<a name="1470"/> 1470:         cmp -&gt; '&gt;'                   : '&gt;'.
<a name="1471"/> 1471:         expr -&gt; 'string'             : '$1'.
<a name="1472"/> 1472: 
<a name="1473"/> 1473:         Erlang code.
<a name="1474"/> 1474: 
<a name="1475"/> 1475:         -export([t/0]).
<a name="1476"/> 1476: 
<a name="1477"/> 1477:         t() -&gt;
<a name="1478"/> 1478:             {ok,{cmp,'&gt;',{string,1},{string,3}}} = 
<a name="1479"/> 1479:                 parse([{string,1}, {'&gt;', 2}, {string,3}]),
<a name="1480"/> 1480:             ok.
<a name="1481"/> 1481:       &quot;&gt;&gt;,
<a name="1482"/> 1482:       default,
<a name="1483"/> 1483:       ok}],
<a name="1484"/> 1484:     run(Config, Ts),
<a name="1485"/> 1485: 
<a name="1486"/> 1486:     Dir = ?privdir,
<a name="1487"/> 1487:     %% Report errors. Very simple test of format_error/1.
<a name="1488"/> 1488:     Ret = [return, {report, true}],
<a name="1489"/> 1489:     Filename = filename:join(Dir, &quot;file.yrl&quot;),
<a name="1490"/> 1490: 
<a name="1491"/> 1491:     %% An error introduced due to this ticket. Terminals can be
<a name="1492"/> 1492:     %% assigned conflicting precedences, which cannot be resolved.
<a name="1493"/> 1493:     ok = file:write_file(Filename,&lt;&lt;&quot;
<a name="1494"/> 1494:             Nonterminals cmp compare expr fopp.
<a name="1495"/> 1495:             Terminals string '&gt;' '='.
<a name="1496"/> 1496:             Rootsymbol compare.
<a name="1497"/> 1497:             Nonassoc 250 cmp.
<a name="1498"/> 1498:             Left 300 '&gt;'.
<a name="1499"/> 1499: 
<a name="1500"/> 1500:             compare -&gt; expr cmp expr	: {cmp, '$2', '$1', '$3'}.
<a name="1501"/> 1501:             compare -&gt; expr fopp expr	: {cmp, '$2', '$1', '$3'}.
<a name="1502"/> 1502:             compare -&gt; expr '=' expr        : '$1'.
<a name="1503"/> 1503:             compare -&gt; expr 		: {cmp, '==', '$1', {string, foo}}.
<a name="1504"/> 1504:             cmp -&gt; '&gt;' '='			: '&gt;='.
<a name="1505"/> 1505:             cmp -&gt; '&gt;'			: '&gt;'.
<a name="1506"/> 1506:             expr -&gt; string  		: '$1'.
<a name="1507"/> 1507: 
<a name="1508"/> 1508:             fopp -&gt; '&gt;' '='			: '&gt;='.
<a name="1509"/> 1509:             fopp -&gt; '&gt;'			: '&gt;'.&quot;&gt;&gt;),
<a name="1510"/> 1510: 
<a name="1511"/> 1511:     Ret = [return, {report, true}],
<a name="1512"/> 1512:     {error,[{_,[{none,yecc,{conflict,_}}]}],[]} = 
<a name="1513"/> 1513:         yecc:file(Filename, Ret),
<a name="1514"/> 1514:     file:delete(Filename),
<a name="otp_6362-last_expr"/><a name="1515"/> 1515:     ok.
<a name="1516"/> 1516: 
<a name="my_yeccpre-0"/><a name="1517"/> 1517: <b>my_yeccpre</b>() -&gt;
<a name="1518"/> 1518:   %% Version 1.1.
<a name="my_yeccpre-last_expr"/><a name="1519"/> 1519: <b>  &lt;&lt;&quot;parse</b>(Tokens) -&gt;
<a name="1520"/> 1520:          yeccpars0(Tokens, false).
<a name="1521"/> 1521: 
<a name="1522"/> 1522:      parse_and_scan({F, A}) -&gt; % Fun or {M, F}
<a name="1523"/> 1523:          yeccpars0([], {F, A});
<a name="1524"/> 1524:      parse_and_scan({M, F, A}) -&gt;
<a name="1525"/> 1525:          yeccpars0([], {{M, F}, A}).
<a name="1526"/> 1526: 
<a name="1527"/> 1527:      format_error(Message) -&gt;
<a name="1528"/> 1528:          case io_lib:deep_char_list(Message) of
<a name="1529"/> 1529:              true -&gt;
<a name="1530"/> 1530:                  Message;
<a name="1531"/> 1531:              _ -&gt;
<a name="1532"/> 1532:                  io_lib:write(Message)
<a name="1533"/> 1533:          end.
<a name="1534"/> 1534: 
<a name="1535"/> 1535:      % To be used in grammar files to throw an error message to the parser
<a name="1536"/> 1536:      % toplevel. Doesn't have to be exported!
<a name="1537"/> 1537:      -compile({nowarn_unused_function,{return_error,2}}).
<a name="1538"/> 1538:      return_error(Line, Message) -&gt;
<a name="1539"/> 1539:          throw({error, {Line, yecc_test, Message}}).
<a name="1540"/> 1540: 
<a name="1541"/> 1541:      yeccpars0(Tokens, MFA) -&gt;
<a name="1542"/> 1542:          try yeccpars1(Tokens, MFA, 0, [], [])
<a name="1543"/> 1543:          catch 
<a name="1544"/> 1544:              throw: {error, {_Line, yecc_test, _M}} = Error -&gt; 
<a name="1545"/> 1545:                         Error % probably from return_error/1
<a name="1546"/> 1546:          end.
<a name="1547"/> 1547: 
<a name="1548"/> 1548:      % Don't change yeccpars1/6 too much, it is called recursively by yeccpars2/8!
<a name="1549"/> 1549:     yeccpars1([Token | Tokens], Tokenizer, State, States, Vstack) -&gt;
<a name="1550"/> 1550:         yeccpars2(State, element(1, Token), States, Vstack, Token, Tokens,
<a name="1551"/> 1551:                   Tokenizer);
<a name="1552"/> 1552:     yeccpars1([], {F, A}, State, States, Vstack) -&gt;
<a name="1553"/> 1553:         case apply(F, A) of
<a name="1554"/> 1554:             {ok, Tokens, _Endline} -&gt;
<a name="1555"/> 1555:                 yeccpars1(Tokens, {F, A}, State, States, Vstack);
<a name="1556"/> 1556:             {eof, _Endline} -&gt;
<a name="1557"/> 1557:                 yeccpars1([], false, State, States, Vstack);
<a name="1558"/> 1558:             {error, Descriptor, _Endline} -&gt;
<a name="1559"/> 1559:                 {error, Descriptor}
<a name="1560"/> 1560:         end;
<a name="1561"/> 1561:     yeccpars1([], false, State, States, Vstack) -&gt;
<a name="1562"/> 1562:         yeccpars2(State, '$end', States, Vstack, {'$end', 999999}, [], false).
<a name="1563"/> 1563: 
<a name="1564"/> 1564:      % For internal use only.
<a name="1565"/> 1565:      yeccerror(Token) -&gt;
<a name="1566"/> 1566:          {error,
<a name="1567"/> 1567:           {element(2, Token), yecc_test,
<a name="1568"/> 1568:            [\&quot;syntax error before: \&quot;, yecctoken2string(Token)]}}.
<a name="1569"/> 1569: 
<a name="1570"/> 1570:      yecctoken2string({atom, _, A}) -&gt; io_lib:write(A);
<a name="1571"/> 1571:      yecctoken2string({integer,_,N}) -&gt; io_lib:write(N);
<a name="1572"/> 1572:      yecctoken2string({float,_,F}) -&gt; io_lib:write(F);
<a name="1573"/> 1573:      yecctoken2string({char,_,C}) -&gt; io_lib:write_char(C);
<a name="1574"/> 1574:      yecctoken2string({var,_,V}) -&gt; io_lib:format('~s', [V]);
<a name="1575"/> 1575:      yecctoken2string({string,_,S}) -&gt; io_lib:write_string(S);
<a name="1576"/> 1576:      yecctoken2string({reserved_symbol, _, A}) -&gt; io_lib:format('~w', [A]);
<a name="1577"/> 1577:      yecctoken2string({_Cat, _, Val}) -&gt; io_lib:format('~w', [Val]);
<a name="1578"/> 1578:      yecctoken2string({'dot', _}) -&gt; io_lib:format('~w', ['.']);
<a name="1579"/> 1579:      yecctoken2string({'$end', _}) -&gt;
<a name="1580"/> 1580:          [];
<a name="1581"/> 1581:      yecctoken2string({Other, _}) when is_atom(Other) -&gt;
<a name="1582"/> 1582:          io_lib:format('~w', [Other]);
<a name="1583"/> 1583:      yecctoken2string(Other) -&gt;
<a name="1584"/> 1584:          io_lib:write(Other).
<a name="1585"/> 1585: &quot;&gt;&gt;.
<a name="1586"/> 1586: 
<a name="otp_7945-1"/><a name="1587"/> 1587: <b>otp_7945</b>(doc) -&gt;
<a name="1588"/> 1588:     &quot;OTP-7945. A bug introduced in R13A.&quot;;
<a name="1589"/> 1589: <b>otp_7945</b>(suite) -&gt; [];
<a name="1590"/> 1590: <b>otp_7945</b>(Config) when is_list(Config) -&gt;
<a name="1591"/> 1591:     A2 = erl_anno:new(2),
<a name="1592"/> 1592:     A3 = erl_anno:new(3),
<a name="1593"/> 1593:     {error,_} = erl_parse:parse([{atom,A3,foo},{'.',A2,9,9}]),
<a name="otp_7945-last_expr"/><a name="1594"/> 1594:     ok.
<a name="1595"/> 1595: 
<a name="otp_8483-1"/><a name="1596"/> 1596: <b>otp_8483</b>(doc) -&gt;
<a name="1597"/> 1597:     &quot;OTP-8483. reduce/accept conflict&quot;;
<a name="1598"/> 1598: <b>otp_8483</b>(suite) -&gt; [];
<a name="1599"/> 1599: <b>otp_8483</b>(Config) when is_list(Config) -&gt;
<a name="1600"/> 1600:     Dir = ?privdir,
<a name="1601"/> 1601:     Input = filename:join(Dir, &quot;bug.yrl&quot;),
<a name="1602"/> 1602: 
<a name="1603"/> 1603:     Bug1 = &lt;&lt;&quot;Nonterminals elem seq.
<a name="1604"/> 1604:               Terminals 'foo'.
<a name="1605"/> 1605:               Rootsymbol elem.
<a name="1606"/> 1606:               elem -&gt; 'foo'.
<a name="1607"/> 1607:               elem -&gt; seq.
<a name="1608"/> 1608:               seq -&gt; elem.
<a name="1609"/> 1609:               seq -&gt; seq elem.&quot;&gt;&gt;,
<a name="1610"/> 1610:     ok = file:write_file(Input, Bug1),
<a name="1611"/> 1611:     Ret = [return, {report, true}],
<a name="1612"/> 1612:     {error,[{_,[{none,yecc,{conflict,_}},
<a name="1613"/> 1613:                 {none,yecc,{conflict,{'$end',4,{[seq,elem],3,{6,15}},
<a name="1614"/> 1614:                                       {reduce,[seq,seq,elem],4,{7,15}}}}},
<a name="1615"/> 1615:                       {none,yecc,{conflict,_}}]}],
<a name="1616"/> 1616:            [{_,[{none,yecc,{conflicts,1,3}}]}]} = 
<a name="1617"/> 1617:         yecc:file(Input, Ret),
<a name="1618"/> 1618:     {error,[{_,[{none,yecc,{conflict,_}},
<a name="1619"/> 1619:                 {none,yecc,{conflict,{'$end',4,{[seq,elem],3,6},
<a name="1620"/> 1620:                                       {reduce,[seq,seq,elem],4,7}}}},
<a name="1621"/> 1621:                       {none,yecc,{conflict,_}}]}],
<a name="1622"/> 1622:            [{_,[{none,yecc,{conflicts,1,3}}]}]} =
<a name="1623"/> 1623:         yecc:file(Input, [{error_location, line} | Ret]),
<a name="1624"/> 1624:     file:delete(Input),
<a name="otp_8483-last_expr"/><a name="1625"/> 1625:     ok.
<a name="1626"/> 1626: 
<a name="otp_8486-1"/><a name="1627"/> 1627: <b>otp_8486</b>(doc) -&gt;
<a name="1628"/> 1628:     &quot;OTP-8486.&quot;;
<a name="1629"/> 1629: <b>otp_8486</b>(suite) -&gt; [];
<a name="1630"/> 1630: <b>otp_8486</b>(Config) when is_list(Config) -&gt;
<a name="1631"/> 1631:     Ts = [{otp_8486,&lt;&lt;&quot;
<a name="1632"/> 1632:            Nonterminals boolean command.
<a name="1633"/> 1633:            Terminals '(' ')' if then else true and or skip while do.
<a name="1634"/> 1634:            Rootsymbol command.
<a name="1635"/> 1635:            Left 100 or.
<a name="1636"/> 1636:            Left 200 and.
<a name="1637"/> 1637:            boolean -&gt; '(' boolean ')' : '$2'.
<a name="1638"/> 1638:            boolean -&gt; 'true' : b.
<a name="1639"/> 1639:            boolean -&gt; boolean 'and' boolean : {a,'$1','$3'}.
<a name="1640"/> 1640:            boolean -&gt; boolean 'or' boolean : {o,'$1','$3'}.
<a name="1641"/> 1641:            command -&gt; 'skip' : s.
<a name="1642"/> 1642:            command -&gt; 'if' boolean 'then' command 'else' command : 
<a name="1643"/> 1643:                                   {i,'$2','$4','$6'}.
<a name="1644"/> 1644:            command -&gt; 'while' boolean 'do' command : {w,'$2','$4'}.
<a name="1645"/> 1645: 
<a name="1646"/> 1646:            Erlang code.
<a name="1647"/> 1647:            -export([t/0]).
<a name="1648"/> 1648:            t() -&gt;
<a name="1649"/> 1649:                {ok,{i,{o,b,b},s,s}} =
<a name="1650"/> 1650:                    parse([{'if',1},{'true',1},{'or',1},{'true',1},
<a name="1651"/> 1651:                           {'then',1},{'skip',1},{'else',1},{'skip',1}]),
<a name="1652"/> 1652:                ok.
<a name="1653"/> 1653:           &quot;&gt;&gt;,default,ok}],
<a name="1654"/> 1654:     run(Config, Ts),
<a name="otp_8486-last_expr"/><a name="1655"/> 1655:     ok.
<a name="1656"/> 1656: 
<a name="otp_7292-1"/><a name="1657"/> 1657: <b>otp_7292</b>(doc) -&gt;
<a name="1658"/> 1658:     &quot;OTP-7292. Header declarations for edoc.&quot;;
<a name="1659"/> 1659: <b>otp_7292</b>(suite) -&gt; [];
<a name="1660"/> 1660: <b>otp_7292</b>(Config) when is_list(Config) -&gt;
<a name="1661"/> 1661:     Dir = ?privdir,
<a name="1662"/> 1662:     Filename = filename:join(Dir, &quot;file.yrl&quot;),
<a name="1663"/> 1663:     Parserfile1 = filename:join(Dir, &quot;a file&quot;),
<a name="1664"/> 1664: 
<a name="1665"/> 1665:     Contents =  &lt;&lt;&quot;Nonterminals nt. 
<a name="1666"/> 1666:                    Terminals t. 
<a name="1667"/> 1667:                    Rootsymbol nt. 
<a name="1668"/> 1668:                    Endsymbol e.
<a name="1669"/> 1669:                    nt -&gt; t : a bad code.
<a name="1670"/> 1670: 
<a name="1671"/> 1671:                    Header \&quot;%% copyright bla bla bla\&quot;
<a name="1672"/> 1672:                    \&quot;%% @private\&quot; \&quot;%% foo\&quot;
<a name="1673"/> 1673:                    \&quot;%% @author X.Y.\&quot;.
<a name="1674"/> 1674: 
<a name="1675"/> 1675:                    Erlang code.
<a name="1676"/> 1676: 
<a name="1677"/> 1677:                    %% @private
<a name="1678"/> 1678:                    %% etc.
<a name="1679"/> 1679: 
<a name="1680"/> 1680:                    foo() -&gt;
<a name="1681"/> 1681:                        bar. &quot;&gt;&gt;,
<a name="1682"/> 1682: 
<a name="1683"/> 1683:     %% Check that correct line number is used in messages.
<a name="1684"/> 1684:     ok = file:write_file(Filename, Contents),
<a name="1685"/> 1685:     ParserFile3 = [{parserfile, Parserfile1}],
<a name="1686"/> 1686:     Ret = [return, {report, true}],
<a name="1687"/> 1687:     {ok, _, []} = yecc:file(Filename, ParserFile3 ++ Ret),
<a name="1688"/> 1688: 
<a name="1689"/> 1689:     %% Note: checking the line numbers. Changes when yeccpre.hrl changes.
<a name="1690"/> 1690:     fun() -&gt;
<a name="1691"/> 1691:             SzYeccPre = yeccpre_size(),
<a name="1692"/> 1692:             {error,
<a name="1693"/> 1693:                    [{_,[{{5,32},_,[&quot;syntax error before: &quot;,&quot;bad&quot;]}]},
<a name="1694"/> 1694:                     {_,[{{L1,_},_,{undefined_function,{yeccpars2_2_,1}}},
<a name="1695"/> 1695:                         {{L2,_},_,{bad_inline,{yeccpars2_2_,1}}},
<a name="1696"/> 1696:                         {{_,_},_,{undefined_function,{yeccpars2_2_,1}}},
<a name="1697"/> 1697:                         {{_,_},_,{bad_nowarn_unused_function,{yeccpars2_2_,1}}}]}],
<a name="1698"/> 1698:              [{_,[{{16,20},_,{unused_function,{foo,0}}}]}]} =
<a name="1699"/> 1699:                 compile:file(Parserfile1, [basic_validation, return]),
<a name="1700"/> 1700:             ?assertEqual(L1, 48 + SzYeccPre),
<a name="1701"/> 1701:             ?assertEqual(L2, 57 + SzYeccPre)
<a name="1702"/> 1702:     end(),
<a name="1703"/> 1703: 
<a name="1704"/> 1704:     YeccPre = filename:join(Dir, &quot;yeccpre.hrl&quot;),
<a name="1705"/> 1705:     ok = file:write_file(YeccPre, 
<a name="1706"/> 1706:        [&lt;&lt;&quot;-export([parse/1, parse_and_scan/1, format_error/1]).\n&quot;&gt;&gt;,
<a name="1707"/> 1707:         yeccpre_v1_2()]),
<a name="1708"/> 1708:     Inc = [{includefile,YeccPre}],
<a name="1709"/> 1709:     {ok, _, []} = yecc:file(Filename, ParserFile3 ++ Inc ++ Ret),
<a name="1710"/> 1710:     fun() -&gt;
<a name="1711"/> 1711:             SzYeccPre = yeccpre_size(YeccPre),
<a name="1712"/> 1712:             {error,
<a name="1713"/> 1713:                    [{_,[{{5,32},_,[&quot;syntax error before: &quot;,&quot;bad&quot;]}]},
<a name="1714"/> 1714:                     {_,[{{L1,_},_,{undefined_function,{yeccpars2_2_,1}}},
<a name="1715"/> 1715:                         {{L2,_},_,{bad_inline,{yeccpars2_2_,1}}},
<a name="1716"/> 1716:                         {{_,_},_,{undefined_function,{yeccpars2_2_,1}}},
<a name="1717"/> 1717:                         {{_,_},_,{bad_nowarn_unused_function,{yeccpars2_2_,1}}}]}],
<a name="1718"/> 1718:                    [{_,[{{16,20},_,{unused_function,{foo,0}}}]}]} =
<a name="1719"/> 1719:                 compile:file(Parserfile1, [basic_validation, return]),
<a name="1720"/> 1720:             ?assertEqual(L1, 45 + SzYeccPre),
<a name="1721"/> 1721:             ?assertEqual(L2, 54 + SzYeccPre)
<a name="1722"/> 1722:     end(),
<a name="1723"/> 1723: 
<a name="1724"/> 1724:     file:delete(YeccPre),
<a name="1725"/> 1725:     file:delete(Parserfile1 ++ &quot;.erl&quot;),
<a name="1726"/> 1726:     file:delete(Filename),
<a name="1727"/> 1727: 
<a name="otp_7292-last_expr"/><a name="1728"/> 1728:     ok.
<a name="1729"/> 1729: 
<a name="yeccpre_v1_2-0"/><a name="1730"/> 1730: <b>yeccpre_v1_2</b>() -&gt;
<a name="yeccpre_v1_2-last_expr"/><a name="1731"/> 1731:     &lt;&lt;&quot;
<a name="1732"/> 1732: parse(Tokens) -&gt;
<a name="1733"/> 1733:     yeccpars0(Tokens, false).
<a name="1734"/> 1734: 
<a name="1735"/> 1735: parse_and_scan({F, A}) -&gt;
<a name="1736"/> 1736:     yeccpars0([], {F, A});
<a name="1737"/> 1737: parse_and_scan({M, F, A}) -&gt;
<a name="1738"/> 1738:     Arity = length(A),
<a name="1739"/> 1739:     yeccpars0([], {fun M:F/Arity, A}).
<a name="1740"/> 1740: 
<a name="1741"/> 1741: format_error(Message) -&gt;
<a name="1742"/> 1742:     case io_lib:deep_char_list(Message) of
<a name="1743"/> 1743: 	true -&gt;
<a name="1744"/> 1744: 	    Message;
<a name="1745"/> 1745: 	_ -&gt;
<a name="1746"/> 1746: 	    io_lib:write(Message)
<a name="1747"/> 1747:     end.
<a name="1748"/> 1748: 
<a name="1749"/> 1749: <b>-define</b>(CODE_VERSION, \&quot;1.2\&quot;).
<a name="1750"/> 1750: 
<a name="1751"/> 1751: yeccpars0(Tokens, MFA) -&gt;
<a name="1752"/> 1752:     try yeccpars1(Tokens, MFA, 0, [], [])
<a name="1753"/> 1753:     catch 
<a name="1754"/> 1754:         error: Error : Stacktrace -&gt;
<a name="1755"/> 1755:             try yecc_error_type(Error, Stacktrace) of
<a name="1756"/> 1756:                 {syntax_error, Token} -&gt;
<a name="1757"/> 1757:                     yeccerror(Token);
<a name="1758"/> 1758:                 {missing_in_goto_table=Tag, State} -&gt;
<a name="1759"/> 1759:                     Desc = {State, Tag},
<a name="1760"/> 1760:                     erlang:raise(error, {yecc_bug, ?CODE_VERSION, Desc},
<a name="1761"/> 1761:                                 Stacktrace);
<a name="1762"/> 1762:                 {missing_in_goto_table=Tag, Symbol, State} -&gt;
<a name="1763"/> 1763:                     Desc = {Symbol, State, Tag},
<a name="1764"/> 1764:                     erlang:raise(error, {yecc_bug, ?CODE_VERSION, Desc},
<a name="1765"/> 1765:                                 Stacktrace)
<a name="1766"/> 1766:             catch _:_ -&gt; erlang:raise(error, Error, Stacktrace)
<a name="1767"/> 1767:             end;
<a name="1768"/> 1768:         throw: {error, {_Line, ?MODULE, _M}} = Error -&gt; 
<a name="1769"/> 1769:             Error % probably from return_error/2
<a name="1770"/> 1770:     end.
<a name="1771"/> 1771: 
<a name="1772"/> 1772: yecc_error_type(function_clause, [{?MODULE,F,[_,_,_,_,Token,_,_]} | _]) -&gt;
<a name="1773"/> 1773:     \&quot;yeccpars2\&quot; ++ _ = atom_to_list(F),
<a name="1774"/> 1774:     {syntax_error, Token};
<a name="1775"/> 1775: yecc_error_type({case_clause,{State}}, [{?MODULE,yeccpars2,_}|_]) -&gt;
<a name="1776"/> 1776:     %% Inlined goto-function
<a name="1777"/> 1777:     {missing_in_goto_table, State};
<a name="1778"/> 1778: yecc_error_type(function_clause, [{?MODULE,F,[State]}|_]) -&gt;
<a name="1779"/> 1779:     \&quot;yeccgoto_\&quot; ++ SymbolL = atom_to_list(F),
<a name="1780"/> 1780:     {ok,[{atom,_,Symbol}]} = erl_scan:string(SymbolL),
<a name="1781"/> 1781:     {missing_in_goto_table, Symbol, State}.
<a name="1782"/> 1782: 
<a name="1783"/> 1783: yeccpars1([Token | Tokens], Tokenizer, State, States, Vstack) -&gt;
<a name="1784"/> 1784:     yeccpars2(State, element(1, Token), States, Vstack, Token, Tokens, 
<a name="1785"/> 1785:               Tokenizer);
<a name="1786"/> 1786: yeccpars1([], {F, A}, State, States, Vstack) -&gt;
<a name="1787"/> 1787:     case apply(F, A) of
<a name="1788"/> 1788:         {ok, Tokens, _Endline} -&gt;
<a name="1789"/> 1789: 	    yeccpars1(Tokens, {F, A}, State, States, Vstack);
<a name="1790"/> 1790:         {eof, _Endline} -&gt;
<a name="1791"/> 1791:             yeccpars1([], false, State, States, Vstack);
<a name="1792"/> 1792:         {error, Descriptor, _Endline} -&gt;
<a name="1793"/> 1793:             {error, Descriptor}
<a name="1794"/> 1794:     end;
<a name="1795"/> 1795: yeccpars1([], false, State, States, Vstack) -&gt;
<a name="1796"/> 1796:     yeccpars2(State, '$end', States, Vstack, {'$end', 999999}, [], false).
<a name="1797"/> 1797: 
<a name="1798"/> 1798: yeccpars1(State1, State, States, Vstack, Stack1, [Token | Tokens], 
<a name="1799"/> 1799:           Tokenizer) -&gt;
<a name="1800"/> 1800:     yeccpars2(State, element(1, Token), [State1 | States],
<a name="1801"/> 1801:               [Stack1 | Vstack], Token, Tokens, Tokenizer);
<a name="1802"/> 1802: yeccpars1(State1, State, States, Vstack, Stack1, [], {F, A}) -&gt;
<a name="1803"/> 1803:     case apply(F, A) of
<a name="1804"/> 1804:         {ok, Tokens, _Endline} -&gt;
<a name="1805"/> 1805: 	    yeccpars1(State1, State, States, Vstack, Stack1, Tokens, {F, A});
<a name="1806"/> 1806:         {eof, _Endline} -&gt;
<a name="1807"/> 1807:             yeccpars1(State1, State, States, Vstack, Stack1, [], false);
<a name="1808"/> 1808:         {error, Descriptor, _Endline} -&gt;
<a name="1809"/> 1809:             {error, Descriptor}
<a name="1810"/> 1810:     end;
<a name="1811"/> 1811: yeccpars1(State1, State, States, Vstack, Stack1, [], false) -&gt;
<a name="1812"/> 1812:     yeccpars2(State, '$end', [State1 | States], [Stack1 | Vstack],
<a name="1813"/> 1813:               {'$end', 999999}, [], false).
<a name="1814"/> 1814: 
<a name="1815"/> 1815: yeccerror(Token) -&gt;
<a name="1816"/> 1816:     {error,
<a name="1817"/> 1817:      {element(2, Token), ?MODULE,
<a name="1818"/> 1818:       [\&quot;syntax error before: \&quot;, yecctoken2string(Token)]}}.
<a name="1819"/> 1819: 
<a name="1820"/> 1820: yecctoken2string({atom, _, A}) -&gt; io_lib:write(A);
<a name="1821"/> 1821: yecctoken2string({integer,_,N}) -&gt; io_lib:write(N);
<a name="1822"/> 1822: yecctoken2string({float,_,F}) -&gt; io_lib:write(F);
<a name="1823"/> 1823: yecctoken2string({char,_,C}) -&gt; io_lib:write_char(C);
<a name="1824"/> 1824: yecctoken2string({var,_,V}) -&gt; io_lib:format('~s', [V]);
<a name="1825"/> 1825: yecctoken2string({string,_,S}) -&gt; io_lib:write_string(S);
<a name="1826"/> 1826: yecctoken2string({reserved_symbol, _, A}) -&gt; io_lib:format('~w', [A]);
<a name="1827"/> 1827: yecctoken2string({_Cat, _, Val}) -&gt; io_lib:format('~w', [Val]);
<a name="1828"/> 1828: yecctoken2string({'dot', _}) -&gt; io_lib:format('~w', ['.']);
<a name="1829"/> 1829: yecctoken2string({'$end', _}) -&gt;
<a name="1830"/> 1830:     [];
<a name="1831"/> 1831: yecctoken2string({Other, _}) when is_atom(Other) -&gt;
<a name="1832"/> 1832:     io_lib:format('~w', [Other]);
<a name="1833"/> 1833: yecctoken2string(Other) -&gt;
<a name="1834"/> 1834:     io_lib:write(Other).
<a name="1835"/> 1835: &quot;&gt;&gt;.
<a name="1836"/> 1836: 
<a name="run-2"/><a name="1837"/> 1837: <b>run</b>(Config, Tests) -&gt;
<a name="1838"/> 1838:     F = fun({N,P,Pre,E}) -&gt;
<a name="1839"/> 1839:                 case catch run_test(Config, P, Pre) of
<a name="1840"/> 1840:                     E -&gt; 
<a name="1841"/> 1841:                         ok;
<a name="1842"/> 1842:                     Bad -&gt; 
<a name="1843"/> 1843:                         ct:fail(&quot;~nTest ~p failed. Expected~n  ~p~n&quot;
<a name="1844"/> 1844:                                   &quot;but got~n  ~p~n&quot;, [N, E, Bad])
<a name="1845"/> 1845:                 end
<a name="1846"/> 1846:         end,
<a name="run-last_expr"/><a name="1847"/> 1847: <b>    lists:foreach</b>(F, Tests).
<a name="1848"/> 1848: 
<a name="otp_7969-1"/><a name="1849"/> 1849: <b>otp_7969</b>(doc) -&gt;
<a name="1850"/> 1850:     &quot;OTP-7969. Interface to the I/O protocol..&quot;;
<a name="1851"/> 1851: <b>otp_7969</b>(suite) -&gt; [];
<a name="1852"/> 1852: <b>otp_7969</b>(Config) when is_list(Config) -&gt;
<a name="1853"/> 1853:     {ok,Ts1,_} =
<a name="1854"/> 1854:         erl_scan:string(&quot;'foo\nbar'&quot;, {1,1}, [text]),
<a name="1855"/> 1855:     {error,{{2,5},_,[&quot;syntax error before: &quot;,[]]}} = erl_parse:parse(Ts1),
<a name="1856"/> 1856: 
<a name="1857"/> 1857:     {ok,Ts1_1,_} = erl_scan:string(&quot;'foo\nbar'&quot;, 1, [text]),
<a name="1858"/> 1858:     {error,{2,_,[&quot;syntax error before: &quot;,[]]}} = erl_parse:parse(Ts1_1),
<a name="1859"/> 1859: 
<a name="1860"/> 1860:     {ok,Ts2,_EndLocation} =
<a name="1861"/> 1861:         erl_scan:string(&quot;'foo\nbar'&quot;, {1,1}, []),
<a name="1862"/> 1862:     %% Can't do better than report possibly wrong location:
<a name="1863"/> 1863:     {error,{{1,1},_,[&quot;syntax error before: &quot;,[]]}} = erl_parse:parse(Ts2),
<a name="1864"/> 1864: 
<a name="1865"/> 1865:     {ok, Ts11, _}=R1 = erl_scan:string(&quot;f() -&gt; a.&quot;),
<a name="1866"/> 1866:     F1 = fun() -&gt; {ok,Ts11 ++ [{'$end',2}],2} end,
<a name="1867"/> 1867:     A1 = erl_anno:new(1),
<a name="1868"/> 1868:     {ok,{function,A1,f,0,[{clause,A1,[],[],[{atom,A1,a}]}]}} =
<a name="1869"/> 1869:         erl_parse:parse_and_scan({F1, []}),
<a name="1870"/> 1870:     F2 = fun() -&gt; erl_scan:string(&quot;f() -&gt; ,&quot;) end,
<a name="1871"/> 1871:     {error,{1,erl_parse,_}} = erl_parse:parse_and_scan({F2, []}),
<a name="1872"/> 1872:     F3 = fun() -&gt; case erase(foo) of
<a name="1873"/> 1873:                             bar -&gt; 
<a name="1874"/> 1874:                                 {ok,[{'$end',2}],3};
<a name="1875"/> 1875:                             undefined -&gt;
<a name="1876"/> 1876:                                 put(foo,bar), R1
<a name="1877"/> 1877:                         end
<a name="1878"/> 1878:                end,
<a name="1879"/> 1879:     {ok,{function,A1,f,0,[{clause,A1,[],[],[{atom,A1,a}]}]}} =
<a name="1880"/> 1880:         erl_parse:parse_and_scan({F3,[]}),
<a name="1881"/> 1881:     F4 = fun() -&gt; {error, {1, ?MODULE, bad}, 2} end,
<a name="1882"/> 1882:     {error, {1,?MODULE,bad}} = erl_parse:parse_and_scan({F4, []}),
<a name="1883"/> 1883:     F5 = fun() -&gt; {eof, 3} end,
<a name="1884"/> 1884:     {error,{3,erl_parse,_}} = erl_parse:parse_and_scan({F5, []}),
<a name="1885"/> 1885:     {error,{999999,erl_parse,_}} = erl_parse:parse([]),
<a name="1886"/> 1886:     {ok, Ts21, EL} = erl_scan:string(&quot;f() -&gt; a; g() -&gt; b. &quot;, {1,1}),
<a name="1887"/> 1887:     F6 = fun() -&gt; {ok, Ts21, EL} end,
<a name="1888"/> 1888:     {error,{{1,11},erl_parse,_}} = erl_parse:parse_and_scan({F6, []}),
<a name="otp_7969-last_expr"/><a name="1889"/> 1889:     ok.
<a name="1890"/> 1890: 
<a name="otp_8919-1"/><a name="1891"/> 1891: <b>otp_8919</b>(doc) -&gt;
<a name="1892"/> 1892:     &quot;OTP-8919. Improve formatting of Yecc error messages.&quot;;
<a name="1893"/> 1893: <b>otp_8919</b>(suite) -&gt; [];
<a name="1894"/> 1894: <b>otp_8919</b>(Config) when is_list(Config) -&gt;
<a name="1895"/> 1895:     A1 = erl_anno:new(1),
<a name="1896"/> 1896:     {error,{1,Mod,Mess}} = erl_parse:parse([{cat,A1,&quot;hello&quot;}]),
<a name="1897"/> 1897:     &quot;syntax error before: \&quot;hello\&quot;&quot; = lists:flatten(Mod:format_error(Mess)),
<a name="otp_8919-last_expr"/><a name="1898"/> 1898:     ok.
<a name="1899"/> 1899: 
<a name="otp_10302-1"/><a name="1900"/> 1900: <b>otp_10302</b>(doc) -&gt;
<a name="1901"/> 1901:     &quot;OTP-10302. Unicode characters scanner/parser.&quot;;
<a name="1902"/> 1902: <b>otp_10302</b>(suite) -&gt; [];
<a name="1903"/> 1903: <b>otp_10302</b>(Config) when is_list(Config) -&gt;
<a name="1904"/> 1904:     Dir = ?privdir,
<a name="1905"/> 1905:     Filename = filename:join(Dir, &quot;OTP-10302.yrl&quot;),
<a name="1906"/> 1906:     Ret = [return, {report, true}],
<a name="1907"/> 1907:     Mini1 = &lt;&lt;&quot;%% coding: utf-8
<a name="1908"/> 1908:                Nonterminals Hpp.
<a name="1909"/> 1909:                nt -&gt; t.&quot;&gt;&gt;,
<a name="1910"/> 1910:     ok = file:write_file(Filename, Mini1),
<a name="1911"/> 1911:     %% This could (and should) be refined:
<a name="1912"/> 1912:     {error,[{Filename,[{{2,29},Mod1,Err1}]}],[]} =
<a name="1913"/> 1913:         yecc:file(Filename, Ret),
<a name="1914"/> 1914:     &quot;cannot translate from UTF-8&quot; = Mod1:format_error(Err1),
<a name="1915"/> 1915: 
<a name="1916"/> 1916:     Mini2 = &lt;&lt;&quot;%% coding: Utf-8
<a name="1917"/> 1917:                Nonterminals Hopp.
<a name="1918"/> 1918:                Terminals t.
<a name="1919"/> 1919:                Rootsymbol Hopp.
<a name="1920"/> 1920: 
<a name="1921"/> 1921:                Hopp -&gt; t.
<a name="1922"/> 1922: 
<a name="1923"/> 1923:                Erlang code.
<a name="1924"/> 1924: 
<a name="1925"/> 1925:                t() -&gt;
<a name="1926"/> 1926:                    Hpp.&quot;&gt;&gt;,
<a name="1927"/> 1927:     ok = file:write_file(Filename, Mini2),
<a name="1928"/> 1928:     {error,[{Filename,[{11,Mod2,Err2}]}],[]} =
<a name="1929"/> 1929:         yecc:file(Filename, Ret),
<a name="1930"/> 1930:     &quot;cannot parse; possibly encoding mismatch&quot; = Mod2:format_error(Err2),
<a name="1931"/> 1931: 
<a name="1932"/> 1932:     Mini3 = &lt;&lt;&quot;%% coding: latin-1
<a name="1933"/> 1933:                Nonterminals Hopp.
<a name="1934"/> 1934:                Terminals t.
<a name="1935"/> 1935:                Rootsymbol Hopp.
<a name="1936"/> 1936: 
<a name="1937"/> 1937:                Hopp -&gt; t.
<a name="1938"/> 1938: 
<a name="1939"/> 1939:                Erlang code.
<a name="1940"/> 1940: 
<a name="1941"/> 1941:                t() -&gt;
<a name="1942"/> 1942:                    Hpp.&quot;&gt;&gt;,
<a name="1943"/> 1943:     ok = file:write_file(Filename, Mini3),
<a name="1944"/> 1944:     YeccPre = filename:join(Dir, &quot;yeccpre.hrl&quot;),
<a name="1945"/> 1945:     ok = file:write_file(YeccPre, [&lt;&lt;&quot;%% coding: UTF-8\n .\n&quot;&gt;&gt;]),
<a name="1946"/> 1946:     Inc = [{includefile,YeccPre}],
<a name="1947"/> 1947:     {error,[{_,[{2,yecc,cannot_parse}]}],[]} =
<a name="1948"/> 1948:         yecc:file(Filename, Inc ++ Ret),
<a name="1949"/> 1949: 
<a name="1950"/> 1950:     ok = file:write_file(Filename,
<a name="1951"/> 1951:      &lt;&lt;&quot;%% coding: UTF-8
<a name="1952"/> 1952:         Nonterminals Hopp.
<a name="1953"/> 1953:         Terminals t.
<a name="1954"/> 1954:         Rootsymbol \&quot;rn_\&quot;.
<a name="1955"/> 1955:         Hopp -&gt; t : '$1'.&quot;&gt;&gt;),
<a name="1956"/> 1956:     {error,[{Filename,[{{4,20},yecc,{bad_symbol,&quot;rn_&quot;++[1024]}}]}],[]} =
<a name="1957"/> 1957:         yecc:file(Filename, Ret),
<a name="1958"/> 1958: 
<a name="1959"/> 1959:     ok = file:write_file(Filename,
<a name="1960"/> 1960:      &lt;&lt;&quot;%% coding: UTF-8
<a name="1961"/> 1961:         Nonterminals Hopp.
<a name="1962"/> 1962:         Terminals t.
<a name="1963"/> 1963:         Rootsymbol Hopp.
<a name="1964"/> 1964:         Endsymbol \&quot;rn_\&quot;.
<a name="1965"/> 1965:         Hopp -&gt; t : '$1'.&quot;&gt;&gt;),
<a name="1966"/> 1966:     {error,[{Filename,[{{5,19},yecc,{bad_symbol,&quot;rn_&quot;++[1024]}}]}],[]} =
<a name="1967"/> 1967:         yecc:file(Filename, Ret),
<a name="1968"/> 1968: 
<a name="1969"/> 1969:     ok = file:write_file(Filename,
<a name="1970"/> 1970:      &lt;&lt;&quot;%% coding: UTF-8
<a name="1971"/> 1971:         Nonterminals Hopp.
<a name="1972"/> 1972:         Terminals t.
<a name="1973"/> 1973:         Rootsymbol Hopp.
<a name="1974"/> 1974:         Expect \&quot;rn_\&quot;.
<a name="1975"/> 1975:         Hopp -&gt; t : '$1'.&quot;&gt;&gt;),
<a name="1976"/> 1976:     {error,[{Filename,[{{5,16},yecc,{bad_symbol,&quot;rn_&quot;++[1024]}}]}],[]} =
<a name="1977"/> 1977:         yecc:file(Filename, Ret),
<a name="1978"/> 1978: 
<a name="1979"/> 1979:     ok = file:write_file(Filename,
<a name="1980"/> 1980:      &lt;&lt;&quot;%% coding: UTF-8
<a name="1981"/> 1981:         Nonterminals Hopp.
<a name="1982"/> 1982:         Terminals t.
<a name="1983"/> 1983:         Rootsymbol Hopp.
<a name="1984"/> 1984:         States \&quot;rn_\&quot;.
<a name="1985"/> 1985:         Hopp -&gt; t : '$1'.&quot;&gt;&gt;),
<a name="1986"/> 1986:     {error,[{Filename,[{{5,16},yecc,{bad_symbol,&quot;rn_&quot;++[1024]}}]}],[]} =
<a name="1987"/> 1987:         yecc:file(Filename, Ret),
<a name="1988"/> 1988: 
<a name="1989"/> 1989:     Ts = [{otp_10302_1,&lt;&lt;&quot;
<a name="1990"/> 1990:            %% coding: UTF-8
<a name="1991"/> 1991:            Header \&quot;%% rn_\&quot; \&quot;%% \\x{400}B\&quot;.
<a name="1992"/> 1992:            Nonterminals Hpp list.
<a name="1993"/> 1993:            Terminals element.
<a name="1994"/> 1994:            Rootsymbol Hpp.
<a name="1995"/> 1995: 
<a name="1996"/> 1996:            Hpp -&gt; list : '$1'.
<a name="1997"/> 1997: 
<a name="1998"/> 1998:            list -&gt; element : '$1'.
<a name="1999"/> 1999:            list -&gt; list element :
<a name="2000"/> 2000:                        begin
<a name="2001"/> 2001:                            Hpp = foo,
<a name="2002"/> 2002:                            {Hpp, 'Hpp',\&quot;\\x{400}B\&quot;,\&quot;rn_\&quot;}
<a name="2003"/> 2003:                        end.
<a name="2004"/> 2004: 
<a name="2005"/> 2005:            Erlang code.
<a name="2006"/> 2006: 
<a name="2007"/> 2007:            -export([t/0]).
<a name="2008"/> 2008: 
<a name="2009"/> 2009:            t() -&gt;
<a name="2010"/> 2010:                L = [{element, 1}, {element,2}],
<a name="2011"/> 2011:                {ok, R} = parse(L),
<a name="2012"/> 2012:                Hpp = foo,
<a name="2013"/> 2013:                {_,_,[1024,66],[246,114,110,95,1024]} = R,
<a name="2014"/> 2014:                {Hpp,'Hpp',\&quot;\\x{400}B\&quot;,\&quot;rn_\&quot;} = R,
<a name="2015"/> 2015:                ok.
<a name="2016"/> 2016:           &quot;&gt;&gt;,default,ok},
<a name="2017"/> 2017:           {otp_10302_2,&lt;&lt;&quot;
<a name="2018"/> 2018:            %% coding: Latin-1
<a name="2019"/> 2019:            Nonterminals Hpp list.
<a name="2020"/> 2020:            Terminals element.
<a name="2021"/> 2021:            Rootsymbol Hpp.
<a name="2022"/> 2022: 
<a name="2023"/> 2023:            Hpp -&gt; list : '$1'.
<a name="2024"/> 2024: 
<a name="2025"/> 2025:            list -&gt; element : '$1'.
<a name="2026"/> 2026:            list -&gt; list element :
<a name="2027"/> 2027:                        begin
<a name="2028"/> 2028:                            Hpp = foo,
<a name="2029"/> 2029:                            {Hpp, 'Hpp',\&quot;\\x{400}B\&quot;,\&quot;rn_\&quot;}
<a name="2030"/> 2030:                        end.
<a name="2031"/> 2031: 
<a name="2032"/> 2032:            Erlang code.
<a name="2033"/> 2033: 
<a name="2034"/> 2034:            -export([t/0]).
<a name="2035"/> 2035: 
<a name="2036"/> 2036:            t() -&gt;
<a name="2037"/> 2037:                L = [{element, 1}, {element,2}],
<a name="2038"/> 2038:                {ok, R} = parse(L),
<a name="2039"/> 2039:                Hpp = foo,
<a name="2040"/> 2040:                {_,_,[1024,66],[195,182,114,110,95,208,128]} = R,
<a name="2041"/> 2041:                {Hpp,'Hpp',\&quot;\\x{400}B\&quot;,\&quot;rn_\&quot;} = R,
<a name="2042"/> 2042:                ok.
<a name="2043"/> 2043:           &quot;&gt;&gt;,default,ok}],
<a name="2044"/> 2044:     run(Config, Ts),
<a name="otp_10302-last_expr"/><a name="2045"/> 2045:     ok.
<a name="2046"/> 2046: 
<a name="otp_11269-1"/><a name="2047"/> 2047: <b>otp_11269</b>(doc) -&gt;
<a name="2048"/> 2048:     &quot;OTP-11269. A bug.&quot;;
<a name="2049"/> 2049: <b>otp_11269</b>(suite) -&gt; [];
<a name="2050"/> 2050: <b>otp_11269</b>(Config) when is_list(Config) -&gt;
<a name="2051"/> 2051:     Dir = ?privdir,
<a name="2052"/> 2052:     Filename = filename:join(Dir, &quot;OTP-11269.yrl&quot;),
<a name="2053"/> 2053:     Ret = [return, {report, false}],
<a name="2054"/> 2054:     Pai = &lt;&lt;&quot;Nonterminals
<a name="2055"/> 2055:              list list0 list1 newline_list.
<a name="2056"/> 2056: 
<a name="2057"/> 2057:              Terminals
<a name="2058"/> 2058:              '\n' semi.
<a name="2059"/> 2059: 
<a name="2060"/> 2060:              Rootsymbol  list.
<a name="2061"/> 2061: 
<a name="2062"/> 2062:              Endsymbol '$end'.
<a name="2063"/> 2063: 
<a name="2064"/> 2064:              list -&gt;   newline_list list0 : '$2'.
<a name="2065"/> 2065: 
<a name="2066"/> 2066:              list0 -&gt; list1 '\n' newline_list : '$1'.
<a name="2067"/> 2067: 
<a name="2068"/> 2068:              list1 -&gt; list1 semi newline_list list1 :
<a name="2069"/> 2069:                            {command_connect, '$1', '$4', semi}.
<a name="2070"/> 2070: 
<a name="2071"/> 2071:              newline_list -&gt; newline_list '\n' : nil.&quot;&gt;&gt;,
<a name="2072"/> 2072:     ok = file:write_file(Filename, Pai),
<a name="2073"/> 2073:     {ok,ErlFile,[{_YrlFile,[{none,yecc,{conflicts,1,0}}]}]} =
<a name="2074"/> 2074:         yecc:file(Filename, Ret),
<a name="2075"/> 2075:     Opts = [return, warn_unused_vars,{outdir,Dir}],
<a name="2076"/> 2076:     {ok,'OTP-11269',_Warnings} = compile:file(ErlFile, Opts),
<a name="otp_11269-last_expr"/><a name="2077"/> 2077:     ok.
<a name="2078"/> 2078: 
<a name="otp_11286-1"/><a name="2079"/> 2079: <b>otp_11286</b>(doc) -&gt;
<a name="2080"/> 2080:     &quot;OTP-11286. A Unicode filename bug; both Leex and Yecc.&quot;;
<a name="2081"/> 2081: <b>otp_11286</b>(suite) -&gt; [];
<a name="2082"/> 2082: <b>otp_11286</b>(Config) when is_list(Config) -&gt;
<a name="2083"/> 2083:     {ok, Peer, Node} = ?CT_PEER([&quot;+fnu&quot;]),
<a name="2084"/> 2084:     Dir = ?privdir,
<a name="2085"/> 2085:     UName = [1024] ++ &quot;u&quot;,
<a name="2086"/> 2086:     UDir = filename:join(Dir, UName),
<a name="2087"/> 2087:     _ = rpc:call(Node, file, make_dir, [UDir]),
<a name="2088"/> 2088: 
<a name="2089"/> 2089:     %% Note: Cannot use UName as filename since the filename is used
<a name="2090"/> 2090:     %% as module name. To be fixed in R18.
<a name="2091"/> 2091:     Filename = filename:join(UDir, 'OTP-11286.yrl'),
<a name="2092"/> 2092:     Ret = [return, {report, false}, time],
<a name="2093"/> 2093: 
<a name="2094"/> 2094:     Mini1 = &lt;&lt;&quot;%% coding: utf-8
<a name="2095"/> 2095:                Terminals t.
<a name="2096"/> 2096:                Nonterminals nt.
<a name="2097"/> 2097:                Rootsymbol  nt.
<a name="2098"/> 2098:                nt -&gt; t.&quot;&gt;&gt;,
<a name="2099"/> 2099:     ok = rpc:call(Node, file, write_file, [Filename, Mini1]),
<a name="2100"/> 2100:     {ok,ErlFile,[]} = rpc:call(Node, yecc, file, [Filename, Ret]),
<a name="2101"/> 2101:     Opts = [return, warn_unused_vars,{outdir,Dir}],
<a name="2102"/> 2102:     {ok,_,_} = rpc:call(Node, compile, file, [ErlFile, Opts]),
<a name="2103"/> 2103: 
<a name="2104"/> 2104:     Mini2 = &lt;&lt;&quot;Terminals t.
<a name="2105"/> 2105:                Nonterminals nt.
<a name="2106"/> 2106:                Rootsymbol  nt.
<a name="2107"/> 2107:                nt -&gt; t.&quot;&gt;&gt;,
<a name="2108"/> 2108:     ok = rpc:call(Node, file, write_file, [Filename, Mini2]),
<a name="2109"/> 2109:     {ok,ErlFile,[]} = rpc:call(Node, yecc, file, [Filename, Ret]),
<a name="2110"/> 2110:     Opts = [return, warn_unused_vars,{outdir,Dir}],
<a name="2111"/> 2111:     {ok,_,_} = rpc:call(Node, compile, file, [ErlFile, Opts]),
<a name="2112"/> 2112: 
<a name="2113"/> 2113:     Mini3 = &lt;&lt;&quot;%% coding: latin-1
<a name="2114"/> 2114:                Terminals t.
<a name="2115"/> 2115:                Nonterminals nt.
<a name="2116"/> 2116:                Rootsymbol  nt.
<a name="2117"/> 2117:                nt -&gt; t.&quot;&gt;&gt;,
<a name="2118"/> 2118:     ok = rpc:call(Node, file, write_file, [Filename, Mini3]),
<a name="2119"/> 2119:     {ok,ErlFile,[]} = rpc:call(Node, yecc, file, [Filename, Ret]),
<a name="2120"/> 2120:     Opts = [return, warn_unused_vars,{outdir,Dir}],
<a name="2121"/> 2121:     {ok,_,_} = rpc:call(Node, compile, file, [ErlFile, Opts]),
<a name="2122"/> 2122: 
<a name="2123"/> 2123:     peer:stop(Peer),
<a name="otp_11286-last_expr"/><a name="2124"/> 2124:     ok.
<a name="2125"/> 2125: 
<a name="otp_14285-1"/><a name="2126"/> 2126: <b>otp_14285</b>(Config) -&gt;
<a name="2127"/> 2127:     Dir = ?privdir,
<a name="2128"/> 2128:     YeccPre = filename:join(Dir, &quot;yeccpre.hrl&quot;),
<a name="2129"/> 2129:     ok = file:write_file(YeccPre,
<a name="2130"/> 2130:                                [&lt;&lt;&quot;-export([t/0]).\n&quot;&gt;&gt;,my_yeccpre()]),
<a name="2131"/> 2131: 
<a name="2132"/> 2132:     T0 = &lt;&lt;&quot;
<a name="2133"/> 2133:         Nonterminals '\\x{400}'. 
<a name="2134"/> 2134:         Terminals t.
<a name="2135"/> 2135:         Rootsymbol '\\x{400}'.
<a name="2136"/> 2136:        '\\x{400}' -&gt; t : '$1'.
<a name="2137"/> 2137:        Erlang code.
<a name="2138"/> 2138:        t() -&gt;
<a name="2139"/> 2139:            L = [{t, 1}],
<a name="2140"/> 2140:            {ok, R} = parse(L),
<a name="2141"/> 2141:            {t, 1} = R,
<a name="2142"/> 2142:            ok.&quot;&gt;&gt;,
<a name="2143"/> 2143:     Ts0 = [{otp_14285_1,
<a name="2144"/> 2144:            [&lt;&lt;&quot;%% coding: Latin-1\n&quot;&gt;&gt;,T0],YeccPre,ok},
<a name="2145"/> 2145:          {otp_14285_2,
<a name="2146"/> 2146:            [&lt;&lt;&quot;%% coding: coding: UTF-8\n&quot;&gt;&gt;,T0],YeccPre,ok}],
<a name="2147"/> 2147:     run(Config, Ts0),
<a name="2148"/> 2148:     file:delete(YeccPre),
<a name="2149"/> 2149: 
<a name="2150"/> 2150:     T1 = &lt;&lt;&quot;
<a name="2151"/> 2151:         Nonterminals '1\\x{400}' list 'unused\\x{400}'.
<a name="2152"/> 2152:         Terminals '2\\x{400}'.
<a name="2153"/> 2153:         Rootsymbol '1\\x{400}'.
<a name="2154"/> 2154: 
<a name="2155"/> 2155:         '1\\x{400}' -&gt; list : '$1'.
<a name="2156"/> 2156: 
<a name="2157"/> 2157:         list -&gt; '2\\x{400}' : '$1'.
<a name="2158"/> 2158:         list -&gt; list '2\\x{400}' : {foo,'\\x{400}'}.
<a name="2159"/> 2159: 
<a name="2160"/> 2160:         Erlang code.
<a name="2161"/> 2161: 
<a name="2162"/> 2162:         -export([t/0]).
<a name="2163"/> 2163: 
<a name="2164"/> 2164:         t() -&gt;
<a name="2165"/> 2165:             L = [{'2\\x{400}', 1}, {'2\\x{400}',2}],
<a name="2166"/> 2166:             {ok, R} = parse(L),
<a name="2167"/> 2167:             {foo,A} = R,
<a name="2168"/> 2168:             '\\x{400}' = A,
<a name="2169"/> 2169:             [1024] = atom_to_list(A),
<a name="2170"/> 2170:             ok.&quot;&gt;&gt;,
<a name="2171"/> 2171: 
<a name="2172"/> 2172:     Ts1 = [{otp_14285_3,
<a name="2173"/> 2173:             [&lt;&lt;&quot;%% coding: Latin-1\n&quot;&gt;&gt;,T1],default,ok},
<a name="2174"/> 2174:            {otp_14285_4,
<a name="2175"/> 2175:             [&lt;&lt;&quot;%% coding: UTF-8\n&quot;&gt;&gt;,T1],default,ok}],
<a name="2176"/> 2176:     run(Config, Ts1),
<a name="2177"/> 2177: 
<a name="2178"/> 2178:     T2 = &lt;&lt;&quot;
<a name="2179"/> 2179:         Nonterminals E.
<a name="2180"/> 2180:         Terminals '-' '+' '=' id.
<a name="2181"/> 2181:         Rootsymbol E.
<a name="2182"/> 2182:         Endsymbol '\\x{400}'.
<a name="2183"/> 2183: 
<a name="2184"/> 2184:         E -&gt; E '=' E : {op, '=', '$1', '$3'}.
<a name="2185"/> 2185:         E -&gt; E '+' E  : {op, '+', '$1', '$3'}.
<a name="2186"/> 2186:         E -&gt; '-' E : {op, '-', '$2'}.
<a name="2187"/> 2187:         E -&gt; id : '$1'.
<a name="2188"/> 2188: 
<a name="2189"/> 2189:         Nonassoc 100 '='.
<a name="2190"/> 2190:         Right 200 '+' '-'.
<a name="2191"/> 2191: 
<a name="2192"/> 2192:         Erlang code.
<a name="2193"/> 2193: 
<a name="2194"/> 2194:         -export([t/0]).
<a name="2195"/> 2195: 
<a name="2196"/> 2196:         t() -&gt;
<a name="2197"/> 2197:             {ok,{op,'=',{id,1},{op,'-',{op,'+',{id,4},{id,6}}}}} = 
<a name="2198"/> 2198:                 parse([{id,1},{'=',2},{'-',3},{id,4},{'+',5},{id,6},
<a name="2199"/> 2199:                       {'\\x{400}',1}]),
<a name="2200"/> 2200:             ok.&quot;&gt;&gt;,
<a name="2201"/> 2201: 
<a name="2202"/> 2202:     Ts2 = [{otp_14285_5,
<a name="2203"/> 2203:             [&lt;&lt;&quot;%% coding: Latin-1\n&quot;&gt;&gt;,T2],default,ok},
<a name="2204"/> 2204:            {otp_14285_6,
<a name="2205"/> 2205:             [&lt;&lt;&quot;%% coding: UTF-8\n&quot;&gt;&gt;,T2],default,ok}],
<a name="2206"/> 2206:     run(Config, Ts2),
<a name="2207"/> 2207: 
<a name="otp_14285-last_expr"/><a name="2208"/> 2208:     ok.
<a name="2209"/> 2209: 
<a name="otp_17023-1"/><a name="2210"/> 2210: <b>otp_17023</b>(Config) -&gt;
<a name="2211"/> 2211:     Dir = ?privdir,
<a name="2212"/> 2212:     Filename = filename:join(Dir, &quot;file.yrl&quot;),
<a name="2213"/> 2213:     Ret = [return, {report, true}],
<a name="2214"/> 2214: 
<a name="2215"/> 2215:     {'EXIT', {badarg, _}} = (catch yecc:file(Filename, [{noopt,true}])),
<a name="2216"/> 2216:     OldEnv = os:getenv(&quot;ERL_COMPILER_OPTIONS&quot;),
<a name="2217"/> 2217:     true = os:putenv(&quot;ERL_COMPILER_OPTIONS&quot;, &quot;strong_validation&quot;),
<a name="2218"/> 2218:     ok = file:write_file(Filename,&lt;&lt;&quot;
<a name="2219"/> 2219:               Nonterminals nt. 
<a name="2220"/> 2220:               Terminals t.
<a name="2221"/> 2221:               Rootsymbol nt.
<a name="2222"/> 2222:               nt -&gt; t : '$2'.
<a name="2223"/> 2223:           &quot;&gt;&gt;),
<a name="2224"/> 2224:     {error,[{_,[{{5,25},yecc,{undefined_pseudo_variable,'$2'}}]}],[]} =
<a name="2225"/> 2225:         yecc:file(Filename, Ret),
<a name="2226"/> 2226:     true = os:putenv(&quot;ERL_COMPILER_OPTIONS&quot;, &quot;{return, false}&quot;),
<a name="2227"/> 2227:     error = yecc:file(Filename, Ret),
<a name="2228"/> 2228:     error = yecc:file(Filename, [return | Ret]), % overridden
<a name="2229"/> 2229:     case OldEnv of
<a name="2230"/> 2230:         false -&gt;
<a name="2231"/> 2231:             os:unsetenv(&quot;ERL_COMPILER_OPTIONS&quot;);
<a name="2232"/> 2232:         _ -&gt;
<a name="2233"/> 2233:             os:putenv(&quot;ERL_COMPILER_OPTIONS&quot;, OldEnv)
<a name="2234"/> 2234:     end,
<a name="otp_17023-last_expr"/><a name="2235"/> 2235:     ok.
<a name="2236"/> 2236: 
<a name="otp_17535-1"/><a name="2237"/> 2237: <b>otp_17535</b>(doc) -&gt;
<a name="2238"/> 2238:     &quot;GH-5067. Compiler finds unused functions.&quot;;
<a name="2239"/> 2239: <b>otp_17535</b>(suite) -&gt; [];
<a name="2240"/> 2240: <b>otp_17535</b>(Config) when is_list(Config) -&gt;
<a name="2241"/> 2241:     Dir = ?privdir,
<a name="2242"/> 2242:     Filename = filename:join(Dir, &quot;OTP-17535.yrl&quot;),
<a name="2243"/> 2243:     Ret = [return, {report, true}],
<a name="2244"/> 2244:     J = &lt;&lt;&quot;Nonterminals start statem.
<a name="2245"/> 2245:           Terminals  'if'.
<a name="2246"/> 2246:           Rootsymbol start.
<a name="2247"/> 2247:           start -&gt; statem : b.
<a name="2248"/> 2248:           statem -&gt; 'if' statem : a.
<a name="2249"/> 2249:           Erlang code.&quot;&gt;&gt;,
<a name="2250"/> 2250:     ok = file:write_file(Filename, J),
<a name="2251"/> 2251:     {ok, ErlFile, []} = yecc:file(Filename, Ret),
<a name="2252"/> 2252:     {ok, _, []} = compile:file(ErlFile, [return]),
<a name="otp_17535-last_expr"/><a name="2253"/> 2253:     ok.
<a name="2254"/> 2254: 
<a name="yeccpre_size-0"/><a name="2255"/> 2255: <b>yeccpre_size</b>() -&gt;
<a name="yeccpre_size-last_expr"/><a name="2256"/> 2256: <b>    yeccpre_size</b>(default_yeccpre()).
<a name="2257"/> 2257: 
<a name="yeccpre_size-1"/><a name="2258"/> 2258: <b>yeccpre_size</b>(File) -&gt;
<a name="yeccpre_size-last_expr"/><a name="2259"/> 2259: <b>    n_lines</b>(File).
<a name="2260"/> 2260:     
<a name="default_yeccpre-0"/><a name="2261"/> 2261: <b>default_yeccpre</b>() -&gt;
<a name="default_yeccpre-last_expr"/><a name="2262"/> 2262: <b>    filename:join</b>([code:lib_dir(parsetools),&quot;include&quot;,&quot;yeccpre.hrl&quot;]).
<a name="2263"/> 2263: 
<a name="n_lines-1"/><a name="2264"/> 2264: <b>n_lines</b>(File) -&gt;
<a name="2265"/> 2265:     {ok, Bin} = file:read_file(File),
<a name="n_lines-last_expr"/><a name="2266"/> 2266: <b>    length</b>([C || C=$\n &lt;- binary_to_list(Bin)]).
<a name="2267"/> 2267: 
<a name="run_test-3"/><a name="2268"/> 2268: <b>run_test</b>(Config, Def, Pre) -&gt;
<a name="2269"/> 2269:     %% io:format(&quot;testing ~s~n&quot;, [binary_to_list(Def)]),
<a name="2270"/> 2270:     DefFile = 'yecc_test.yrl',
<a name="2271"/> 2271:     Filename = 'yecc_test.erl',
<a name="2272"/> 2272:     DataDir = ?privdir,
<a name="2273"/> 2273:     YrlFile = filename:join(DataDir, DefFile),
<a name="2274"/> 2274:     ErlFile = filename:join(DataDir, Filename),
<a name="2275"/> 2275:     Opts = [return, warn_unused_vars,{outdir,DataDir}],
<a name="2276"/> 2276:     ok = file:write_file(YrlFile, Def),
<a name="2277"/> 2277:     YOpts = [return, {report, false} | 
<a name="2278"/> 2278:              case Pre of
<a name="2279"/> 2279:                  default -&gt;
<a name="2280"/> 2280:                      [];
<a name="2281"/> 2281:                  _ -&gt;
<a name="2282"/> 2282:                      [{includefile,Pre}]
<a name="2283"/> 2283:              end],
<a name="2284"/> 2284:     P0 = pps(),
<a name="2285"/> 2285:     YRet = yecc:file(YrlFile, [verbose | YOpts]),
<a name="run_test-last_expr"/><a name="2286"/> 2286: <b>    case {pps</b>(), YRet} of
<a name="2287"/> 2287:         {P0, {ok, _Outfile, _YWs}} -&gt;
<a name="2288"/> 2288:                  case compile:file(ErlFile, Opts) of
<a name="2289"/> 2289:                      {ok, _M, _Ws} -&gt; 
<a name="2290"/> 2290:                          AbsFile = filename:rootname(ErlFile, &quot;.erl&quot;),
<a name="2291"/> 2291:                          Mod = yecc_test,
<a name="2292"/> 2292:                          code:purge(Mod),
<a name="2293"/> 2293:                          code:load_abs(AbsFile, Mod),
<a name="2294"/> 2294:                          Mod:t();
<a name="2295"/> 2295:                          %% warnings(ErlFile, Ws);
<a name="2296"/> 2296:                      {error, [{ErlFile,Es}], []} -&gt; {error, Es, []};
<a name="2297"/> 2297:                      {error, [{ErlFile,Es}], [{ErlFile,Ws}]} -&gt; {error, Es, Ws};
<a name="2298"/> 2298:                      Error  -&gt; Error
<a name="2299"/> 2299:                  end;
<a name="2300"/> 2300:         {P0, {error, [{YrlFile,YEs}], []}} -&gt; {error, YEs, []};
<a name="2301"/> 2301:         {P0, {error, [{YrlFile,YEs}], [{YrlFile,YWs}]}} -&gt; {error, YEs, YWs};
<a name="2302"/> 2302:         {P0, YError} -&gt; YError;
<a name="2303"/> 2303:         {P, _} -&gt;
<a name="2304"/> 2304:             ct:fail(&quot;failure, got ~p~n, expected ~p\n&quot;, [P, P0])
<a name="2305"/> 2305:     end.
<a name="2306"/> 2306: 
<a name="extract-2"/><a name="2307"/> 2307: <b>extract</b>(File, {error, Es, Ws}) -&gt;
<a name="2308"/> 2308:     {errors, extract(File, Es), extract(File, Ws)};    
<a name="2309"/> 2309: <b>extract</b>(File, Ts) -&gt;
<a name="extract-last_expr"/><a name="2310"/> 2310: <b>    lists:append</b>([T || {F, T} &lt;- Ts,  F =:= File]).
<a name="2311"/> 2311: 
<a name="pps-0"/><a name="2312"/> 2312: <b>pps</b>() -&gt;
<a name="pps-last_expr"/><a name="2313"/> 2313: <b>    {port_list</b>(), process_list()}.
<a name="2314"/> 2314: 
<a name="port_list-0"/><a name="2315"/> 2315: <b>port_list</b>() -&gt;
<a name="port_list-last_expr"/><a name="2316"/> 2316: <b>    [{P,safe_second_element</b>(erlang:port_info(P, name))} || P &lt;- erlang:ports()].
<a name="2317"/> 2317: 
<a name="process_list-0"/><a name="2318"/> 2318: <b>process_list</b>() -&gt;
<a name="process_list-last_expr"/><a name="2319"/> 2319: <b>    [{P,process_info</b>(P, registered_name),
<a name="2320"/> 2320:       safe_second_element(process_info(P, initial_call))} || 
<a name="2321"/> 2321:         P &lt;- processes(), is_process_alive(P)].
<a name="2322"/> 2322: 
<a name="safe_second_element-1"/><a name="2323"/> 2323: <b>safe_second_element</b>({_,Info}) -&gt; Info;
<a name="safe_second_element-last_expr"/><a name="2324"/> 2324: <b>safe_second_element</b>(Other) -&gt; Other.
<a name="2325"/> 2325: 
<a name="search_for_file_attr-2"/><a name="2326"/> 2326: <b>search_for_file_attr</b>(PartialFilePathRegex, Forms) -&gt;
<a name="search_for_file_attr-last_expr"/><a name="2327"/> 2327: <b>    lists:search</b>(fun
<a name="2328"/> 2328:                    ({attribute, _, file, {FileAttr, _}}) -&gt;
<a name="2329"/> 2329:                       case re:run(FileAttr, PartialFilePathRegex, [unicode]) of
<a name="2330"/> 2330:                         nomatch -&gt; false;
<a name="2331"/> 2331:                         _ -&gt; true
<a name="2332"/> 2332:                       end;
<a name="2333"/> 2333:                    (_) -&gt; false end,
<a name="2334"/> 2334:                  Forms).
</pre>
<script>
var hash = window.location.hash.substring(1);
var anchor = document.getElementsByName(hash);
anchor[0].style.backgroundColor="orange";
</script>
</body>
</html>
