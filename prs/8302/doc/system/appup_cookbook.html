<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.31.2">
    <meta name="project" content="Erlang System Documentation v27.0-rc2">


    <title>Appup Cookbook — Erlang System Documentation v27.0-rc2</title>
    <link rel="stylesheet" href="dist/html-erlang-DUKXLSAT.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-A7S2WMC7.js"></script>
    <script src="dist/sidebar_items-C6865BFD.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-JRPQ5PR6.js"></script>

<style>.dark img { background-color: white; }</style>
  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<div class="background-layer"></div>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Erlang System Documentation" />
        </a>

      <div>
        <a href="../index.html" class="sidebar-projectName" translate="no">
Erlang System Documentation
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v27.0-rc2
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">
      <div class="top-search">
        <div class="search-settings">
          <form class="search-bar" action="search.html">
            <label class="search-label">
              <span class="sr-only">Search documentation of Erlang System Documentation</span>
              <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
            </label>
            <button type="submit" class="search-button" aria-label="Submit Search">
              <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
            </button>
            <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
              <i class="ri-close-line ri-lg" title="Cancel search"></i>
            </button>
          </form>
          <div class="autocomplete">
          </div>
          <button class="icon-settings display-settings">
            <i class="ri-settings-3-line"></i>
            <span class="sr-only">Settings</span>
          </button>
        </div>

      </div>

<h1>

    <a href="https://github.com/bjorng/otp/blob/bjorn/fix-phis-nodes/GH-8296/system/doc/design_principles/appup_cookbook.md#L1" title="View Source" class="icon-action" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>


  <span>Appup Cookbook</span>
</h1>

<p><a href="" id="appup-cookbook"></a></p><p>This section includes examples of <code class="inline">.appup</code> files for typical cases of
upgrades/downgrades done in runtime.</p><h2 id="changing-a-functional-module" class="section-heading">
  <a href="#changing-a-functional-module" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Changing a Functional Module</span>
</h2>
<p>When a functional module has been changed, for example, if a new function has
been added or a bug has been corrected, simple code replacement is sufficient,
for example:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="2293745458-1">{</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="2293745458-2">[</span><span class="p" data-group-id="2293745458-3">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2293745458-4">[</span><span class="p" data-group-id="2293745458-5">{</span><span class="nb">load_module</span><span class="p">,</span><span class="w"> </span><span class="ss">m</span><span class="p" data-group-id="2293745458-5">}</span><span class="p" data-group-id="2293745458-4">]</span><span class="p" data-group-id="2293745458-3">}</span><span class="p" data-group-id="2293745458-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="2293745458-6">[</span><span class="p" data-group-id="2293745458-7">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2293745458-8">[</span><span class="p" data-group-id="2293745458-9">{</span><span class="nb">load_module</span><span class="p">,</span><span class="w"> </span><span class="ss">m</span><span class="p" data-group-id="2293745458-9">}</span><span class="p" data-group-id="2293745458-8">]</span><span class="p" data-group-id="2293745458-7">}</span><span class="p" data-group-id="2293745458-6">]</span><span class="w">
</span><span class="p" data-group-id="2293745458-1">}</span><span class="p">.</span></code></pre><h2 id="changing-a-residence-module" class="section-heading">
  <a href="#changing-a-residence-module" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Changing a Residence Module</span>
</h2>
<p>In a system implemented according to the OTP design principles, all processes,
except system processes and special processes, reside in one of the behaviours
<code class="inline">supervisor</code>, <code class="inline">gen_server</code>, <code class="inline">gen_fsm</code>, <code class="inline">gen_statem</code> or <code class="inline">gen_event</code>. These belong
to the STDLIB application and upgrading/downgrading normally requires an
emulator restart.</p><p>OTP thus provides no support for changing residence modules except in the case
of <a href="appup_cookbook.html#spec">special processes</a>.</p><h2 id="changing-a-callback-module" class="section-heading">
  <a href="#changing-a-callback-module" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Changing a Callback Module</span>
</h2>
<p>A callback module is a functional module, and for code extensions simple code
replacement is sufficient.</p><p><em>Example:</em> When adding a function to <code class="inline">ch3</code>, as described in the example in
<a href="release_handling.html#appup">Release Handling</a>, <code class="inline">ch_app.appup</code> looks as follows:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="2128965068-1">{</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="2128965068-2">[</span><span class="p" data-group-id="2128965068-3">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2128965068-4">[</span><span class="p" data-group-id="2128965068-5">{</span><span class="nb">load_module</span><span class="p">,</span><span class="w"> </span><span class="ss">ch3</span><span class="p" data-group-id="2128965068-5">}</span><span class="p" data-group-id="2128965068-4">]</span><span class="p" data-group-id="2128965068-3">}</span><span class="p" data-group-id="2128965068-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="2128965068-6">[</span><span class="p" data-group-id="2128965068-7">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2128965068-8">[</span><span class="p" data-group-id="2128965068-9">{</span><span class="nb">load_module</span><span class="p">,</span><span class="w"> </span><span class="ss">ch3</span><span class="p" data-group-id="2128965068-9">}</span><span class="p" data-group-id="2128965068-8">]</span><span class="p" data-group-id="2128965068-7">}</span><span class="p" data-group-id="2128965068-6">]</span><span class="w">
</span><span class="p" data-group-id="2128965068-1">}</span><span class="p">.</span></code></pre><p>OTP also supports changing the internal state of behaviour processes, see
<a href="appup_cookbook.html#int_state">Changing Internal State</a>.</p><p><a href="" id="int_state"></a></p><h2 id="changing-internal-state" class="section-heading">
  <a href="#changing-internal-state" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Changing Internal State</span>
</h2>
<p>In this case, simple code replacement is not sufficient. The process must
explicitly transform its state using the callback function <code class="inline">code_change</code> before
switching to the new version of the callback module. Thus, synchronized code
replacement is used.</p><p><em>Example:</em> Consider <code class="inline">gen_server</code> <code class="inline">ch3</code> from
<a href="gen_server_concepts.html#ex">gen_server Behaviour</a>. The internal state is a term
<code class="inline">Chs</code> representing the available channels. Assume you want to add a counter <code class="inline">N</code>,
which keeps track of the number of <code class="inline">alloc</code> requests so far. This means that the
format must be changed to <code class="inline">{Chs,N}</code>.</p><p>The <code class="inline">.appup</code> file can look as follows:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="5889492846-1">{</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="5889492846-2">[</span><span class="p" data-group-id="5889492846-3">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5889492846-4">[</span><span class="p" data-group-id="5889492846-5">{</span><span class="ss">update</span><span class="p">,</span><span class="w"> </span><span class="ss">ch3</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5889492846-6">{</span><span class="ss">advanced</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5889492846-7">[</span><span class="p" data-group-id="5889492846-7">]</span><span class="p" data-group-id="5889492846-6">}</span><span class="p" data-group-id="5889492846-5">}</span><span class="p" data-group-id="5889492846-4">]</span><span class="p" data-group-id="5889492846-3">}</span><span class="p" data-group-id="5889492846-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="5889492846-8">[</span><span class="p" data-group-id="5889492846-9">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5889492846-10">[</span><span class="p" data-group-id="5889492846-11">{</span><span class="ss">update</span><span class="p">,</span><span class="w"> </span><span class="ss">ch3</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5889492846-12">{</span><span class="ss">advanced</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5889492846-13">[</span><span class="p" data-group-id="5889492846-13">]</span><span class="p" data-group-id="5889492846-12">}</span><span class="p" data-group-id="5889492846-11">}</span><span class="p" data-group-id="5889492846-10">]</span><span class="p" data-group-id="5889492846-9">}</span><span class="p" data-group-id="5889492846-8">]</span><span class="w">
</span><span class="p" data-group-id="5889492846-1">}</span><span class="p">.</span></code></pre><p>The third element of the <code class="inline">update</code> instruction is a tuple <code class="inline">{advanced,Extra}</code>,
which says that the affected processes are to do a state transformation before
loading the new version of the module. This is done by the processes calling the
callback function <code class="inline">code_change</code> (see the <a href="../../lib/stdlib-5.2.1/doc/html/gen_server.html"><code class="inline">gen_server</code></a> manual page in STDLIB).
The term <code class="inline">Extra</code>, in this case <code class="inline">[]</code>, is passed as is to the function:</p><p><a href="" id="code_change"></a></p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="5761504451-1">(</span><span class="ss">ch3</span><span class="p" data-group-id="5761504451-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="5761504451-2">(</span><span class="p" data-group-id="5761504451-3">[</span><span class="ss">code_change</span><span class="p">/</span><span class="mi">3</span><span class="p" data-group-id="5761504451-3">]</span><span class="p" data-group-id="5761504451-2">)</span><span class="p">.</span><span class="w">
</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="nf">code_change</span><span class="p" data-group-id="5761504451-4">(</span><span class="p" data-group-id="5761504451-5">{</span><span class="ss">down</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Vsn</span><span class="p" data-group-id="5761504451-5">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5761504451-6">{</span><span class="n">Chs</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p" data-group-id="5761504451-6">}</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Extra</span><span class="p" data-group-id="5761504451-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5761504451-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Chs</span><span class="p" data-group-id="5761504451-7">}</span><span class="p">;</span><span class="w">
</span><span class="nf">code_change</span><span class="p" data-group-id="5761504451-8">(</span><span class="p">_</span><span class="n">Vsn</span><span class="p">,</span><span class="w"> </span><span class="n">Chs</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Extra</span><span class="p" data-group-id="5761504451-8">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5761504451-9">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5761504451-10">{</span><span class="n">Chs</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5761504451-10">}</span><span class="p" data-group-id="5761504451-9">}</span><span class="p">.</span></code></pre><p>The first argument is <code class="inline">{down,Vsn}</code> if there is a downgrade, or <code class="inline">Vsn</code> if there is
a upgrade. The term <code class="inline">Vsn</code> is fetched from the 'original' version of the module,
that is, the version you are upgrading from, or downgrading to.</p><p>The version is defined by the module attribute <code class="inline">vsn</code>, if any. There is no such
attribute in <code class="inline">ch3</code>, so in this case the version is the checksum (a huge integer)
of the beam file, an uninteresting value, which is ignored.</p><p>The other callback functions of <code class="inline">ch3</code> must also be modified and perhaps a new
interface function must be added, but this is not shown here.</p><h2 id="module-dependencies" class="section-heading">
  <a href="#module-dependencies" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Module Dependencies</span>
</h2>
<p>Assume that a module is extended by adding an interface function, as in the
example in <a href="release_handling.html#appup">Release Handling</a>, where a function
<code class="inline">available/0</code> is added to <code class="inline">ch3</code>.</p><p>If a call is added to this function, say in module <code class="inline">m1</code>, a runtime error could
can occur during release upgrade if the new version of <code class="inline">m1</code> is loaded first and
calls <code class="inline">ch3:available/0</code> before the new version of <code class="inline">ch3</code> is loaded.</p><p>Thus, <code class="inline">ch3</code> must be loaded before <code class="inline">m1</code>, in the upgrade case, and conversely in
the downgrade case. <code class="inline">m1</code> is said to be <em>dependent on</em> <code class="inline">ch3</code>. In a release
handling instruction, this is expressed by the <code class="inline">DepMods</code> element:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="1976729705-1">{</span><span class="nb">load_module</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p">,</span><span class="w"> </span><span class="n">DepMods</span><span class="p" data-group-id="1976729705-1">}</span><span class="w">
</span><span class="p" data-group-id="1976729705-2">{</span><span class="ss">update</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1976729705-3">{</span><span class="ss">advanced</span><span class="p">,</span><span class="w"> </span><span class="n">Extra</span><span class="p" data-group-id="1976729705-3">}</span><span class="p">,</span><span class="w"> </span><span class="n">DepMods</span><span class="p" data-group-id="1976729705-2">}</span></code></pre><p><code class="inline">DepMods</code> is a list of modules, on which <code class="inline">Module</code> is dependent.</p><p><em>Example:</em> The module <code class="inline">m1</code> in application <code class="inline">myapp</code> is dependent on <code class="inline">ch3</code> when
upgrading from &quot;1&quot; to &quot;2&quot;, or downgrading from &quot;2&quot; to &quot;1&quot;:</p><pre><code class="makeup erlang" translate="no"><span class="ss">myapp</span><span class="p">.</span><span class="nc">appup</span><span class="p">:</span><span class="w">

</span><span class="p" data-group-id="0375833235-1">{</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="0375833235-2">[</span><span class="p" data-group-id="0375833235-3">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0375833235-4">[</span><span class="p" data-group-id="0375833235-5">{</span><span class="nb">load_module</span><span class="p">,</span><span class="w"> </span><span class="ss">m1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0375833235-6">[</span><span class="ss">ch3</span><span class="p" data-group-id="0375833235-6">]</span><span class="p" data-group-id="0375833235-5">}</span><span class="p" data-group-id="0375833235-4">]</span><span class="p" data-group-id="0375833235-3">}</span><span class="p" data-group-id="0375833235-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="0375833235-7">[</span><span class="p" data-group-id="0375833235-8">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0375833235-9">[</span><span class="p" data-group-id="0375833235-10">{</span><span class="nb">load_module</span><span class="p">,</span><span class="w"> </span><span class="ss">m1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0375833235-11">[</span><span class="ss">ch3</span><span class="p" data-group-id="0375833235-11">]</span><span class="p" data-group-id="0375833235-10">}</span><span class="p" data-group-id="0375833235-9">]</span><span class="p" data-group-id="0375833235-8">}</span><span class="p" data-group-id="0375833235-7">]</span><span class="w">
</span><span class="p" data-group-id="0375833235-1">}</span><span class="p">.</span><span class="w">

</span><span class="ss">ch_app</span><span class="p">.</span><span class="nc">appup</span><span class="p">:</span><span class="w">

</span><span class="p" data-group-id="0375833235-12">{</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="0375833235-13">[</span><span class="p" data-group-id="0375833235-14">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0375833235-15">[</span><span class="p" data-group-id="0375833235-16">{</span><span class="nb">load_module</span><span class="p">,</span><span class="w"> </span><span class="ss">ch3</span><span class="p" data-group-id="0375833235-16">}</span><span class="p" data-group-id="0375833235-15">]</span><span class="p" data-group-id="0375833235-14">}</span><span class="p" data-group-id="0375833235-13">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="0375833235-17">[</span><span class="p" data-group-id="0375833235-18">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0375833235-19">[</span><span class="p" data-group-id="0375833235-20">{</span><span class="nb">load_module</span><span class="p">,</span><span class="w"> </span><span class="ss">ch3</span><span class="p" data-group-id="0375833235-20">}</span><span class="p" data-group-id="0375833235-19">]</span><span class="p" data-group-id="0375833235-18">}</span><span class="p" data-group-id="0375833235-17">]</span><span class="w">
</span><span class="p" data-group-id="0375833235-12">}</span><span class="p">.</span></code></pre><p>If instead <code class="inline">m1</code> and <code class="inline">ch3</code> belong to the same application, the <code class="inline">.appup</code> file can
look as follows:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="6762750737-1">{</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="6762750737-2">[</span><span class="p" data-group-id="6762750737-3">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="6762750737-4">[</span><span class="p" data-group-id="6762750737-5">{</span><span class="nb">load_module</span><span class="p">,</span><span class="w"> </span><span class="ss">ch3</span><span class="p" data-group-id="6762750737-5">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6762750737-6">{</span><span class="nb">load_module</span><span class="p">,</span><span class="w"> </span><span class="ss">m1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6762750737-7">[</span><span class="ss">ch3</span><span class="p" data-group-id="6762750737-7">]</span><span class="p" data-group-id="6762750737-6">}</span><span class="p" data-group-id="6762750737-4">]</span><span class="p" data-group-id="6762750737-3">}</span><span class="p" data-group-id="6762750737-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="6762750737-8">[</span><span class="p" data-group-id="6762750737-9">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="6762750737-10">[</span><span class="p" data-group-id="6762750737-11">{</span><span class="nb">load_module</span><span class="p">,</span><span class="w"> </span><span class="ss">ch3</span><span class="p" data-group-id="6762750737-11">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6762750737-12">{</span><span class="nb">load_module</span><span class="p">,</span><span class="w"> </span><span class="ss">m1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6762750737-13">[</span><span class="ss">ch3</span><span class="p" data-group-id="6762750737-13">]</span><span class="p" data-group-id="6762750737-12">}</span><span class="p" data-group-id="6762750737-10">]</span><span class="p" data-group-id="6762750737-9">}</span><span class="p" data-group-id="6762750737-8">]</span><span class="w">
</span><span class="p" data-group-id="6762750737-1">}</span><span class="p">.</span></code></pre><p><code class="inline">m1</code> is dependent on <code class="inline">ch3</code> also when downgrading. <code class="inline">systools</code> knows the
difference between up- and downgrading and generates a correct <code class="inline">relup</code>, where
<code class="inline">ch3</code> is loaded before <code class="inline">m1</code> when upgrading, but <code class="inline">m1</code> is loaded before <code class="inline">ch3</code> when
downgrading.</p><p><a href="" id="spec"></a></p><h2 id="changing-code-for-a-special-process" class="section-heading">
  <a href="#changing-code-for-a-special-process" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Changing Code for a Special Process</span>
</h2>
<p>In this case, simple code replacement is not sufficient. When a new version of a
residence module for a special process is loaded, the process must make a fully
qualified call to its loop function to switch to the new code. Thus,
synchronized code replacement must be used.</p><blockquote><h4 class="info">Note</h4><p>The name(s) of the user-defined residence module(s) must be listed in the
<code class="inline">Modules</code> part of the child specification for the special process. Otherwise
the release handler cannot find the process.</p></blockquote><p><em>Example:</em> Consider the example <code class="inline">ch4</code> in <a href="spec_proc.html#ex">sys and proc_lib</a>.
When started by a supervisor, the child specification can look as follows:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="5331922931-1">{</span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5331922931-2">{</span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="ss">start_link</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5331922931-3">[</span><span class="p" data-group-id="5331922931-3">]</span><span class="p" data-group-id="5331922931-2">}</span><span class="p">,</span><span class="w">
 </span><span class="ss">permanent</span><span class="p">,</span><span class="w"> </span><span class="ss">brutal_kill</span><span class="p">,</span><span class="w"> </span><span class="ss">worker</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5331922931-4">[</span><span class="ss">ch4</span><span class="p" data-group-id="5331922931-4">]</span><span class="p" data-group-id="5331922931-1">}</span></code></pre><p>If <code class="inline">ch4</code> is part of the application <code class="inline">sp_app</code> and a new version of the module is
to be loaded when upgrading from version &quot;1&quot; to &quot;2&quot; of this application,
<code class="inline">sp_app.appup</code> can look as follows:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="7025689854-1">{</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="7025689854-2">[</span><span class="p" data-group-id="7025689854-3">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7025689854-4">[</span><span class="p" data-group-id="7025689854-5">{</span><span class="ss">update</span><span class="p">,</span><span class="w"> </span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7025689854-6">{</span><span class="ss">advanced</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7025689854-7">[</span><span class="p" data-group-id="7025689854-7">]</span><span class="p" data-group-id="7025689854-6">}</span><span class="p" data-group-id="7025689854-5">}</span><span class="p" data-group-id="7025689854-4">]</span><span class="p" data-group-id="7025689854-3">}</span><span class="p" data-group-id="7025689854-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="7025689854-8">[</span><span class="p" data-group-id="7025689854-9">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7025689854-10">[</span><span class="p" data-group-id="7025689854-11">{</span><span class="ss">update</span><span class="p">,</span><span class="w"> </span><span class="ss">ch4</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7025689854-12">{</span><span class="ss">advanced</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7025689854-13">[</span><span class="p" data-group-id="7025689854-13">]</span><span class="p" data-group-id="7025689854-12">}</span><span class="p" data-group-id="7025689854-11">}</span><span class="p" data-group-id="7025689854-10">]</span><span class="p" data-group-id="7025689854-9">}</span><span class="p" data-group-id="7025689854-8">]</span><span class="w">
</span><span class="p" data-group-id="7025689854-1">}</span><span class="p">.</span></code></pre><p>The <code class="inline">update</code> instruction must contain the tuple <code class="inline">{advanced,Extra}</code>. The
instruction makes the special process call the callback function
<code class="inline">system_code_change/4</code>, a function the user must implement. The term <code class="inline">Extra</code>, in
this case <code class="inline">[]</code>, is passed as is to <code class="inline">system_code_change/4</code>:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1853711123-1">(</span><span class="ss">ch4</span><span class="p" data-group-id="1853711123-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1853711123-2">(</span><span class="p" data-group-id="1853711123-3">[</span><span class="ss">system_code_change</span><span class="p">/</span><span class="mi">4</span><span class="p" data-group-id="1853711123-3">]</span><span class="p" data-group-id="1853711123-2">)</span><span class="p">.</span><span class="w">
</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">

</span><span class="nf">system_code_change</span><span class="p" data-group-id="1853711123-4">(</span><span class="n">Chs</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Module</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">OldVsn</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Extra</span><span class="p" data-group-id="1853711123-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1853711123-5">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Chs</span><span class="p" data-group-id="1853711123-5">}</span><span class="p">.</span></code></pre><ul><li>The first argument is the internal state <code class="inline">State</code>, passed from function
<code class="inline">sys:handle_system_msg(Request, From, Parent, Module, Deb, State)</code>, and called
by the special process when a system message is received. In <code class="inline">ch4</code>, the
internal state is the set of available channels <code class="inline">Chs</code>.</li><li>The second argument is the name of the module (<code class="inline">ch4</code>).</li><li>The third argument is <code class="inline">Vsn</code> or <code class="inline">{down,Vsn}</code>, as described for
<a href="../../lib/stdlib-5.2.1/doc/html/gen_server.html#c:code_change/3"><code class="inline">gen_server:code_change/3</code></a> in
<a href="appup_cookbook.html#code_change">Changing Internal State</a>.</li></ul><p>In this case, all arguments but the first are ignored and the function simply
returns the internal state again. This is enough if the code only has been
extended. If instead the internal state is changed (similar to the example in
<a href="appup_cookbook.html#int_state">Changing Internal State</a>), this is done in this
function and <code class="inline">{ok,Chs2}</code> returned.</p><p><a href="" id="sup"></a></p><h2 id="changing-a-supervisor" class="section-heading">
  <a href="#changing-a-supervisor" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Changing a Supervisor</span>
</h2>
<p>The supervisor behaviour supports changing the internal state, that is, changing
the restart strategy and maximum restart frequency properties, as well as
changing the existing child specifications.</p><p>Child processes can be added or deleted, but this is not handled automatically.
Instructions must be given by in the <code class="inline">.appup</code> file.</p><h3 id="changing-properties" class="section-heading">
  <a href="#changing-properties" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Changing Properties</span>
</h3>
<p>Since the supervisor is to change its internal state, synchronized code
replacement is required. However, a special <code class="inline">update</code> instruction must be used.</p><p>First, the new version of the callback module must be loaded, both in the case
of upgrade and downgrade. Then the new return value of <code class="inline">init/1</code> can be checked
and the internal state be changed accordingly.</p><p>The following <code class="inline">upgrade</code> instruction is used for supervisors:</p><pre><code class="text">{update, Module, supervisor}</code></pre><p><em>Example:</em> To change the restart strategy of <code class="inline">ch_sup</code> (from
<a href="sup_princ.html#ex">Supervisor Behaviour</a>) from <code class="inline">one_for_one</code> to <code class="inline">one_for_all</code>,
change the callback function <code class="inline">init/1</code> in <code class="inline">ch_sup.erl</code>:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="8269149950-1">(</span><span class="ss">ch_sup</span><span class="p" data-group-id="8269149950-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">

</span><span class="nf">init</span><span class="p" data-group-id="8269149950-2">(</span><span class="p">_</span><span class="n">Args</span><span class="p" data-group-id="8269149950-2">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8269149950-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8269149950-4">{</span><span class="p" data-group-id="8269149950-5">#{</span><span class="ss">strategy</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">one_for_all</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="8269149950-5">}</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="8269149950-4">}</span><span class="p" data-group-id="8269149950-3">}</span><span class="p">.</span></code></pre><p>The file <code class="inline">ch_app.appup</code>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="0195830408-1">{</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="0195830408-2">[</span><span class="p" data-group-id="0195830408-3">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0195830408-4">[</span><span class="p" data-group-id="0195830408-5">{</span><span class="ss">update</span><span class="p">,</span><span class="w"> </span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="ss">supervisor</span><span class="p" data-group-id="0195830408-5">}</span><span class="p" data-group-id="0195830408-4">]</span><span class="p" data-group-id="0195830408-3">}</span><span class="p" data-group-id="0195830408-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="0195830408-6">[</span><span class="p" data-group-id="0195830408-7">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0195830408-8">[</span><span class="p" data-group-id="0195830408-9">{</span><span class="ss">update</span><span class="p">,</span><span class="w"> </span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="ss">supervisor</span><span class="p" data-group-id="0195830408-9">}</span><span class="p" data-group-id="0195830408-8">]</span><span class="p" data-group-id="0195830408-7">}</span><span class="p" data-group-id="0195830408-6">]</span><span class="w">
</span><span class="p" data-group-id="0195830408-1">}</span><span class="p">.</span></code></pre><h3 id="changing-child-specifications" class="section-heading">
  <a href="#changing-child-specifications" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Changing Child Specifications</span>
</h3>
<p>The instruction, and thus the <code class="inline">.appup</code> file, when changing an existing child
specification, is the same as when changing properties as described earlier:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="4653152092-1">{</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="4653152092-2">[</span><span class="p" data-group-id="4653152092-3">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4653152092-4">[</span><span class="p" data-group-id="4653152092-5">{</span><span class="ss">update</span><span class="p">,</span><span class="w"> </span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="ss">supervisor</span><span class="p" data-group-id="4653152092-5">}</span><span class="p" data-group-id="4653152092-4">]</span><span class="p" data-group-id="4653152092-3">}</span><span class="p" data-group-id="4653152092-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="4653152092-6">[</span><span class="p" data-group-id="4653152092-7">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4653152092-8">[</span><span class="p" data-group-id="4653152092-9">{</span><span class="ss">update</span><span class="p">,</span><span class="w"> </span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="ss">supervisor</span><span class="p" data-group-id="4653152092-9">}</span><span class="p" data-group-id="4653152092-8">]</span><span class="p" data-group-id="4653152092-7">}</span><span class="p" data-group-id="4653152092-6">]</span><span class="w">
</span><span class="p" data-group-id="4653152092-1">}</span><span class="p">.</span></code></pre><p>The changes do not affect existing child processes. For example, changing the
start function only specifies how the child process is to be restarted, if
needed later on.</p><p>The id of the child specification cannot be changed.</p><p>Changing the <code class="inline">Modules</code> field of the child specification can affect the release
handling process itself, as this field is used to identify which processes are
affected when doing a synchronized code replacement.</p><p><a href="" id="sup_add"></a></p><h3 id="adding-and-deleting-child-processes" class="section-heading">
  <a href="#adding-and-deleting-child-processes" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Adding and Deleting Child Processes</span>
</h3>
<p>As stated earlier, changing child specifications does not affect existing child
processes. New child specifications are automatically added, but not deleted.
Child processes are not automatically started or terminated, this must be done
using <code class="inline">apply</code> instructions.</p><p><em>Example:</em> Assume a new child process <code class="inline">m1</code> is to be added to <code class="inline">ch_sup</code> when
upgrading <code class="inline">ch_app</code> from &quot;1&quot; to &quot;2&quot;. This means <code class="inline">m1</code> is to be deleted when
downgrading from &quot;2&quot; to &quot;1&quot;:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="9701193298-1">{</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="9701193298-2">[</span><span class="p" data-group-id="9701193298-3">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="9701193298-4">[</span><span class="p" data-group-id="9701193298-5">{</span><span class="ss">update</span><span class="p">,</span><span class="w"> </span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="ss">supervisor</span><span class="p" data-group-id="9701193298-5">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9701193298-6">{</span><span class="nb">apply</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9701193298-7">{</span><span class="ss">supervisor</span><span class="p">,</span><span class="w"> </span><span class="ss">restart_child</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9701193298-8">[</span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="ss">m1</span><span class="p" data-group-id="9701193298-8">]</span><span class="p" data-group-id="9701193298-7">}</span><span class="p" data-group-id="9701193298-6">}</span><span class="w">
   </span><span class="p" data-group-id="9701193298-4">]</span><span class="p" data-group-id="9701193298-3">}</span><span class="p" data-group-id="9701193298-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="9701193298-9">[</span><span class="p" data-group-id="9701193298-10">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="9701193298-11">[</span><span class="p" data-group-id="9701193298-12">{</span><span class="nb">apply</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9701193298-13">{</span><span class="ss">supervisor</span><span class="p">,</span><span class="w"> </span><span class="ss">terminate_child</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9701193298-14">[</span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="ss">m1</span><span class="p" data-group-id="9701193298-14">]</span><span class="p" data-group-id="9701193298-13">}</span><span class="p" data-group-id="9701193298-12">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9701193298-15">{</span><span class="nb">apply</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9701193298-16">{</span><span class="ss">supervisor</span><span class="p">,</span><span class="w"> </span><span class="ss">delete_child</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9701193298-17">[</span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="ss">m1</span><span class="p" data-group-id="9701193298-17">]</span><span class="p" data-group-id="9701193298-16">}</span><span class="p" data-group-id="9701193298-15">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9701193298-18">{</span><span class="ss">update</span><span class="p">,</span><span class="w"> </span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="ss">supervisor</span><span class="p" data-group-id="9701193298-18">}</span><span class="w">
   </span><span class="p" data-group-id="9701193298-11">]</span><span class="p" data-group-id="9701193298-10">}</span><span class="p" data-group-id="9701193298-9">]</span><span class="w">
</span><span class="p" data-group-id="9701193298-1">}</span><span class="p">.</span></code></pre><p>The order of the instructions is important.</p><p>The supervisor must be registered as <code class="inline">ch_sup</code> for the script to work. If the
supervisor is not registered, it cannot be accessed directly from the script.
Instead a help function that finds the pid of the supervisor and calls
<code class="inline">supervisor:restart_child</code>, and so on, must be written. This function is then to
be called from the script using the <code class="inline">apply</code> instruction.</p><p>If the module <code class="inline">m1</code> is introduced in version &quot;2&quot; of <code class="inline">ch_app</code>, it must also be
loaded when upgrading and deleted when downgrading:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="6606427194-1">{</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="6606427194-2">[</span><span class="p" data-group-id="6606427194-3">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="6606427194-4">[</span><span class="p" data-group-id="6606427194-5">{</span><span class="ss">add_module</span><span class="p">,</span><span class="w"> </span><span class="ss">m1</span><span class="p" data-group-id="6606427194-5">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6606427194-6">{</span><span class="ss">update</span><span class="p">,</span><span class="w"> </span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="ss">supervisor</span><span class="p" data-group-id="6606427194-6">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6606427194-7">{</span><span class="nb">apply</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6606427194-8">{</span><span class="ss">supervisor</span><span class="p">,</span><span class="w"> </span><span class="ss">restart_child</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6606427194-9">[</span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="ss">m1</span><span class="p" data-group-id="6606427194-9">]</span><span class="p" data-group-id="6606427194-8">}</span><span class="p" data-group-id="6606427194-7">}</span><span class="w">
   </span><span class="p" data-group-id="6606427194-4">]</span><span class="p" data-group-id="6606427194-3">}</span><span class="p" data-group-id="6606427194-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="6606427194-10">[</span><span class="p" data-group-id="6606427194-11">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="6606427194-12">[</span><span class="p" data-group-id="6606427194-13">{</span><span class="nb">apply</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6606427194-14">{</span><span class="ss">supervisor</span><span class="p">,</span><span class="w"> </span><span class="ss">terminate_child</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6606427194-15">[</span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="ss">m1</span><span class="p" data-group-id="6606427194-15">]</span><span class="p" data-group-id="6606427194-14">}</span><span class="p" data-group-id="6606427194-13">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6606427194-16">{</span><span class="nb">apply</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6606427194-17">{</span><span class="ss">supervisor</span><span class="p">,</span><span class="w"> </span><span class="ss">delete_child</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6606427194-18">[</span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="ss">m1</span><span class="p" data-group-id="6606427194-18">]</span><span class="p" data-group-id="6606427194-17">}</span><span class="p" data-group-id="6606427194-16">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6606427194-19">{</span><span class="ss">update</span><span class="p">,</span><span class="w"> </span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="ss">supervisor</span><span class="p" data-group-id="6606427194-19">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6606427194-20">{</span><span class="nb">delete_module</span><span class="p">,</span><span class="w"> </span><span class="ss">m1</span><span class="p" data-group-id="6606427194-20">}</span><span class="w">
   </span><span class="p" data-group-id="6606427194-12">]</span><span class="p" data-group-id="6606427194-11">}</span><span class="p" data-group-id="6606427194-10">]</span><span class="w">
</span><span class="p" data-group-id="6606427194-1">}</span><span class="p">.</span></code></pre><p>As stated earlier, the order of the instructions is important. When upgrading,
<code class="inline">m1</code> must be loaded, and the supervisor child specification changed, before the
new child process can be started. When downgrading, the child process must be
terminated before the child specification is changed and the module is deleted.</p><h2 id="adding-or-deleting-a-module" class="section-heading">
  <a href="#adding-or-deleting-a-module" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Adding or Deleting a Module</span>
</h2>
<p><em>Example:</em> A new functional module <code class="inline">m</code> is added to <code class="inline">ch_app</code>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="3444421003-1">{</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="3444421003-2">[</span><span class="p" data-group-id="3444421003-3">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3444421003-4">[</span><span class="p" data-group-id="3444421003-5">{</span><span class="ss">add_module</span><span class="p">,</span><span class="w"> </span><span class="ss">m</span><span class="p" data-group-id="3444421003-5">}</span><span class="p" data-group-id="3444421003-4">]</span><span class="p" data-group-id="3444421003-3">}</span><span class="p" data-group-id="3444421003-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="3444421003-6">[</span><span class="p" data-group-id="3444421003-7">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3444421003-8">[</span><span class="p" data-group-id="3444421003-9">{</span><span class="nb">delete_module</span><span class="p">,</span><span class="w"> </span><span class="ss">m</span><span class="p" data-group-id="3444421003-9">}</span><span class="p" data-group-id="3444421003-8">]</span><span class="p" data-group-id="3444421003-7">}</span><span class="p" data-group-id="3444421003-6">]</span></code></pre><h2 id="starting-or-terminating-a-process" class="section-heading">
  <a href="#starting-or-terminating-a-process" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Starting or Terminating a Process</span>
</h2>
<p>In a system structured according to the OTP design principles, any process would
be a child process belonging to a supervisor, see
<a href="appup_cookbook.html#sup_add">Adding and Deleting Child Processes</a> in Changing a
Supervisor.</p><h2 id="adding-or-removing-an-application" class="section-heading">
  <a href="#adding-or-removing-an-application" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Adding or Removing an Application</span>
</h2>
<p>When adding or removing an application, no <code class="inline">.appup</code> file is needed. When
generating <code class="inline">relup</code>, the <code class="inline">.rel</code> files are compared and the <code class="inline">add_application</code> and
<code class="inline">remove_application</code> instructions are added automatically.</p><h2 id="restarting-an-application" class="section-heading">
  <a href="#restarting-an-application" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Restarting an Application</span>
</h2>
<p>Restarting an application is useful when a change is too complicated to be made
without restarting the processes, for example, if the supervisor hierarchy has
been restructured.</p><p><em>Example:</em> When adding a child <code class="inline">m1</code> to <code class="inline">ch_sup</code>, as in
<a href="appup_cookbook.html#sup_add">Adding and Deleting Child Processes</a> in Changing a
Supervisor, an alternative to updating the supervisor is to restart the entire
application:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="1917024750-1">{</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="1917024750-2">[</span><span class="p" data-group-id="1917024750-3">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1917024750-4">[</span><span class="p" data-group-id="1917024750-5">{</span><span class="ss">restart_application</span><span class="p">,</span><span class="w"> </span><span class="ss">ch_app</span><span class="p" data-group-id="1917024750-5">}</span><span class="p" data-group-id="1917024750-4">]</span><span class="p" data-group-id="1917024750-3">}</span><span class="p" data-group-id="1917024750-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="1917024750-6">[</span><span class="p" data-group-id="1917024750-7">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1917024750-8">[</span><span class="p" data-group-id="1917024750-9">{</span><span class="ss">restart_application</span><span class="p">,</span><span class="w"> </span><span class="ss">ch_app</span><span class="p" data-group-id="1917024750-9">}</span><span class="p" data-group-id="1917024750-8">]</span><span class="p" data-group-id="1917024750-7">}</span><span class="p" data-group-id="1917024750-6">]</span><span class="w">
</span><span class="p" data-group-id="1917024750-1">}</span><span class="p">.</span></code></pre><p><a href="" id="app_spec"></a></p><h2 id="changing-an-application-specification" class="section-heading">
  <a href="#changing-an-application-specification" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Changing an Application Specification</span>
</h2>
<p>When installing a release, the application specifications are automatically
updated before evaluating the <code class="inline">relup</code> script. Thus, no instructions are needed
in the <code class="inline">.appup</code> file:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="2124500953-1">{</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="2124500953-2">[</span><span class="p" data-group-id="2124500953-3">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2124500953-4">[</span><span class="p" data-group-id="2124500953-4">]</span><span class="p" data-group-id="2124500953-3">}</span><span class="p" data-group-id="2124500953-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="2124500953-5">[</span><span class="p" data-group-id="2124500953-6">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2124500953-7">[</span><span class="p" data-group-id="2124500953-7">]</span><span class="p" data-group-id="2124500953-6">}</span><span class="p" data-group-id="2124500953-5">]</span><span class="w">
</span><span class="p" data-group-id="2124500953-1">}</span><span class="p">.</span></code></pre><h2 id="changing-application-configuration" class="section-heading">
  <a href="#changing-application-configuration" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Changing Application Configuration</span>
</h2>
<p>Changing an application configuration by updating the <code class="inline">env</code> key in the <code class="inline">.app</code>
file is an instance of changing an application specification, see the previous
section.</p><p>Alternatively, application configuration parameters can be added or updated in
<code class="inline">sys.config</code>.</p><h2 id="changing-included-applications" class="section-heading">
  <a href="#changing-included-applications" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Changing Included Applications</span>
</h2>
<p>The release handling instructions for adding, removing, and restarting
applications apply to primary applications only. There are no corresponding
instructions for included applications. However, since an included application
is really a supervision tree with a topmost supervisor, started as a child
process to a supervisor in the including application, a <code class="inline">relup</code> file can be
manually created.</p><p><em>Example:</em> Assume there is a release containing an application <code class="inline">prim_app</code>, which
have a supervisor <code class="inline">prim_sup</code> in its supervision tree.</p><p>In a new version of the release, the application <code class="inline">ch_app</code> is to be included in
<code class="inline">prim_app</code>. That is, its topmost supervisor <code class="inline">ch_sup</code> is to be started as a child
process to <code class="inline">prim_sup</code>.</p><p>The workflow is as follows:</p><p><em>Step 1)</em> Edit the code for <code class="inline">prim_sup</code>:</p><pre><code class="makeup erlang" translate="no"><span class="nf">init</span><span class="p" data-group-id="5757785375-1">(</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="5757785375-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5757785375-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5757785375-3">{</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="ss">supervisor</span><span class="w"> </span><span class="ss">flags</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">,</span><span class="w">
          </span><span class="p" data-group-id="5757785375-4">[</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">,</span><span class="w">
           </span><span class="p" data-group-id="5757785375-5">{</span><span class="ss">ch_sup</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5757785375-6">{</span><span class="ss">ch_sup</span><span class="p">,</span><span class="ss">start_link</span><span class="p">,</span><span class="p" data-group-id="5757785375-7">[</span><span class="p" data-group-id="5757785375-7">]</span><span class="p" data-group-id="5757785375-6">}</span><span class="p">,</span><span class="w">
            </span><span class="ss">permanent</span><span class="p">,</span><span class="ss">infinity</span><span class="p">,</span><span class="ss">supervisor</span><span class="p">,</span><span class="p" data-group-id="5757785375-8">[</span><span class="ss">ch_sup</span><span class="p" data-group-id="5757785375-8">]</span><span class="p" data-group-id="5757785375-5">}</span><span class="p">,</span><span class="w">
           </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="5757785375-4">]</span><span class="p" data-group-id="5757785375-3">}</span><span class="p" data-group-id="5757785375-2">}</span><span class="p">.</span></code></pre><p><em>Step 2)</em> Edit the <code class="inline">.app</code> file for <code class="inline">prim_app</code>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="2660366005-1">{</span><span class="ss">application</span><span class="p">,</span><span class="w"> </span><span class="ss">prim_app</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="2660366005-2">[</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="2660366005-3">{</span><span class="ss">vsn</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="p" data-group-id="2660366005-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="2660366005-4">{</span><span class="ss">included_applications</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2660366005-5">[</span><span class="ss">ch_app</span><span class="p" data-group-id="2660366005-5">]</span><span class="p" data-group-id="2660366005-4">}</span><span class="p">,</span><span class="w">
  </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
 </span><span class="p" data-group-id="2660366005-2">]</span><span class="p" data-group-id="2660366005-1">}</span><span class="p">.</span></code></pre><p><em>Step 3)</em> Create a new <code class="inline">.rel</code> file, including <code class="inline">ch_app</code>:</p><pre><code class="text">{release,
 ...,
 [...,
  {prim_app, &quot;2&quot;},
  {ch_app, &quot;1&quot;}]}.</code></pre><p>The included application can be started in two ways. This is described in the
next two sections.</p><h3 id="application-restart" class="section-heading">
  <a href="#application-restart" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Application Restart</span>
</h3>
<p><em>Step 4a)</em> One way to start the included application is to restart the entire
<code class="inline">prim_app</code> application. Normally, the <code class="inline">restart_application</code> instruction in the
<code class="inline">.appup</code> file for <code class="inline">prim_app</code> would be used.</p><p>However, if this is done and a <code class="inline">relup</code> file is generated, not only would it
contain instructions for restarting (that is, removing and adding) <code class="inline">prim_app</code>,
it would also contain instructions for starting <code class="inline">ch_app</code> (and stopping it, in
the case of downgrade). This is because <code class="inline">ch_app</code> is included in the new <code class="inline">.rel</code>
file, but not in the old one.</p><p>Instead, a correct <code class="inline">relup</code> file can be created manually, either from scratch or
by editing the generated version. The instructions for starting/stopping
<code class="inline">ch_app</code> are replaced by instructions for loading/unloading the application:</p><pre><code class="makeup c" translate="no"><span class="p" data-group-id="2925492494-1">{</span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="2925492494-2">[</span><span class="p" data-group-id="2925492494-3">{</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="2925492494-4">[</span><span class="p" data-group-id="2925492494-4">]</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="2925492494-5">[</span><span class="p" data-group-id="2925492494-6">{</span><span class="n">load_object_code</span><span class="p">,</span><span class="p" data-group-id="2925492494-7">{</span><span class="n">ch_app</span><span class="p">,</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="p" data-group-id="2925492494-8">[</span><span class="n">ch_sup</span><span class="p">,</span><span class="n">ch3</span><span class="p" data-group-id="2925492494-8">]</span><span class="p" data-group-id="2925492494-7">}</span><span class="p" data-group-id="2925492494-6">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-9">{</span><span class="n">load_object_code</span><span class="p">,</span><span class="p" data-group-id="2925492494-10">{</span><span class="n">prim_app</span><span class="p">,</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="p" data-group-id="2925492494-11">[</span><span class="n">prim_app</span><span class="p">,</span><span class="n">prim_sup</span><span class="p" data-group-id="2925492494-11">]</span><span class="p" data-group-id="2925492494-10">}</span><span class="p" data-group-id="2925492494-9">}</span><span class="p">,</span><span class="w">
    </span><span class="n">point_of_no_return</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-12">{</span><span class="n">apply</span><span class="p">,</span><span class="p" data-group-id="2925492494-13">{</span><span class="n">application</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="p" data-group-id="2925492494-14">[</span><span class="n">prim_app</span><span class="p" data-group-id="2925492494-14">]</span><span class="p" data-group-id="2925492494-13">}</span><span class="p" data-group-id="2925492494-12">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-15">{</span><span class="n">remove</span><span class="p">,</span><span class="p" data-group-id="2925492494-16">{</span><span class="n">prim_app</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p" data-group-id="2925492494-16">}</span><span class="p" data-group-id="2925492494-15">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-17">{</span><span class="n">remove</span><span class="p">,</span><span class="p" data-group-id="2925492494-18">{</span><span class="n">prim_sup</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p" data-group-id="2925492494-18">}</span><span class="p" data-group-id="2925492494-17">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-19">{</span><span class="n">purge</span><span class="p">,</span><span class="p" data-group-id="2925492494-20">[</span><span class="n">prim_app</span><span class="p">,</span><span class="n">prim_sup</span><span class="p" data-group-id="2925492494-20">]</span><span class="p" data-group-id="2925492494-19">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-21">{</span><span class="n">load</span><span class="p">,</span><span class="p" data-group-id="2925492494-22">{</span><span class="n">prim_app</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p" data-group-id="2925492494-22">}</span><span class="p" data-group-id="2925492494-21">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-23">{</span><span class="n">load</span><span class="p">,</span><span class="p" data-group-id="2925492494-24">{</span><span class="n">prim_sup</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p" data-group-id="2925492494-24">}</span><span class="p" data-group-id="2925492494-23">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-25">{</span><span class="n">load</span><span class="p">,</span><span class="p" data-group-id="2925492494-26">{</span><span class="n">ch_sup</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p" data-group-id="2925492494-26">}</span><span class="p" data-group-id="2925492494-25">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-27">{</span><span class="n">load</span><span class="p">,</span><span class="p" data-group-id="2925492494-28">{</span><span class="n">ch3</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p" data-group-id="2925492494-28">}</span><span class="p" data-group-id="2925492494-27">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-29">{</span><span class="n">apply</span><span class="p">,</span><span class="p" data-group-id="2925492494-30">{</span><span class="n">application</span><span class="p">,</span><span class="n">load</span><span class="p">,</span><span class="p" data-group-id="2925492494-31">[</span><span class="n">ch_app</span><span class="p" data-group-id="2925492494-31">]</span><span class="p" data-group-id="2925492494-30">}</span><span class="p" data-group-id="2925492494-29">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-32">{</span><span class="n">apply</span><span class="p">,</span><span class="p" data-group-id="2925492494-33">{</span><span class="n">application</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="p" data-group-id="2925492494-34">[</span><span class="n">prim_app</span><span class="p">,</span><span class="n">permanent</span><span class="p" data-group-id="2925492494-34">]</span><span class="p" data-group-id="2925492494-33">}</span><span class="p" data-group-id="2925492494-32">}</span><span class="p" data-group-id="2925492494-5">]</span><span class="p" data-group-id="2925492494-3">}</span><span class="p" data-group-id="2925492494-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="2925492494-35">[</span><span class="p" data-group-id="2925492494-36">{</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="2925492494-37">[</span><span class="p" data-group-id="2925492494-37">]</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="2925492494-38">[</span><span class="p" data-group-id="2925492494-39">{</span><span class="n">load_object_code</span><span class="p">,</span><span class="p" data-group-id="2925492494-40">{</span><span class="n">prim_app</span><span class="p">,</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="p" data-group-id="2925492494-41">[</span><span class="n">prim_app</span><span class="p">,</span><span class="n">prim_sup</span><span class="p" data-group-id="2925492494-41">]</span><span class="p" data-group-id="2925492494-40">}</span><span class="p" data-group-id="2925492494-39">}</span><span class="p">,</span><span class="w">
    </span><span class="n">point_of_no_return</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-42">{</span><span class="n">apply</span><span class="p">,</span><span class="p" data-group-id="2925492494-43">{</span><span class="n">application</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="p" data-group-id="2925492494-44">[</span><span class="n">prim_app</span><span class="p" data-group-id="2925492494-44">]</span><span class="p" data-group-id="2925492494-43">}</span><span class="p" data-group-id="2925492494-42">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-45">{</span><span class="n">apply</span><span class="p">,</span><span class="p" data-group-id="2925492494-46">{</span><span class="n">application</span><span class="p">,</span><span class="n">unload</span><span class="p">,</span><span class="p" data-group-id="2925492494-47">[</span><span class="n">ch_app</span><span class="p" data-group-id="2925492494-47">]</span><span class="p" data-group-id="2925492494-46">}</span><span class="p" data-group-id="2925492494-45">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-48">{</span><span class="n">remove</span><span class="p">,</span><span class="p" data-group-id="2925492494-49">{</span><span class="n">ch_sup</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p" data-group-id="2925492494-49">}</span><span class="p" data-group-id="2925492494-48">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-50">{</span><span class="n">remove</span><span class="p">,</span><span class="p" data-group-id="2925492494-51">{</span><span class="n">ch3</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p" data-group-id="2925492494-51">}</span><span class="p" data-group-id="2925492494-50">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-52">{</span><span class="n">purge</span><span class="p">,</span><span class="p" data-group-id="2925492494-53">[</span><span class="n">ch_sup</span><span class="p">,</span><span class="n">ch3</span><span class="p" data-group-id="2925492494-53">]</span><span class="p" data-group-id="2925492494-52">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-54">{</span><span class="n">remove</span><span class="p">,</span><span class="p" data-group-id="2925492494-55">{</span><span class="n">prim_app</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p" data-group-id="2925492494-55">}</span><span class="p" data-group-id="2925492494-54">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-56">{</span><span class="n">remove</span><span class="p">,</span><span class="p" data-group-id="2925492494-57">{</span><span class="n">prim_sup</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p" data-group-id="2925492494-57">}</span><span class="p" data-group-id="2925492494-56">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-58">{</span><span class="n">purge</span><span class="p">,</span><span class="p" data-group-id="2925492494-59">[</span><span class="n">prim_app</span><span class="p">,</span><span class="n">prim_sup</span><span class="p" data-group-id="2925492494-59">]</span><span class="p" data-group-id="2925492494-58">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-60">{</span><span class="n">load</span><span class="p">,</span><span class="p" data-group-id="2925492494-61">{</span><span class="n">prim_app</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p" data-group-id="2925492494-61">}</span><span class="p" data-group-id="2925492494-60">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-62">{</span><span class="n">load</span><span class="p">,</span><span class="p" data-group-id="2925492494-63">{</span><span class="n">prim_sup</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p">,</span><span class="n">brutal_purge</span><span class="p" data-group-id="2925492494-63">}</span><span class="p" data-group-id="2925492494-62">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2925492494-64">{</span><span class="n">apply</span><span class="p">,</span><span class="p" data-group-id="2925492494-65">{</span><span class="n">application</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="p" data-group-id="2925492494-66">[</span><span class="n">prim_app</span><span class="p">,</span><span class="n">permanent</span><span class="p" data-group-id="2925492494-66">]</span><span class="p" data-group-id="2925492494-65">}</span><span class="p" data-group-id="2925492494-64">}</span><span class="p" data-group-id="2925492494-38">]</span><span class="p" data-group-id="2925492494-36">}</span><span class="p" data-group-id="2925492494-35">]</span><span class="w">
</span><span class="p" data-group-id="2925492494-1">}</span><span class="p">.</span></code></pre><h3 id="supervisor-change" class="section-heading">
  <a href="#supervisor-change" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Supervisor Change</span>
</h3>
<p><em>Step 4b)</em> Another way to start the included application (or stop it in the case
of downgrade) is by combining instructions for adding and removing child
processes to/from <code class="inline">prim_sup</code> with instructions for loading/unloading all
<code class="inline">ch_app</code> code and its application specification.</p><p>Again, the <code class="inline">relup</code> file is created manually. Either from scratch or by editing a
generated version. Load all code for <code class="inline">ch_app</code> first, and also load the
application specification, before <code class="inline">prim_sup</code> is updated. When downgrading,
<code class="inline">prim_sup</code> is to updated first, before the code for <code class="inline">ch_app</code> and its application
specification are unloaded.</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="1753991002-1">{</span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="1753991002-2">[</span><span class="p" data-group-id="1753991002-3">{</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="1753991002-4">[</span><span class="p" data-group-id="1753991002-4">]</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="1753991002-5">[</span><span class="p" data-group-id="1753991002-6">{</span><span class="ss">load_object_code</span><span class="p">,</span><span class="p" data-group-id="1753991002-7">{</span><span class="ss">ch_app</span><span class="p">,</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="p" data-group-id="1753991002-8">[</span><span class="ss">ch_sup</span><span class="p">,</span><span class="ss">ch3</span><span class="p" data-group-id="1753991002-8">]</span><span class="p" data-group-id="1753991002-7">}</span><span class="p" data-group-id="1753991002-6">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-9">{</span><span class="ss">load_object_code</span><span class="p">,</span><span class="p" data-group-id="1753991002-10">{</span><span class="ss">prim_app</span><span class="p">,</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="p" data-group-id="1753991002-11">[</span><span class="ss">prim_sup</span><span class="p" data-group-id="1753991002-11">]</span><span class="p" data-group-id="1753991002-10">}</span><span class="p" data-group-id="1753991002-9">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">point_of_no_return</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-12">{</span><span class="ss">load</span><span class="p">,</span><span class="p" data-group-id="1753991002-13">{</span><span class="ss">ch_sup</span><span class="p">,</span><span class="ss">brutal_purge</span><span class="p">,</span><span class="ss">brutal_purge</span><span class="p" data-group-id="1753991002-13">}</span><span class="p" data-group-id="1753991002-12">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-14">{</span><span class="ss">load</span><span class="p">,</span><span class="p" data-group-id="1753991002-15">{</span><span class="ss">ch3</span><span class="p">,</span><span class="ss">brutal_purge</span><span class="p">,</span><span class="ss">brutal_purge</span><span class="p" data-group-id="1753991002-15">}</span><span class="p" data-group-id="1753991002-14">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-16">{</span><span class="nb">apply</span><span class="p">,</span><span class="p" data-group-id="1753991002-17">{</span><span class="ss">application</span><span class="p">,</span><span class="ss">load</span><span class="p">,</span><span class="p" data-group-id="1753991002-18">[</span><span class="ss">ch_app</span><span class="p" data-group-id="1753991002-18">]</span><span class="p" data-group-id="1753991002-17">}</span><span class="p" data-group-id="1753991002-16">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-19">{</span><span class="ss">suspend</span><span class="p">,</span><span class="p" data-group-id="1753991002-20">[</span><span class="ss">prim_sup</span><span class="p" data-group-id="1753991002-20">]</span><span class="p" data-group-id="1753991002-19">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-21">{</span><span class="ss">load</span><span class="p">,</span><span class="p" data-group-id="1753991002-22">{</span><span class="ss">prim_sup</span><span class="p">,</span><span class="ss">brutal_purge</span><span class="p">,</span><span class="ss">brutal_purge</span><span class="p" data-group-id="1753991002-22">}</span><span class="p" data-group-id="1753991002-21">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-23">{</span><span class="ss">code_change</span><span class="p">,</span><span class="ss">up</span><span class="p">,</span><span class="p" data-group-id="1753991002-24">[</span><span class="p" data-group-id="1753991002-25">{</span><span class="ss">prim_sup</span><span class="p">,</span><span class="p" data-group-id="1753991002-26">[</span><span class="p" data-group-id="1753991002-26">]</span><span class="p" data-group-id="1753991002-25">}</span><span class="p" data-group-id="1753991002-24">]</span><span class="p" data-group-id="1753991002-23">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-27">{</span><span class="ss">resume</span><span class="p">,</span><span class="p" data-group-id="1753991002-28">[</span><span class="ss">prim_sup</span><span class="p" data-group-id="1753991002-28">]</span><span class="p" data-group-id="1753991002-27">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-29">{</span><span class="nb">apply</span><span class="p">,</span><span class="p" data-group-id="1753991002-30">{</span><span class="ss">supervisor</span><span class="p">,</span><span class="ss">restart_child</span><span class="p">,</span><span class="p" data-group-id="1753991002-31">[</span><span class="ss">prim_sup</span><span class="p">,</span><span class="ss">ch_sup</span><span class="p" data-group-id="1753991002-31">]</span><span class="p" data-group-id="1753991002-30">}</span><span class="p" data-group-id="1753991002-29">}</span><span class="p" data-group-id="1753991002-5">]</span><span class="p" data-group-id="1753991002-3">}</span><span class="p" data-group-id="1753991002-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="1753991002-32">[</span><span class="p" data-group-id="1753991002-33">{</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="1753991002-34">[</span><span class="p" data-group-id="1753991002-34">]</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="1753991002-35">[</span><span class="p" data-group-id="1753991002-36">{</span><span class="ss">load_object_code</span><span class="p">,</span><span class="p" data-group-id="1753991002-37">{</span><span class="ss">prim_app</span><span class="p">,</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="p" data-group-id="1753991002-38">[</span><span class="ss">prim_sup</span><span class="p" data-group-id="1753991002-38">]</span><span class="p" data-group-id="1753991002-37">}</span><span class="p" data-group-id="1753991002-36">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">point_of_no_return</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-39">{</span><span class="nb">apply</span><span class="p">,</span><span class="p" data-group-id="1753991002-40">{</span><span class="ss">supervisor</span><span class="p">,</span><span class="ss">terminate_child</span><span class="p">,</span><span class="p" data-group-id="1753991002-41">[</span><span class="ss">prim_sup</span><span class="p">,</span><span class="ss">ch_sup</span><span class="p" data-group-id="1753991002-41">]</span><span class="p" data-group-id="1753991002-40">}</span><span class="p" data-group-id="1753991002-39">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-42">{</span><span class="nb">apply</span><span class="p">,</span><span class="p" data-group-id="1753991002-43">{</span><span class="ss">supervisor</span><span class="p">,</span><span class="ss">delete_child</span><span class="p">,</span><span class="p" data-group-id="1753991002-44">[</span><span class="ss">prim_sup</span><span class="p">,</span><span class="ss">ch_sup</span><span class="p" data-group-id="1753991002-44">]</span><span class="p" data-group-id="1753991002-43">}</span><span class="p" data-group-id="1753991002-42">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-45">{</span><span class="ss">suspend</span><span class="p">,</span><span class="p" data-group-id="1753991002-46">[</span><span class="ss">prim_sup</span><span class="p" data-group-id="1753991002-46">]</span><span class="p" data-group-id="1753991002-45">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-47">{</span><span class="ss">load</span><span class="p">,</span><span class="p" data-group-id="1753991002-48">{</span><span class="ss">prim_sup</span><span class="p">,</span><span class="ss">brutal_purge</span><span class="p">,</span><span class="ss">brutal_purge</span><span class="p" data-group-id="1753991002-48">}</span><span class="p" data-group-id="1753991002-47">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-49">{</span><span class="ss">code_change</span><span class="p">,</span><span class="ss">down</span><span class="p">,</span><span class="p" data-group-id="1753991002-50">[</span><span class="p" data-group-id="1753991002-51">{</span><span class="ss">prim_sup</span><span class="p">,</span><span class="p" data-group-id="1753991002-52">[</span><span class="p" data-group-id="1753991002-52">]</span><span class="p" data-group-id="1753991002-51">}</span><span class="p" data-group-id="1753991002-50">]</span><span class="p" data-group-id="1753991002-49">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-53">{</span><span class="ss">resume</span><span class="p">,</span><span class="p" data-group-id="1753991002-54">[</span><span class="ss">prim_sup</span><span class="p" data-group-id="1753991002-54">]</span><span class="p" data-group-id="1753991002-53">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-55">{</span><span class="ss">remove</span><span class="p">,</span><span class="p" data-group-id="1753991002-56">{</span><span class="ss">ch_sup</span><span class="p">,</span><span class="ss">brutal_purge</span><span class="p">,</span><span class="ss">brutal_purge</span><span class="p" data-group-id="1753991002-56">}</span><span class="p" data-group-id="1753991002-55">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-57">{</span><span class="ss">remove</span><span class="p">,</span><span class="p" data-group-id="1753991002-58">{</span><span class="ss">ch3</span><span class="p">,</span><span class="ss">brutal_purge</span><span class="p">,</span><span class="ss">brutal_purge</span><span class="p" data-group-id="1753991002-58">}</span><span class="p" data-group-id="1753991002-57">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-59">{</span><span class="ss">purge</span><span class="p">,</span><span class="p" data-group-id="1753991002-60">[</span><span class="ss">ch_sup</span><span class="p">,</span><span class="ss">ch3</span><span class="p" data-group-id="1753991002-60">]</span><span class="p" data-group-id="1753991002-59">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1753991002-61">{</span><span class="nb">apply</span><span class="p">,</span><span class="p" data-group-id="1753991002-62">{</span><span class="ss">application</span><span class="p">,</span><span class="ss">unload</span><span class="p">,</span><span class="p" data-group-id="1753991002-63">[</span><span class="ss">ch_app</span><span class="p" data-group-id="1753991002-63">]</span><span class="p" data-group-id="1753991002-62">}</span><span class="p" data-group-id="1753991002-61">}</span><span class="p" data-group-id="1753991002-35">]</span><span class="p" data-group-id="1753991002-33">}</span><span class="p" data-group-id="1753991002-32">]</span><span class="w">
</span><span class="p" data-group-id="1753991002-1">}</span><span class="p">.</span></code></pre><h2 id="changing-non-erlang-code" class="section-heading">
  <a href="#changing-non-erlang-code" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Changing Non-Erlang Code</span>
</h2>
<p>Changing code for a program written in another programming language than Erlang,
for example, a port program, is application-dependent and OTP provides no
special support for it.</p><p><em>Example:</em> When changing code for a port program, assume that the Erlang process
controlling the port is a <code class="inline">gen_server</code> <code class="inline">portc</code> and that the port is opened in
the callback function <code class="inline">init/1</code>:</p><pre><code class="makeup erlang" translate="no"><span class="nf">init</span><span class="p" data-group-id="7381724131-1">(</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="7381724131-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">,</span><span class="w">
    </span><span class="n">PortPrg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">filename</span><span class="p">:</span><span class="nf">join</span><span class="p" data-group-id="7381724131-2">(</span><span class="nc">code</span><span class="p">:</span><span class="nf">priv_dir</span><span class="p" data-group-id="7381724131-3">(</span><span class="n">App</span><span class="p" data-group-id="7381724131-3">)</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;portc&quot;</span><span class="p" data-group-id="7381724131-2">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">open_port</span><span class="p" data-group-id="7381724131-4">(</span><span class="p" data-group-id="7381724131-5">{</span><span class="nb">spawn</span><span class="p">,</span><span class="n">PortPrg</span><span class="p" data-group-id="7381724131-5">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7381724131-6">[</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="7381724131-6">]</span><span class="p" data-group-id="7381724131-4">)</span><span class="p">,</span><span class="w">
    </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7381724131-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">state</span><span class="p" data-group-id="7381724131-8">{</span><span class="ss">port</span><span class="o">=</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="7381724131-8">}</span><span class="p" data-group-id="7381724131-7">}</span><span class="p">.</span></code></pre><p>If the port program is to be updated, the code for the <code class="inline">gen_server</code> can be
extended with a <code class="inline">code_change</code> function, which closes the old port and opens a
new port. (If necessary, the <code class="inline">gen_server</code> can first request data that must be
saved from the port program and pass this data to the new port):</p><pre><code class="makeup erlang" translate="no"><span class="nf">code_change</span><span class="p" data-group-id="8416584384-1">(</span><span class="p">_</span><span class="n">OldVsn</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p">,</span><span class="w"> </span><span class="ss">port</span><span class="p" data-group-id="8416584384-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">State</span><span class="o">#</span><span class="ss">state</span><span class="p">.</span><span class="ss">port</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="ss">close</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="8416584384-2">{</span><span class="n">Port</span><span class="p">,</span><span class="ss">close</span><span class="p" data-group-id="8416584384-2">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">true</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="n">PortPrg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">filename</span><span class="p">:</span><span class="nf">join</span><span class="p" data-group-id="8416584384-3">(</span><span class="nc">code</span><span class="p">:</span><span class="nf">priv_dir</span><span class="p" data-group-id="8416584384-4">(</span><span class="n">App</span><span class="p" data-group-id="8416584384-4">)</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;portc&quot;</span><span class="p" data-group-id="8416584384-3">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">open_port</span><span class="p" data-group-id="8416584384-5">(</span><span class="p" data-group-id="8416584384-6">{</span><span class="nb">spawn</span><span class="p">,</span><span class="n">PortPrg</span><span class="p" data-group-id="8416584384-6">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8416584384-7">[</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="8416584384-7">]</span><span class="p" data-group-id="8416584384-5">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8416584384-8">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">state</span><span class="p" data-group-id="8416584384-9">{</span><span class="ss">port</span><span class="o">=</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="8416584384-9">}</span><span class="p" data-group-id="8416584384-8">}</span><span class="p">.</span></code></pre><p>Update the application version number in the <code class="inline">.app</code> file and write an <code class="inline">.appup</code>
file:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="0794060073-1">[</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="0794060073-2">[</span><span class="p" data-group-id="0794060073-3">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0794060073-4">[</span><span class="p" data-group-id="0794060073-5">{</span><span class="ss">update</span><span class="p">,</span><span class="w"> </span><span class="ss">portc</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0794060073-6">{</span><span class="ss">advanced</span><span class="p">,</span><span class="ss">port</span><span class="p" data-group-id="0794060073-6">}</span><span class="p" data-group-id="0794060073-5">}</span><span class="p" data-group-id="0794060073-4">]</span><span class="p" data-group-id="0794060073-3">}</span><span class="p" data-group-id="0794060073-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="0794060073-7">[</span><span class="p" data-group-id="0794060073-8">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0794060073-9">[</span><span class="p" data-group-id="0794060073-10">{</span><span class="ss">update</span><span class="p">,</span><span class="w"> </span><span class="ss">portc</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0794060073-11">{</span><span class="ss">advanced</span><span class="p">,</span><span class="ss">port</span><span class="p" data-group-id="0794060073-11">}</span><span class="p" data-group-id="0794060073-10">}</span><span class="p" data-group-id="0794060073-9">]</span><span class="p" data-group-id="0794060073-8">}</span><span class="p" data-group-id="0794060073-7">]</span><span class="w">
</span><span class="p" data-group-id="0794060073-1">]</span><span class="p">.</span></code></pre><p>Ensure that the <code class="inline">priv</code> directory, where the C program is located, is included in
the new release package:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">systools</span><span class="p">:</span><span class="nf">make_tar</span><span class="p" data-group-id="6020520753-1">(</span><span class="s">&quot;my_release&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6020520753-2">[</span><span class="p" data-group-id="6020520753-3">{</span><span class="ss">dirs</span><span class="p">,</span><span class="p" data-group-id="6020520753-4">[</span><span class="ss">priv</span><span class="p" data-group-id="6020520753-4">]</span><span class="p" data-group-id="6020520753-3">}</span><span class="p" data-group-id="6020520753-2">]</span><span class="p" data-group-id="6020520753-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">.</span><span class="p">.</span><span class="p">.</span></code></pre><h2 id="emulator-restart-and-upgrade" class="section-heading">
  <a href="#emulator-restart-and-upgrade" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Emulator Restart and Upgrade</span>
</h2>
<p>Two upgrade instructions restart the emulator:</p><ul><li><p><code class="inline">restart_new_emulator</code></p><p>Intended when ERTS, Kernel, STDLIB, or SASL is upgraded. It is automatically
added when the <code class="inline">relup</code> file is generated by <code class="inline">systools:make_relup/3,4</code>. It is
executed before all other upgrade instructions. For more information about
this instruction, see restart_new_emulator (Low-Level) in
<a href="release_handling.html#restart_new_emulator_instr">Release Handling Instructions</a>.</p></li><li><p><code class="inline">restart_emulator</code></p><p>Used when a restart of the emulator is required after all other upgrade
instructions are executed. For more information about this instruction, see
restart_emulator (Low-Level) in
<a href="release_handling.html#restart_emulator_instr">Release Handling Instructions</a>.</p></li></ul><p>If an emulator restart is necessary and no upgrade instructions are needed, that
is, if the restart itself is enough for the upgraded applications to start
running the new versions, a simple <code class="inline">relup</code> file can be created manually:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="4028609580-1">{</span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="4028609580-2">[</span><span class="p" data-group-id="4028609580-3">{</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="4028609580-4">[</span><span class="p" data-group-id="4028609580-4">]</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="4028609580-5">[</span><span class="ss">restart_emulator</span><span class="p" data-group-id="4028609580-5">]</span><span class="p" data-group-id="4028609580-3">}</span><span class="p" data-group-id="4028609580-2">]</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="4028609580-6">[</span><span class="p" data-group-id="4028609580-7">{</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="4028609580-8">[</span><span class="p" data-group-id="4028609580-8">]</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="4028609580-9">[</span><span class="ss">restart_emulator</span><span class="p" data-group-id="4028609580-9">]</span><span class="p" data-group-id="4028609580-7">}</span><span class="p" data-group-id="4028609580-6">]</span><span class="w">
</span><span class="p" data-group-id="4028609580-1">}</span><span class="p">.</span></code></pre><p>In this case, the release handler framework with automatic packing and unpacking
of release packages, automatic path updates, and so on, can be used without
having to specify <code class="inline">.appup</code> files.</p><h2 id="emulator-upgrade-from-pre-otp-r15" class="section-heading">
  <a href="#emulator-upgrade-from-pre-otp-r15" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Emulator Upgrade From Pre OTP R15</span>
</h2>
<p>From OTP R15, an emulator upgrade is performed by restarting the emulator with
new versions of the core applications (Kernel, STDLIB, and SASL) before loading
code and running upgrade instruction for other applications. For this to work,
the release to upgrade from must include OTP R15 or later.</p><p>For the case where the release to upgrade from includes an earlier emulator
version, <code class="inline">systools:make_relup</code> creates a backwards compatible relup file. This
means that all upgrade instructions are executed before the emulator is
restarted. The new application code is therefore loaded into the old emulator.
If the new code is compiled with the new emulator, there can be cases where the
beam format has changed and beam files cannot be loaded. To overcome this
problem, compile the new code with the old emulator.</p>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="release_handling.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Release Handling
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="programming_examples.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Introduction
        </span>
      </a>

  </div>
</div>
      <footer class="footer">
        <p>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

              <a href="Erlang System Documentation.epub" title="ePub version">
                Download ePub version
              </a>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.31.2) for the

            <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

        </p>
<p>Copyright © 1996-2023 <a href="https://www.ericsson.com">Ericsson AB</a></p>
      </footer>
    </div>
  </div>
</main>
</div>


  </body>
</html>
